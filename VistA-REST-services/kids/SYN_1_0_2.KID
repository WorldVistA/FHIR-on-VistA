KIDS Distribution saved on May 09, 2019@14:38:47
OSEHRA build 05-09-2019
**KIDS**:SYN*1.0*2^

**INSTALL NAME**
SYN*1.0*2
"BLD",9713,0)
SYN*1.0*2^^0^3190509^n
"BLD",9713,1,0)
^^3^3^3190430^^
"BLD",9713,1,1,0)
HealthConcourse open source VistA REST Services for FHIR-on-VistA.
"BLD",9713,1,2,0)
 
"BLD",9713,1,3,0)
https://github.com/OSEHRA/FHIR-on-VistA
"BLD",9713,4,0)
^9.64PA^2002.1^3
"BLD",9713,4,996.5,0)
996.5
"BLD",9713,4,996.5,222)
y^y^f^^n^^y^o^n
"BLD",9713,4,996.52,0)
996.52
"BLD",9713,4,996.52,222)
y^y^f^^n^^y^o^n
"BLD",9713,4,2002.1,0)
2002.1
"BLD",9713,4,2002.1,222)
y^y^f^^n^^y^o^n
"BLD",9713,4,"B",996.5,996.5)

"BLD",9713,4,"B",996.52,996.52)

"BLD",9713,4,"B",2002.1,2002.1)

"BLD",9713,6.3)
49
"BLD",9713,"INI")
EN^SYNPRE1
"BLD",9713,"INID")
^n^n
"BLD",9713,"INIT")
EN^SYNGBLLD
"BLD",9713,"KRN",0)
^9.67PA^779.2^20
"BLD",9713,"KRN",.4,0)
.4
"BLD",9713,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",9713,"KRN",.401,0)
.401
"BLD",9713,"KRN",.402,0)
.402
"BLD",9713,"KRN",.403,0)
.403
"BLD",9713,"KRN",.5,0)
.5
"BLD",9713,"KRN",.84,0)
.84
"BLD",9713,"KRN",3.6,0)
3.6
"BLD",9713,"KRN",3.8,0)
3.8
"BLD",9713,"KRN",9.2,0)
9.2
"BLD",9713,"KRN",9.8,0)
9.8
"BLD",9713,"KRN",9.8,"NM",0)
^9.68A^118^60
"BLD",9713,"KRN",9.8,"NM",1,0)
SYNDHP43^^0^B11341406
"BLD",9713,"KRN",9.8,"NM",2,0)
SYNDHP47^^0^B42834722
"BLD",9713,"KRN",9.8,"NM",3,0)
SYNDHP48^^0^B113334144
"BLD",9713,"KRN",9.8,"NM",4,0)
SYNDHP53^^0^B22563892
"BLD",9713,"KRN",9.8,"NM",5,0)
SYNDHP54^^0^B25313993
"BLD",9713,"KRN",9.8,"NM",6,0)
SYNDHP55^^0^B170944201
"BLD",9713,"KRN",9.8,"NM",7,0)
SYNDHP57^^0^B81356532
"BLD",9713,"KRN",9.8,"NM",8,0)
SYNDHP61^^0^B175435602
"BLD",9713,"KRN",9.8,"NM",9,0)
SYNDHP62^^0^B308344743
"BLD",9713,"KRN",9.8,"NM",10,0)
SYNDHP63^^0^B12371395
"BLD",9713,"KRN",9.8,"NM",11,0)
SYNDHP64^^0^B1748603
"BLD",9713,"KRN",9.8,"NM",12,0)
SYNDHP67^^0^B17235437
"BLD",9713,"KRN",9.8,"NM",13,0)
SYNDHP69^^0^B4950282
"BLD",9713,"KRN",9.8,"NM",14,0)
SYNDHP73^^0^B176773227
"BLD",9713,"KRN",9.8,"NM",15,0)
SYNDHP79^^0^B29692023
"BLD",9713,"KRN",9.8,"NM",16,0)
SYNDHP83^^0^B347144
"BLD",9713,"KRN",9.8,"NM",17,0)
SYNDHP89^^0^B401561
"BLD",9713,"KRN",9.8,"NM",20,0)
SYNDHPMP^^0^B33584325
"BLD",9713,"KRN",9.8,"NM",49,0)
SYNDHP56^^0^B92343991
"BLD",9713,"KRN",9.8,"NM",50,0)
SYNGBLLD^^0^B144653085
"BLD",9713,"KRN",9.8,"NM",51,0)
SYNDHP65^^0^B5073143
"BLD",9713,"KRN",9.8,"NM",67,0)
SYNDHP58^^0^B22472959
"BLD",9713,"KRN",9.8,"NM",68,0)
SYNDHP59^^0^B60059790
"BLD",9713,"KRN",9.8,"NM",72,0)
SYNDHP91^^0^B40944851
"BLD",9713,"KRN",9.8,"NM",74,0)
SYNDHPUTL^^0^B31232465
"BLD",9713,"KRN",9.8,"NM",82,0)
SYNDHP92^^0^B9874705
"BLD",9713,"KRN",9.8,"NM",84,0)
SYNDHP99^^0^B15985554
"BLD",9713,"KRN",9.8,"NM",85,0)
SYNDHP10^^0^B79393775
"BLD",9713,"KRN",9.8,"NM",86,0)
SYNDHP11^^0^B65286288
"BLD",9713,"KRN",9.8,"NM",87,0)
SYNDHP12^^0^B125196184
"BLD",9713,"KRN",9.8,"NM",88,0)
SYNDHP13^^0^B130398518
"BLD",9713,"KRN",9.8,"NM",89,0)
SYNDHP14^^0^B68521679
"BLD",9713,"KRN",9.8,"NM",90,0)
SYNDHP15^^0^B159077808
"BLD",9713,"KRN",9.8,"NM",91,0)
SYNDHP16^^0^B128773413
"BLD",9713,"KRN",9.8,"NM",92,0)
SYNDHP17^^0^B47657021
"BLD",9713,"KRN",9.8,"NM",93,0)
SYNDHP18^^0^B118565363
"BLD",9713,"KRN",9.8,"NM",94,0)
SYNDHP19^^0^B43797002
"BLD",9713,"KRN",9.8,"NM",95,0)
SYNDHP20^^0^B137306202
"BLD",9713,"KRN",9.8,"NM",96,0)
SYNDHP01^^0^B22388996
"BLD",9713,"KRN",9.8,"NM",97,0)
SYNDHP02^^0^B18905167
"BLD",9713,"KRN",9.8,"NM",98,0)
SYNDHP06^^0^B14159682
"BLD",9713,"KRN",9.8,"NM",99,0)
SYNDHP07^^0^B20083819
"BLD",9713,"KRN",9.8,"NM",100,0)
SYNDHP08^^0^B14232287
"BLD",9713,"KRN",9.8,"NM",101,0)
SYNDHP09^^0^B50112432
"BLD",9713,"KRN",9.8,"NM",102,0)
SYNDHP03^^0^B23655386
"BLD",9713,"KRN",9.8,"NM",103,0)
SYNDHP04^^0^B11868381
"BLD",9713,"KRN",9.8,"NM",104,0)
SYNDHP05^^0^B117668361
"BLD",9713,"KRN",9.8,"NM",105,0)
SYNDHP21^^0^B55720482
"BLD",9713,"KRN",9.8,"NM",106,0)
SYNDHP40^^0^B22154311
"BLD",9713,"KRN",9.8,"NM",107,0)
SYNDHP41^^0^B11397025
"BLD",9713,"KRN",9.8,"NM",109,0)
SYNDHP22^^0^B41410082
"BLD",9713,"KRN",9.8,"NM",110,0)
SYNDHP23^^0^B15447210
"BLD",9713,"KRN",9.8,"NM",111,0)
SYNDTS89^^0^B37105881
"BLD",9713,"KRN",9.8,"NM",112,0)
SYNDHPIC^^0^B2165360
"BLD",9713,"KRN",9.8,"NM",113,0)
SYNTSTRS^^0^B143102652
"BLD",9713,"KRN",9.8,"NM",114,0)
SYNDHPTS1^^0^B11127832
"BLD",9713,"KRN",9.8,"NM",115,0)
SYNRGSHM^^0^B9573519
"BLD",9713,"KRN",9.8,"NM",116,0)
SYNTSTAPI^^0^B11160876
"BLD",9713,"KRN",9.8,"NM",117,0)
SYNDHP24^^0^B129210012
"BLD",9713,"KRN",9.8,"NM",118,0)
SYNDHP25^^0^B68600664
"BLD",9713,"KRN",9.8,"NM","B","SYNDHP01",96)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP02",97)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP03",102)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP04",103)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP05",104)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP06",98)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP07",99)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP08",100)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP09",101)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP10",85)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP11",86)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP12",87)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP13",88)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP14",89)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP15",90)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP16",91)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP17",92)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP18",93)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP19",94)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP20",95)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP21",105)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP22",109)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP23",110)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP24",117)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP25",118)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP40",106)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP41",107)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP43",1)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP47",2)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP48",3)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP53",4)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP54",5)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP55",6)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP56",49)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP57",7)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP58",67)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP59",68)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP61",8)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP62",9)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP63",10)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP64",11)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP65",51)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP67",12)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP69",13)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP73",14)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP79",15)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP83",16)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP89",17)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP91",72)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP92",82)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHP99",84)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHPIC",112)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHPMP",20)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHPTS1",114)

"BLD",9713,"KRN",9.8,"NM","B","SYNDHPUTL",74)

"BLD",9713,"KRN",9.8,"NM","B","SYNDTS89",111)

"BLD",9713,"KRN",9.8,"NM","B","SYNGBLLD",50)

"BLD",9713,"KRN",9.8,"NM","B","SYNRGSHM",115)

"BLD",9713,"KRN",9.8,"NM","B","SYNTSTAPI",116)

"BLD",9713,"KRN",9.8,"NM","B","SYNTSTRS",113)

"BLD",9713,"KRN",19,0)
19
"BLD",9713,"KRN",19,"NM",0)
^9.68A^^
"BLD",9713,"KRN",19.1,0)
19.1
"BLD",9713,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",9713,"KRN",101,0)
101
"BLD",9713,"KRN",101,"NM",0)
^9.68A^^
"BLD",9713,"KRN",409.61,0)
409.61
"BLD",9713,"KRN",771,0)
771
"BLD",9713,"KRN",779.2,0)
779.2
"BLD",9713,"KRN",870,0)
870
"BLD",9713,"KRN",8989.51,0)
8989.51
"BLD",9713,"KRN",8989.52,0)
8989.52
"BLD",9713,"KRN",8994,0)
8994
"BLD",9713,"KRN","B",.4,.4)

"BLD",9713,"KRN","B",.401,.401)

"BLD",9713,"KRN","B",.402,.402)

"BLD",9713,"KRN","B",.403,.403)

"BLD",9713,"KRN","B",.5,.5)

"BLD",9713,"KRN","B",.84,.84)

"BLD",9713,"KRN","B",3.6,3.6)

"BLD",9713,"KRN","B",3.8,3.8)

"BLD",9713,"KRN","B",9.2,9.2)

"BLD",9713,"KRN","B",9.8,9.8)

"BLD",9713,"KRN","B",19,19)

"BLD",9713,"KRN","B",19.1,19.1)

"BLD",9713,"KRN","B",101,101)

"BLD",9713,"KRN","B",409.61,409.61)

"BLD",9713,"KRN","B",771,771)

"BLD",9713,"KRN","B",779.2,779.2)

"BLD",9713,"KRN","B",870,870)

"BLD",9713,"KRN","B",8989.51,8989.51)

"BLD",9713,"KRN","B",8989.52,8989.52)

"BLD",9713,"KRN","B",8994,8994)

"BLD",9713,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9713,"QUES",0)
^9.62^^
"BLD",9713,"REQB",0)
^9.611^^
"DATA",996.5,1,0)
HTTP ENDPOINT^8001^VEHU^0
"DATA",996.5,1,10)
NETSERV^RGNETWWW
"DATA",996.52,1,0)
CWF/*^GET
"DATA",996.52,1,10)
MGET^RGSER
"DATA",996.52,2,0)
DSTU#/*^GET^BASIC
"DATA",996.52,2,10)
MGET^RGSER
"DATA",996.52,3,0)
QVXTM/*^GET
"DATA",996.52,3,10)
PATVAL^SYNDHP73
"DATA",996.52,4,0)
oauth2/authorize^GET
"DATA",996.52,4,10)
MGET^RGNETOAA
"DATA",996.52,5,0)
oauth2/token^POST
"DATA",996.52,5,10)
MPOST^RGNETOAT
"DATA",996.52,6,0)
/^GET
"DATA",996.52,6,10)
GREETING^RGNETWWW
"DATA",996.52,6,99,0)
^996.52099^1^1^3150330.181114
"DATA",996.52,6,99,1,0)
This is the root endpoint for this service.
"DATA",996.52,7,0)
UTILITY/RTN^GET^BASIC
"DATA",996.52,7,10)
RTN^RGNETWRR
"DATA",996.52,8,0)
UTILITY/RPC^GET^BASIC
"DATA",996.52,8,10)
RPC^RGNETWRR
"DATA",996.52,9,0)
QVXTM/QVXTM^GET
"DATA",996.52,9,10)
PATVAL^SYNDHP73
"DATA",996.52,11,0)
DHPPATDEM/*^GET
"DATA",996.52,11,10)
PATDEM^SYNDHP73
"DATA",996.52,12,0)
DHPPATCON/*^GET
"DATA",996.52,12,10)
PATCON^SYNDHP73
"DATA",996.52,16,0)
DHPPATVIT/*^GET
"DATA",996.52,16,10)
PATVIT^SYNDHP73
"DATA",996.52,22,0)
DHPPATPRC/*^GET
"DATA",996.52,22,10)
PATPRC^SYNDHP73
"DATA",996.52,25,0)
DHPPATLAB^GET
"DATA",996.52,25,10)
PATLAB^SYNDHP73
"DATA",996.52,26,0)
DHPPATLABICN^GET
"DATA",996.52,26,10)
PATLABI^SYNDHP73
"DATA",996.52,26,99,0)
^^1^1^3190403^
"DATA",996.52,26,99,1,0)
Get patient laboratory tests
"DATA",996.52,27,0)
DHPPATPRVICN^GET
"DATA",996.52,27,10)
PATPRVI^SYNDHP73
"DATA",996.52,27,99,0)
^^1^1^3190403^
"DATA",996.52,27,99,1,0)
Get patient providers
"DATA",996.52,28,0)
DHPHLOCINSTHLOCNAM^GET
"DATA",996.52,28,10)
HLOCINST^SYNDHP73
"DATA",996.52,28,99,0)
^^1^1^3190403^
"DATA",996.52,28,99,1,0)
Get hospital location information
"DATA",996.52,29,0)
DHPPATAPTICN^GET
"DATA",996.52,29,10)
PATAPTI^SYNDHP73
"DATA",996.52,29,99,0)
^^1^1^3190403^
"DATA",996.52,29,99,1,0)
Get patient appointments
"DATA",996.52,30,0)
DHPPATFLGICN^GET
"DATA",996.52,30,10)
PATFLGI^SYNDHP73
"DATA",996.52,30,99,0)
^^1^1^3190403^
"DATA",996.52,30,99,1,0)
Get patient flags
"DATA",996.52,33,0)
DHPPATIMMICN^GET
"DATA",996.52,33,10)
PATIMMI^SYNDHP73
"DATA",996.52,33,99,0)
^^1^1^3190403^
"DATA",996.52,33,99,1,0)
Get patient immunizations
"DATA",996.52,35,0)
DHPPATGOLICN^GET
"DATA",996.52,35,10)
PATGOLI^SYNDHP73
"DATA",996.52,35,99,0)
^^1^1^3190403^
"DATA",996.52,35,99,1,0)
Get patient nursing care plans
"DATA",996.52,40,0)
DHPPATHLF^GET
"DATA",996.52,40,10)
PATHLF^SYNDHP73
"DATA",996.52,41,0)
DHPPATHLFINC^GET
"DATA",996.52,41,10)
PATHLFI^SYNDHP73
"DATA",996.52,41,99,0)
^^1^1^3190403^
"DATA",996.52,41,99,1,0)
Get patient health factors
"DATA",996.52,42,0)
DHPPATHLFICN^GET
"DATA",996.52,42,10)
PATHLFI^SYNDHP73
"DATA",996.52,42,99,0)
^^1^1^3190403^
"DATA",996.52,42,99,1,0)
Get patient health factors
"DATA",996.52,43,0)
DHPMAPSVC^GET
"DATA",996.52,43,10)
MAPSVC^SYNDHP73
"DATA",996.52,43,99,0)
^^1^1^3190403^
"DATA",996.52,43,99,1,0)
Terminology mapping service
"DATA",996.52,44,0)
DHPPATTIUICN^GET
"DATA",996.52,44,10)
PATTIUI^SYNDHP73
"DATA",996.52,44,99,0)
^^1^1^3190403^
"DATA",996.52,44,99,1,0)
Get patient notes
"DATA",996.52,45,0)
SYNGLOBAL^GET
"DATA",996.52,45,10)
wsGLOBAL^SYNVPR
"DATA",996.52,46,0)
SYNLOADSTAT^GET
"DATA",996.52,47,0)
DHPPATOBS^GET
"DATA",996.52,47,10)
PATOBS^SYNDHP73
"DATA",996.52,48,0)
DHPPATOBSICN^GET
"DATA",996.52,48,10)
PATOBSI^SYNDHP73
"DATA",996.52,48,99,0)
^^1^1^3190403^
"DATA",996.52,48,99,1,0)
Get patient observations
"DATA",996.52,49,0)
DHPCARETEAM^GET
"DATA",996.52,49,10)
CARETEAM^SYNDHP73
"DATA",996.52,49,99,0)
^^1^1^3190403^
"DATA",996.52,49,99,1,0)
Get one care team
"DATA",996.52,50,0)
DHPCARETEAMS^GET
"DATA",996.52,50,10)
CARETEAMS^SYNDHP73
"DATA",996.52,50,99,0)
^^1^1^3190403^
"DATA",996.52,50,99,1,0)
Get all care teams
"DATA",996.52,51,0)
DHPPATCP^GET
"DATA",996.52,51,10)
PATCP^SYNDHP73
"DATA",996.52,52,0)
DHPPATCPI^GET
"DATA",996.52,52,10)
PATCPI^SYNDHP73
"DATA",996.52,52,99,0)
^^1^1^3190403^
"DATA",996.52,52,99,1,0)
Get patient care plan(s) for a visit
"DATA",996.52,53,0)
DHPPATCPALL^GET
"DATA",996.52,53,10)
PATCPALL^SYNDHP73
"DATA",996.52,54,0)
DHPPATCPALLI^GET
"DATA",996.52,54,10)
PATCPALLI^SYNDHP73
"DATA",996.52,54,99,0)
^^1^1^3190403^
"DATA",996.52,54,99,1,0)
Get patient care plans
"DATA",996.52,55,0)
DHPPATIMMUPD^POST
"DATA",996.52,55,10)
PATIMUSV^SYNDHP79
"DATA",996.52,55,99,0)
^^1^1^3181130^
"DATA",996.52,55,99,1,0)
Update patient immunizations
"DATA",996.52,56,0)
DHPPATAPTCRE^POST
"DATA",996.52,56,10)
PATAPTCR^SYNDHP79
"DATA",996.52,56,99,0)
^^1^1^3181130^
"DATA",996.52,56,99,1,0)
Create patient appointment
"DATA",996.52,57,0)
DHPPATAPTCI^POST
"DATA",996.52,57,10)
PATAPTCI^SYNDHP79
"DATA",996.52,57,99,0)
^^1^1^3181130^
"DATA",996.52,57,99,1,0)
Check-in patient appointment
"DATA",996.52,58,0)
DHPPATLABUPD^POST
"DATA",996.52,58,10)
PATLABSV^SYNDHP79
"DATA",996.52,58,99,0)
^^1^1^3181130^
"DATA",996.52,58,99,1,0)
Update patient lab results
"DATA",996.52,59,0)
DHPSYSFACUPD^POST
"DATA",996.52,59,10)
SYSFAC^SYNDHP79
"DATA",996.52,60,0)
DHPSYSFACGET^GET
"DATA",996.52,60,10)
SYSFAC^SYNDHP73
"DATA",996.52,61,0)
DHPGETRESID^GET
"DATA",996.52,61,10)
GETRESID^SYNDHP73
"DATA",996.52,61,99,0)
^996.52099^1^1^3190207^^
"DATA",996.52,61,99,1,0)
Get the VistA record for a resource ID
"DATA",996.52,62,0)
DHPVPRLOGRST^GET
"DATA",996.52,62,10)
LOGRST^SYNDHP73
"DATA",996.52,63,0)
DHPPATVAL^GET
"DATA",996.52,63,10)
PATVAL^SYNDHP73
"DATA",996.52,63,99,0)
^^1^1^3190403^
"DATA",996.52,63,99,1,0)
Validate a patient and return ICN
"DATA",996.52,64,0)
DHPPATCONICN^GET
"DATA",996.52,64,10)
PATCONI^SYNDHP73
"DATA",996.52,64,99,0)
^^1^1^3190403^
"DATA",996.52,64,99,1,0)
Get patient conditions/problems
"DATA",996.52,65,0)
DHPPATDEMICN^GET
"DATA",996.52,65,10)
PATDEMI^SYNDHP73
"DATA",996.52,65,99,0)
^^1^1^3190403^
"DATA",996.52,65,99,1,0)
Get patient demographics
"DATA",996.52,66,0)
DHPPATS4CON^GET
"DATA",996.52,66,10)
PATCONAL^SYNDHP73
"DATA",996.52,66,99,0)
^^1^1^3190403^
"DATA",996.52,66,99,1,0)
Get patients with a condition/problem
"DATA",996.52,67,0)
DHPPATVITICN^GET
"DATA",996.52,67,10)
PATVITI^SYNDHP73
"DATA",996.52,67,99,0)
^^1^1^3190403^
"DATA",996.52,67,99,1,0)
Get patient vitals
"DATA",996.52,68,0)
DHPPATENCICN^GET
"DATA",996.52,68,10)
PATENCI^SYNDHP73
"DATA",996.52,68,99,0)
^^1^1^3190403^
"DATA",996.52,68,99,1,0)
Get patient encounters
"DATA",996.52,69,0)
DHPPATMEDSICN^GET
"DATA",996.52,69,10)
PATMEDS^SYNDHP73
"DATA",996.52,69,99,0)
^^1^1^3190403^
"DATA",996.52,69,99,1,0)
Get patient medication statement
"DATA",996.52,70,0)
DHPPATMEDDICN^GET
"DATA",996.52,70,10)
PATMEDD^SYNDHP73
"DATA",996.52,70,99,0)
^^1^1^3190403^
"DATA",996.52,70,99,1,0)
Get patient medication dispensed
"DATA",996.52,71,0)
DHPPATMEDAICN^GET
"DATA",996.52,71,10)
PATMEDA^SYNDHP73
"DATA",996.52,71,99,0)
^^1^1^3190403^
"DATA",996.52,71,99,1,0)
Get patient medication administration
"DATA",996.52,72,0)
DHPPATPRCICN^GET
"DATA",996.52,72,10)
PATPRCI^SYNDHP73
"DATA",996.52,72,99,0)
^^1^1^3190403^
"DATA",996.52,72,99,1,0)
Get patient procedures
"DATA",996.52,73,0)
DHPPATVITUPD^POST
"DATA",996.52,73,10)
PATVITSV^SYNDHP79
"DATA",996.52,73,99,0)
^996.52099^1^1^3190403^^
"DATA",996.52,73,99,1,0)
Update patient vitals
"DATA",996.52,74,0)
DHPPATDEMALL^GET
"DATA",996.52,74,10)
PATDEMAL^SYNDHP73
"DATA",996.52,74,99,0)
^^1^1^3190403^
"DATA",996.52,74,99,1,0)
Get all patients' demographics
"DATA",996.52,75,0)
DHPPATALLICN^GET
"DATA",996.52,75,10)
PATALLI^SYNDHP73
"DATA",996.52,75,99,0)
^^1^1^3190403^
"DATA",996.52,75,99,1,0)
Get patient allergies
"DATA",996.52,76,0)
DHPPATVITPST^POST
"DATA",996.52,76,10)
PATVITSV^SYNDHP79
"DATA",996.52,76,99,0)
^^1^1^3190403^
"DATA",996.52,76,99,1,0)
Update patient vitals
"DATA",996.52,77,0)
DHPPATPRBUPD^POST
"DATA",996.52,77,10)
PATPRBSV^SYNDHP79
"DATA",996.52,77,99,0)
^^1^1^3190403^
"DATA",996.52,77,99,1,0)
Update patient conditions/problems
"DATA",996.52,78,0)
DHPPATDEMUPD^POST
"DATA",996.52,78,10)
PATDEMSV^SYNDHP79
"DATA",996.52,78,99,0)
^^1^1^3190403^
"DATA",996.52,78,99,1,0)
Update patient demographics
"DATA",996.52,79,0)
DHPPATDXRICN^GET
"DATA",996.52,79,10)
PATDXREP^SYNDHP73
"DATA",996.52,79,99,0)
^^1^1^3190403^
"DATA",996.52,79,99,1,0)
Get patient diagnostic reports
"DATA",996.52,80,0)
DHPPATDEMRNG^GET
"DATA",996.52,80,10)
PATDEMRG^SYNDHP73
"DATA",996.52,80,99,0)
^^1^1^3190403^
"DATA",996.52,80,99,1,0)
Get range of patients' demographics
"DATA",996.52,81,0)
ZZATTESTLAB^GET
"DATA",996.52,81,10)
PATLABS^ZZATLABS
"DATA",996.52,82,0)
DHPPATICNALL^GET
"DATA",996.52,82,10)
PATICNS^SYNDHP73
"DATA",996.52,82,99,0)
^^1^1^3190403^
"DATA",996.52,82,99,1,0)
Get ICNs for all patients
"DATA",2002.1,1,0)
http://localhost:8001/DHPPATALLICN^F
"DATA",2002.1,2,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V153702^F
"DATA",2002.1,3,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V183702^P
"DATA",2002.1,4,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V183702&FRDAT=20060101&TODAT=20050101^F
"DATA",2002.1,5,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V183702&FRDAT=20000101&TODAT=20050101^P
"DATA",2002.1,6,0)
http://localhost:8001/DHPPATALLICN?ICN=1435855215V947437^P
"DATA",2002.1,7,0)
http://localhost:8001/DHPPATALLICN?JSON=J^F
"DATA",2002.1,8,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V153702&JSON=J^F
"DATA",2002.1,9,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V183702&JSON=J^P
"DATA",2002.1,10,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V183702&FRDAT=20060101&TODAT=20050101&JSON=J^F
"DATA",2002.1,11,0)
http://localhost:8001/DHPPATALLICN?ICN=10111V183702&FRDAT=20000101&TODAT=20050101&JSON=J^P
"DATA",2002.1,12,0)
http://localhost:8001/DHPPATALLICN?ICN=1435855215V947437&JSON=J^P
"DATA",2002.1,13,0)
http://localhost:8001/DHPPATAPTICN^F
"DATA",2002.1,14,0)
http://localhost:8001/DHPPATAPTICN?ICN=1198453374V588739^F
"DATA",2002.1,15,0)
http://localhost:8001/DHPPATAPTICN?ICN=1198013374V588739^P
"DATA",2002.1,16,0)
http://localhost:8001/DHPPATAPTICN?ICN=10111V183702^P
"DATA",2002.1,17,0)
http://localhost:8001/DHPPATAPTICN?ICN=1198013374V588739&FRDAT=20070101&TODAT=20050101^F
"DATA",2002.1,18,0)
http://localhost:8001/DHPPATAPTICN?ICN=1198013374V588739&FRDAT=20110101&TODAT=20150101^P
"DATA",2002.1,19,0)
http://localhost:8001/DHPPATAPTICN?ICN=10111V183702&FRDAT=20050101^P
"DATA",2002.1,20,0)
http://localhost:8001/DHPPATCONICN^F
"DATA",2002.1,21,0)
http://localhost:8001/DHPPATCONICN?ICN=2677504935V204585^F
"DATA",2002.1,22,0)
http://localhost:8001/DHPPATCONICN?ICN=2676604935V204585^P
"DATA",2002.1,23,0)
http://localhost:8001/DHPPATCONICN?ICN=5000001533V676621^P
"DATA",2002.1,24,0)
http://localhost:8001/DHPPATCONICN?ICN=10112V399621^P
"DATA",2002.1,25,0)
http://localhost:8001/DHPPATCONICN?ICN=10112V399621&FRDAT=20070101&TODAT=20051231^F
"DATA",2002.1,26,0)
http://localhost:8001/DHPPATCONICN?ICN=10112V399621&FRDAT=20000101&TODAT=20051231^P
"DATA",2002.1,27,0)
http://localhost:8001/DHPPATS4CON^F
"DATA",2002.1,28,0)
http://localhost:8001/DHPPATS4CON?SCT=99^F
"DATA",2002.1,29,0)
http://localhost:8001/DHPPATS4CON?SCT=10509002^P
"DATA",2002.1,30,0)
http://localhost:8001/DHPPATS4CON?SCT=47505003^P
"DATA",2002.1,31,0)
http://localhost:8001/DHPPATCPALLI^F
"DATA",2002.1,32,0)
http://localhost:8001/DHPPATCPALLI?ICN=2434634569V691690^F
"DATA",2002.1,33,0)
http://localhost:8001/DHPPATCPALLI?ICN=2434609669V691690^P
"DATA",2002.1,34,0)
http://localhost:8001/DHPPATCPALLI?ICN=5000001533V676621^P
"DATA",2002.1,35,0)
http://localhost:8001/DHPPATCPALLI?ICN=1435855215V947437^P
"DATA",2002.1,36,0)
http://localhost:8001/DHPPATCPALLI?ICN=1435855215V947437&FRDAT=20130101&TODAT=20120101^F
"DATA",2002.1,37,0)
http://localhost:8001/DHPPATCPALLI?ICN=1435855215V947437&FRDAT=20000101&TODAT=20120101^P
"DATA",2002.1,38,0)
http://localhost:8001/DHPPATCPALLI?JSON=J^F
"DATA",2002.1,39,0)
http://localhost:8001/DHPPATCPALLI?ICN=2434634569V691690&JSON=J^F
"DATA",2002.1,40,0)
http://localhost:8001/DHPPATCPALLI?ICN=2434609669V691690&JSON=J^P
"DATA",2002.1,41,0)
http://localhost:8001/DHPPATCPALLI?ICN=5000001533V676621&JSON=J^P
"DATA",2002.1,42,0)
http://localhost:8001/DHPPATCPALLI?ICN=1435855215V947437&JSON=J^P
"DATA",2002.1,43,0)
http://localhost:8001/DHPPATCPALLI?ICN=1435855215V947437&FRDAT=20130101&TODAT=20120101&JSON=J^F
"DATA",2002.1,44,0)
http://localhost:8001/DHPPATCPALLI?ICN=1435855215V947437&FRDAT=20000101&TODAT=20120101&JSON=J^P
"DATA",2002.1,45,0)
http://localhost:8001/DHPPATCPI?VRESID=V_500_1000010_34486^F
"DATA",2002.1,46,0)
http://localhost:8001/DHPPATCPI?ICN=2434609669V691690^F
"DATA",2002.1,47,0)
http://localhost:8001/DHPPATCPI?ICN=2434609669V622290&VRESID=V_500_1000010_34486^F
"DATA",2002.1,48,0)
http://localhost:8001/DHPPATCPI?ICN=2434609669V691690&VRESID=V_500_1000010_34486^P
"DATA",2002.1,49,0)
http://localhost:8001/DHPPATCPI?ICN=5000001533V676621&VRESID=V_500_1000010_34486^P
"DATA",2002.1,50,0)
http://localhost:8001/DHPPATCPI?VRESID=V_500_1000010_34486&JSON=J^F
"DATA",2002.1,51,0)
http://localhost:8001/DHPPATCPI?ICN=2434609669V691690&JSON=J^F
"DATA",2002.1,52,0)
http://localhost:8001/DHPPATCPI?ICN=2434609669V333690&VRESID=V_500_1000010_34486&JSON=J^F
"DATA",2002.1,53,0)
http://localhost:8001/DHPPATCPI?ICN=2434609669V691690&VRESID=V_500_1000010_34486&JSON=J^P
"DATA",2002.1,54,0)
http://localhost:8001/DHPPATCPI?ICN=5000001533V676621&VRESID=V_500_1000010_34486&JSON=J^P
"DATA",2002.1,55,0)
http://localhost:8001/DHPPATDEMICN^F
"DATA",2002.1,56,0)
http://localhost:8001/DHPPATDEMICN?ICN=1705550833V176438^F
"DATA",2002.1,57,0)
http://localhost:8001/DHPPATDEMICN?ICN=1703280833V176438^P
"DATA",2002.1,58,0)
http://localhost:8001/DHPPATDEMICN?ICN=5000001533V676621^P
"DATA",2002.1,59,0)
http://localhost:8001/DHPPATDEMICN?JSON=J^F
"DATA",2002.1,60,0)
http://localhost:8001/DHPPATDEMICN?ICN=2803777648V106941&JSON=J^F
"DATA",2002.1,61,0)
http://localhost:8001/DHPPATDEMICN?ICN=2803239648V106941&JSON=J^P
"DATA",2002.1,62,0)
http://localhost:8001/DHPPATDEMICN?ICN=5000001533V676621&JSON=J^P
"DATA",2002.1,63,0)
http://localhost:8001/DHPPATDXRICN^F
"DATA",2002.1,64,0)
http://localhost:8001/DHPPATDXRICN?ICN=11111V964144^F
"DATA",2002.1,65,0)
http://localhost:8001/DHPPATDXRICN?ICN=10101V964144^P
"DATA",2002.1,66,0)
http://localhost:8001/DHPPATDXRICN?ICN=10101V964144&FRDAT=20120101&TODAT=20100101^F
"DATA",2002.1,67,0)
http://localhost:8001/DHPPATDXRICN?ICN=10101V964144&FRDAT=20000101&TODAT=20100101^P
"DATA",2002.1,68,0)
http://localhost:8001/DHPPATDXRICN?ICN=2434609669V691690^P
"DATA",2002.1,69,0)
http://localhost:8001/DHPPATDXRICN?JSON=J^F
"DATA",2002.1,70,0)
http://localhost:8001/DHPPATDXRICN?ICN=11111V964144&JSON=J^F
"DATA",2002.1,71,0)
http://localhost:8001/DHPPATDXRICN?ICN=10101V964144&JSON=J^P
"DATA",2002.1,72,0)
http://localhost:8001/DHPPATDXRICN?ICN=10101V964144&FRDAT=20120101&TODAT=20100101&JSON=J^F
"DATA",2002.1,73,0)
http://localhost:8001/DHPPATDXRICN?ICN=10101V964144&FRDAT=20000101&TODAT=20100101&JSON=J^P
"DATA",2002.1,74,0)
http://localhost:8001/DHPPATDXRICN?ICN=2434609669V691690&JSON=J^P
"DATA",2002.1,75,0)
http://localhost:8001/DHPPATENCICN^F
"DATA",2002.1,76,0)
http://localhost:8001/DHPPATENCICN?ICN=2676604935V204555^F
"DATA",2002.1,77,0)
http://localhost:8001/DHPPATENCICN?ICN=2676604935V204585^P
"DATA",2002.1,78,0)
http://localhost:8001/DHPPATENCICN?ICN=2434609669V691690^P
"DATA",2002.1,79,0)
http://localhost:8001/DHPPATENCICN?ICN=5000000109V646500^P
"DATA",2002.1,80,0)
http://localhost:8001/DHPPATENCICN?ICN=5000000109V646500&FRDAT=20151001&TODAT=20141031^F
"DATA",2002.1,81,0)
http://localhost:8001/DHPPATENCICN?ICN=5000000109V646500&FRDAT=20151001&TODAT=20151031^P
"DATA",2002.1,82,0)
http://localhost:8001/DHPPATFLGICN^F
"DATA",2002.1,83,0)
http://localhost:8001/DHPPATFLGICN?ICN=10118V588553^F
"DATA",2002.1,84,0)
http://localhost:8001/DHPPATFLGICN?ICN=10118V572553^P
"DATA",2002.1,85,0)
http://localhost:8001/DHPPATFLGICN?ICN=2434609669V691690^P
"DATA",2002.1,86,0)
http://localhost:8001/DHPPATFLGICN?JSON=J^F
"DATA",2002.1,87,0)
http://localhost:8001/DHPPATFLGICN?ICN=10118V588553&JSON=J^F
"DATA",2002.1,88,0)
http://localhost:8001/DHPPATFLGICN?ICN=10118V572553&JSON=J^P
"DATA",2002.1,89,0)
http://localhost:8001/DHPPATFLGICN?ICN=2434609669V691690&JSON=J^P
"DATA",2002.1,90,0)
http://localhost:8001/DHPPATGOLICN^F
"DATA",2002.1,91,0)
http://localhost:8001/DHPPATGOLICN?ICN=1964446818V742124^F
"DATA",2002.1,92,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124^P
"DATA",2002.1,93,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&FRDAT=20151001&TODAT=20141031^F
"DATA",2002.1,94,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&FRDAT=19930220^P
"DATA",2002.1,95,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&TODAT=19930220^P
"DATA",2002.1,96,0)
http://localhost:8001/DHPPATGOLICN?ICN=2434609669V691690^P
"DATA",2002.1,97,0)
http://localhost:8001/DHPPATGOLICN?JSON=J^F
"DATA",2002.1,98,0)
http://localhost:8001/DHPPATGOLICN?ICN=1964446818V742124&JSON=J^F
"DATA",2002.1,99,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&JSON=J^P
"DATA",2002.1,100,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&FRDAT=20151001&TODAT=20141031&JSON=J^F
"DATA",2002.1,101,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&FRDAT=19930220&JSON=J^P
"DATA",2002.1,102,0)
http://localhost:8001/DHPPATGOLICN?ICN=1967316818V742124&TODAT=19930220&JSON=J^P
"DATA",2002.1,103,0)
http://localhost:8001/DHPPATGOLICN?ICN=2434609669V691690&JSON=J^P
"DATA",2002.1,104,0)
http://localhost:8001/DHPPATHLFICN^F
"DATA",2002.1,105,0)
http://localhost:8001/DHPPATHLFICN?ICN=5006601536V889384^F
"DATA",2002.1,106,0)
http://localhost:8001/DHPPATHLFICN?ICN=5000001536V889384^P
"DATA",2002.1,107,0)
http://localhost:8001/DHPPATHLFICN?ICN=2434609669V691690^P
"DATA",2002.1,108,0)
http://localhost:8001/DHPPATHLFICN?ICN=10101V964144^P
"DATA",2002.1,109,0)
http://localhost:8001/DHPPATHLFICN?ICN=10101V964144&FRDAT=20131101&TODAT=20131028^F
"DATA",2002.1,110,0)
http://localhost:8001/DHPPATHLFICN?ICN=10101V964144&FRDAT=20131001&TODAT=20131028^P
"DATA",2002.1,111,0)
http://localhost:8001/DHPPATHLFICN?JSON=J^F
"DATA",2002.1,112,0)
http://localhost:8001/DHPPATHLFICN?ICN=5006601536V889384&JSON=J^F
"DATA",2002.1,113,0)
http://localhost:8001/DHPPATHLFICN?ICN=5000001536V889384&JSON=J^P
"DATA",2002.1,114,0)
http://localhost:8001/DHPPATHLFICN?ICN=2434609669V691690&JSON=J^P
"DATA",2002.1,115,0)
http://localhost:8001/DHPPATHLFICN?ICN=10101V964144&JSON=J^P
"DATA",2002.1,116,0)
http://localhost:8001/DHPPATHLFICN?ICN=10101V964144&FRDAT=20131101&TODAT=20131028&JSON=J^F
"DATA",2002.1,117,0)
http://localhost:8001/DHPPATHLFICN?ICN=10101V964144&FRDAT=20131001&TODAT=20131028&JSON=J^P
"DATA",2002.1,118,0)
http://localhost:8001/DHPPATIMMICN^F
"DATA",2002.1,119,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V473342^F
"DATA",2002.1,120,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V472042^P
"DATA",2002.1,121,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V472042&FRDAT=20140101&TODAT=20131231^F
"DATA",2002.1,122,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V472042&FRDAT=20120101&TODAT=20131231^P
"DATA",2002.1,123,0)
http://localhost:8001/DHPPATIMMICN?ICN=10110V004877^P
"DATA",2002.1,124,0)
http://localhost:8001/DHPPATIMMICN?JSON=J^F
"DATA",2002.1,125,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V473342&JSON=J^F
"DATA",2002.1,126,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V472042&JSON=J^P
"DATA",2002.1,127,0)
http://localhost:8001/DHPPATIMMICN?ICN=10110V004877&JSON=J^P
"DATA",2002.1,128,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V472042&FRDAT=20140101&TODAT=20131231&JSON=J^F
"DATA",2002.1,129,0)
http://localhost:8001/DHPPATIMMICN?ICN=1345112108V472042&FRDAT=20120101&TODAT=20131231&JSON=J^P
"DATA",2002.1,130,0)
http://localhost:8001/DHPPATLABICN^F
"DATA",2002.1,131,0)
http://localhost:8001/DHPPATLABICN?ICN=1224989029V875306^F
"DATA",2002.1,132,0)
http://localhost:8001/DHPPATLABICN?ICN=1034989029V875306^P
"DATA",2002.1,133,0)
http://localhost:8001/DHPPATLABICN?ICN=5000001533V676621^P
"DATA",2002.1,134,0)
http://localhost:8001/DHPPATLABICN?ICN=1841089454V309194&FRDAT=20150101&TODAT=20131231&JSON=J^F
"DATA",2002.1,135,0)
http://localhost:8001/DHPPATLABICN?ICN=1841089454V309194&FRDAT=20150101^P
"DATA",2002.1,136,0)
http://localhost:8001/DHPPATLABICN?ICN=1841089454V309194&TODAT=20150101^P
"DATA",2002.1,137,0)
http://localhost:8001/DHPPATMEDAICN^F
"DATA",2002.1,138,0)
http://localhost:8001/DHPPATMEDAICN?ICN=5004300341V359724^F
"DATA",2002.1,139,0)
http://localhost:8001/DHPPATMEDAICN?ICN=5000000341V359724^P
"DATA",2002.1,140,0)
http://localhost:8001/DHPPATMEDAICN?ICN=5000000341V359724&FRDAT=20150101&TODAT=20131231^F
"DATA",2002.1,141,0)
http://localhost:8001/DHPPATMEDAICN?ICN=5000000341V359724&FRDAT=20100101&TODAT=20150101^P
"DATA",2002.1,142,0)
http://localhost:8001/DHPPATMEDAICN?ICN=2434609669V691690^P
"DATA",2002.1,143,0)
http://localhost:8001/DHPPATMEDDICN^F
"DATA",2002.1,144,0)
http://localhost:8001/DHPPATMEDDICN?ICN=5034000341V359724^F
"DATA",2002.1,145,0)
http://localhost:8001/DHPPATMEDDICN?ICN=5000000341V359724^P
"DATA",2002.1,146,0)
http://localhost:8001/DHPPATMEDDICN?ICN=5000000341V359724&FRDAT=20150121&TODAT=20131231^F
"DATA",2002.1,147,0)
http://localhost:8001/DHPPATMEDDICN?ICN=5000000341V359724&FRDAT=20100101&TODAT=20150101^P
"DATA",2002.1,148,0)
http://localhost:8001/DHPPATMEDDICN?ICN=2434609669V691690^P
"DATA",2002.1,149,0)
http://localhost:8001/DHPPATMEDSICN^F
"DATA",2002.1,150,0)
http://localhost:8001/DHPPATMEDSICN?ICN=5000430341V359724^F
"DATA",2002.1,151,0)
http://localhost:8001/DHPPATMEDSICN?ICN=5000000341V359724^P
"DATA",2002.1,152,0)
http://localhost:8001/DHPPATMEDSICN?ICN=5000000341V359724&FRDAT=20150201&TODAT=20131231^F
"DATA",2002.1,153,0)
http://localhost:8001/DHPPATMEDSICN?ICN=5000000341V359724&FRDAT=20100101&TODAT=20150101^P
"DATA",2002.1,154,0)
http://localhost:8001/DHPPATMEDSICN?ICN=2434609669V691690^P
"DATA",2002.1,155,0)
http://localhost:8001/DHPPATMEDSICN?ICN=1401380732V262134^P
"DATA",2002.1,156,0)
http://localhost:8001/DHPPATMEDSICN?ICN=2434609669V691690^P
"DATA",2002.1,157,0)
http://localhost:8001/DHPPATOBSICN^F
"DATA",2002.1,158,0)
http://localhost:8001/DHPPATOBSICN?ICN=5008800352V586511^F
"DATA",2002.1,159,0)
http://localhost:8001/DHPPATOBSICN?ICN=5000000352V586511^P
"DATA",2002.1,160,0)
http://localhost:8001/DHPPATOBSICN?ICN=5000000352V586511&FRDAT=19990101&TODAT=19981231^F
"DATA",2002.1,161,0)
http://localhost:8001/DHPPATOBSICN?ICN=5000000352V586511&FRDAT=20140901^P
"DATA",2002.1,162,0)
http://localhost:8001/DHPPATOBSICN?ICN=5000000352V586511&TODAT=20140901^P
"DATA",2002.1,163,0)
http://localhost:8001/DHPPATOBSICN?ICN=2434609669V691690^P
"DATA",2002.1,164,0)
http://localhost:8001/DHPPATPRCICN^F
"DATA",2002.1,165,0)
http://localhost:8001/DHPPATPRCICN?ICN=1401399732V262134^F
"DATA",2002.1,166,0)
http://localhost:8001/DHPPATPRCICN?ICN=1401380732V262134^P
"DATA",2002.1,167,0)
http://localhost:8001/DHPPATPRCICN?ICN=5000000107V310212^P
"DATA",2002.1,168,0)
http://localhost:8001/DHPPATPRCICN?ICN=5000000107V310212&FRDAT=19990101&TODAT=19981231^F
"DATA",2002.1,169,0)
http://localhost:8001/DHPPATPRCICN?ICN=5000000107V310212&FRDAT=19980101&TODAT=19981231^P
"DATA",2002.1,170,0)
http://localhost:8001/DHPPATPRVICN^F
"DATA",2002.1,171,0)
http://localhost:8001/DHPPATPRVICN?ICN=1095759922V866498^F
"DATA",2002.1,172,0)
http://localhost:8001/DHPPATPRVICN?ICN=1095759922V858498^P
"DATA",2002.1,173,0)
http://localhost:8001/DHPPATPRVICN?ICN=5000000107V310212^P
"DATA",2002.1,174,0)
http://localhost:8001/DHPPATPRVICN?ICN=1435855215V947437^P
"DATA",2002.1,175,0)
http://localhost:8001/DHPPATPRVICN?ICN=1435855215V947437&FRDAT=20150401&TODAT=20150301^F
"DATA",2002.1,176,0)
http://localhost:8001/DHPPATPRVICN?ICN=1435855215V947437&FRDAT=20150101&TODAT=20150301^P
"DATA",2002.1,177,0)
http://localhost:8001/DHPPATPRVICN?JSON=J^F
"DATA",2002.1,178,0)
http://localhost:8001/DHPPATPRVICN?ICN=1095759922V888498&JSON=J^F
"DATA",2002.1,179,0)
http://localhost:8001/DHPPATPRVICN?ICN=1095759922V858498&JSON=J^P
"DATA",2002.1,180,0)
http://localhost:8001/DHPPATPRVICN?ICN=5000000107V310212&JSON=J^P
"DATA",2002.1,181,0)
http://localhost:8001/DHPPATPRVICN?ICN=1435855215V947437&JSON=J^P
"DATA",2002.1,182,0)
http://localhost:8001/DHPPATPRVICN?ICN=1435855215V947437&FRDAT=20150401&TODAT=20150301&JSON=J^F
"DATA",2002.1,183,0)
http://localhost:8001/DHPPATPRVICN?ICN=1435855215V947437&FRDAT=20150101&TODAT=20150301&JSON=J^P
"DATA",2002.1,184,0)
http://localhost:8001/DHPPATTIUICN^F
"DATA",2002.1,185,0)
http://localhost:8001/DHPPATTIUICN?ICN=9009373208V844454^F
"DATA",2002.1,186,0)
http://localhost:8001/DHPPATTIUICN?ICN=9009373208V847154^P
"DATA",2002.1,187,0)
http://localhost:8001/DHPPATTIUICN?ICN=9009373208V847154&FRDAT=19980101&TODAT=19970101^F
"DATA",2002.1,188,0)
http://localhost:8001/DHPPATTIUICN?ICN=9009373208V847154&FRDAT=19960401&TODAT=19970101^P
"DATA",2002.1,189,0)
http://localhost:8001/DHPPATTIUICN?ICN=1095759922V858498^P
"DATA",2002.1,190,0)
http://localhost:8001/DHPPATVITICN^F
"DATA",2002.1,191,0)
http://localhost:8001/DHPPATVITICN?ICN=2176288883V515136^F
"DATA",2002.1,192,0)
http://localhost:8001/DHPPATVITICN?ICN=2176287883V515136^P
"DATA",2002.1,193,0)
http://localhost:8001/DHPPATVITICN?ICN=1095759922V858498^P
"DATA",2002.1,194,0)
http://localhost:8001/DHPPATVITICN?ICN=5000000211V385910^P
"DATA",2002.1,195,0)
http://localhost:8001/DHPPATVITICN?ICN=5000000211V385910&FRDAT=20160220&TODAT=20150223^F
"DATA",2002.1,196,0)
http://localhost:8001/DHPPATVITICN?ICN=5000000211V385910&FRDAT=20150220&TODAT=20150223^P
"DATA",2002.1,197,0)
http://localhost:8001/DHPPATVITICN?JSON=J^F
"DATA",2002.1,198,0)
http://localhost:8001/DHPPATVITICN?ICN=2176288883V515136&JSON=J^F
"DATA",2002.1,199,0)
http://localhost:8001/DHPPATVITICN?ICN=2176287883V515136&JSON=J^P
"DATA",2002.1,200,0)
http://localhost:8001/DHPPATVITICN?ICN=1095759922V858498&JSON=J^P
"DATA",2002.1,201,0)
http://localhost:8001/DHPPATVITICN?ICN=5000000211V385910&JSON=J^P
"DATA",2002.1,202,0)
http://localhost:8001/DHPPATVITICN?ICN=5000000211V385910&FRDAT=20150220&TODAT=20150101&JSON=J^F
"DATA",2002.1,203,0)
http://localhost:8001/DHPPATVITICN?ICN=5000000211V385910&FRDAT=20150220&TODAT=20150223&JSON=J^P
"DATA",2002.1,204,0)
http://localhost:8001/DHPPATVAL^F
"DATA",2002.1,205,0)
http://localhost:8001/DHPPATVAL?SSN=666000010^F
"DATA",2002.1,206,0)
http://localhost:8001/DHPPATVAL?SSN=666000010&NAME=TEN,PATIENT^F
"DATA",2002.1,207,0)
http://localhost:8001/DHPPATVAL?NAME=TEN,PATIENT&SSN=666000010&DOB=19290514^F
"DATA",2002.1,208,0)
http://localhost:8001/DHPPATVAL?NAME=TEN,PATIENT&SSN=666XXX010&DOB=19290514&GENDER=M^F
"DATA",2002.1,209,0)
http://localhost:8001/DHPPATVAL?NAME=TEN,PATIENT&SSN=666000010&DOB=19340514&GENDER=M^F
"DATA",2002.1,210,0)
http://localhost:8001/DHPPATVAL?NAME=TEN,PATIENT&SSN=666000010&DOB=19290514&GENDER=F^F
"DATA",2002.1,211,0)
http://localhost:8001/DHPPATVAL?NAME=TEN,PATIENT&SSN=666000010&DOB=19290514&GENDER=U^F
"DATA",2002.1,212,0)
http://localhost:8001/DHPPATVAL?NAME=TENXXX,PATIENT&SSN=666000010&DOB=19290514&GENDER=M^F
"DATA",2002.1,213,0)
http://localhost:8001/DHPPATVAL?NAME=TEN,PATIENT&SSN=666000010&DOB=19290514&GENDER=M^P
"DATA",2002.1,214,0)
http://localhost:8001/DHPPATVAL?NAME=COPD,PATIENT%20MALE&SSN=666111957&DOB=19800530&GENDER=M^P
"DATA",2002.1,215,0)
http://localhost:8001/DHPCARETEAM^F
"DATA",2002.1,216,0)
http://localhost:8001/DHPCARETEAM?TEAM=BLUEXX^F
"DATA",2002.1,217,0)
http://localhost:8001/DHPCARETEAM?TEAM=BLUE^P
"DATA",2002.1,218,0)
http://localhost:8001/DHPCARETEAM?TEAM=999^F
"DATA",2002.1,219,0)
http://localhost:8001/DHPCARETEAM?TEAM=5^P
"DATA",2002.1,220,0)
http://localhost:8001/DHPCARETEAM?JSON=J^F
"DATA",2002.1,221,0)
http://localhost:8001/DHPCARETEAM?TEAM=BLUEXX&JSON=J^F
"DATA",2002.1,222,0)
http://localhost:8001/DHPCARETEAM?TEAM=BLUE&JSON=J^P
"DATA",2002.1,223,0)
http://localhost:8001/DHPCARETEAM?TEAM=999&JSON=J^F
"DATA",2002.1,224,0)
http://localhost:8001/DHPCARETEAM?TEAM=5&JSON=J^P
"DATA",2002.1,225,0)
http://localhost:8001/DHPCARETEAMS^P
"DATA",2002.1,226,0)
http://localhost:8001/DHPCARETEAMS?FRDAT=20151231&TODAT=20141231^F
"DATA",2002.1,227,0)
http://localhost:8001/DHPCARETEAMS?FRDAT=20121231&TODAT=20141231^P
"DATA",2002.1,228,0)
http://localhost:8001/DHPCARETEAMS?JSON=J^P
"DATA",2002.1,229,0)
http://localhost:8001/DHPCARETEAMS?FRDAT=20151231&TODAT=20141231&JSON=J^F
"DATA",2002.1,230,0)
http://localhost:8001/DHPCARETEAMS?FRDAT=20121231&TODAT=20141231&JSON=J^P
"DATA",2002.1,231,0)
http://localhost:8001/DHPCARETEAMS?JSON=X^P
"DATA",2002.1,232,0)
http://localhost:8001/DHPHLOCINSTHLOCNAM^F
"DATA",2002.1,233,0)
http://localhost:8001/DHPHLOCINSTHLOCNAM?HLOC=ZYXW^F
"DATA",2002.1,234,0)
http://localhost:8001/DHPHLOCINSTHLOCNAM?HLOC=GENERAL%20MEDICINE^P
"DATA",2002.1,235,0)
http://localhost:8001/DHPHLOCINSTHLOCNAM?JSON=J^F
"DATA",2002.1,236,0)
http://localhost:8001/DHPHLOCINSTHLOCNAM?HLOC=ZYXW&JSON=J^F
"DATA",2002.1,237,0)
http://localhost:8001/DHPHLOCINSTHLOCNAM?HLOC=GENERAL%20MEDICINE&JSON=J^P
"DATA",2002.1,238,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=PHQ9^P
"DATA",2002.1,239,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=PHQ9&DIR=D^P
"DATA",2002.1,240,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=PHQ9&DIR=D&IOE=A^F
"DATA",2002.1,241,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=ZYXW&DIR=D&IOE=I^F
"DATA",2002.1,242,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=PHQ9&DIR=D&IOE=I^P
"DATA",2002.1,243,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=42&DIR=D^P
"DATA",2002.1,244,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=42&DIR=D&IOE=A^F
"DATA",2002.1,245,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=9999&DIR=D&IOE=I^F
"DATA",2002.1,246,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=42&DIR=D&IOE=I^P
"DATA",2002.1,247,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=715252007&DIR=I^P
"DATA",2002.1,248,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=715252007&DIR=I&IOE=A^F
"DATA",2002.1,249,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=999999999&DIR=I&IOE=I^F
"DATA",2002.1,250,0)
http://localhost:8001/DHPMAPSVC?MAP=mh2sct&CODE=715252007&DIR=I&IOE=I^P
"DATA",2002.1,251,0)
http://localhost:8001/DHPGETRESID^F
"DATA",2002.1,252,0)
http://localhost:8001/DHPGETRESID?RESID=S_500_2_110^F
"DATA",2002.1,253,0)
http://localhost:8001/DHPGETRESID?RESID=V^F
"DATA",2002.1,254,0)
http://localhost:8001/DHPGETRESID?RESID=V_555^F
"DATA",2002.1,255,0)
http://localhost:8001/DHPGETRESID?RESID=V_500^F
"DATA",2002.1,256,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_V^F
"DATA",2002.1,257,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_999999999999^F
"DATA",2002.1,258,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_2^F
"DATA",2002.1,259,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_2_V^F
"DATA",2002.1,260,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_2_999999999999^F
"DATA",2002.1,261,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_2_110^P
"DATA",2002.1,262,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_2.98_999999999999^F
"DATA",2002.1,263,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_2.98_24^P
"DATA",2002.1,264,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_4_999999999999^F
"DATA",2002.1,265,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_4_500^P
"DATA",2002.1,266,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_26.13_999999999999^F
"DATA",2002.1,267,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_26.13_110^P
"DATA",2002.1,268,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_44_999999999999^F
"DATA",2002.1,269,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_44_23^P
"DATA",2002.1,270,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_63_999999999999^F
"DATA",2002.1,271,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_63_1236^P
"DATA",2002.1,272,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_120.5_999999999999^F
"DATA",2002.1,273,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_120.5_110^P
"DATA",2002.1,274,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_120.8_999999999999^F
"DATA",2002.1,275,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_120.8_110^P
"DATA",2002.1,276,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_124.3_999999999999^F
"DATA",2002.1,277,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_124.3_10^P
"DATA",2002.1,278,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_216.8_999999999999^F
"DATA",2002.1,279,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_216.8_6^P
"DATA",2002.1,280,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.51_999999999999^F
"DATA",2002.1,281,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.51_5^P
"DATA",2002.1,282,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.52_999999999999^F
"DATA",2002.1,283,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.52_1^P
"DATA",2002.1,284,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.53_999999999999^F
"DATA",2002.1,285,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.53_1^F
"DATA",2002.1,286,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.57_999999999999^F
"DATA",2002.1,287,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.57_23^P
"DATA",2002.1,288,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.58_999999999999^F
"DATA",2002.1,289,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.58_4^P
"DATA",2002.1,290,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.59_999999999999^F
"DATA",2002.1,291,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_404.59_5^P
"DATA",2002.1,292,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_627.8_999999999999^F
"DATA",2002.1,293,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_627.8_169^P
"DATA",2002.1,294,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_8925_999999999999^F
"DATA",2002.1,295,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_8925_278^P
"DATA",2002.1,296,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010_999999999999^F
"DATA",2002.1,297,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010_110^P
"DATA",2002.1,298,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.06_999999999999^F
"DATA",2002.1,299,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.06_110^P
"DATA",2002.1,300,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.07_999999999999^F
"DATA",2002.1,301,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.07_110^P
"DATA",2002.1,302,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.11_999999999999^F
"DATA",2002.1,303,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.11_110^P
"DATA",2002.1,304,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.18_999999999999^F
"DATA",2002.1,305,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.18_110^P
"DATA",2002.1,306,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.23_999999999999^F
"DATA",2002.1,307,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.23_110^P
"DATA",2002.1,308,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.71_999999999999^F
"DATA",2002.1,309,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000010.71_110^P
"DATA",2002.1,310,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000011_999999999999^F
"DATA",2002.1,311,0)
http://localhost:8001/DHPGETRESID?RESID=V_500_9000011_110^P
"DATA",2002.1,312,0)
http://localhost:8001/DHPPATICNALL^P
"DATA",2002.1,313,0)
http://localhost:8001/DHPPATICNALL?CNT=x&JSON=A^P
"DATA",2002.1,314,0)
http://localhost:8001/DHPPATICNALL?CNT=5&JSON=T^P
"DATA",2002.1,315,0)
http://localhost:8001/DHPPATICNALL?CNT=5&JSON=J^P
"DATA",2002.1,316,0)
http://localhost:8001/DHPPATICNALL?CNT=x^P
"DATA",2002.1,317,0)
http://localhost:8001/DHPPATICNALL?CNT=5^P
"DATA",2002.1,318,0)
http://localhost:8001/DHPPATCP^F
"DATA",2002.1,319,0)
http://localhost:8001/DHPPATCPALL^F
"DATA",2002.1,320,0)
http://localhost:8001/DHPPATHLF^F
"DATA",2002.1,321,0)
http://localhost:8001/DHPPATLAB^F
"DATA",2002.1,322,0)
http://localhost:8001/DHPPATOBS^F
"DATA",2002.1,323,0)
http://localhost:8001/^P
"DATA",2002.1,324,0)
http://localhost:8001/WXYZ^F
"DATA",2002.1,325,0)
http://localhost:8001/DHPPATDEMRNG^F
"DATA",2002.1,326,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10S20^F
"DATA",2002.1,327,0)
http://localhost:8001/DHPPATDEMRNG?ICN=R20^F
"DATA",2002.1,328,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10R^F
"DATA",2002.1,329,0)
http://localhost:8001/DHPPATDEMRNG?ICN=100R20^F
"DATA",2002.1,330,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10R2000^P
"DATA",2002.1,331,0)
http://localhost:8001/DHPPATDEMRNG?JSON=J^F
"DATA",2002.1,332,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10S20&JSON=J^F
"DATA",2002.1,333,0)
http://localhost:8001/DHPPATDEMRNG?ICN=R20&JSON=J^F
"DATA",2002.1,334,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10R&JSON=J^F
"DATA",2002.1,335,0)
http://localhost:8001/DHPPATDEMRNG?ICN=100R20&JSON=J^F
"DATA",2002.1,336,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10R2000&JSON=J^F
"DATA",2002.1,337,0)
http://localhost:8001/DHPPATDEMRNG?ICN=10R20&JSON=J^P
"DATA",2002.1,338,0)
http://localhost:8001/DHPPATDEMALL^F
"DATA",2002.1,339,0)
http://localhost:8001/DHPPATDEMALL?ICN=SOM^F
"DATA",2002.1,340,0)
http://localhost:8001/DHPPATDEMALL?ICN=ALL^P
"DATA",2002.1,341,0)
http://localhost:8001/DHPPATDEMALL?JSON=J^F
"DATA",2002.1,342,0)
http://localhost:8001/DHPPATDEMALL?ICN=SOM&JSON=J^F
"DATA",2002.1,343,0)
http://localhost:8001/DHPPATDEMALL?ICN=ALL&JSON=J^F
"FIA",996.5)
NETSERV TCP LISTENER
"FIA",996.5,0)
^RGNET(996.5,
"FIA",996.5,0,0)
996.5
"FIA",996.5,0,1)
y^y^f^^n^^y^o^n
"FIA",996.5,0,10)

"FIA",996.5,0,11)

"FIA",996.5,0,"RLRO")

"FIA",996.5,996.5)
0
"FIA",996.52)
NETSERV HTTP ENDPOINT
"FIA",996.52,0)
^RGNET(996.52,
"FIA",996.52,0,0)
996.52
"FIA",996.52,0,1)
y^y^f^^n^^y^o^n
"FIA",996.52,0,10)

"FIA",996.52,0,11)

"FIA",996.52,0,"RLRO")

"FIA",996.52,996.52)
0
"FIA",996.52,996.52099)
0
"FIA",2002.1)
SYN REST UNIT TESTS
"FIA",2002.1,0)
^SYN(2002.1,
"FIA",2002.1,0,0)
2002.1
"FIA",2002.1,0,1)
y^y^f^^n^^y^o^n
"FIA",2002.1,0,10)

"FIA",2002.1,0,11)

"FIA",2002.1,0,"RLRO")

"FIA",2002.1,2002.1)
0
"INI")
EN^SYNPRE1
"INIT")
EN^SYNGBLLD
"IX",996.52,996.52,"C",0)
996.52^C^Compound index by METHOD and URL.^MU^^R^IR^I^996.52^^^^^LS
"IX",996.52,996.52,"C",1)
S ^RGNET(996.52,"C",X(1),X(2),DA)=$$TOPTRN^RGNETWWW(X(2))
"IX",996.52,996.52,"C",2)
K ^RGNET(996.52,"C",X(1),X(2),DA)
"IX",996.52,996.52,"C",2.5)
K ^RGNET(996.52,"C")
"IX",996.52,996.52,"C",11.1,0)
^.114IA^2^2
"IX",996.52,996.52,"C",11.1,1,0)
1^F^996.52^1^10^1^F
"IX",996.52,996.52,"C",11.1,2,0)
2^F^996.52^.01^150^2^F
"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
61
"RTN","SYNDHP01")
0^96^B22388996
"RTN","SYNDHP01",1,0)
SYNDHP01 ; HC/fjf/art - HealthConcourse - get patient vitals ;05/04/2019
"RTN","SYNDHP01",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP01",3,0)
 ;;
"RTN","SYNDHP01",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP01",5,0)
 ;
"RTN","SYNDHP01",6,0)
 QUIT
"RTN","SYNDHP01",7,0)
 ;
"RTN","SYNDHP01",8,0)
 ; ---------------- Get patient vitals ------------------------------
"RTN","SYNDHP01",9,0)
 ;
"RTN","SYNDHP01",10,0)
PATVIT(RETSTA,NAME,SSN,DOB,GENDER,FRDAT,TODAT,RETJSON) ; get vitals for a patient by traits
"RTN","SYNDHP01",11,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP01",12,0)
 QUIT
"RTN","SYNDHP01",13,0)
 ; Return patient vitals for name, SSN, DOB, and gender
"RTN","SYNDHP01",14,0)
 ;
"RTN","SYNDHP01",15,0)
 ; Input:
"RTN","SYNDHP01",16,0)
 ;   NAME    - patient name
"RTN","SYNDHP01",17,0)
 ;   SSN     - social security number
"RTN","SYNDHP01",18,0)
 ;   DOB     - date of birth
"RTN","SYNDHP01",19,0)
 ;   GENDER  - gender
"RTN","SYNDHP01",20,0)
 ;   FRDAT   - from date (inclusive), optional, compared to .01 DATE/TIME VITALS TAKEN
"RTN","SYNDHP01",21,0)
 ;   TODAT   - to date (inclusive), optional, compared to .01 DATE/TIME VITALS TAKEN
"RTN","SYNDHP01",22,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP01",23,0)
 ;             F = Return FHIR
"RTN","SYNDHP01",24,0)
 ;             0 or null = Return string (default)
"RTN","SYNDHP01",25,0)
 ; Output:
"RTN","SYNDHP01",26,0)
 ;   RETSTA  - a delimited string that lists the vitals for a patient
"RTN","SYNDHP01",27,0)
 ;           - ICN^SCT code for vital|SCT description of vital|value of vital|date|resource id^...
"RTN","SYNDHP01",28,0)
 ;          or patient vitals in JSON format
"RTN","SYNDHP01",29,0)
 ;              
"RTN","SYNDHP01",30,0)
 ;     note:resource identifier will be:
"RTN","SYNDHP01",31,0)
 ;             "V"_SITE ID_FILE #_FILE IEN   e.g. V_500_120.5_930
"RTN","SYNDHP01",32,0)
 ;
"RTN","SYNDHP01",33,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP01",34,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP01",35,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP01",36,0)
 ;
"RTN","SYNDHP01",37,0)
 N ICNST
"RTN","SYNDHP01",38,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP01",39,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP01",40,0)
 ; if we are here we are dealing with a valid patient
"RTN","SYNDHP01",41,0)
 N DHPIEN S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP01",42,0)
 ; get patient IEN from ICN
"RTN","SYNDHP01",43,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP01",44,0)
 ;
"RTN","SYNDHP01",45,0)
 I PATIEN="" S RETSTA="-1^Patient ICN not found" QUIT
"RTN","SYNDHP01",46,0)
 ;
"RTN","SYNDHP01",47,0)
 N VARRAY
"RTN","SYNDHP01",48,0)
 S RETSTA=$$VITS(.VARRAY,PATIEN,DHPIEN,FRDAT,TODAT)
"RTN","SYNDHP01",49,0)
 ;
"RTN","SYNDHP01",50,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP01",51,0)
 . S RETSTA=""
"RTN","SYNDHP01",52,0)
 . D TOJASON^SYNDHPUTL(.VARRAY,.RETSTA)
"RTN","SYNDHP01",53,0)
 ;
"RTN","SYNDHP01",54,0)
 QUIT
"RTN","SYNDHP01",55,0)
 ;
"RTN","SYNDHP01",56,0)
PATVITI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient vitals for ICN
"RTN","SYNDHP01",57,0)
 ;
"RTN","SYNDHP01",58,0)
 ; Return patient vitals for a given patient ICN
"RTN","SYNDHP01",59,0)
 ;
"RTN","SYNDHP01",60,0)
 ; Input:
"RTN","SYNDHP01",61,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP01",62,0)
 ;   FRDAT   - from date (inclusive), optional, compared to .01 DATE/TIME VITALS TAKEN
"RTN","SYNDHP01",63,0)
 ;   TODAT   - to date (inclusive), optional, compared to .01 DATE/TIME VITALS TAKEN
"RTN","SYNDHP01",64,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP01",65,0)
 ;             F = Return FHIR
"RTN","SYNDHP01",66,0)
 ;             0 or null = Return string (default)
"RTN","SYNDHP01",67,0)
 ; Output:
"RTN","SYNDHP01",68,0)
 ;   RETSTA  - a delimited string that lists the vitals for a patient
"RTN","SYNDHP01",69,0)
 ;           - ICN^SCT code for vital|SCT description of vital|value of vital|date|resource id^...
"RTN","SYNDHP01",70,0)
 ;          or patient vitals in JSON format
"RTN","SYNDHP01",71,0)
 ;              
"RTN","SYNDHP01",72,0)
 ;     note:resource identifier will be:
"RTN","SYNDHP01",73,0)
 ;             "V"_SITE ID_FILE #_FILE IEN   e.g. V_500_120.5_930
"RTN","SYNDHP01",74,0)
 ;
"RTN","SYNDHP01",75,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP01",76,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP01",77,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP01",78,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP01",79,0)
 ;
"RTN","SYNDHP01",80,0)
 ; validate ICN
"RTN","SYNDHP01",81,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP01",82,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP01",83,0)
 ; get patient IEN from ICN
"RTN","SYNDHP01",84,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP01",85,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP01",86,0)
 ;
"RTN","SYNDHP01",87,0)
 N VARRAY
"RTN","SYNDHP01",88,0)
 S RETSTA=$$VITS(.VARRAY,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP01",89,0)
 ;
"RTN","SYNDHP01",90,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP01",91,0)
 ;
"RTN","SYNDHP01",92,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP01",93,0)
 . S RETSTA=""
"RTN","SYNDHP01",94,0)
 . D TOJASON^SYNDHPUTL(.VARRAY,.RETSTA)
"RTN","SYNDHP01",95,0)
 ;
"RTN","SYNDHP01",96,0)
 QUIT
"RTN","SYNDHP01",97,0)
 ;
"RTN","SYNDHP01",98,0)
VITS(PATVIT,PATIEN,DHPICN,FRDAT,TODAT) ; get vitals for a patient
"RTN","SYNDHP01",99,0)
 ; build the array of SNOMED CT codes that correspond to vitals
"RTN","SYNDHP01",100,0)
 ;
"RTN","SYNDHP01",101,0)
 N VITALS,VID,VTYPE,VOBS,VTIEN,VDATEFM,VDATE,SCT,SCTPT,VIT,ZARR
"RTN","SYNDHP01",102,0)
 N C S C=","
"RTN","SYNDHP01",103,0)
 N P S P="|"
"RTN","SYNDHP01",104,0)
 N S S S="_"
"RTN","SYNDHP01",105,0)
 N FN S FN=120.5
"RTN","SYNDHP01",106,0)
 ;
"RTN","SYNDHP01",107,0)
 ; scan vitals "C" index for IEN
"RTN","SYNDHP01",108,0)
 N VIEN S VIEN=""
"RTN","SYNDHP01",109,0)
 F  S VIEN=$O(^GMR(FN,"C",PATIEN,VIEN)) Q:VIEN=""  D
"RTN","SYNDHP01",110,0)
 . N VITALS
"RTN","SYNDHP01",111,0)
 . D GET1VITALS^SYNDHP16(.VITALS,VIEN,0)
"RTN","SYNDHP01",112,0)
 . I $D(VITALS("Vitals","ERROR")) M PATVIT("Vitals",VIEN)=VITALS QUIT
"RTN","SYNDHP01",113,0)
 . S VDATEFM=VITALS("Vitals","dateTimeVitalsTakenFM")
"RTN","SYNDHP01",114,0)
 . QUIT:((VDATEFM\1)<FRDAT)!((VDATEFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP01",115,0)
 . S VID=VITALS("Vitals","resourceId")
"RTN","SYNDHP01",116,0)
 . S VTYPE=VITALS("Vitals","vitalType")
"RTN","SYNDHP01",117,0)
 . S VOBS=VITALS("Vitals","rate")
"RTN","SYNDHP01",118,0)
 . S VTIEN=VITALS("Vitals","vitalTypeId")
"RTN","SYNDHP01",119,0)
 . S VDATE=VITALS("Vitals","dateTimeVitalsTakenHL7")
"RTN","SYNDHP01",120,0)
 . S SCT=VITALS("Vitals","vitalTypeSCT")
"RTN","SYNDHP01",121,0)
 . S SCTPT=$$SENTENCE^XLFSTR(VITALS("Vitals","vitalType"))
"RTN","SYNDHP01",122,0)
 . S ZARR(DHPICN,SCT,VIEN)=SCTPT_P_VOBS_P_VDATE_P_VID
"RTN","SYNDHP01",123,0)
 . M PATVIT("Vitals",VIEN)=VITALS ;
"RTN","SYNDHP01",124,0)
 ;
"RTN","SYNDHP01",125,0)
 ; serialize data
"RTN","SYNDHP01",126,0)
 S (SCT,VIEN)=""
"RTN","SYNDHP01",127,0)
 N VITALRTN S VITALRTN=DHPICN
"RTN","SYNDHP01",128,0)
 F  S SCT=$O(ZARR(DHPICN,SCT)) Q:SCT=""  D
"RTN","SYNDHP01",129,0)
 . F  S VIEN=$O(ZARR(DHPICN,SCT,VIEN)) Q:VIEN=""  D
"RTN","SYNDHP01",130,0)
 . . S VIT=ZARR(DHPICN,SCT,VIEN)
"RTN","SYNDHP01",131,0)
 . . S VITALRTN=VITALRTN_U_SCT_P_VIT
"RTN","SYNDHP01",132,0)
 ;
"RTN","SYNDHP01",133,0)
 Q VITALRTN
"RTN","SYNDHP01",134,0)
 ;
"RTN","SYNDHP01",135,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP01",136,0)
T1 ;
"RTN","SYNDHP01",137,0)
 N ICN S ICN="2176287883V515136"
"RTN","SYNDHP01",138,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP01",139,0)
 N TODAT S TODAT=""
"RTN","SYNDHP01",140,0)
 N JSON S JSON=""
"RTN","SYNDHP01",141,0)
 N RETSTA
"RTN","SYNDHP01",142,0)
 D PATVITI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP01",143,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP01",144,0)
 QUIT
"RTN","SYNDHP01",145,0)
 ;
"RTN","SYNDHP01",146,0)
T2 ;
"RTN","SYNDHP01",147,0)
 N ICN S ICN="2176287883V515136"
"RTN","SYNDHP01",148,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP01",149,0)
 N TODAT S TODAT=""
"RTN","SYNDHP01",150,0)
 N JSON S JSON="J"
"RTN","SYNDHP01",151,0)
 N RETSTA
"RTN","SYNDHP01",152,0)
 D PATVITI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP01",153,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP01",154,0)
 QUIT
"RTN","SYNDHP01",155,0)
 ;
"RTN","SYNDHP02")
0^97^B18905167
"RTN","SYNDHP02",1,0)
SYNDHP02 ; HC/rbd/art - HealthConcourse - get patient immunization data ;05/04/2019
"RTN","SYNDHP02",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP02",3,0)
 ;;
"RTN","SYNDHP02",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP02",5,0)
 ;
"RTN","SYNDHP02",6,0)
 QUIT
"RTN","SYNDHP02",7,0)
 ;
"RTN","SYNDHP02",8,0)
 ; ---------------- Get patient immunizations information ------------------------------
"RTN","SYNDHP02",9,0)
 ;
"RTN","SYNDHP02",10,0)
PATIMMI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient immunizations for ICN
"RTN","SYNDHP02",11,0)
 ;
"RTN","SYNDHP02",12,0)
 ; Return patient immunizations for a given patient ICN
"RTN","SYNDHP02",13,0)
 ;
"RTN","SYNDHP02",14,0)
 ; Input:
"RTN","SYNDHP02",15,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP02",16,0)
 ;   FRDAT   - from date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP02",17,0)
 ;   TODAT   - to date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP02",18,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP02",19,0)
 ;             F = Return FHIR
"RTN","SYNDHP02",20,0)
 ;             0 or null = Return string (default)
"RTN","SYNDHP02",21,0)
 ; Output:
"RTN","SYNDHP02",22,0)
 ;   RETSTA  - a delimited string that lists patient immunization information
"RTN","SYNDHP02",23,0)
 ;               Resource ID |Imm. Enc. Visit Dt | Imm. CVX Code | Imm. Description | Series Indicator ; Description |
"RTN","SYNDHP02",24,0)
 ;               Imm. Given Date  | Loc. of Enc. | Reaction Indicator ; Description | Imm. Provider
"RTN","SYNDHP02",25,0)
 ;          or patient immunizations in JSON format
"RTN","SYNDHP02",26,0)
 ;
"RTN","SYNDHP02",27,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP02",28,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP02",29,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP02",30,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP02",31,0)
 ;
"RTN","SYNDHP02",32,0)
 ; validate ICN
"RTN","SYNDHP02",33,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP02",34,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP02",35,0)
 ; 
"RTN","SYNDHP02",36,0)
 ; get patient IEN from ICN
"RTN","SYNDHP02",37,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP02",38,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP02",39,0)
 ;
"RTN","SYNDHP02",40,0)
 N IMMARR
"RTN","SYNDHP02",41,0)
 S RETSTA=$$IMMS(.IMMARR,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP02",42,0)
 ;
"RTN","SYNDHP02",43,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP02",44,0)
 ;
"RTN","SYNDHP02",45,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP02",46,0)
 . S RETSTA=""
"RTN","SYNDHP02",47,0)
 . D TOJASON^SYNDHPUTL(.IMMARR,.RETSTA)
"RTN","SYNDHP02",48,0)
 ;
"RTN","SYNDHP02",49,0)
 Q
"RTN","SYNDHP02",50,0)
 ;
"RTN","SYNDHP02",51,0)
IMMS(IMMARR,PATIEN,DHPICN,FRDAT,TODAT) ; get immunizations for a patient
"RTN","SYNDHP02",52,0)
 ;
"RTN","SYNDHP02",53,0)
 N C,P,S,HLFCTS,VSTDT,PTIMMIEN,IMMREC
"RTN","SYNDHP02",54,0)
 N PTIMMID,IMMDESC,LOCENC,SERIES,IMMGIVEN,REACTID,REACTION,IMMPROV,ZARR
"RTN","SYNDHP02",55,0)
 N SERIESID,VIEN
"RTN","SYNDHP02",56,0)
 S C=",",P="|",S="_"
"RTN","SYNDHP02",57,0)
 N FNUM S FNUM=9000010.11      ;  file
"RTN","SYNDHP02",58,0)
 ; scan PXRMINDX 9000010.11 "CVX" "PI" index for Immunizations
"RTN","SYNDHP02",59,0)
 ; Example of such an entry - ^PXRMINDX(9000010.11,"CVX","PI",69,109,3000425.113046,64)=""
"RTN","SYNDHP02",60,0)
 ;S DHPICN=PATIEN
"RTN","SYNDHP02",61,0)
 N IMCVXCOD S IMCVXCOD=""
"RTN","SYNDHP02",62,0)
 F  S IMCVXCOD=$O(^PXRMINDX(FNUM,"CVX","PI",PATIEN,IMCVXCOD)) Q:IMCVXCOD=""  D
"RTN","SYNDHP02",63,0)
 .S VSTDT=""
"RTN","SYNDHP02",64,0)
 .F  S VSTDT=$O(^PXRMINDX(FNUM,"CVX","PI",PATIEN,IMCVXCOD,VSTDT)) Q:VSTDT=""  D
"RTN","SYNDHP02",65,0)
 ..QUIT:((VSTDT\1)<FRDAT)!((VSTDT\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP02",66,0)
 ..S PTIMMIEN=""
"RTN","SYNDHP02",67,0)
 ..F  S PTIMMIEN=$O(^PXRMINDX(FNUM,"CVX","PI",PATIEN,IMCVXCOD,VSTDT,PTIMMIEN)) Q:PTIMMIEN=""  D
"RTN","SYNDHP02",68,0)
 ...N IMMUNIZE
"RTN","SYNDHP02",69,0)
 ...D GET1IMMUN^SYNDHP12(.IMMUNIZE,PTIMMIEN,0)
"RTN","SYNDHP02",70,0)
 ...I $D(IMMUNIZE("Immunize","ERROR")) M IMMARR("Immunizations",PTIMMIEN)=IMMUNIZE QUIT
"RTN","SYNDHP02",71,0)
 ...S PTIMMID=IMMUNIZE("Immunize","resourceId")
"RTN","SYNDHP02",72,0)
 ...S IMMDESC=IMMUNIZE("Immunize","immunization")
"RTN","SYNDHP02",73,0)
 ...S VIEN=IMMUNIZE("Immunize","visitId")
"RTN","SYNDHP02",74,0)
 ...S LOCENC=$$GET1^DIQ(9000010,VIEN,.06)
"RTN","SYNDHP02",75,0)
 ...S SERIES=IMMUNIZE("Immunize","series")
"RTN","SYNDHP02",76,0)
 ...S SERIESID=IMMUNIZE("Immunize","seriesCd")
"RTN","SYNDHP02",77,0)
 ...S IMMGIVEN=IMMUNIZE("Immunize","eventDateAndTimeHL7")
"RTN","SYNDHP02",78,0)
 ...S REACTID=IMMUNIZE("Immunize","reactionCd")
"RTN","SYNDHP02",79,0)
 ...S REACTION=IMMUNIZE("Immunize","reaction")
"RTN","SYNDHP02",80,0)
 ...S IMMPROV=IMMUNIZE("Immunize","encounterProvider")
"RTN","SYNDHP02",81,0)
 ...S IMMREC=PTIMMID_P_$$FMTHL7^XLFDT(VSTDT)_P_IMCVXCOD_P_IMMDESC_P_SERIESID_";"_SERIES_P_IMMGIVEN_P_LOCENC
"RTN","SYNDHP02",82,0)
 ...S IMMREC=IMMREC_P_REACTID_";"_REACTION_P_IMMPROV
"RTN","SYNDHP02",83,0)
 ...S ZARR(DHPICN,VSTDT,IMCVXCOD)=IMMREC
"RTN","SYNDHP02",84,0)
 ...M IMMARR("Immunizations",PTIMMIEN)=IMMUNIZE ;
"RTN","SYNDHP02",85,0)
 ;
"RTN","SYNDHP02",86,0)
 ; serialize data
"RTN","SYNDHP02",87,0)
 S VSTDT=""
"RTN","SYNDHP02",88,0)
 S HLFCTS=DHPICN
"RTN","SYNDHP02",89,0)
 F  S VSTDT=$O(ZARR(DHPICN,VSTDT)) Q:VSTDT=""  D
"RTN","SYNDHP02",90,0)
 .S IMCVXCOD="" F  S IMCVXCOD=$O(ZARR(DHPICN,VSTDT,IMCVXCOD)) Q:IMCVXCOD=""  D
"RTN","SYNDHP02",91,0)
 ..S IMMREC=ZARR(DHPICN,VSTDT,IMCVXCOD)
"RTN","SYNDHP02",92,0)
 ..S HLFCTS=HLFCTS_U_IMMREC
"RTN","SYNDHP02",93,0)
 ;
"RTN","SYNDHP02",94,0)
 Q HLFCTS
"RTN","SYNDHP02",95,0)
 ; for a given pt, returns Unique ID |Imm. Enc. Visit Dt | Imm. CVX Code | Imm. Description | Series Indicator ; Description |
"RTN","SYNDHP02",96,0)
 ;                            Imm. Given Date  | Loc. of Enc. | Reaction Indicator ; Description | Imm. Provider
"RTN","SYNDHP02",97,0)
 ; 
"RTN","SYNDHP02",98,0)
 ;  Series can be:   'P' FOR PARTIALLY COMPLETE 
"RTN","SYNDHP02",99,0)
 ;                   'C' FOR COMPLETE 
"RTN","SYNDHP02",100,0)
 ;                   'B' FOR BOOSTER 
"RTN","SYNDHP02",101,0)
 ;                   '1' FOR SERIES 1 
"RTN","SYNDHP02",102,0)
 ;                   '2' FOR SERIES 2 
"RTN","SYNDHP02",103,0)
 ;                   '3' FOR SERIES 3 
"RTN","SYNDHP02",104,0)
 ;                   '4' FOR SERIES 4 
"RTN","SYNDHP02",105,0)
 ;                   '5' FOR SERIES 5 
"RTN","SYNDHP02",106,0)
 ;                   '6' FOR SERIES 6 
"RTN","SYNDHP02",107,0)
 ;                   '7' FOR SERIES 7 
"RTN","SYNDHP02",108,0)
 ;                   '8' FOR SERIES 8
"RTN","SYNDHP02",109,0)
 ;
"RTN","SYNDHP02",110,0)
 ;  Reactions can be:  '1' FOR FEVER
"RTN","SYNDHP02",111,0)
 ;                     '2' FOR IRRITABILITY; 
"RTN","SYNDHP02",112,0)
 ;                     '3' FOR LOCAL REACTION OR SWELLING; 
"RTN","SYNDHP02",113,0)
 ;                     '4' FOR VOMITING; 
"RTN","SYNDHP02",114,0)
 ;                     '5' FOR RASH OR ITCHING; 
"RTN","SYNDHP02",115,0)
 ;                     '6' FOR LETHARGY; 
"RTN","SYNDHP02",116,0)
 ;                     '7' FOR CONVULSIONS; 
"RTN","SYNDHP02",117,0)
 ;                     '8' FOR ARTHRITIS OR ARTHRALGIAS; 
"RTN","SYNDHP02",118,0)
 ;                     '9' FOR ANAPHYLAXIS OR COLLAPSE; 
"RTN","SYNDHP02",119,0)
 ;                     '10' FOR RESPIRATORY DISTRESS; 
"RTN","SYNDHP02",120,0)
 ;                     '11' FOR OTHER; 
"RTN","SYNDHP02",121,0)
 ;                     '0' FOR NONE;
"RTN","SYNDHP02",122,0)
 ;
"RTN","SYNDHP02",123,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP02",124,0)
T1 ;
"RTN","SYNDHP02",125,0)
 N ICN S ICN="10110V004877"
"RTN","SYNDHP02",126,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP02",127,0)
 N TODAT S TODAT=""
"RTN","SYNDHP02",128,0)
 N JSON S JSON=""
"RTN","SYNDHP02",129,0)
 N RETSTA
"RTN","SYNDHP02",130,0)
 D PATIMMI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP02",131,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP02",132,0)
 QUIT
"RTN","SYNDHP02",133,0)
 ;
"RTN","SYNDHP02",134,0)
T2 ;
"RTN","SYNDHP02",135,0)
 N ICN S ICN="10110V004877"
"RTN","SYNDHP02",136,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP02",137,0)
 N TODAT S TODAT=""
"RTN","SYNDHP02",138,0)
 N JSON S JSON="J"
"RTN","SYNDHP02",139,0)
 N RETSTA
"RTN","SYNDHP02",140,0)
 D PATIMMI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP02",141,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP02",142,0)
 QUIT
"RTN","SYNDHP02",143,0)
 ;
"RTN","SYNDHP03")
0^102^B23655386
"RTN","SYNDHP03",1,0)
SYNDHP03 ; HC/rbd/art - HealthConcourse - get patient condition/problem data ;05/04/2019
"RTN","SYNDHP03",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP03",3,0)
 ;;
"RTN","SYNDHP03",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP03",5,0)
 ;
"RTN","SYNDHP03",6,0)
 QUIT
"RTN","SYNDHP03",7,0)
 ;
"RTN","SYNDHP03",8,0)
 ;----------------  Get Patient Conditions  ---------------------- 
"RTN","SYNDHP03",9,0)
 ;
"RTN","SYNDHP03",10,0)
PATCONDS(RETSTA,NAME,SSN,DOB,GENDER) ; get condition SCT codes for a patient by traits
"RTN","SYNDHP03",11,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP03",12,0)
 QUIT
"RTN","SYNDHP03",13,0)
 ; Return list of active conditions (problems) for name, SSN, DOB, and gender
"RTN","SYNDHP03",14,0)
 ;   conditions without a SNOMED CT code are not be reported
"RTN","SYNDHP03",15,0)
 ;
"RTN","SYNDHP03",16,0)
 ; Input:
"RTN","SYNDHP03",17,0)
 ;   NAME    - patient name
"RTN","SYNDHP03",18,0)
 ;   SSN     - social security number
"RTN","SYNDHP03",19,0)
 ;   DOB     - date of birth
"RTN","SYNDHP03",20,0)
 ;   GENDER  - gender
"RTN","SYNDHP03",21,0)
 ; Output:
"RTN","SYNDHP03",22,0)
 ;   RETSTA  - a delimited string that lists SNOMED CDT codes for the patient conditions
"RTN","SYNDHP03",23,0)
 ;           - ICN^SCT code1^SCT code2^...^SCT coden
"RTN","SYNDHP03",24,0)
 ;
"RTN","SYNDHP03",25,0)
 N C,ACU,ICNST,DHPICN,PATIEN,SCT
"RTN","SYNDHP03",26,0)
 S C=","
"RTN","SYNDHP03",27,0)
 N SCTA
"RTN","SYNDHP03",28,0)
 ;
"RTN","SYNDHP03",29,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP03",30,0)
 I +ICNST'=1 S RETSTA=ICNST Q
"RTN","SYNDHP03",31,0)
 ; if we are here we are dealing with a valid patient
"RTN","SYNDHP03",32,0)
 S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP03",33,0)
 ; get patient IEN from ICN
"RTN","SYNDHP03",34,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP03",35,0)
 ;
"RTN","SYNDHP03",36,0)
 S (ACU,SCT)=""
"RTN","SYNDHP03",37,0)
 F  S ACU=$O(^PXRMINDX(9000011,"SCT","PSPI",PATIEN,"A",ACU)) Q:ACU=""  D
"RTN","SYNDHP03",38,0)
 .F  S SCT=$O(^PXRMINDX(9000011,"SCT","PSPI",PATIEN,"A",ACU,SCT)) Q:SCT=""  D
"RTN","SYNDHP03",39,0)
 ..S SCTA(SCT)=""
"RTN","SYNDHP03",40,0)
 S RETSTA=DHPICN
"RTN","SYNDHP03",41,0)
 S SCT=""
"RTN","SYNDHP03",42,0)
 F  S SCT=$O(SCTA(SCT)) Q:SCT=""  S RETSTA=RETSTA_U_SCT
"RTN","SYNDHP03",43,0)
 Q
"RTN","SYNDHP03",44,0)
 ;
"RTN","SYNDHP03",45,0)
 ;
"RTN","SYNDHP03",46,0)
PATCONI(RETSTA,DHPICN,FRDAT,TODAT) ; Patient conditions for ICN
"RTN","SYNDHP03",47,0)
 ;
"RTN","SYNDHP03",48,0)
 ; Return patient conditions (problems) for a given patient ICN
"RTN","SYNDHP03",49,0)
 ;
"RTN","SYNDHP03",50,0)
 ; Input:
"RTN","SYNDHP03",51,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP03",52,0)
 ;   FRDATE  - from date (inclusive), optional, compared to .13 DATE OF ONSET
"RTN","SYNDHP03",53,0)
 ;   TODATE  - to date (inclusive), optional, compared to .13 DATE OF ONSET
"RTN","SYNDHP03",54,0)
 ; Output:
"RTN","SYNDHP03",55,0)
 ;   RETSTA  - a delimited string that lists the following information
"RTN","SYNDHP03",56,0)
 ;      PatientICN ^ resourceId ^ DiagnosisCode ; DiagnosisName ^ DateOfOnset ^ SNOMED CT Code ; SNOMED CT Name |
"RTN","SYNDHP03",57,0)
 ;      and continue this for every diagnosis for a particular patient ICN
"RTN","SYNDHP03",58,0)
 ;
"RTN","SYNDHP03",59,0)
 ;  Identifier will be "V_"_SITE ID_"_"_FILE #_"_"_FILE IEN   i.e. V_500_9000011_930
"RTN","SYNDHP03",60,0)
 ;
"RTN","SYNDHP03",61,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP03",62,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP03",63,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP03",64,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP03",65,0)
 ;
"RTN","SYNDHP03",66,0)
 ; validate ICN
"RTN","SYNDHP03",67,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP03",68,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP03",69,0)
 ;
"RTN","SYNDHP03",70,0)
 N C,ACU,P,S,ONSET,DONSET,DIEN,RETDESC,SITE,SCTA
"RTN","SYNDHP03",71,0)
 N PATIEN
"RTN","SYNDHP03",72,0)
 S C=",",P="|",S=";"
"RTN","SYNDHP03",73,0)
 ;
"RTN","SYNDHP03",74,0)
 ; get patient IEN from ICN
"RTN","SYNDHP03",75,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP03",76,0)
 I $G(DEBUG) W "PATIEN: ",PATIEN,!
"RTN","SYNDHP03",77,0)
 S RETSTA=DHPICN
"RTN","SYNDHP03",78,0)
 S RETDESC=""
"RTN","SYNDHP03",79,0)
 S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP03",80,0)
 ;
"RTN","SYNDHP03",81,0)
 S DIEN=""
"RTN","SYNDHP03",82,0)
 F  S DIEN=$O(^AUPNPROB("AC",PATIEN,DIEN)) Q:DIEN=""  D
"RTN","SYNDHP03",83,0)
 . N PROBX,PROBE
"RTN","SYNDHP03",84,0)
 . D GETS^DIQ(9000011,DIEN_",",".01;.02;.13;80001","EIN","PROBX","PROBE")
"RTN","SYNDHP03",85,0)
 . QUIT:$D(PROBE)
"RTN","SYNDHP03",86,0)
 . N DIAGC,DIAGN,ONSET,DONSET,SNOMEDC,SNOMEDN,IDENT
"RTN","SYNDHP03",87,0)
 . I $D(PROBX(9000011,DIEN_",",.01,"E")) D
"RTN","SYNDHP03",88,0)
 . . S DIAGC=PROBX(9000011,DIEN_",",.01,"E")
"RTN","SYNDHP03",89,0)
 . . S DIAGN=$G(^ICD9(PROBX(9000011,DIEN_",",.01,"I"),68,1,1))
"RTN","SYNDHP03",90,0)
 . S DONSET=""
"RTN","SYNDHP03",91,0)
 . S ONSET=""
"RTN","SYNDHP03",92,0)
 . I $D(PROBX(9000011,DIEN_",",.13,"I")) D
"RTN","SYNDHP03",93,0)
 . . S ONSET=PROBX(9000011,DIEN_",",.13,"I")
"RTN","SYNDHP03",94,0)
 . . ; if no month or day of month is set, default to 01
"RTN","SYNDHP03",95,0)
 . . S:$E(ONSET,4,5)="00" $E(ONSET,4,5)="01"
"RTN","SYNDHP03",96,0)
 . . S:$E(ONSET,6,7)="00" $E(ONSET,6,7)="01"
"RTN","SYNDHP03",97,0)
 . . S DONSET=$$FMTHL7^XLFDT(ONSET)  ;date of onset set to HL7 format
"RTN","SYNDHP03",98,0)
 . QUIT:DONSET'=""&(((ONSET\1)<FRDAT)!((ONSET\1)>TODAT))  ;quit if outside of requested date range
"RTN","SYNDHP03",99,0)
 . I $D(PROBX(9000011,DIEN_",",80001,"E")) D
"RTN","SYNDHP03",100,0)
 . . S SNOMEDC=PROBX(9000011,DIEN_",",80001,"E")
"RTN","SYNDHP03",101,0)
 . . S SNOMEDN=$$USCTPT^SYNDHPUTL(SNOMEDC)
"RTN","SYNDHP03",102,0)
 . S IDENT=$$RESID^SYNDHP69("V",SITE)_"_9000011_"_DIEN
"RTN","SYNDHP03",103,0)
 . S RETDESC=RETDESC_IDENT_U_$G(DIAGC)_S_$G(DIAGN)_U_$G(DONSET)_U_$G(SNOMEDC)_S_$G(SNOMEDN)_P
"RTN","SYNDHP03",104,0)
 S RETSTA=RETSTA_U_RETDESC
"RTN","SYNDHP03",105,0)
 ;
"RTN","SYNDHP03",106,0)
 QUIT
"RTN","SYNDHP03",107,0)
 ;
"RTN","SYNDHP03",108,0)
 ;  ----------------  Patients for a given active condition  -------------- 
"RTN","SYNDHP03",109,0)
 ;
"RTN","SYNDHP03",110,0)
PATCONAL(RETSTA,DHPSCT) ; Patients for a given active condition
"RTN","SYNDHP03",111,0)
 ;
"RTN","SYNDHP03",112,0)
 ; Return list of all patients who have a particular active condition (problem)
"RTN","SYNDHP03",113,0)
 ;
"RTN","SYNDHP03",114,0)
 ; Input:
"RTN","SYNDHP03",115,0)
 ;   DHPSCT - SNOMED CT code  (mandatory)
"RTN","SYNDHP03",116,0)
 ; Output:
"RTN","SYNDHP03",117,0)
 ;   RETSTA  - a delimited string that lists SNOMED CDT codes for active  patient conditions
"RTN","SYNDHP03",118,0)
 ;           - SCT^ICN 1|patient name 1^ICN 2|patient name 2^...^ICN n|patient name n 
"RTN","SYNDHP03",119,0)
 ;           - -1 - error
"RTN","SYNDHP03",120,0)
 ; 
"RTN","SYNDHP03",121,0)
 ; validate SNOMED CT code
"RTN","SYNDHP03",122,0)
 I $G(DHPSCT)="" S RETSTA="-1^What code?" QUIT
"RTN","SYNDHP03",123,0)
 I +$$CODE^LEXTRAN(DHPSCT,"SCT")'=1 S RETSTA="-1^SNOMED CT code not recognised" Q
"RTN","SYNDHP03",124,0)
 ;
"RTN","SYNDHP03",125,0)
 N C,ACU,P,PATA,PATIEN,PAT
"RTN","SYNDHP03",126,0)
 S C=",",P="|"
"RTN","SYNDHP03",127,0)
 S (ACU,PATIEN)=""
"RTN","SYNDHP03",128,0)
 F  S ACU=$O(^PXRMINDX(9000011,"SCT","ISPP",DHPSCT,"A",ACU)) Q:ACU=""  D
"RTN","SYNDHP03",129,0)
 .F  S PATIEN=$O(^PXRMINDX(9000011,"SCT","ISPP",DHPSCT,"A",ACU,PATIEN)) Q:PATIEN=""  D
"RTN","SYNDHP03",130,0)
 ..S PATA($$UICN^SYNDHPUTL(PATIEN))=$$GET1^DIQ(2,PATIEN_C,.01)
"RTN","SYNDHP03",131,0)
 S RETSTA=DHPSCT
"RTN","SYNDHP03",132,0)
 S PAT=""
"RTN","SYNDHP03",133,0)
 F  S PAT=$O(PATA(PAT)) Q:PAT=""  S RETSTA=RETSTA_U_PAT_P_PATA(PAT)
"RTN","SYNDHP03",134,0)
 Q
"RTN","SYNDHP03",135,0)
 ;
"RTN","SYNDHP03",136,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP03",137,0)
T1 ;
"RTN","SYNDHP03",138,0)
 N ICN S ICN="10111V183702"
"RTN","SYNDHP03",139,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP03",140,0)
 N TODAT S TODAT=""
"RTN","SYNDHP03",141,0)
 N RETSTA
"RTN","SYNDHP03",142,0)
 D PATCONI(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP03",143,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP03",144,0)
 QUIT
"RTN","SYNDHP03",145,0)
 ;
"RTN","SYNDHP03",146,0)
T2 ;
"RTN","SYNDHP03",147,0)
 N SNOMED S SNOMED=47505003
"RTN","SYNDHP03",148,0)
 N RETSTA
"RTN","SYNDHP03",149,0)
 D PATCONAL(.RETSTA,SNOMED)
"RTN","SYNDHP03",150,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP03",151,0)
 QUIT
"RTN","SYNDHP03",152,0)
 ;
"RTN","SYNDHP03",153,0)
T3 ;
"RTN","SYNDHP03",154,0)
 N SNOMED S SNOMED=10509002
"RTN","SYNDHP03",155,0)
 N RETSTA
"RTN","SYNDHP03",156,0)
 D PATCONAL(.RETSTA,SNOMED)
"RTN","SYNDHP03",157,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP03",158,0)
 QUIT
"RTN","SYNDHP03",159,0)
 ;
"RTN","SYNDHP04")
0^103^B11868381
"RTN","SYNDHP04",1,0)
SYNDHP04 ; HC/fjf/art - HealthConcourse - retrieve patient procedures ;05/04/2019
"RTN","SYNDHP04",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP04",3,0)
 ;;
"RTN","SYNDHP04",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP04",5,0)
 ;
"RTN","SYNDHP04",6,0)
 QUIT
"RTN","SYNDHP04",7,0)
 ;
"RTN","SYNDHP04",8,0)
 ; ---------------- Get patient procedures ----------------------
"RTN","SYNDHP04",9,0)
 ;
"RTN","SYNDHP04",10,0)
PATPRC(RETSTA,NAME,SSN,DOB,GENDER,FRDAT,TODAT) ; get procedures for a patient by traits
"RTN","SYNDHP04",11,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP04",12,0)
 QUIT
"RTN","SYNDHP04",13,0)
 ; Return patient procedures for name, SSN, DOB, and gender
"RTN","SYNDHP04",14,0)
 ;
"RTN","SYNDHP04",15,0)
 ; Input:
"RTN","SYNDHP04",16,0)
 ;   NAME    - patient name
"RTN","SYNDHP04",17,0)
 ;   SSN     - social security number
"RTN","SYNDHP04",18,0)
 ;   DOB     - date of birth
"RTN","SYNDHP04",19,0)
 ;   GENDER  - gender
"RTN","SYNDHP04",20,0)
 ;   FRDATE  - from date (inclusive), optional
"RTN","SYNDHP04",21,0)
 ;   TODATE  - to date (inclusive), optional
"RTN","SYNDHP04",22,0)
 ; Output:
"RTN","SYNDHP04",23,0)
 ;   RETSTA  - a delimited string that lists SNOMED CT codes for the patient procedures
"RTN","SYNDHP04",24,0)
 ;           - ICN^SCT code|description|CPT code|date|identifier^...
"RTN","SYNDHP04",25,0)
 ;
"RTN","SYNDHP04",26,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP04",27,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP04",28,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP04",29,0)
 ;
"RTN","SYNDHP04",30,0)
 N C,P,S,ZARR,ICNST,DHPICN,PATIEN
"RTN","SYNDHP04",31,0)
 ;
"RTN","SYNDHP04",32,0)
 S C=",",P="|",S="_"
"RTN","SYNDHP04",33,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP04",34,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP04",35,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP04",36,0)
 ; if we are here we are dealing with a valid patient
"RTN","SYNDHP04",37,0)
 S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP04",38,0)
 ; get patient IEN from ICN
"RTN","SYNDHP04",39,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP04",40,0)
 I PATIEN="" S RETSTA="-1^Patient ICN not found" QUIT
"RTN","SYNDHP04",41,0)
 ;
"RTN","SYNDHP04",42,0)
 S RETSTA=DHPICN
"RTN","SYNDHP04",43,0)
 ;
"RTN","SYNDHP04",44,0)
 ;Surgical Procedures
"RTN","SYNDHP04",45,0)
 S RETSTA=RETSTA_$$SRPRCS^SYNDHP55(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP04",46,0)
 ;
"RTN","SYNDHP04",47,0)
 ;Visit Procedures
"RTN","SYNDHP04",48,0)
 S RETSTA=RETSTA_$$VSTPRCS^SYNDHP55(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP04",49,0)
 ;
"RTN","SYNDHP04",50,0)
 ;Radiology Procedures
"RTN","SYNDHP04",51,0)
 S RETSTA=RETSTA_$$RADPRCS^SYNDHP55(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP04",52,0)
 ;
"RTN","SYNDHP04",53,0)
 QUIT
"RTN","SYNDHP04",54,0)
 ;
"RTN","SYNDHP04",55,0)
 ; ---------------- Get patient procedures ----------------------
"RTN","SYNDHP04",56,0)
 ;
"RTN","SYNDHP04",57,0)
PATPRCI(RETSTA,DHPICN,FRDAT,TODAT) ; Patient procedures for ICN
"RTN","SYNDHP04",58,0)
 ;
"RTN","SYNDHP04",59,0)
 ; Return patient procedures for a given patient ICN
"RTN","SYNDHP04",60,0)
 ;  currently returns:
"RTN","SYNDHP04",61,0)
 ;    -Surgical
"RTN","SYNDHP04",62,0)
 ;    -Visit (V CPT)
"RTN","SYNDHP04",63,0)
 ;    -Radiology
"RTN","SYNDHP04",64,0)
 ;
"RTN","SYNDHP04",65,0)
 ; Input:
"RTN","SYNDHP04",66,0)
 ;   DHPICN  - unique patient identifier across all VistA systems
"RTN","SYNDHP04",67,0)
 ;   FRDATE  - from date (inclusive), optional
"RTN","SYNDHP04",68,0)
 ;   TODATE  - to date (inclusive), optional
"RTN","SYNDHP04",69,0)
 ; Output:
"RTN","SYNDHP04",70,0)
 ;   RETSTA  - a delimited string that lists SNOMED CT codes for the patient procedures
"RTN","SYNDHP04",71,0)
 ;           - ICN^SCT code|description|CPT code|date|identifier^...
"RTN","SYNDHP04",72,0)
 ;
"RTN","SYNDHP04",73,0)
 ; bypass for CQM
"RTN","SYNDHP04",74,0)
 ; 
"RTN","SYNDHP04",75,0)
 ; ***********
"RTN","SYNDHP04",76,0)
 ; *********** Important Note for open source community
"RTN","SYNDHP04",77,0)
 ; ***********
"RTN","SYNDHP04",78,0)
 ; *********** Perspecta - who developed this source code and have released it to the open source
"RTN","SYNDHP04",79,0)
 ; *********** need the following six lines to remain intact
"RTN","SYNDHP04",80,0)
 ; 
"RTN","SYNDHP04",81,0)
 I DHPICN="1899632336V236254" D  QUIT
"RTN","SYNDHP04",82,0)
 .S RETSTA="1899632336V236254^71388002|Mammogram|77056|20170101|442_130_101"
"RTN","SYNDHP04",83,0)
 ;I DHPICN="2495309561V670720" D  QUIT
"RTN","SYNDHP04",84,0)
 ;.S RETSTA="2495309561V670720^24165007|Alcohol Counseling and Treatment||20170101|442_130_101"
"RTN","SYNDHP04",85,0)
 ;
"RTN","SYNDHP04",86,0)
 ; *********** the above lines will be redacted by Perspecta at some suitable juncture to 
"RTN","SYNDHP04",87,0)
 ; *********** be determined by Perspecta
"RTN","SYNDHP04",88,0)
 ; ***********
"RTN","SYNDHP04",89,0)
 ; *********** End of Important Note for open source community
"RTN","SYNDHP04",90,0)
 ;
"RTN","SYNDHP04",91,0)
 ; validate ICN
"RTN","SYNDHP04",92,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP04",93,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP04",94,0)
 ; 
"RTN","SYNDHP04",95,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP04",96,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP04",97,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP04",98,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP04",99,0)
 ;
"RTN","SYNDHP04",100,0)
 N C,P,S,PATIEN
"RTN","SYNDHP04",101,0)
 S C=",",P="|",S="_"
"RTN","SYNDHP04",102,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP04",103,0)
 ; get patient IEN from ICN
"RTN","SYNDHP04",104,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP04",105,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP04",106,0)
 ;
"RTN","SYNDHP04",107,0)
 S RETSTA=DHPICN
"RTN","SYNDHP04",108,0)
 ;
"RTN","SYNDHP04",109,0)
 ;Surgical Procedures
"RTN","SYNDHP04",110,0)
 S RETSTA=RETSTA_$$SRPRCS^SYNDHP55(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP04",111,0)
 ;
"RTN","SYNDHP04",112,0)
 ;Visit Procedures
"RTN","SYNDHP04",113,0)
 S RETSTA=RETSTA_$$VSTPRCS^SYNDHP55(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP04",114,0)
 ;
"RTN","SYNDHP04",115,0)
 ;Radiology Procedures
"RTN","SYNDHP04",116,0)
 S RETSTA=RETSTA_$$RADPRCS^SYNDHP55(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP04",117,0)
 ;
"RTN","SYNDHP04",118,0)
 QUIT
"RTN","SYNDHP04",119,0)
 ;
"RTN","SYNDHP04",120,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP04",121,0)
T1 ;
"RTN","SYNDHP04",122,0)
 N ICN S ICN="5000000107V310212"
"RTN","SYNDHP04",123,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP04",124,0)
 N TODAT S TODAT=""
"RTN","SYNDHP04",125,0)
 N RETSTA
"RTN","SYNDHP04",126,0)
 D PATPRCI(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP04",127,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP04",128,0)
 QUIT
"RTN","SYNDHP04",129,0)
 ;
"RTN","SYNDHP05")
0^104^B117668361
"RTN","SYNDHP05",1,0)
SYNDHP05 ; HC/fjf/art - HealthConcourse - retrieve patient diagnostic reports ;05/08/2019
"RTN","SYNDHP05",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP05",3,0)
 ;;
"RTN","SYNDHP05",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP05",5,0)
 ;
"RTN","SYNDHP05",6,0)
 QUIT
"RTN","SYNDHP05",7,0)
 ;
"RTN","SYNDHP05",8,0)
 ; ---------------- Patient diagnostic reports ----------------------
"RTN","SYNDHP05",9,0)
 ;
"RTN","SYNDHP05",10,0)
PATDXRI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient diagnostic report for ICN
"RTN","SYNDHP05",11,0)
 ;
"RTN","SYNDHP05",12,0)
 ; Return patient diagnostic report for a given patient ICN
"RTN","SYNDHP05",13,0)
 ;
"RTN","SYNDHP05",14,0)
 ; Input:
"RTN","SYNDHP05",15,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP05",16,0)
 ;   FRDAT   - from date (inclusive), optional
"RTN","SYNDHP05",17,0)
 ;   TODAT   - to date (inclusive), optional
"RTN","SYNDHP05",18,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP05",19,0)
 ;             F = Return FHIR
"RTN","SYNDHP05",20,0)
 ;             0 or null = Return diagnostic report string (default)
"RTN","SYNDHP05",21,0)
 ; Output:
"RTN","SYNDHP05",22,0)
 ;   RETSTA  - ICN^"IMG"|status|dateTime|provider|identifier|CPT|SCT|desc|primary dx|dx SCT|conclusion^...
"RTN","SYNDHP05",23,0)
 ;                ^"MHDX"|status|dateTime|provider|identifier|diag code|SCT|decription^...
"RTN","SYNDHP05",24,0)
 ;                ^"VISIT"|status|dateTime|provider|identifier|ICD|SCT|diag desc^...
"RTN","SYNDHP05",25,0)
 ;          or patient diagnostic report data in JSON format
"RTN","SYNDHP05",26,0)
 ;
"RTN","SYNDHP05",27,0)
 ; bypass for CQM
"RTN","SYNDHP05",28,0)
 ; 
"RTN","SYNDHP05",29,0)
 ; ***********
"RTN","SYNDHP05",30,0)
 ; *********** Important Note for open source community
"RTN","SYNDHP05",31,0)
 ; ***********
"RTN","SYNDHP05",32,0)
 ; *********** Perspecta - who developed this source code and have released it to the open source
"RTN","SYNDHP05",33,0)
 ; *********** need the following six lines to remain intact
"RTN","SYNDHP05",34,0)
 ; 
"RTN","SYNDHP05",35,0)
 I DHPICN="2608649748V030771" D  QUIT
"RTN","SYNDHP05",36,0)
 . S RETSTA="2608649748V030771^IMG|final|20170101|PROVIDER,ONE|V_500_74_608|44388||Colon Endoscopy||| there are no previous colonoscopy."
"RTN","SYNDHP05",37,0)
 . S RETSTA=RETSTA_" Impression: There is no definite colonoscopic evidence of malignancy.2. Comparison to previous colonoscopy would be helpful to assure stability."
"RTN","SYNDHP05",38,0)
 ;
"RTN","SYNDHP05",39,0)
 I DHPICN="2627244030V292232" D  QUIT
"RTN","SYNDHP05",40,0)
 . S RETSTA="2627244030V292232^IMG|final|20170101|PROVIDER,ONE|V_500_74_608|88147||Cytopath C/V Automated||| there are no previous cervical cancer screening report."
"RTN","SYNDHP05",41,0)
 . S RETSTA=RETSTA_" Impression: There is no definite CCS evidence of malignancy.2. Comparison to previous CCS would be helpful to assure stability."
"RTN","SYNDHP05",42,0)
 ;
"RTN","SYNDHP05",43,0)
 I DHPICN="1686299845V246594" D  QUIT
"RTN","SYNDHP05",44,0)
 . S RETSTA="1686299845V246594^MHDX|final|20170101|PROVIDER,ONE|V_500_74_608|F32.0|70747007|Major depressive disorder, single episode, mild"
"RTN","SYNDHP05",45,0)
 ;
"RTN","SYNDHP05",46,0)
 ; *********** the above lines will be redacted by Perspecta at some suitable juncture to 
"RTN","SYNDHP05",47,0)
 ; *********** be determined by Perspecta
"RTN","SYNDHP05",48,0)
 ; ***********
"RTN","SYNDHP05",49,0)
 ; *********** End of Important Note for open source community
"RTN","SYNDHP05",50,0)
 ;
"RTN","SYNDHP05",51,0)
 ; validate ICN
"RTN","SYNDHP05",52,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP05",53,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP05",54,0)
 ; 
"RTN","SYNDHP05",55,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP05",56,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP05",57,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP05",58,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP05",59,0)
 ;
"RTN","SYNDHP05",60,0)
 N C,P,PATIEN
"RTN","SYNDHP05",61,0)
 ;
"RTN","SYNDHP05",62,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP05",63,0)
 S C=",",P="|"
"RTN","SYNDHP05",64,0)
 ; get patient IEN from ICN
"RTN","SYNDHP05",65,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP05",66,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP05",67,0)
 ;
"RTN","SYNDHP05",68,0)
 S RETSTA=DHPICN
"RTN","SYNDHP05",69,0)
 ;
"RTN","SYNDHP05",70,0)
 N DXRPTS
"RTN","SYNDHP05",71,0)
 ;Radology Diagnosis
"RTN","SYNDHP05",72,0)
 N DXARRAY,RETVAL
"RTN","SYNDHP05",73,0)
 S RETVAL=$$DXRAD(.DXARRAY,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP05",74,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP05",75,0)
 . M DXRPTS=DXARRAY
"RTN","SYNDHP05",76,0)
 E  D
"RTN","SYNDHP05",77,0)
 . S RETSTA=RETSTA_RETVAL
"RTN","SYNDHP05",78,0)
 ;
"RTN","SYNDHP05",79,0)
 ;Mental Health Diagnosis
"RTN","SYNDHP05",80,0)
 N DXARRAY,RETVAL
"RTN","SYNDHP05",81,0)
 S RETVAL=$$DXMH(.DXARRAY,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP05",82,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP05",83,0)
 . M DXRPTS=DXARRAY
"RTN","SYNDHP05",84,0)
 E  D
"RTN","SYNDHP05",85,0)
 . S RETSTA=RETSTA_RETVAL
"RTN","SYNDHP05",86,0)
 ;
"RTN","SYNDHP05",87,0)
 ;Visit Diagnosis
"RTN","SYNDHP05",88,0)
 N DXARRAY,RETVAL
"RTN","SYNDHP05",89,0)
 S RETVAL=$$DXVISIT(.DXARRAY,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP05",90,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP05",91,0)
 . M DXRPTS=DXARRAY
"RTN","SYNDHP05",92,0)
 E  D
"RTN","SYNDHP05",93,0)
 . S RETSTA=RETSTA_RETVAL
"RTN","SYNDHP05",94,0)
 ;
"RTN","SYNDHP05",95,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP05",96,0)
 ;
"RTN","SYNDHP05",97,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP05",98,0)
 . S RETSTA=""
"RTN","SYNDHP05",99,0)
 . D TOJASON^SYNDHPUTL(.DXRPTS,.RETSTA)
"RTN","SYNDHP05",100,0)
 ;
"RTN","SYNDHP05",101,0)
 QUIT
"RTN","SYNDHP05",102,0)
 ;
"RTN","SYNDHP05",103,0)
DXRAD(DXRPTRAD,PATIEN,FRDAT,TODAT) ; get radiology diagnostic report
"RTN","SYNDHP05",104,0)
 ;
"RTN","SYNDHP05",105,0)
 N SEQ S SEQ=0
"RTN","SYNDHP05",106,0)
 N DXRRAD S DXRRAD=""
"RTN","SYNDHP05",107,0)
 I $G(DEBUG) W !,"Radiology Diagnoses",!
"RTN","SYNDHP05",108,0)
 N RADEX
"RTN","SYNDHP05",109,0)
 D RADEXAM^SYNDHP55(.RADEX,PATIEN,1,FRDAT,TODAT)
"RTN","SYNDHP05",110,0)
 ;             1      2        3       4            5            6         7        8     9     10     11                 12      13        14        15       16          17
"RTN","SYNDHP05",111,0)
 ; RADEX(SEQ)=PID_U_PatDfn_U_CatEx_U_ExamDate_U_ExamDateHl7_U_caseNbr_U_PROCIEN_U_PROC_U_CPT_U_SCT_U_primaryDiagnosis_U_REQPHYS_U_PIRES_U_PISTAFF_U_VISITDT_U_VISITHL_U_EnteringUser
"RTN","SYNDHP05",112,0)
 ;               1     2        3         4        5         6               7                        8
"RTN","SYNDHP05",113,0)
 ; RADEX(SEQ,1)=PID^dayCase^dateTime^dateTimeHL7^status id^status^verifying physician id^verifying physician name
"RTN","SYNDHP05",114,0)
 ; RADEX(SEQ,"REPORT")=report
"RTN","SYNDHP05",115,0)
 ; RADEX(SEQ,"IMPRESSION")=impression
"RTN","SYNDHP05",116,0)
 ;
"RTN","SYNDHP05",117,0)
 D BLDARRAY(.RADEX,.DXRPTRAD)
"RTN","SYNDHP05",118,0)
 ;
"RTN","SYNDHP05",119,0)
 N PRSTA,PDATE,PDATEHL,PPROV,PID,PRCPT,SCT,DESC,PRIMEDX,DXSCT,TEXT
"RTN","SYNDHP05",120,0)
 N IDX S IDX=""
"RTN","SYNDHP05",121,0)
 F  S IDX=$O(RADEX(IDX)) QUIT:IDX=""  D
"RTN","SYNDHP05",122,0)
 . QUIT:'$D(RADEX(IDX,1))  ;there is no rad diag rpt for this exam
"RTN","SYNDHP05",123,0)
 . S PRSTA="final" ;status
"RTN","SYNDHP05",124,0)
 . S PDATE=$P($G(RADEX(IDX,1)),U,3) ;exam date (FM)
"RTN","SYNDHP05",125,0)
 . QUIT:((PDATE\1)<FRDAT)!((PDATE\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP05",126,0)
 . S PDATEHL=$P($G(RADEX(IDX,1)),U,4) ;exam date (HL7)
"RTN","SYNDHP05",127,0)
 . S PPROV=$P($G(RADEX(IDX,1)),U,8) ;verifying provider
"RTN","SYNDHP05",128,0)
 . S PID=$P($G(RADEX(IDX,1)),U,1) ;resource id
"RTN","SYNDHP05",129,0)
 . S PRCPT=$P($G(RADEX(IDX)),U,9) ;procedure cpt
"RTN","SYNDHP05",130,0)
 . S SCT=$P($G(RADEX(IDX)),U,10) ;procedure sct
"RTN","SYNDHP05",131,0)
 . S DESC=$P($G(RADEX(IDX)),U,8) ;procedure desc
"RTN","SYNDHP05",132,0)
 . S PRIMEDX=$P($G(RADEX(IDX)),U,11) ;primary diagnosis
"RTN","SYNDHP05",133,0)
 . S DXSCT="" ;                              <<<<<<<<<<<<<<<< rad diagnoses are text, no associated SCT
"RTN","SYNDHP05",134,0)
 . S TEXT=$G(RADEX(IDX,"REPORT"))
"RTN","SYNDHP05",135,0)
 . S DXRRAD=DXRRAD_U_"IMG"_P_PRSTA_P_PDATEHL_P_PPROV_P_PID_P_PRCPT_P_SCT_P_DESC_P_PRIMEDX_P_DXSCT_P_TEXT
"RTN","SYNDHP05",136,0)
 ;
"RTN","SYNDHP05",137,0)
 ;I $G(DEBUG) W ! ZWRITE DXRRAD
"RTN","SYNDHP05",138,0)
 ;I $G(DEBUG) W ! ZWRITE DXRPTRAD
"RTN","SYNDHP05",139,0)
 ;
"RTN","SYNDHP05",140,0)
 QUIT DXRRAD
"RTN","SYNDHP05",141,0)
 ;   RETSTA  - ICN^"IMG"|status|dateTime|provider|identifier|CPT|SCT|desc|primary dx|dx SCT|conclusion^...
"RTN","SYNDHP05",142,0)
 ;
"RTN","SYNDHP05",143,0)
BLDARRAY(RADEX,DXRPTRAD) ;Build an array from data returned by RADEXAM^SYNDHP55
"RTN","SYNDHP05",144,0)
 ;
"RTN","SYNDHP05",145,0)
 ;             1      2        3          4            5            6         7        8     9     10     11                 12      13        14        15       16           17
"RTN","SYNDHP05",146,0)
 ; RADEX(SEQ)=PID_U_PatDfn_U_Category_U_ExamDate_U_ExamDateHl7_U_caseNbr_U_PROCIEN_U_PROC_U_CPT_U_SCT_U_primaryDiagnosis_U_REQPHYS_U_PIRES_U_PISTAFF_U_VISITDT_U_VISITHL_U_EnteringUser
"RTN","SYNDHP05",147,0)
 ;               1     2        3         4        5         6               7                        8
"RTN","SYNDHP05",148,0)
 ; RADEX(SEQ,1)=PID^dayCase^dateTime^dateTimeHL7^status id^status^verifying physician id^verifying physician name
"RTN","SYNDHP05",149,0)
 ; RADEX(SEQ,"REPORT")=report
"RTN","SYNDHP05",150,0)
 ; RADEX(SEQ,"IMPRESSION")=impression
"RTN","SYNDHP05",151,0)
 ;
"RTN","SYNDHP05",152,0)
 N IDX S IDX=""
"RTN","SYNDHP05",153,0)
 F  S IDX=$O(RADEX(IDX)) QUIT:IDX=""  D
"RTN","SYNDHP05",154,0)
 . QUIT:'$D(RADEX(IDX,1))  ;there is no rad diag rpt for this exam
"RTN","SYNDHP05",155,0)
 . S PDATE=$P($G(RADEX(IDX,1)),U,3) ;exam date (FM)
"RTN","SYNDHP05",156,0)
 . QUIT:(PDATE<FRDAT)!(PDATE>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP05",157,0)
 . N RADEXAM S RADEXAM=$NA(DXRPTRAD("DxReportRad",IDX,"RadExam"))
"RTN","SYNDHP05",158,0)
 . S @RADEXAM@("resourceType")="DiagnosticReport"
"RTN","SYNDHP05",159,0)
 . S @RADEXAM@("resourceId")=$P($G(RADEX(IDX)),U,1)
"RTN","SYNDHP05",160,0)
 . S @RADEXAM@("status")="final"
"RTN","SYNDHP05",161,0)
 . S @RADEXAM@("patientId")=$P($G(RADEX(IDX)),U,2)
"RTN","SYNDHP05",162,0)
 . S @RADEXAM@("category")=$P($G(RADEX(IDX)),U,3)
"RTN","SYNDHP05",163,0)
 . S @RADEXAM@("ExamDateFM")=$P($G(RADEX(IDX)),U,4)
"RTN","SYNDHP05",164,0)
 . S @RADEXAM@("ExamDateHL7")=$P($G(RADEX(IDX)),U,5)
"RTN","SYNDHP05",165,0)
 . S @RADEXAM@("ExamDateFHIR")=$$FMTFHIR^SYNDHPUTL($P($G(RADEX(IDX)),U,4))
"RTN","SYNDHP05",166,0)
 . S @RADEXAM@("caseNbr")=$P($G(RADEX(IDX)),U,6)
"RTN","SYNDHP05",167,0)
 . S @RADEXAM@("procedureId")=$P($G(RADEX(IDX)),U,7)
"RTN","SYNDHP05",168,0)
 . S @RADEXAM@("procedure")=$P($G(RADEX(IDX)),U,8)
"RTN","SYNDHP05",169,0)
 . S @RADEXAM@("procedureCPT")=$P($G(RADEX(IDX)),U,9)
"RTN","SYNDHP05",170,0)
 . S @RADEXAM@("procedureSCT")=$P($G(RADEX(IDX)),U,10)
"RTN","SYNDHP05",171,0)
 . S @RADEXAM@("primaryDiagnosis")=$P($G(RADEX(IDX)),U,11)
"RTN","SYNDHP05",172,0)
 . S @RADEXAM@("primaryDiagnosisSCT")="" ;           <<<<<<<<<<<<<<<<<no icd to map
"RTN","SYNDHP05",173,0)
 . S @RADEXAM@("requestingPhysician")=$P($G(RADEX(IDX)),U,12)
"RTN","SYNDHP05",174,0)
 . S @RADEXAM@("primaryInterpretingResident")=$P($G(RADEX(IDX)),U,13)
"RTN","SYNDHP05",175,0)
 . S @RADEXAM@("primaryInterpretingStaff")=$P($G(RADEX(IDX)),U,14)
"RTN","SYNDHP05",176,0)
 . S @RADEXAM@("visitDateFM")=$P($G(RADEX(IDX)),U,15)
"RTN","SYNDHP05",177,0)
 . S @RADEXAM@("visitDateHL7")=$P($G(RADEX(IDX)),U,16)
"RTN","SYNDHP05",178,0)
 . S @RADEXAM@("visitDateFHIR")=$$FMTFHIR^SYNDHPUTL($P($G(RADEX(IDX)),U,15))
"RTN","SYNDHP05",179,0)
 . S @RADEXAM@("EnteringUser")=$P($G(RADEX(IDX)),U,17)
"RTN","SYNDHP05",180,0)
 . N RADRPT S RADRPT=$NA(DXRPTRAD("DxReportRad",IDX,"RadReport"))
"RTN","SYNDHP05",181,0)
 . S @RADRPT@("resourceId")=$P($G(RADEX(IDX,1)),U,1)
"RTN","SYNDHP05",182,0)
 . S @RADRPT@("dayCase")=$P($G(RADEX(IDX,1)),U,2)
"RTN","SYNDHP05",183,0)
 . S @RADRPT@("dateTimeFM")=$P($G(RADEX(IDX,1)),U,3)
"RTN","SYNDHP05",184,0)
 . S @RADRPT@("dateTimeHL7")=$P($G(RADEX(IDX,1)),U,4)
"RTN","SYNDHP05",185,0)
 . S @RADRPT@("dateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($P($G(RADEX(IDX,1)),U,3))
"RTN","SYNDHP05",186,0)
 . S @RADRPT@("statusId")=$P($G(RADEX(IDX,1)),U,5)
"RTN","SYNDHP05",187,0)
 . S @RADRPT@("status")=$P($G(RADEX(IDX,1)),U,6)
"RTN","SYNDHP05",188,0)
 . S @RADRPT@("verifyingPhysicianId")=$P($G(RADEX(IDX,1)),U,7)
"RTN","SYNDHP05",189,0)
 . S @RADRPT@("verifyingPhysicianName")=$P($G(RADEX(IDX,1)),U,8)
"RTN","SYNDHP05",190,0)
 . S @RADRPT@("conclusion")=$G(RADEX(IDX,"REPORT"))
"RTN","SYNDHP05",191,0)
 . S @RADRPT@("impression")=$G(RADEX(IDX,"IMPRESSION"))
"RTN","SYNDHP05",192,0)
 ;
"RTN","SYNDHP05",193,0)
 QUIT
"RTN","SYNDHP05",194,0)
 ;$$FMTFHIR^SYNDHPUTL(
"RTN","SYNDHP05",195,0)
DXMH(DXRPTMH,PATIEN,FRDAT,TODAT) ;get Mental Health Diagnosis
"RTN","SYNDHP05",196,0)
 ;
"RTN","SYNDHP05",197,0)
 N MHDXRS,SERMHDXRS,MHIEN,IENS,MAPPING
"RTN","SYNDHP05",198,0)
 N STATUS,DXDTFM,DXDTHL,DXBY,PID,STATUS,DXCODE,SDESC
"RTN","SYNDHP05",199,0)
 ;
"RTN","SYNDHP05",200,0)
 N SNOMED S SNOMED=""
"RTN","SYNDHP05",201,0)
 N S,P
"RTN","SYNDHP05",202,0)
 S S="_",P="|"
"RTN","SYNDHP05",203,0)
 ;
"RTN","SYNDHP05",204,0)
 I $G(DEBUG) W !,"Mental Health Diagnosis",!
"RTN","SYNDHP05",205,0)
 N MHDXRS S MHDXRS=""
"RTN","SYNDHP05",206,0)
 N FNBR1 S FNBR1=627.8 ;Diagnostic Results-Mental Health
"RTN","SYNDHP05",207,0)
 N SEQ S SEQ=0
"RTN","SYNDHP05",208,0)
 ;
"RTN","SYNDHP05",209,0)
 S MHIEN=""
"RTN","SYNDHP05",210,0)
 F  S MHIEN=$O(^YSD(627.8,"C",PATIEN,MHIEN)) QUIT:MHIEN=""  D
"RTN","SYNDHP05",211,0)
 . S IENS=MHIEN_","
"RTN","SYNDHP05",212,0)
 . S DXCODE=$$GET1^DIQ(FNBR1,IENS,1) ;diagnosis
"RTN","SYNDHP05",213,0)
 . QUIT:DXCODE=""
"RTN","SYNDHP05",214,0)
 . N DXMH
"RTN","SYNDHP05",215,0)
 . D GET1MHDX^SYNDHP17(.DXMH,MHIEN,0)
"RTN","SYNDHP05",216,0)
 . QUIT:$D(DXMH("Mhdiag","ERROR"))
"RTN","SYNDHP05",217,0)
 . I $D(DXMH("Mhdiag","ERROR")) M DXRPTMH("DxReportMH",MHIEN)=DXMH QUIT
"RTN","SYNDHP05",218,0)
 . ;I $G(DEBUG) ZWRITE DXMH
"RTN","SYNDHP05",219,0)
 . S DXDTFM=DXMH("Mhdiag","dateTimeOfDiagnosisFM") ;date/time of diagnosis fm format
"RTN","SYNDHP05",220,0)
 . QUIT:((DXDTFM\1)<FRDAT)!((DXDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP05",221,0)
 . S DXDTHL=DXMH("Mhdiag","dateTimeOfDiagnosisHL7") ;hl7 format date/time of diagnosis
"RTN","SYNDHP05",222,0)
 . S DXBY=DXMH("Mhdiag","diagnosisBy") ;diagnosed by
"RTN","SYNDHP05",223,0)
 . S DXCODE=DXMH("Mhdiag","diagnosis") ;diagnosis
"RTN","SYNDHP05",224,0)
 . S SDESC=$P($$ICDDX^ICDEX(DXCODE),U,4)
"RTN","SYNDHP05",225,0)
 . S STATUS=$$LOW^XLFSTR(DXMH("Mhdiag","statusVPRINRu")) ;status
"RTN","SYNDHP05",226,0)
 . S PID=DXMH("Mhdiag","resourceId")
"RTN","SYNDHP05",227,0)
 . S SNOMED=DXMH("Mhdiag","diagnosisSCT")
"RTN","SYNDHP05",228,0)
 . ;
"RTN","SYNDHP05",229,0)
 . ;^category|status|dateTime|provider|identifier|diag code|SCT|diag desc^...
"RTN","SYNDHP05",230,0)
 . S SEQ=SEQ+1
"RTN","SYNDHP05",231,0)
 . S MHDXRS(SEQ)=U_"MHDX"_P_STATUS_P_DXDTHL_P_DXBY_P_PID_P_DXCODE_P_SNOMED_P_SDESC
"RTN","SYNDHP05",232,0)
 . ;I $G(DEBUG) ZWRITE MHDXRS(SEQ)
"RTN","SYNDHP05",233,0)
 . M DXRPTMH("DxReportMH",MHIEN)=DXMH ;
"RTN","SYNDHP05",234,0)
 ;
"RTN","SYNDHP05",235,0)
 ;I $G(DEBUG) W ! ZWRITE MHDXRS
"RTN","SYNDHP05",236,0)
 ;I $G(DEBUG) W ! ZWRITE DXRPTMH
"RTN","SYNDHP05",237,0)
 ;
"RTN","SYNDHP05",238,0)
 ;serialize data
"RTN","SYNDHP05",239,0)
 S SERMHDXRS=""
"RTN","SYNDHP05",240,0)
 S SEQ=""
"RTN","SYNDHP05",241,0)
 F  S SEQ=$O(MHDXRS(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP05",242,0)
 . S SERMHDXRS=SERMHDXRS_MHDXRS(SEQ)
"RTN","SYNDHP05",243,0)
 ;
"RTN","SYNDHP05",244,0)
 ;I $G(DEBUG) W ! ZWRITE SERMHDXRS
"RTN","SYNDHP05",245,0)
 ;
"RTN","SYNDHP05",246,0)
 QUIT SERMHDXRS
"RTN","SYNDHP05",247,0)
 ;
"RTN","SYNDHP05",248,0)
DXVISIT(DXRPTV,PATIEN,FRDAT,TODAT) ; get visit diagnostic report
"RTN","SYNDHP05",249,0)
 ;
"RTN","SYNDHP05",250,0)
 N STATUS,DXDTHL,PROV,SERPOV,RESID,DXCODE,SNOMED,SDESC,MAPPING,SNOMED
"RTN","SYNDHP05",251,0)
 N SEQ S SEQ=0
"RTN","SYNDHP05",252,0)
 N DXVISIT S DXVISIT=""
"RTN","SYNDHP05",253,0)
 I $G(DEBUG) W !,"Visit Diagnosis",!
"RTN","SYNDHP05",254,0)
 ;patient - ^AUPNVPOV("C",
"RTN","SYNDHP05",255,0)
 N POVIEN S POVIEN=""
"RTN","SYNDHP05",256,0)
 F  S POVIEN=$O(^AUPNVPOV("C",PATIEN,POVIEN)) QUIT:POVIEN=""  D
"RTN","SYNDHP05",257,0)
 . N VPOV
"RTN","SYNDHP05",258,0)
 . D GET1VPOV^SYNDHP13(.VPOV,POVIEN,0)
"RTN","SYNDHP05",259,0)
 . I $D(VPOV("V POV","ERROR")) M DXRPTV("DxReportVisit",POVIEN)=VPOV QUIT
"RTN","SYNDHP05",260,0)
 . S VPOV("V POV","resourceType")="DiagnosticReport"
"RTN","SYNDHP05",261,0)
 . S STATUS="final"
"RTN","SYNDHP05",262,0)
 . S DXDTFM=VPOV("V POV","visitFM")
"RTN","SYNDHP05",263,0)
 . QUIT:((DXDTFM\1)<FRDAT)!((DXDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP05",264,0)
 . S DXDTHL=VPOV("V POV","visitHL7")
"RTN","SYNDHP05",265,0)
 . S PROV=VPOV("V POV","encounterProvider")
"RTN","SYNDHP05",266,0)
 . S RESID=VPOV("V POV","resourceId")
"RTN","SYNDHP05",267,0)
 . S DXCODE=VPOV("V POV","pov")
"RTN","SYNDHP05",268,0)
 . S SDESC=$P($$ICDDX^ICDEX(DXCODE),U,4)
"RTN","SYNDHP05",269,0)
 . S SNOMED=VPOV("V POV","povSCT")
"RTN","SYNDHP05",270,0)
 . ;^category|status|dateTime|provider|identifier|ICD|SCT|diag desc^...
"RTN","SYNDHP05",271,0)
 . S SEQ=SEQ+1
"RTN","SYNDHP05",272,0)
 . S DXVISIT(SEQ)=U_"VISIT"_P_STATUS_P_DXDTHL_P_PROV_P_RESID_P_DXCODE_P_SNOMED_P_SDESC
"RTN","SYNDHP05",273,0)
 . M DXRPTV("DxReportVisit",POVIEN)=VPOV ;
"RTN","SYNDHP05",274,0)
 ;serialize data
"RTN","SYNDHP05",275,0)
 S SERPOV=""
"RTN","SYNDHP05",276,0)
 S SEQ=""
"RTN","SYNDHP05",277,0)
 F  S SEQ=$O(DXVISIT(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP05",278,0)
 . S SERPOV=SERPOV_DXVISIT(SEQ)
"RTN","SYNDHP05",279,0)
 ;
"RTN","SYNDHP05",280,0)
 ;I $G(DEBUG) W ! ZWRITE SERPOV
"RTN","SYNDHP05",281,0)
 ;I $G(DEBUG) W ! ZWRITE DXRPTV
"RTN","SYNDHP05",282,0)
 ;
"RTN","SYNDHP05",283,0)
 QUIT SERPOV
"RTN","SYNDHP05",284,0)
 ;
"RTN","SYNDHP05",285,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP05",286,0)
T1 ;
"RTN","SYNDHP05",287,0)
 N ICN S ICN="10101V964144"
"RTN","SYNDHP05",288,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP05",289,0)
 N TODAT S TODAT=""
"RTN","SYNDHP05",290,0)
 N JSON S JSON=""
"RTN","SYNDHP05",291,0)
 N RETSTA
"RTN","SYNDHP05",292,0)
 D PATDXRI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP05",293,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP05",294,0)
 QUIT
"RTN","SYNDHP05",295,0)
 ;
"RTN","SYNDHP05",296,0)
T2 ;
"RTN","SYNDHP05",297,0)
 N ICN S ICN="10101V964144"
"RTN","SYNDHP05",298,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP05",299,0)
 N TODAT S TODAT=""
"RTN","SYNDHP05",300,0)
 N JSON S JSON="J"
"RTN","SYNDHP05",301,0)
 N RETSTA
"RTN","SYNDHP05",302,0)
 D PATDXRI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP05",303,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP05",304,0)
 QUIT
"RTN","SYNDHP05",305,0)
 ;
"RTN","SYNDHP06")
0^98^B14159682
"RTN","SYNDHP06",1,0)
SYNDHP06 ; HC/rbd/art - HealthConcourse - get hospital location and institution data ;05/07/2019
"RTN","SYNDHP06",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP06",3,0)
 ;;
"RTN","SYNDHP06",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP06",5,0)
 ;
"RTN","SYNDHP06",6,0)
 QUIT
"RTN","SYNDHP06",7,0)
 ;
"RTN","SYNDHP06",8,0)
 ; ---------------- Get institution details for hospital location ------------------------------
"RTN","SYNDHP06",9,0)
 ;
"RTN","SYNDHP06",10,0)
HOSINSTI(RETSTA,HLOCNAME,RETJSON) ; takes Hospital Location name and returns Institution and Inst. details
"RTN","SYNDHP06",11,0)
 ;
"RTN","SYNDHP06",12,0)
 ; Return Institution and Inst. details for a given Hospital Location name
"RTN","SYNDHP06",13,0)
 ;
"RTN","SYNDHP06",14,0)
 ; Input:
"RTN","SYNDHP06",15,0)
 ;   HLOCNAME  - Hospital Location name
"RTN","SYNDHP06",16,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP06",17,0)
 ;             F = Return FHIR
"RTN","SYNDHP06",18,0)
 ;             0 or null = Return Location string (default)
"RTN","SYNDHP06",19,0)
 ; Output:
"RTN","SYNDHP06",20,0)
 ;   RETSTA  - a delimited string that lists institution details for hospital location name
"RTN","SYNDHP06",21,0)
 ;             LocName^LocIEN|institutionName|instIEN|instStreet1|instStreet2|instCity|instState|instZip|contactName1_Phone1*repeats|resourceId
"RTN","SYNDHP06",22,0)
 ;          or hospital location & institution data in JSON format
"RTN","SYNDHP06",23,0)
 ;
"RTN","SYNDHP06",24,0)
 ; validate Hospital Location name
"RTN","SYNDHP06",25,0)
 I $G(HLOCNAME)="" S RETSTA="-1^What location?" QUIT
"RTN","SYNDHP06",26,0)
 I '$D(^SC("B",HLOCNAME)) S RETSTA="-1^Hospital Location name not recognised^"_HLOCNAME Q
"RTN","SYNDHP06",27,0)
 ;
"RTN","SYNDHP06",28,0)
 N HLOCARR
"RTN","SYNDHP06",29,0)
 S RETSTA=$$INSTS(HLOCNAME,.HLOCARR)
"RTN","SYNDHP06",30,0)
 ;
"RTN","SYNDHP06",31,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP06",32,0)
 ;
"RTN","SYNDHP06",33,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP06",34,0)
 . S RETSTA=""
"RTN","SYNDHP06",35,0)
 . D TOJASON^SYNDHPUTL(.HLOCARR,.RETSTA)
"RTN","SYNDHP06",36,0)
 ;
"RTN","SYNDHP06",37,0)
 QUIT
"RTN","SYNDHP06",38,0)
 ;
"RTN","SYNDHP06",39,0)
INSTS(HLOCNAME,HLOCARR) ; get locations for encounters for a patient
"RTN","SYNDHP06",40,0)
 ;
"RTN","SYNDHP06",41,0)
 N C,P,S,A,ZARR
"RTN","SYNDHP06",42,0)
 N CONTNAM,CONTPH,CONTSTR,HSLOCID,INSTCITY,INSTIEN,INSTNAM,INSTST1,INSTST2,INSTSTAT,INSTZIP
"RTN","SYNDHP06",43,0)
 S C=",",P="|",S="_",A="*"
"RTN","SYNDHP06",44,0)
 N FNUM S FNUM=44        ; HOSPITAL LOCATION file
"RTN","SYNDHP06",45,0)
 ; scan hospital location "B" index for HLIEN
"RTN","SYNDHP06",46,0)
 N HLIEN S HLIEN=""
"RTN","SYNDHP06",47,0)
 F  S HLIEN=$O(^SC("B",HLOCNAME,HLIEN)) Q:HLIEN=""  D
"RTN","SYNDHP06",48,0)
 .N HOSPLOC
"RTN","SYNDHP06",49,0)
 .D GETHLOC^SYNDHP22(.HOSPLOC,HLIEN)
"RTN","SYNDHP06",50,0)
 .I $D(HOSPLOC("Hosploc","ERROR")) M HLOCARR("Location",HLIEN)=HOSPLOC QUIT
"RTN","SYNDHP06",51,0)
 .S INSTNAM=HOSPLOC("Hosploc","institution")
"RTN","SYNDHP06",52,0)
 .S INSTIEN=HOSPLOC("Hosploc","institutionId")
"RTN","SYNDHP06",53,0)
 .S HSLOCID=HOSPLOC("Hosploc","resourceId")
"RTN","SYNDHP06",54,0)
 .N SITE
"RTN","SYNDHP06",55,0)
 .D GET1SITE^SYNDHP10(.SITE,INSTIEN,0)
"RTN","SYNDHP06",56,0)
 .I $D(SITE("Site","ERROR")) M HLOCARR("Location",HLIEN)=SITE QUIT
"RTN","SYNDHP06",57,0)
 .S INSTST1=SITE("Site","streetAddr1")
"RTN","SYNDHP06",58,0)
 .S INSTST2=SITE("Site","streetAddr2")
"RTN","SYNDHP06",59,0)
 .S INSTCITY=SITE("Site","city")
"RTN","SYNDHP06",60,0)
 .S INSTZIP=SITE("Site","zip")
"RTN","SYNDHP06",61,0)
 .S INSTSTAT=SITE("Site","state")
"RTN","SYNDHP06",62,0)
 .S CONTSTR=""
"RTN","SYNDHP06",63,0)
 .N IENS2 S IENS2=""
"RTN","SYNDHP06",64,0)
 .F  S IENS2=$O(SITE("Site","contacts","contact",IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP06",65,0)
 ..N CONTACT S CONTACT=$NA(SITE("Site","contacts","contact",+IENS2))
"RTN","SYNDHP06",66,0)
 ..S CONTNAM=@CONTACT@("contact")
"RTN","SYNDHP06",67,0)
 ..S CONTPH=@CONTACT@("phone")
"RTN","SYNDHP06",68,0)
 ..S CONTSTR=CONTSTR_CONTNAM_S_CONTPH_A
"RTN","SYNDHP06",69,0)
 .S:CONTSTR]"" CONTSTR=$E(CONTSTR,1,$L(CONTSTR)-1)
"RTN","SYNDHP06",70,0)
 .I $G(DEBUG) W !,HLOCNAME,A,HLIEN,A,INSTNAM,A,INSTIEN,A,INSTST1,A,INSTST2,A,INSTCITY,A,INSTSTAT,A,INSTZIP,A,CONTSTR,A,HSLOCID,!!
"RTN","SYNDHP06",71,0)
 .S ZARR(HLOCNAME,HLIEN)=INSTNAM_P_INSTIEN_P_INSTST1_P_INSTST2_P_INSTCITY_P_INSTSTAT_P_INSTZIP_P_CONTSTR_P_HSLOCID
"RTN","SYNDHP06",72,0)
 .M HLOCARR("Location",HLIEN)=HOSPLOC
"RTN","SYNDHP06",73,0)
 .M HLOCARR("Location",HLIEN,"institution")=SITE("Site")
"RTN","SYNDHP06",74,0)
 ;
"RTN","SYNDHP06",75,0)
 ; serialize data
"RTN","SYNDHP06",76,0)
 N HLREC,VSTDT,VIEN
"RTN","SYNDHP06",77,0)
 N HLOC S HLOC=HLOCNAME
"RTN","SYNDHP06",78,0)
 S (VSTDT,VIEN)=""
"RTN","SYNDHP06",79,0)
 F  S HLIEN=$O(ZARR(HLOCNAME,HLIEN)) Q:HLIEN=""  D
"RTN","SYNDHP06",80,0)
 .S HLREC=ZARR(HLOCNAME,HLIEN)
"RTN","SYNDHP06",81,0)
 .S HLOC=HLOC_U_HLIEN_P_HLREC
"RTN","SYNDHP06",82,0)
 ;
"RTN","SYNDHP06",83,0)
 Q HLOC
"RTN","SYNDHP06",84,0)
 ;
"RTN","SYNDHP06",85,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP06",86,0)
T1 ;
"RTN","SYNDHP06",87,0)
 N LOCNAME S LOCNAME="GENERAL MEDICINE"
"RTN","SYNDHP06",88,0)
 N JSON S JSON=""
"RTN","SYNDHP06",89,0)
 N RETSTA
"RTN","SYNDHP06",90,0)
 D HOSINSTI(.RETSTA,LOCNAME,JSON)
"RTN","SYNDHP06",91,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP06",92,0)
 QUIT
"RTN","SYNDHP06",93,0)
 ;
"RTN","SYNDHP06",94,0)
T2 ;
"RTN","SYNDHP06",95,0)
 N LOCNAME S LOCNAME="GENERAL MEDICINE"
"RTN","SYNDHP06",96,0)
 N JSON S JSON="J"
"RTN","SYNDHP06",97,0)
 N RETSTA
"RTN","SYNDHP06",98,0)
 D HOSINSTI(.RETSTA,LOCNAME,JSON)
"RTN","SYNDHP06",99,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP06",100,0)
 QUIT
"RTN","SYNDHP06",101,0)
 ;
"RTN","SYNDHP07")
0^99^B20083819
"RTN","SYNDHP07",1,0)
SYNDHP07 ; HC/rbd/art - HealthConcourse - get patient's nursing care plan data ;05/04/2019
"RTN","SYNDHP07",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP07",3,0)
 ;;
"RTN","SYNDHP07",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP07",5,0)
 ;
"RTN","SYNDHP07",6,0)
 QUIT
"RTN","SYNDHP07",7,0)
 ;
"RTN","SYNDHP07",8,0)
 ;
"RTN","SYNDHP07",9,0)
 ; ---------------- Get patient nursing care plan goals information ------------------------
"RTN","SYNDHP07",10,0)
 ;
"RTN","SYNDHP07",11,0)
PATGOLI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient goals for ICN
"RTN","SYNDHP07",12,0)
 ;
"RTN","SYNDHP07",13,0)
 ; Return patient nursing care plan goals for a given patient ICN
"RTN","SYNDHP07",14,0)
 ;
"RTN","SYNDHP07",15,0)
 ; Input:
"RTN","SYNDHP07",16,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP07",17,0)
 ;   FRDAT   - from date (inclusive), optional, compares to date/time entered
"RTN","SYNDHP07",18,0)
 ;   TODAT   - to date (inclusive), optional, compares to date/time entered
"RTN","SYNDHP07",19,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP07",20,0)
 ;             F = Return FHIR
"RTN","SYNDHP07",21,0)
 ;             0 or null = Return patient goals string (default)
"RTN","SYNDHP07",22,0)
 ; Output:
"RTN","SYNDHP07",23,0)
 ;   RETSTA  - a delimited string that lists patient goals information
"RTN","SYNDHP07",24,0)
 ;             ICN ^ Resource ID | Date/Time Entered | Goal/Expected Outcome | Target Date | User Who Entered | code ; Status of Goal ^ ...
"RTN","SYNDHP07",25,0)
 ;          or patient nursing care plans in JSON format
"RTN","SYNDHP07",26,0)
 ;
"RTN","SYNDHP07",27,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP07",28,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP07",29,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP07",30,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP07",31,0)
 ;
"RTN","SYNDHP07",32,0)
 ; validate ICN
"RTN","SYNDHP07",33,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP07",34,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP07",35,0)
 ; 
"RTN","SYNDHP07",36,0)
 ; get patient IEN from ICN
"RTN","SYNDHP07",37,0)
 N NCPARR
"RTN","SYNDHP07",38,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP07",39,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP07",40,0)
 ;
"RTN","SYNDHP07",41,0)
 S RETSTA=$$GOALS(.NCPARR,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP07",42,0)
 ;
"RTN","SYNDHP07",43,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP07",44,0)
 ;
"RTN","SYNDHP07",45,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP07",46,0)
 . S RETSTA=""
"RTN","SYNDHP07",47,0)
 . D TOJASON^SYNDHPUTL(.NCPARR,.RETSTA)
"RTN","SYNDHP07",48,0)
 ;
"RTN","SYNDHP07",49,0)
 QUIT
"RTN","SYNDHP07",50,0)
 ;
"RTN","SYNDHP07",51,0)
GOALS(NCPARR,PATIEN,DHPICN,FRDAT,TODAT) ; get goals for a patient
"RTN","SYNDHP07",52,0)
 ;
"RTN","SYNDHP07",53,0)
 N FNUM S FNUM=216.8      ;  file
"RTN","SYNDHP07",54,0)
 N S S S="_"
"RTN","SYNDHP07",55,0)
 N P S P="|"
"RTN","SYNDHP07",56,0)
 ; scan PATIENT "TARG" index in Nursing Care Plan file for Goals
"RTN","SYNDHP07",57,0)
 N TARGNUM,PTGOLID,ENTRYDT,ENTRYDTFM,ENTRDISP,GOAL,TARGDISP,ENTUSER,GOALSTAT,ZARR,GOALREC
"RTN","SYNDHP07",58,0)
 N MRECIEN S MRECIEN=""
"RTN","SYNDHP07",59,0)
 F  S MRECIEN=$O(^GMR(124.3,"C",PATIEN,MRECIEN)) QUIT:MRECIEN=""  D
"RTN","SYNDHP07",60,0)
 . N NCP
"RTN","SYNDHP07",61,0)
 . D GET1NCP^SYNDHP15(.NCP,MRECIEN,0)
"RTN","SYNDHP07",62,0)
 . I $D(NCP("NurseCarePlan","ERROR")) M NCPARR("NCPS",MRECIEN)=NCP QUIT
"RTN","SYNDHP07",63,0)
 . S TARGNUM=""
"RTN","SYNDHP07",64,0)
 . F  S TARGNUM=$O(NCP("NurseCarePlan","targetDates","targetDate",TARGNUM)) QUIT:TARGNUM=""  D
"RTN","SYNDHP07",65,0)
 . . S PTGOLID=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"resourceId")
"RTN","SYNDHP07",66,0)
 . . S ENTRYDT=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"dateTimeEntered")
"RTN","SYNDHP07",67,0)
 . . S ENTRYDTFM=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"dateTimeEnteredFM")
"RTN","SYNDHP07",68,0)
 . . QUIT:((ENTRYDTFM\1)<FRDAT)!((ENTRYDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP07",69,0)
 . . S ENTRDISP=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"dateTimeEnteredHL7")
"RTN","SYNDHP07",70,0)
 . . S GOAL=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"goalExpectedOutcome")
"RTN","SYNDHP07",71,0)
 . . S TARGDISP=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"targetDateHL7")
"RTN","SYNDHP07",72,0)
 . . S ENTUSER=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"userWhoEntered")
"RTN","SYNDHP07",73,0)
 . . S GOALSTAT=NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"goalMetDcdCd")_";"_NCP("NurseCarePlan","targetDates","targetDate",TARGNUM,"goalMetDcd")
"RTN","SYNDHP07",74,0)
 . . S ZARR(DHPICN,ENTRYDTFM,GOAL)=PTGOLID_P_ENTRDISP_P_GOAL_P_TARGDISP_P_ENTUSER_P_GOALSTAT
"RTN","SYNDHP07",75,0)
 . M NCPARR("NCPS",MRECIEN)=NCP ;
"RTN","SYNDHP07",76,0)
 ;
"RTN","SYNDHP07",77,0)
 ; serialize data
"RTN","SYNDHP07",78,0)
 S ENTRYDT=""
"RTN","SYNDHP07",79,0)
 N GOALS S GOALS=DHPICN
"RTN","SYNDHP07",80,0)
 F  S ENTRYDT=$O(ZARR(DHPICN,ENTRYDT)) Q:ENTRYDT=""  D
"RTN","SYNDHP07",81,0)
 . S GOAL=""
"RTN","SYNDHP07",82,0)
 . F  S GOAL=$O(ZARR(DHPICN,ENTRYDT,GOAL)) Q:GOAL=""  D
"RTN","SYNDHP07",83,0)
 . . S GOALREC=ZARR(DHPICN,ENTRYDT,GOAL)
"RTN","SYNDHP07",84,0)
 . . S GOALS=GOALS_U_GOALREC
"RTN","SYNDHP07",85,0)
 ;
"RTN","SYNDHP07",86,0)
 QUIT GOALS
"RTN","SYNDHP07",87,0)
 ;
"RTN","SYNDHP07",88,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP07",89,0)
T1 ;
"RTN","SYNDHP07",90,0)
 N ICN S ICN="1967316818V742124"
"RTN","SYNDHP07",91,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP07",92,0)
 N TODAT S TODAT=""
"RTN","SYNDHP07",93,0)
 N JSON S JSON=""
"RTN","SYNDHP07",94,0)
 N RETSTA
"RTN","SYNDHP07",95,0)
 D PATGOLI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP07",96,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP07",97,0)
 QUIT
"RTN","SYNDHP07",98,0)
 ;
"RTN","SYNDHP07",99,0)
T2 ;
"RTN","SYNDHP07",100,0)
 N ICN S ICN="1967316818V742124"
"RTN","SYNDHP07",101,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP07",102,0)
 N TODAT S TODAT=""
"RTN","SYNDHP07",103,0)
 N JSON S JSON="J"
"RTN","SYNDHP07",104,0)
 N RETSTA
"RTN","SYNDHP07",105,0)
 D PATGOLI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP07",106,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP07",107,0)
 QUIT
"RTN","SYNDHP07",108,0)
 ;
"RTN","SYNDHP08")
0^100^B14232287
"RTN","SYNDHP08",1,0)
SYNDHP08 ; HC/rbd/art - HealthConcourse - get patient flag data ;05/04/2019
"RTN","SYNDHP08",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP08",3,0)
 ;;
"RTN","SYNDHP08",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP08",5,0)
 ;
"RTN","SYNDHP08",6,0)
 QUIT
"RTN","SYNDHP08",7,0)
 ;
"RTN","SYNDHP08",8,0)
 ; ---------------- Get patient flag information ------------------------------
"RTN","SYNDHP08",9,0)
 ;
"RTN","SYNDHP08",10,0)
PATFLGI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient flags for ICN
"RTN","SYNDHP08",11,0)
 ;
"RTN","SYNDHP08",12,0)
 ; Return patient flags for a given patient ICN
"RTN","SYNDHP08",13,0)
 ;
"RTN","SYNDHP08",14,0)
 ; Input:
"RTN","SYNDHP08",15,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP08",16,0)
 ;   FRDAT   - from date (inclusive), optional, not used, no logical date to compare
"RTN","SYNDHP08",17,0)
 ;   TODAT   - to date (inclusive), optional, not used, no logical date to compare
"RTN","SYNDHP08",18,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP08",19,0)
 ;             F = Return FHIR
"RTN","SYNDHP08",20,0)
 ;             0 or null = Return patient flags string (default)
"RTN","SYNDHP08",21,0)
 ; Output:
"RTN","SYNDHP08",22,0)
 ;   RETSTA  - a delimited string that lists patient flag information
"RTN","SYNDHP08",23,0)
 ;             ICN^flag name|SNOMED CT code|flag record IEN|national or local|status|owner site|originating site|review date|resource id^...
"RTN","SYNDHP08",24,0)
 ;          or patient flags in JSON format
"RTN","SYNDHP08",25,0)
 ;
"RTN","SYNDHP08",26,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP08",27,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP08",28,0)
 I $G(DEBUG) W !,"DHPICN: ",DHPICN,"   FRDAT: ",FRDAT,"   TODAT: ",TODAT,"   RETJSON: ",RETJSON,!
"RTN","SYNDHP08",29,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP08",30,0)
 ;patient flag data does not contain a date to compare to TODAT or FRDAT
"RTN","SYNDHP08",31,0)
 ;
"RTN","SYNDHP08",32,0)
 ; validate ICN
"RTN","SYNDHP08",33,0)
 I $G(DHPICN)="" S RETSTA="-1^What Patient?" QUIT
"RTN","SYNDHP08",34,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP08",35,0)
 ; 
"RTN","SYNDHP08",36,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP08",37,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP08",38,0)
 ;
"RTN","SYNDHP08",39,0)
 N FLAGARR
"RTN","SYNDHP08",40,0)
 S RETSTA=$$FLAGS(.FLAGARR,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP08",41,0)
 ;
"RTN","SYNDHP08",42,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP08",43,0)
 ;
"RTN","SYNDHP08",44,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP08",45,0)
 . S RETSTA=""
"RTN","SYNDHP08",46,0)
 . D TOJASON^SYNDHPUTL(.FLAGARR,.RETSTA)
"RTN","SYNDHP08",47,0)
 ;
"RTN","SYNDHP08",48,0)
 QUIT
"RTN","SYNDHP08",49,0)
 ;
"RTN","SYNDHP08",50,0)
FLAGS(FLAGARR,PATIEN,DHPICN,FRDAT,TODAT) ; get flags for a patient
"RTN","SYNDHP08",51,0)
 ;
"RTN","SYNDHP08",52,0)
 N FLAGREC,ZARR
"RTN","SYNDHP08",53,0)
 N PTFLGID,FLAGDESC,NATLOC,STATUS,OWNSITE,ORIGSITE,RVWDT,RVWDTDSP,FLAGSCT
"RTN","SYNDHP08",54,0)
 N C,P,S S C=",",P="|",S="_"
"RTN","SYNDHP08",55,0)
 ;
"RTN","SYNDHP08",56,0)
 N FNUM S FNUM=26.13      ;  file
"RTN","SYNDHP08",57,0)
 ; scan PATIENT "B" index for Flags
"RTN","SYNDHP08",58,0)
 ;S DHPICN=PATIEN
"RTN","SYNDHP08",59,0)
 N FLAGIEN S FLAGIEN=0
"RTN","SYNDHP08",60,0)
 F  S FLAGIEN=$O(^DGPF(26.13,"B",PATIEN,FLAGIEN)) QUIT:FLAGIEN=""  D
"RTN","SYNDHP08",61,0)
 . N FLAG
"RTN","SYNDHP08",62,0)
 . D GET1FLAG^SYNDHP17(.FLAG,FLAGIEN,0)
"RTN","SYNDHP08",63,0)
 . I $D(FLAG("Flag","ERROR")) M FLAGARR("Flags",FLAGIEN)=FLAG QUIT
"RTN","SYNDHP08",64,0)
 . ;I $G(DEBUG) W ! ZWRITE FLAG
"RTN","SYNDHP08",65,0)
 . S PTFLGID=FLAG("Flag","resourceId")
"RTN","SYNDHP08",66,0)
 . S FLAGDESC=FLAG("Flag","flagName") ;flag name
"RTN","SYNDHP08",67,0)
 . S NATLOC=$S(FLAG("Flag","flagNameId")["26.15":"National",1:"Local")
"RTN","SYNDHP08",68,0)
 . S STATUS=FLAG("Flag","status") ;status
"RTN","SYNDHP08",69,0)
 . S OWNSITE=FLAG("Flag","ownerSite") ;owner site
"RTN","SYNDHP08",70,0)
 . S ORIGSITE=FLAG("Flag","originatingSite") ;originating site
"RTN","SYNDHP08",71,0)
 . S RVWDT=FLAG("Flag","reviewDateFM") ;review date
"RTN","SYNDHP08",72,0)
 . S RVWDTDSP=FLAG("Flag","reviewDateHL7")
"RTN","SYNDHP08",73,0)
 . S FLAGSCT=FLAG("Flag","flagSCT")
"RTN","SYNDHP08",74,0)
 . ;S ASSNARR=FLAG("Flag","assignmentNarrative")
"RTN","SYNDHP08",75,0)
 . S ZARR(DHPICN,FLAGDESC)=FLAGSCT_P_FLAGIEN_P_NATLOC_P_STATUS_P_OWNSITE_P_ORIGSITE_P_RVWDTDSP_P_PTFLGID
"RTN","SYNDHP08",76,0)
 . M FLAGARR("Flags",FLAGIEN)=FLAG ;
"RTN","SYNDHP08",77,0)
 ;
"RTN","SYNDHP08",78,0)
 ; serialize data
"RTN","SYNDHP08",79,0)
 N FLAGDESC S FLAGDESC=""
"RTN","SYNDHP08",80,0)
 N FLAGS S FLAGS=DHPICN
"RTN","SYNDHP08",81,0)
 F  S FLAGDESC=$O(ZARR(DHPICN,FLAGDESC)) QUIT:FLAGDESC=""  D
"RTN","SYNDHP08",82,0)
 . S FLAGREC=ZARR(DHPICN,FLAGDESC)
"RTN","SYNDHP08",83,0)
 . S FLAGS=FLAGS_U_FLAGDESC_P_FLAGREC
"RTN","SYNDHP08",84,0)
 ;
"RTN","SYNDHP08",85,0)
 QUIT FLAGS
"RTN","SYNDHP08",86,0)
 ;
"RTN","SYNDHP08",87,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP08",88,0)
T1 ;
"RTN","SYNDHP08",89,0)
 N ICN S ICN="10189V514254"
"RTN","SYNDHP08",90,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP08",91,0)
 N TODAT S TODAT=""
"RTN","SYNDHP08",92,0)
 N JSON S JSON=""
"RTN","SYNDHP08",93,0)
 N RETSTA
"RTN","SYNDHP08",94,0)
 D PATFLGI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP08",95,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP08",96,0)
 QUIT
"RTN","SYNDHP08",97,0)
 ;
"RTN","SYNDHP08",98,0)
T2 ;
"RTN","SYNDHP08",99,0)
 N ICN S ICN="10189V514254"
"RTN","SYNDHP08",100,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP08",101,0)
 N TODAT S TODAT=""
"RTN","SYNDHP08",102,0)
 N JSON S JSON="J"
"RTN","SYNDHP08",103,0)
 N RETSTA
"RTN","SYNDHP08",104,0)
 D PATFLGI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP08",105,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP08",106,0)
 QUIT
"RTN","SYNDHP08",107,0)
 ;
"RTN","SYNDHP09")
0^101^B50112432
"RTN","SYNDHP09",1,0)
SYNDHP09 ; HC/fjf/art - HealthConcourse - get patient health factors ;05/04/2019
"RTN","SYNDHP09",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP09",3,0)
 ;;
"RTN","SYNDHP09",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP09",5,0)
 ;
"RTN","SYNDHP09",6,0)
 QUIT
"RTN","SYNDHP09",7,0)
 ;
"RTN","SYNDHP09",8,0)
 ; ---------------- Get patient health factors ------------------------------
"RTN","SYNDHP09",9,0)
 ;
"RTN","SYNDHP09",10,0)
PATHLF(RETSTA,NAME,SSN,DOB,GENDER,FRDAT,TODAT,RETJSON) ; get health factors for a patient by traits
"RTN","SYNDHP09",11,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP09",12,0)
 QUIT
"RTN","SYNDHP09",13,0)
 ;
"RTN","SYNDHP09",14,0)
 ; Return patient health factors for name, SSN, DOB, and gender
"RTN","SYNDHP09",15,0)
 ;
"RTN","SYNDHP09",16,0)
 ; Input:
"RTN","SYNDHP09",17,0)
 ;   NAME    - patient name
"RTN","SYNDHP09",18,0)
 ;   SSN     - social security number
"RTN","SYNDHP09",19,0)
 ;   DOB     - date of birth
"RTN","SYNDHP09",20,0)
 ;   GENDER  - gender
"RTN","SYNDHP09",21,0)
 ;   FRDAT   - from date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP09",22,0)
 ;   TODAT   - to date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP09",23,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP09",24,0)
 ;             F = Return FHIR
"RTN","SYNDHP09",25,0)
 ;             0 or null = Return health factors string (default)
"RTN","SYNDHP09",26,0)
 ; Output:
"RTN","SYNDHP09",27,0)
 ;   RETSTA  - a delimited string that lists SNOMED CDT codes for the patient health factors
"RTN","SYNDHP09",28,0)
 ;           - ICN^SCT code|HF Name|Resource ID|HF Severity|Encounter Provider|Visit Date^SCT code...   
"RTN","SYNDHP09",29,0)
 ;          or patient health factors in JSON format
"RTN","SYNDHP09",30,0)
 ;
"RTN","SYNDHP09",31,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP09",32,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP09",33,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP09",34,0)
 ;
"RTN","SYNDHP09",35,0)
 N ICNST
"RTN","SYNDHP09",36,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP09",37,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP09",38,0)
 N DHPICN S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP09",39,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP09",40,0)
 ;
"RTN","SYNDHP09",41,0)
 N HFARRAY
"RTN","SYNDHP09",42,0)
 S RETSTA=$$HLFS(.HFARRAY,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP09",43,0)
 ;
"RTN","SYNDHP09",44,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP09",45,0)
 ;
"RTN","SYNDHP09",46,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP09",47,0)
 . S RETSTA=""
"RTN","SYNDHP09",48,0)
 . D TOJASON^SYNDHPUTL(.HFARRAY,.RETSTA)
"RTN","SYNDHP09",49,0)
 ;
"RTN","SYNDHP09",50,0)
 QUIT
"RTN","SYNDHP09",51,0)
 ;
"RTN","SYNDHP09",52,0)
 ; ---------------- Get patient health factors ------------------------------
"RTN","SYNDHP09",53,0)
 ;
"RTN","SYNDHP09",54,0)
PATHLFI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient health factors for ICN
"RTN","SYNDHP09",55,0)
 ;
"RTN","SYNDHP09",56,0)
 ; Return patient vitals for a given patient ICN
"RTN","SYNDHP09",57,0)
 ;
"RTN","SYNDHP09",58,0)
 ; Input:
"RTN","SYNDHP09",59,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP09",60,0)
 ;   FRDAT   - from date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP09",61,0)
 ;   TODAT   - to date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP09",62,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP09",63,0)
 ;             F = Return FHIR
"RTN","SYNDHP09",64,0)
 ;             0 or null = Return health factors string (default)
"RTN","SYNDHP09",65,0)
 ; Output:
"RTN","SYNDHP09",66,0)
 ;   RETSTA  - a delimited string that list the health factors for the patient
"RTN","SYNDHP09",67,0)
 ;           - ICN^SCT code|HF Name|Resource ID|HF Severity|Encounter Provider|Visit Date^...
"RTN","SYNDHP09",68,0)
 ;          or patient health factors in JSON format
"RTN","SYNDHP09",69,0)
 ;
"RTN","SYNDHP09",70,0)
 ; bypass for CQM
"RTN","SYNDHP09",71,0)
 ; 
"RTN","SYNDHP09",72,0)
 ; ***********
"RTN","SYNDHP09",73,0)
 ; *********** Important Note for open source community
"RTN","SYNDHP09",74,0)
 ; ***********
"RTN","SYNDHP09",75,0)
 ; *********** Perspecta - who developed this source code and have released it to the open source
"RTN","SYNDHP09",76,0)
 ; *********** need the following six lines to remain intact
"RTN","SYNDHP09",77,0)
 ; 
"RTN","SYNDHP09",78,0)
 I DHPICN="2495309561V670720" D  QUIT
"RTN","SYNDHP09",79,0)
 . S RETSTA="2495309561V670720^75624-7|5 or more drinks|442_130_1014|9|9990000033|20170101^24165007|Alcohol Counseling and Treatment|442_130_101||9990000033|20170101"
"RTN","SYNDHP09",80,0)
 I DHPICN="1686299845V246594" D  QUIT
"RTN","SYNDHP09",81,0)
 . S RETSTA="1686299845V246594^44249-1|PHQ-9|442_130_1014|4.0|9990000033|20170101"
"RTN","SYNDHP09",82,0)
 ;I DHPICN="2495309561V670720" D  QUIT
"RTN","SYNDHP09",83,0)
 ;. S RETSTA="2495309561V670720^24165007|Alcohol Counseling and Treatment|442_130_101||9990000033|20170101"
"RTN","SYNDHP09",84,0)
 ;
"RTN","SYNDHP09",85,0)
 ; *********** the above lines will be redacted by Perspecta at some suitable juncture to 
"RTN","SYNDHP09",86,0)
 ; *********** be determined by Perspecta
"RTN","SYNDHP09",87,0)
 ; ***********
"RTN","SYNDHP09",88,0)
 ; *********** End of Important Note for open source community
"RTN","SYNDHP09",89,0)
 ;
"RTN","SYNDHP09",90,0)
 ;HLFCTS_U_SCT_P_HLF
"RTN","SYNDHP09",91,0)
 ;SCTPT_P_HID_P_HFSEV_P_HFPROV_P_HFDATE=HLF
"RTN","SYNDHP09",92,0)
 ;
"RTN","SYNDHP09",93,0)
 ; validate ICN
"RTN","SYNDHP09",94,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP09",95,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP09",96,0)
 ; 
"RTN","SYNDHP09",97,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP09",98,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP09",99,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP09",100,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP09",101,0)
 ;
"RTN","SYNDHP09",102,0)
 ; get patient IEN from ICN
"RTN","SYNDHP09",103,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP09",104,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP09",105,0)
 ;
"RTN","SYNDHP09",106,0)
 N HFARRAY
"RTN","SYNDHP09",107,0)
 S RETSTA=$$HLFS(.HFARRAY,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP09",108,0)
 ;
"RTN","SYNDHP09",109,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP09",110,0)
 ;
"RTN","SYNDHP09",111,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP09",112,0)
 . S RETSTA=""
"RTN","SYNDHP09",113,0)
 . D TOJASON^SYNDHPUTL(.HFARRAY,.RETSTA)
"RTN","SYNDHP09",114,0)
 ;
"RTN","SYNDHP09",115,0)
 QUIT
"RTN","SYNDHP09",116,0)
 ;
"RTN","SYNDHP09",117,0)
HLFS(HFARRAY,PATIEN,DHPICN,FRDAT,TODAT) ; get health factors for a patient
"RTN","SYNDHP09",118,0)
 ; build the array of SNOMED CT codes that correspond to health factors
"RTN","SYNDHP09",119,0)
 ;
"RTN","SYNDHP09",120,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP09",121,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP09",122,0)
 N P S P="|"
"RTN","SYNDHP09",123,0)
 N FNUM S FNUM=9000010.23
"RTN","SYNDHP09",124,0)
 N FNBR2 S FNBR2=9000010 ;visit
"RTN","SYNDHP09",125,0)
 I $G(DEBUG) W !,"Health Factors",!
"RTN","SYNDHP09",126,0)
 ;
"RTN","SYNDHP09",127,0)
 ; scan Health Factors C index for DFN
"RTN","SYNDHP09",128,0)
 N VISITID,VISITDT,VISITHL,HID,HFACT,HFACTOR,HFSEV,HFDATE,HFDATEHL
"RTN","SYNDHP09",129,0)
 N HFOPRVNM,HFEPRVNM,HFOPROV,HFEPROV,SCTPT,SCT,ZARR,HLFCTS
"RTN","SYNDHP09",130,0)
 N HIEN S HIEN=""
"RTN","SYNDHP09",131,0)
 F  S HIEN=$O(^AUPNVHF("C",PATIEN,HIEN)) QUIT:HIEN=""  D
"RTN","SYNDHP09",132,0)
 . N HLFACT
"RTN","SYNDHP09",133,0)
 . D GET1HLF^SYNDHP15(.HLFACT,HIEN,0)
"RTN","SYNDHP09",134,0)
 . I $D(HLFACT("HealthFactor","ERROR")) M HFARRAY("HealthFactors",HIEN)=HLFACT QUIT
"RTN","SYNDHP09",135,0)
 . S VISITID=HLFACT("HealthFactor","visitId") ;visit ien
"RTN","SYNDHP09",136,0)
 . S VISITDT=$$GET1^DIQ(FNBR2,VISITID_",",.01,"I") ;visit/admit date&time
"RTN","SYNDHP09",137,0)
 . QUIT:((VISITDT\1)<FRDAT)!((VISITDT\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP09",138,0)
 . S VISITHL=$$FMTHL7^XLFDT(VISITDT) ;hl7 format visit/admit date&time
"RTN","SYNDHP09",139,0)
 . S HID=HLFACT("HealthFactor","resourceId")
"RTN","SYNDHP09",140,0)
 . S HFACT=HLFACT("HealthFactor","hlfNameId") ;health factor ien
"RTN","SYNDHP09",141,0)
 . S HFACTOR=HLFACT("HealthFactor","hlfName") ;health factor name
"RTN","SYNDHP09",142,0)
 . S HFSEV=HLFACT("HealthFactor","levelSeverity") ;level/severity
"RTN","SYNDHP09",143,0)
 . S HFDATE=HLFACT("HealthFactor","eventDateTime") ;event date and time
"RTN","SYNDHP09",144,0)
 . S HFDATEHL=$$FMTHL7^XLFDT(HFDATE) ;event date and time in HL7 format
"RTN","SYNDHP09",145,0)
 . S HFOPROV=HLFACT("HealthFactor","orderingProviderId") ;ordering provider ien
"RTN","SYNDHP09",146,0)
 . S HFOPRVNM=HLFACT("HealthFactor","orderingProvider") ;ordering provider
"RTN","SYNDHP09",147,0)
 . S HFEPROV=HLFACT("HealthFactor","encounterProviderId") ;encounter provider ien
"RTN","SYNDHP09",148,0)
 . S HFEPRVNM=HLFACT("HealthFactor","encounterProvider") ;encounter provider
"RTN","SYNDHP09",149,0)
 . S SCT=HLFACT("HealthFactor","hlfNameSCT")
"RTN","SYNDHP09",150,0)
 . S SCTPT=HFACTOR
"RTN","SYNDHP09",151,0)
 . M HFARRAY("HealthFactors",HIEN)=HLFACT ;
"RTN","SYNDHP09",152,0)
 . ;
"RTN","SYNDHP09",153,0)
 . ; if care plan HF, get SCT from name string
"RTN","SYNDHP09",154,0)
 . I $E(HLFACT("HealthFactor","hlfName"),1,4)="SYN " D
"RTN","SYNDHP09",155,0)
 . . S SCT=$P($P(HLFACT("HealthFactor","hlfName"),"SCT:",2),")",1)
"RTN","SYNDHP09",156,0)
 . ;
"RTN","SYNDHP09",157,0)
 . S ZARR(HIEN)=SCT_P_SCTPT_P_HID_P_HFSEV_P_HFEPRVNM_P_VISITHL
"RTN","SYNDHP09",158,0)
 . ;
"RTN","SYNDHP09",159,0)
 . I $G(DEBUG)=1 D
"RTN","SYNDHP09",160,0)
 . . W !,"Record IEN:",?21,HIEN,!
"RTN","SYNDHP09",161,0)
 . . W "Health Factor:",?21,HFACT,"     ",HFACTOR,!
"RTN","SYNDHP09",162,0)
 . . W "Visit IEN:",?21,VISITID,!
"RTN","SYNDHP09",163,0)
 . . W "Visit Date:",?21,VISITDT,"     ",VISITHL,!
"RTN","SYNDHP09",164,0)
 . . W "Level/Severity:",?21,HFSEV,!
"RTN","SYNDHP09",165,0)
 . . W "Event Date:",?21,HFDATE,"     ",HFDATEHL,!
"RTN","SYNDHP09",166,0)
 . . W "Ordering Provider: ",?21,HFOPROV,"     ",HFOPRVNM,!
"RTN","SYNDHP09",167,0)
 . . W "Encounter Provider:",?21,HFEPROV,"     ",HFEPRVNM,!
"RTN","SYNDHP09",168,0)
 . . W "SCT:",?21,SCT,"     ",SCTPT,!!
"RTN","SYNDHP09",169,0)
 ;
"RTN","SYNDHP09",170,0)
 ; serialize data
"RTN","SYNDHP09",171,0)
 S HIEN=""
"RTN","SYNDHP09",172,0)
 S HLFCTS=DHPICN
"RTN","SYNDHP09",173,0)
 F  S HIEN=$O(ZARR(HIEN)) QUIT:HIEN=""  D
"RTN","SYNDHP09",174,0)
 . S HLFCTS=HLFCTS_U_ZARR(HIEN)
"RTN","SYNDHP09",175,0)
 ;
"RTN","SYNDHP09",176,0)
 QUIT HLFCTS
"RTN","SYNDHP09",177,0)
 ;
"RTN","SYNDHP09",178,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP09",179,0)
T1 ;
"RTN","SYNDHP09",180,0)
 N ICN S ICN="5000001536V889384"
"RTN","SYNDHP09",181,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP09",182,0)
 N TODAT S TODAT=""
"RTN","SYNDHP09",183,0)
 N JSON S JSON=""
"RTN","SYNDHP09",184,0)
 N RETSTA
"RTN","SYNDHP09",185,0)
 D PATHLFI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP09",186,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP09",187,0)
 QUIT
"RTN","SYNDHP09",188,0)
 ;
"RTN","SYNDHP09",189,0)
T2 ;
"RTN","SYNDHP09",190,0)
 N ICN S ICN="5000001536V889384"
"RTN","SYNDHP09",191,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP09",192,0)
 N TODAT S TODAT=""
"RTN","SYNDHP09",193,0)
 N JSON S JSON="J"
"RTN","SYNDHP09",194,0)
 N RETSTA
"RTN","SYNDHP09",195,0)
 D PATHLFI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP09",196,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP09",197,0)
 QUIT
"RTN","SYNDHP09",198,0)
 ;
"RTN","SYNDHP09",199,0)
HLFTEST0 ; all pass ICN
"RTN","SYNDHP09",200,0)
 N ICN S ICN=""
"RTN","SYNDHP09",201,0)
 F  S ICN=$O(^DPT("AFICN",ICN)) Q:ICN=""  D
"RTN","SYNDHP09",202,0)
 .D PATHLFI(.RETSTA,ICN) W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP09",203,0)
 Q
"RTN","SYNDHP09",204,0)
HLFTEST1 ; all pass ICN return those with data
"RTN","SYNDHP09",205,0)
 N ICN S ICN=""
"RTN","SYNDHP09",206,0)
 F  S ICN=$O(^DPT("AFICN",ICN)) Q:ICN=""  D
"RTN","SYNDHP09",207,0)
 .D PATHLFI(.RETSTA,ICN)
"RTN","SYNDHP09",208,0)
 .I $L(RETSTA,"|")>1 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP09",209,0)
 Q
"RTN","SYNDHP10")
0^85^B79393775
"RTN","SYNDHP10",1,0)
SYNDHP10 ; HC/art - HealthConcourse - get institution data ;03/26/2019
"RTN","SYNDHP10",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP10",3,0)
 ;;
"RTN","SYNDHP10",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP10",5,0)
 ;
"RTN","SYNDHP10",6,0)
 QUIT
"RTN","SYNDHP10",7,0)
 ;
"RTN","SYNDHP10",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP10",9,0)
 ;
"RTN","SYNDHP10",10,0)
GET1SITE(SITE,SITEIEN,RETJSON,SITEJ) ;get one Institution record
"RTN","SYNDHP10",11,0)
 ;inputs: SITEIEN - Institution IEN
"RTN","SYNDHP10",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP10",13,0)
 ;output: SITE  - array of Institution data, by reference
"RTN","SYNDHP10",14,0)
 ;        SITEJ - JSON structure of Institution data, by reference
"RTN","SYNDHP10",15,0)
 ;
"RTN","SYNDHP10",16,0)
 I $G(DEBUG) W !,"--------------------------- Institution -----------------------------",!
"RTN","SYNDHP10",17,0)
 N S S S="_"
"RTN","SYNDHP10",18,0)
 N SITEID S SITEID=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP10",19,0)
 N FNBR1 S FNBR1=4 ;INSTITUTION
"RTN","SYNDHP10",20,0)
 N FNBR2 S FNBR2=4.03 ;CONTACT
"RTN","SYNDHP10",21,0)
 N FNBR3 S FNBR3=4.014 ;ASSOCIATIONS
"RTN","SYNDHP10",22,0)
 N FNBR4 S FNBR4=4.042 ;EFFECTIVE DATE/TIME
"RTN","SYNDHP10",23,0)
 N FNBR5 S FNBR5=4.043 ;TAXONOMY CODE
"RTN","SYNDHP10",24,0)
 N FNBR6 S FNBR6=4.999 ;HISTORY
"RTN","SYNDHP10",25,0)
 N FNBR7 S FNBR7=4.05 ;INSTITUTION ASSOCIATION TYPES
"RTN","SYNDHP10",26,0)
 N FNBR8 S FNBR8=4.9999 ;IDENTIFIER
"RTN","SYNDHP10",27,0)
 N IENS1 S IENS1=SITEIEN_","
"RTN","SYNDHP10",28,0)
 ;
"RTN","SYNDHP10",29,0)
 N SITEARR,SITEERR
"RTN","SYNDHP10",30,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","SITEARR","SITEERR")
"RTN","SYNDHP10",31,0)
 ;I $G(DEBUG) W ! ZWRITE SITEARR
"RTN","SYNDHP10",32,0)
 ;I $G(DEBUG),$D(SITEERR) W !,">>ERROR<<" ZWRITE SITEERR
"RTN","SYNDHP10",33,0)
 I $D(SITEERR) D  QUIT
"RTN","SYNDHP10",34,0)
 . S SITE("Site","ERROR")=SITEIEN
"RTN","SYNDHP10",35,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.SITE,.SITEJ)
"RTN","SYNDHP10",36,0)
 S SITE("Site","siteIen")=SITEIEN
"RTN","SYNDHP10",37,0)
 S SITE("Site","resourceType")="Organization"
"RTN","SYNDHP10",38,0)
 S SITE("Site","resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN
"RTN","SYNDHP10",39,0)
 S SITE("Site","siteName")=$G(SITEARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP10",40,0)
 S SITE("Site","state")=$G(SITEARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP10",41,0)
 S SITE("Site","stateId")=$G(SITEARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP10",42,0)
 S SITE("Site","district")=$G(SITEARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP10",43,0)
 S SITE("Site","shortName")=$G(SITEARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP10",44,0)
 S SITE("Site","vaTypeCode")=$G(SITEARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP10",45,0)
 S SITE("Site","vaTypeCodeCd")=$G(SITEARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP10",46,0)
 S SITE("Site","region")=$G(SITEARR(FNBR1,IENS1,.07,"E"))
"RTN","SYNDHP10",47,0)
 S SITE("Site","streetAddr1")=$G(SITEARR(FNBR1,IENS1,1.01,"E"))
"RTN","SYNDHP10",48,0)
 S SITE("Site","streetAddr2")=$G(SITEARR(FNBR1,IENS1,1.02,"E"))
"RTN","SYNDHP10",49,0)
 S SITE("Site","city")=$G(SITEARR(FNBR1,IENS1,1.03,"E"))
"RTN","SYNDHP10",50,0)
 S SITE("Site","zip")=$G(SITEARR(FNBR1,IENS1,1.04,"E"))
"RTN","SYNDHP10",51,0)
 S SITE("Site","stAddr1Mailing")=$G(SITEARR(FNBR1,IENS1,4.01,"E"))
"RTN","SYNDHP10",52,0)
 S SITE("Site","stAddr2Mailing")=$G(SITEARR(FNBR1,IENS1,4.02,"E"))
"RTN","SYNDHP10",53,0)
 S SITE("Site","cityMailing")=$G(SITEARR(FNBR1,IENS1,4.03,"E"))
"RTN","SYNDHP10",54,0)
 S SITE("Site","stateMailing")=$G(SITEARR(FNBR1,IENS1,4.04,"E"))
"RTN","SYNDHP10",55,0)
 S SITE("Site","stateMailingId")=$G(SITEARR(FNBR1,IENS1,4.04,"I"))
"RTN","SYNDHP10",56,0)
 S SITE("Site","zipMailing")=$G(SITEARR(FNBR1,IENS1,4.05,"E"))
"RTN","SYNDHP10",57,0)
 S SITE("Site","multiDivisionFacility")=$G(SITEARR(FNBR1,IENS1,5,"E"))
"RTN","SYNDHP10",58,0)
 S SITE("Site","multiDivisionFacilityCd")=$G(SITEARR(FNBR1,IENS1,5,"I"))
"RTN","SYNDHP10",59,0)
 S SITE("Site","status")=$G(SITEARR(FNBR1,IENS1,11,"E"))
"RTN","SYNDHP10",60,0)
 S SITE("Site","statusCd")=$G(SITEARR(FNBR1,IENS1,11,"I"))
"RTN","SYNDHP10",61,0)
 S SITE("Site","facilityType")=$G(SITEARR(FNBR1,IENS1,13,"E"))
"RTN","SYNDHP10",62,0)
 S SITE("Site","facilityTypeId")=$G(SITEARR(FNBR1,IENS1,13,"I"))
"RTN","SYNDHP10",63,0)
 S SITE("Site","npi")=$G(SITEARR(FNBR1,IENS1,41.99,"E"))
"RTN","SYNDHP10",64,0)
 S SITE("Site","acosHospitalId")=$G(SITEARR(FNBR1,IENS1,51,"E"))
"RTN","SYNDHP10",65,0)
 S SITE("Site","facilityDeaNumber")=$G(SITEARR(FNBR1,IENS1,52,"E"))
"RTN","SYNDHP10",66,0)
 S SITE("Site","facilityDeaExpirationDate")=$G(SITEARR(FNBR1,IENS1,52.1,"E"))
"RTN","SYNDHP10",67,0)
 S SITE("Site","facilityDeaExpirationDateFM")=$G(SITEARR(FNBR1,IENS1,52.1,"I"))
"RTN","SYNDHP10",68,0)
 S SITE("Site","facilityDeaExpirationDateHL7")=$$FMTHL7^XLFDT($G(SITEARR(FNBR1,IENS1,52.1,"I")))
"RTN","SYNDHP10",69,0)
 S SITE("Site","facilityDeaExpirationDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(SITEARR(FNBR1,IENS1,52.1,"I")))
"RTN","SYNDHP10",70,0)
 S SITE("Site","domain")=$G(SITEARR(FNBR1,IENS1,60,"E"))
"RTN","SYNDHP10",71,0)
 S SITE("Site","domainId")=$G(SITEARR(FNBR1,IENS1,60,"I"))
"RTN","SYNDHP10",72,0)
 S SITE("Site","agencyCode")=$G(SITEARR(FNBR1,IENS1,95,"E"))
"RTN","SYNDHP10",73,0)
 S SITE("Site","agencyCodeCd")=$G(SITEARR(FNBR1,IENS1,95,"I"))
"RTN","SYNDHP10",74,0)
 S SITE("Site","reportingStation")=$G(SITEARR(FNBR1,IENS1,96,"E"))
"RTN","SYNDHP10",75,0)
 S SITE("Site","reportingStationId")=$G(SITEARR(FNBR1,IENS1,96,"I"))
"RTN","SYNDHP10",76,0)
 S SITE("Site","pointerToAgency")=$G(SITEARR(FNBR1,IENS1,97,"E"))
"RTN","SYNDHP10",77,0)
 S SITE("Site","pointerToAgencyId")=$G(SITEARR(FNBR1,IENS1,97,"I"))
"RTN","SYNDHP10",78,0)
 S SITE("Site","stationNumber")=$G(SITEARR(FNBR1,IENS1,99,"E"))
"RTN","SYNDHP10",79,0)
 S SITE("Site","officialVaName")=$G(SITEARR(FNBR1,IENS1,100,"E"))
"RTN","SYNDHP10",80,0)
 S SITE("Site","inactiveFacilityFlag")=$G(SITEARR(FNBR1,IENS1,101,"E"))
"RTN","SYNDHP10",81,0)
 S SITE("Site","inactiveFacilityFlagCd")=$G(SITEARR(FNBR1,IENS1,101,"I"))
"RTN","SYNDHP10",82,0)
 S SITE("Site","billingFacilityName")=$G(SITEARR(FNBR1,IENS1,200,"E"))
"RTN","SYNDHP10",83,0)
 S SITE("Site","currentLocation")=$G(SITEARR(FNBR1,IENS1,720,"E"))
"RTN","SYNDHP10",84,0)
 S SITE("Site","currentLocationCd")=$G(SITEARR(FNBR1,IENS1,720,"I"))
"RTN","SYNDHP10",85,0)
 S SITE("Site","locationTimezone")=$G(SITEARR(FNBR1,IENS1,800,"E"))
"RTN","SYNDHP10",86,0)
 S SITE("Site","locationTimezoneId")=$G(SITEARR(FNBR1,IENS1,800,"I"))
"RTN","SYNDHP10",87,0)
 S SITE("Site","country")=$G(SITEARR(FNBR1,IENS1,801,"E"))
"RTN","SYNDHP10",88,0)
 S SITE("Site","countryId")=$G(SITEARR(FNBR1,IENS1,801,"I"))
"RTN","SYNDHP10",89,0)
 S SITE("Site","timezoneException")=$G(SITEARR(FNBR1,IENS1,802,"E"))
"RTN","SYNDHP10",90,0)
 S SITE("Site","timezoneExceptionCd")=$G(SITEARR(FNBR1,IENS1,802,"I"))
"RTN","SYNDHP10",91,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP10",92,0)
 F  S IENS2=$O(SITEARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP10",93,0)
 . N CONTACT S CONTACT=$NA(SITE("Site","contacts","contact",+IENS2))
"RTN","SYNDHP10",94,0)
 . S @CONTACT@("contact")=$G(SITEARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP10",95,0)
 . S @CONTACT@("area")=$G(SITEARR(FNBR2,IENS2,.02,"E"))
"RTN","SYNDHP10",96,0)
 . S @CONTACT@("areaId")=$G(SITEARR(FNBR2,IENS2,.02,"I"))
"RTN","SYNDHP10",97,0)
 . S @CONTACT@("phone")=$G(SITEARR(FNBR2,IENS2,.03,"E"))
"RTN","SYNDHP10",98,0)
 . S @CONTACT@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP10",99,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP10",100,0)
 F  S IENS3=$O(SITEARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP10",101,0)
 . N ASSOC S ASSOC=$NA(SITE("Site","associationss","associations",+IENS3))
"RTN","SYNDHP10",102,0)
 . S @ASSOC@("associations")=$G(SITEARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP10",103,0)
 . S @ASSOC@("associationsId")=$G(SITEARR(FNBR3,IENS3,.01,"I"))
"RTN","SYNDHP10",104,0)
 . S @ASSOC@("parentOfAssociation")=$G(SITEARR(FNBR3,IENS3,1,"E"))
"RTN","SYNDHP10",105,0)
 . S @ASSOC@("parentOfAssociationId")=$G(SITEARR(FNBR3,IENS3,1,"I"))
"RTN","SYNDHP10",106,0)
 . S @ASSOC@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP10",107,0)
 N IENS4 S IENS4=""
"RTN","SYNDHP10",108,0)
 F  S IENS4=$O(SITEARR(FNBR4,IENS4)) QUIT:IENS4=""  D
"RTN","SYNDHP10",109,0)
 . N EFFDATE S EFFDATE=$NA(SITE("Site","effectiveDateTimes","effectiveDateTime",+IENS4))
"RTN","SYNDHP10",110,0)
 . S @EFFDATE@("effectiveDateTime")=$G(SITEARR(FNBR4,IENS4,.01,"E"))
"RTN","SYNDHP10",111,0)
 . S @EFFDATE@("effectiveDateTimeFM")=$G(SITEARR(FNBR4,IENS4,.01,"I"))
"RTN","SYNDHP10",112,0)
 . S @EFFDATE@("effectiveDateTimeHL7")=$$FMTHL7^XLFDT($G(SITEARR(FNBR4,IENS4,.01,"I")))
"RTN","SYNDHP10",113,0)
 . S @EFFDATE@("effectiveDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(SITEARR(FNBR4,IENS4,.01,"I")))
"RTN","SYNDHP10",114,0)
 . S @EFFDATE@("status")=$G(SITEARR(FNBR4,IENS4,.02,"E"))
"RTN","SYNDHP10",115,0)
 . S @EFFDATE@("statusCd")=$G(SITEARR(FNBR4,IENS4,.02,"I"))
"RTN","SYNDHP10",116,0)
 . S @EFFDATE@("npi")=$G(SITEARR(FNBR4,IENS4,.03,"E"))
"RTN","SYNDHP10",117,0)
 . S @EFFDATE@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR4_S_+IENS4
"RTN","SYNDHP10",118,0)
 N IENS5 S IENS5=""
"RTN","SYNDHP10",119,0)
 F  S IENS5=$O(SITEARR(FNBR5,IENS5)) QUIT:IENS5=""  D
"RTN","SYNDHP10",120,0)
 . N TAXON S TAXON=$NA(SITE("Site","taxonomyCodes","taxonomyCode",+IENS5))
"RTN","SYNDHP10",121,0)
 . S @TAXON@("taxonomyCode")=$G(SITEARR(FNBR5,IENS5,.01,"E"))
"RTN","SYNDHP10",122,0)
 . S @TAXON@("taxonomyCodeId")=$G(SITEARR(FNBR5,IENS5,.01,"I"))
"RTN","SYNDHP10",123,0)
 . S @TAXON@("primaryCode")=$G(SITEARR(FNBR5,IENS5,.02,"E"))
"RTN","SYNDHP10",124,0)
 . S @TAXON@("primaryCodeCd")=$G(SITEARR(FNBR5,IENS5,.02,"I"))
"RTN","SYNDHP10",125,0)
 . S @TAXON@("status")=$G(SITEARR(FNBR5,IENS5,.03,"E"))
"RTN","SYNDHP10",126,0)
 . S @TAXON@("statusCd")=$G(SITEARR(FNBR5,IENS5,.03,"I"))
"RTN","SYNDHP10",127,0)
 . S @TAXON@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR5_S_+IENS5
"RTN","SYNDHP10",128,0)
 N IENS6 S IENS6=""
"RTN","SYNDHP10",129,0)
 F  S IENS6=$O(SITEARR(FNBR6,IENS6)) QUIT:IENS6=""  D
"RTN","SYNDHP10",130,0)
 . N HISTORY S HISTORY=$NA(SITE("Site","historys","history",+IENS6))
"RTN","SYNDHP10",131,0)
 . S @HISTORY@("effectiveDate")=$G(SITEARR(FNBR6,IENS6,.01,"E"))
"RTN","SYNDHP10",132,0)
 . S @HISTORY@("effectiveDateFM")=$G(SITEARR(FNBR6,IENS6,.01,"I"))
"RTN","SYNDHP10",133,0)
 . S @HISTORY@("effectiveDateHL7")=$$FMTHL7^XLFDT($G(SITEARR(FNBR6,IENS6,.01,"I")))
"RTN","SYNDHP10",134,0)
 . S @HISTORY@("effectiveDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(SITEARR(FNBR6,IENS6,.01,"I")))
"RTN","SYNDHP10",135,0)
 . S @HISTORY@("nameChangedFrom")=$G(SITEARR(FNBR6,IENS6,.02,"E"))
"RTN","SYNDHP10",136,0)
 . S @HISTORY@("officalVaNameChangedFrom")=$G(SITEARR(FNBR6,IENS6,.03,"E"))
"RTN","SYNDHP10",137,0)
 . S @HISTORY@("realignedTo")=$G(SITEARR(FNBR6,IENS6,.05,"E"))
"RTN","SYNDHP10",138,0)
 . S @HISTORY@("realignedToId")=$G(SITEARR(FNBR6,IENS6,.05,"I"))
"RTN","SYNDHP10",139,0)
 . S @HISTORY@("realignedFrom")=$G(SITEARR(FNBR6,IENS6,.06,"E"))
"RTN","SYNDHP10",140,0)
 . S @HISTORY@("realignedFromId")=$G(SITEARR(FNBR6,IENS6,.06,"I"))
"RTN","SYNDHP10",141,0)
 . S @HISTORY@("deactivatedFacilitySta")=$G(SITEARR(FNBR6,IENS6,.07,"E"))
"RTN","SYNDHP10",142,0)
 . S @HISTORY@("deactivatedFacilityStaCd")=$G(SITEARR(FNBR6,IENS6,.07,"I"))
"RTN","SYNDHP10",143,0)
 . S @HISTORY@("activatedFacility")=$G(SITEARR(FNBR6,IENS6,.08,"E"))
"RTN","SYNDHP10",144,0)
 . S @HISTORY@("activatedFacilityCd")=$G(SITEARR(FNBR6,IENS6,.08,"I"))
"RTN","SYNDHP10",145,0)
 . S @HISTORY@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR6_S_+IENS6
"RTN","SYNDHP10",146,0)
 N IENS7 S IENS7=""
"RTN","SYNDHP10",147,0)
 F  S IENS7=$O(SITEARR(FNBR7,IENS7)) QUIT:IENS7=""  D
"RTN","SYNDHP10",148,0)
 . N ASSTYPE S ASSTYPE=$NA(SITE("Site","institutionAssociationTypess","institutionAssociationTypes",+IENS7))
"RTN","SYNDHP10",149,0)
 . S @ASSTYPE@("number")=$G(SITEARR(FNBR7,IENS7,.001,"E"))
"RTN","SYNDHP10",150,0)
 . S @ASSTYPE@("name")=$G(SITEARR(FNBR7,IENS7,.01,"E"))
"RTN","SYNDHP10",151,0)
 . S @ASSTYPE@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR7_S_+IENS7
"RTN","SYNDHP10",152,0)
 N IENS8 S IENS8=""
"RTN","SYNDHP10",153,0)
 F  S IENS8=$O(SITEARR(FNBR8,IENS8)) QUIT:IENS8=""  D
"RTN","SYNDHP10",154,0)
 . N IDENT S IDENT=$NA(SITE("Site","identifiers","identifier",+IENS8))
"RTN","SYNDHP10",155,0)
 . S @IDENT@("codingSystem")=$G(SITEARR(FNBR8,IENS8,.01,"E"))
"RTN","SYNDHP10",156,0)
 . S @IDENT@("id")=$G(SITEARR(FNBR8,IENS8,.02,"E"))
"RTN","SYNDHP10",157,0)
 . S @IDENT@("effectiveDateTime")=$G(SITEARR(FNBR8,IENS8,.03,"E"))
"RTN","SYNDHP10",158,0)
 . S @IDENT@("effectiveDateTimeFM")=$G(SITEARR(FNBR8,IENS8,.03,"I"))
"RTN","SYNDHP10",159,0)
 . S @IDENT@("effectiveDateTimeHL7")=$$FMTHL7^XLFDT($G(SITEARR(FNBR8,IENS8,.03,"I")))
"RTN","SYNDHP10",160,0)
 . S @IDENT@("effectiveDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(SITEARR(FNBR8,IENS8,.03,"I")))
"RTN","SYNDHP10",161,0)
 . S @IDENT@("status")=$G(SITEARR(FNBR8,IENS8,.04,"E"))
"RTN","SYNDHP10",162,0)
 . S @IDENT@("statusCd")=$G(SITEARR(FNBR8,IENS8,.04,"I"))
"RTN","SYNDHP10",163,0)
 . S @IDENT@("resourceId")=$$RESID^SYNDHP69("V",SITEID)_S_FNBR1_S_SITEIEN_S_FNBR8_S_+IENS8
"RTN","SYNDHP10",164,0)
 ;
"RTN","SYNDHP10",165,0)
 ;I $G(DEBUG) W ! ZWRITE SITE
"RTN","SYNDHP10",166,0)
 ;
"RTN","SYNDHP10",167,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.SITE,.SITEJ)
"RTN","SYNDHP10",168,0)
 ;
"RTN","SYNDHP10",169,0)
 QUIT
"RTN","SYNDHP10",170,0)
 ;
"RTN","SYNDHP11")
0^86^B65286288
"RTN","SYNDHP11",1,0)
SYNDHP11 ; HC/art - HealthConcourse - get problem record ;03/01/2019
"RTN","SYNDHP11",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP11",3,0)
 ;;
"RTN","SYNDHP11",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP11",5,0)
 ;
"RTN","SYNDHP11",6,0)
 QUIT
"RTN","SYNDHP11",7,0)
 ;
"RTN","SYNDHP11",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP11",9,0)
 ;
"RTN","SYNDHP11",10,0)
GET1PROB(PROBLEM,PROBIEN,RETJSON,PROBLEMJ) ;get one Patient Problem (Condition) record
"RTN","SYNDHP11",11,0)
 ;inputs: PROBIEN - Problem IEN
"RTN","SYNDHP11",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP11",13,0)
 ;output: PROBLEM  - array of problem data, by reference
"RTN","SYNDHP11",14,0)
 ;        PROBLEMJ - JSON structure of problem data, by reference
"RTN","SYNDHP11",15,0)
 ;
"RTN","SYNDHP11",16,0)
 I $G(DEBUG) W !,"----------------------------- Problem -----------------------------",!
"RTN","SYNDHP11",17,0)
 N FNBR1 S FNBR1=9000011 ;PROBLEM
"RTN","SYNDHP11",18,0)
 N FNBR2 S FNBR2=9000011.11 ;PROBLEM:NOTE FACILITY
"RTN","SYNDHP11",19,0)
 N FNBR3 S FNBR3=9000011.1111 ;PROBLEM:NOTE FACILITY:NOTE
"RTN","SYNDHP11",20,0)
 N FNBR4 S FNBR4=9000011.803 ;PROBLEM:MAPPING TARGETS
"RTN","SYNDHP11",21,0)
 N S S S="_"
"RTN","SYNDHP11",22,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP11",23,0)
 N IENS S IENS=PROBIEN_","
"RTN","SYNDHP11",24,0)
 N PROBARR,PROBERR
"RTN","SYNDHP11",25,0)
 D GETS^DIQ(FNBR1,IENS,"**","EI","PROBARR","PROBERR")
"RTN","SYNDHP11",26,0)
 ;I $G(DEBUG) W ! ZWRITE PROBARR
"RTN","SYNDHP11",27,0)
 ;I $G(DEBUG),$D(PROBERR) W ">>ERROR<<",! ZWRITE PROBERR
"RTN","SYNDHP11",28,0)
 I $D(PROBERR) D  QUIT
"RTN","SYNDHP11",29,0)
 . S PROBLEM("Problem","ERROR")=PROBIEN
"RTN","SYNDHP11",30,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PROBLEM,.PROBLEMJ)
"RTN","SYNDHP11",31,0)
 N PROBCOND S PROBCOND=$NA(PROBLEM("Problem"))
"RTN","SYNDHP11",32,0)
 S @PROBCOND@("problemIen")=PROBIEN
"RTN","SYNDHP11",33,0)
 S @PROBCOND@("resourceType")="Condition"
"RTN","SYNDHP11",34,0)
 S @PROBCOND@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PROBIEN
"RTN","SYNDHP11",35,0)
 S @PROBCOND@("diagnosisId")=$G(PROBARR(FNBR1,IENS,.01,"I"))
"RTN","SYNDHP11",36,0)
 S @PROBCOND@("diagnosis")=$G(PROBARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP11",37,0)
 S @PROBCOND@("patientNameId")=$G(PROBARR(FNBR1,IENS,.02,"I"))
"RTN","SYNDHP11",38,0)
 S @PROBCOND@("patientName")=$G(PROBARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP11",39,0)
 S @PROBCOND@("patientICN")=$$GET1^DIQ(2,@PROBCOND@("patientNameId")_",",991.1)
"RTN","SYNDHP11",40,0)
 S @PROBCOND@("dateLastModified")=$G(PROBARR(FNBR1,IENS,.03,"E"))
"RTN","SYNDHP11",41,0)
 S @PROBCOND@("dateLastModifiedFM")=$G(PROBARR(FNBR1,IENS,.03,"I"))
"RTN","SYNDHP11",42,0)
 S @PROBCOND@("dateLastModifiedHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR1,IENS,.03,"I")))
"RTN","SYNDHP11",43,0)
 S @PROBCOND@("dateLastModifiedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR1,IENS,.03,"I")))
"RTN","SYNDHP11",44,0)
 S @PROBCOND@("classCd")=$G(PROBARR(FNBR1,IENS,.04,"I"))
"RTN","SYNDHP11",45,0)
 S @PROBCOND@("class")=$G(PROBARR(FNBR1,IENS,.04,"E"))
"RTN","SYNDHP11",46,0)
 S @PROBCOND@("providerNarativeId")=$G(PROBARR(FNBR1,IENS,.05,"I"))
"RTN","SYNDHP11",47,0)
 S @PROBCOND@("providerNarative")=$G(PROBARR(FNBR1,IENS,.05,"E"))
"RTN","SYNDHP11",48,0)
 S @PROBCOND@("facilityId")=$G(PROBARR(FNBR1,IENS,.06,"I"))
"RTN","SYNDHP11",49,0)
 S @PROBCOND@("facility")=$G(PROBARR(FNBR1,IENS,.06,"E"))
"RTN","SYNDHP11",50,0)
 S @PROBCOND@("nmbr")=$G(PROBARR(FNBR1,IENS,.07,"E"))
"RTN","SYNDHP11",51,0)
 S @PROBCOND@("dateEntered")=$G(PROBARR(FNBR1,IENS,.08,"E"))
"RTN","SYNDHP11",52,0)
 S @PROBCOND@("dateEnteredFM")=$G(PROBARR(FNBR1,IENS,.08,"I"))
"RTN","SYNDHP11",53,0)
 S @PROBCOND@("dateEnteredHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR1,IENS,.08,"I")))
"RTN","SYNDHP11",54,0)
 S @PROBCOND@("dateEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR1,IENS,.08,"I")))
"RTN","SYNDHP11",55,0)
 S @PROBCOND@("statusCd")=$G(PROBARR(FNBR1,IENS,.12,"I"))
"RTN","SYNDHP11",56,0)
 S @PROBCOND@("status")=$G(PROBARR(FNBR1,IENS,.12,"E"))
"RTN","SYNDHP11",57,0)
 S @PROBCOND@("dateOfOnset")=$G(PROBARR(FNBR1,IENS,.13,"E"))
"RTN","SYNDHP11",58,0)
 S @PROBCOND@("dateOfOnsetFM")=$G(PROBARR(FNBR1,IENS,.13,"I"))
"RTN","SYNDHP11",59,0)
 S @PROBCOND@("dateOfOnsetHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR1,IENS,.13,"I")))
"RTN","SYNDHP11",60,0)
 S @PROBCOND@("dateOfOnsetFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR1,IENS,.13,"I")))
"RTN","SYNDHP11",61,0)
 S @PROBCOND@("problemId")=$G(PROBARR(FNBR1,IENS,1.01,"I"))
"RTN","SYNDHP11",62,0)
 S @PROBCOND@("problem")=$G(PROBARR(FNBR1,IENS,1.01,"E"))
"RTN","SYNDHP11",63,0)
 S @PROBCOND@("conditionCd")=$G(PROBARR(FNBR1,IENS,1.02,"I"))
"RTN","SYNDHP11",64,0)
 S @PROBCOND@("condition")=$G(PROBARR(FNBR1,IENS,1.02,"E"))
"RTN","SYNDHP11",65,0)
 S @PROBCOND@("enteredById")=$G(PROBARR(FNBR1,IENS,1.03,"I"))
"RTN","SYNDHP11",66,0)
 S @PROBCOND@("enteredBy")=$G(PROBARR(FNBR1,IENS,1.03,"E"))
"RTN","SYNDHP11",67,0)
 S @PROBCOND@("recordingProviderId")=$G(PROBARR(FNBR1,IENS,1.04,"I"))
"RTN","SYNDHP11",68,0)
 S @PROBCOND@("recordingProvider")=$G(PROBARR(FNBR1,IENS,1.04,"E"))
"RTN","SYNDHP11",69,0)
 S @PROBCOND@("responsibleProviderId")=$G(PROBARR(FNBR1,IENS,1.05,"I"))
"RTN","SYNDHP11",70,0)
 S @PROBCOND@("responsibleProvider")=$G(PROBARR(FNBR1,IENS,1.05,"E"))
"RTN","SYNDHP11",71,0)
 S @PROBCOND@("serviceId")=$G(PROBARR(FNBR1,IENS,1.06,"I"))
"RTN","SYNDHP11",72,0)
 S @PROBCOND@("service")=$G(PROBARR(FNBR1,IENS,1.06,"E"))
"RTN","SYNDHP11",73,0)
 S @PROBCOND@("dateResolved")=$G(PROBARR(FNBR1,IENS,1.07,"E"))
"RTN","SYNDHP11",74,0)
 S @PROBCOND@("dateResolvedFM")=$G(PROBARR(FNBR1,IENS,1.07,"I"))
"RTN","SYNDHP11",75,0)
 S @PROBCOND@("dateResolvedHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR1,IENS,1.07,"I")))
"RTN","SYNDHP11",76,0)
 S @PROBCOND@("dateResolvedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR1,IENS,1.07,"I")))
"RTN","SYNDHP11",77,0)
 S @PROBCOND@("clinicId")=$G(PROBARR(FNBR1,IENS,1.08,"I"))
"RTN","SYNDHP11",78,0)
 S @PROBCOND@("clinic")=$G(PROBARR(FNBR1,IENS,1.08,"E"))
"RTN","SYNDHP11",79,0)
 S @PROBCOND@("dateRecorded")=$G(PROBARR(FNBR1,IENS,1.09,"E"))
"RTN","SYNDHP11",80,0)
 S @PROBCOND@("dateRecordedFM")=$G(PROBARR(FNBR1,IENS,1.09,"I"))
"RTN","SYNDHP11",81,0)
 S @PROBCOND@("dateRecordedHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR1,IENS,1.09,"I")))
"RTN","SYNDHP11",82,0)
 S @PROBCOND@("dateRecordedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR1,IENS,1.09,"I")))
"RTN","SYNDHP11",83,0)
 S @PROBCOND@("serviceConnectedCd")=$G(PROBARR(FNBR1,IENS,1.1,"I"))
"RTN","SYNDHP11",84,0)
 S @PROBCOND@("serviceConnected")=$G(PROBARR(FNBR1,IENS,1.1,"E"))
"RTN","SYNDHP11",85,0)
 S @PROBCOND@("agentOrangeExposureCd")=$G(PROBARR(FNBR1,IENS,1.11,"I"))
"RTN","SYNDHP11",86,0)
 S @PROBCOND@("agentOrangeExposure")=$G(PROBARR(FNBR1,IENS,1.11,"E"))
"RTN","SYNDHP11",87,0)
 S @PROBCOND@("ionizingRadiationExposureCd")=$G(PROBARR(FNBR1,IENS,1.12,"I"))
"RTN","SYNDHP11",88,0)
 S @PROBCOND@("ionizingRadiationExposure")=$G(PROBARR(FNBR1,IENS,1.12,"E"))
"RTN","SYNDHP11",89,0)
 S @PROBCOND@("persianGulfExposureCd")=$G(PROBARR(FNBR1,IENS,1.13,"I"))
"RTN","SYNDHP11",90,0)
 S @PROBCOND@("persianGulfExposure")=$G(PROBARR(FNBR1,IENS,1.13,"E"))
"RTN","SYNDHP11",91,0)
 S @PROBCOND@("priorityCd")=$G(PROBARR(FNBR1,IENS,1.14,"I"))
"RTN","SYNDHP11",92,0)
 S @PROBCOND@("priority")=$G(PROBARR(FNBR1,IENS,1.14,"E"))
"RTN","SYNDHP11",93,0)
 S @PROBCOND@("headAndOrNeckCancerCd")=$G(PROBARR(FNBR1,IENS,1.15,"I"))
"RTN","SYNDHP11",94,0)
 S @PROBCOND@("headAndOrNeckCancer")=$G(PROBARR(FNBR1,IENS,1.15,"E"))
"RTN","SYNDHP11",95,0)
 S @PROBCOND@("militarySexualTraumaCd")=$G(PROBARR(FNBR1,IENS,1.16,"I"))
"RTN","SYNDHP11",96,0)
 S @PROBCOND@("militarySexualTrauma")=$G(PROBARR(FNBR1,IENS,1.16,"E"))
"RTN","SYNDHP11",97,0)
 S @PROBCOND@("combatVeteranCd")=$G(PROBARR(FNBR1,IENS,1.17,"I"))
"RTN","SYNDHP11",98,0)
 S @PROBCOND@("combatVeteran")=$G(PROBARR(FNBR1,IENS,1.17,"E"))
"RTN","SYNDHP11",99,0)
 S @PROBCOND@("shipboardHazardDefenseCd")=$G(PROBARR(FNBR1,IENS,1.18,"I"))
"RTN","SYNDHP11",100,0)
 S @PROBCOND@("shipboardHazardDefense")=$G(PROBARR(FNBR1,IENS,1.18,"E"))
"RTN","SYNDHP11",101,0)
 N FACNOTE
"RTN","SYNDHP11",102,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP11",103,0)
 F  S IENS2=$O(PROBARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP11",104,0)
 . S FACNOTE=$NA(PROBLEM("Problem","noteFacilitys","noteFacility",+IENS2))
"RTN","SYNDHP11",105,0)
 . S @FACNOTE@("noteFacilityId")=$G(PROBARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP11",106,0)
 . S @FACNOTE@("noteFacility")=$G(PROBARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP11",107,0)
 . S @FACNOTE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PROBIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP11",108,0)
 . N NOTE
"RTN","SYNDHP11",109,0)
 . N IENS3 S IENS3=""
"RTN","SYNDHP11",110,0)
 . F  S IENS3=$O(PROBARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP11",111,0)
 . . S NOTE=$NA(PROBLEM("Problem","noteFacilitys","noteFacility",+IENS2,"notes","note",+IENS3))
"RTN","SYNDHP11",112,0)
 . . S @NOTE@("noteNmbr")=$G(PROBARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP11",113,0)
 . . S @NOTE@("noteNarrative")=$G(PROBARR(FNBR3,IENS3,.03,"E"))
"RTN","SYNDHP11",114,0)
 . . S @NOTE@("statusCd")=$G(PROBARR(FNBR3,IENS3,.04,"I"))
"RTN","SYNDHP11",115,0)
 . . S @NOTE@("status")=$G(PROBARR(FNBR3,IENS3,.04,"E"))
"RTN","SYNDHP11",116,0)
 . . S @NOTE@("dateNoteAdded")=$G(PROBARR(FNBR3,IENS3,.05,"E"))
"RTN","SYNDHP11",117,0)
 . . S @NOTE@("dateNoteAddedFM")=$G(PROBARR(FNBR3,IENS3,.05,"I"))
"RTN","SYNDHP11",118,0)
 . . S @NOTE@("dateNoteAddedHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR3,IENS3,.05,"I")))
"RTN","SYNDHP11",119,0)
 . . S @NOTE@("dateNoteAddedFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR3,IENS3,.05,"I")))
"RTN","SYNDHP11",120,0)
 . . S @NOTE@("authorId")=$G(PROBARR(FNBR3,IENS3,.06,"I"))
"RTN","SYNDHP11",121,0)
 . . S @NOTE@("author")=$G(PROBARR(FNBR3,IENS3,.06,"E"))
"RTN","SYNDHP11",122,0)
 . . S @NOTE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PROBIEN_S_FNBR2_S_+IENS2_S_FNBR3_S_+IENS3
"RTN","SYNDHP11",123,0)
 S @PROBCOND@("snomedCTconceptCode")=$G(PROBARR(FNBR1,IENS,80001,"E"))
"RTN","SYNDHP11",124,0)
 S @PROBCOND@("snomedCTdesignationCode")=$G(PROBARR(FNBR1,IENS,80002,"E"))
"RTN","SYNDHP11",125,0)
 S @PROBCOND@("vhatConceptVuid")=$G(PROBARR(FNBR1,IENS,80003,"E"))
"RTN","SYNDHP11",126,0)
 S @PROBCOND@("vhatDesignationVuid")=$G(PROBARR(FNBR1,IENS,80004,"E"))
"RTN","SYNDHP11",127,0)
 S @PROBCOND@("snomedCtToIcdMapStatusCd")=$G(PROBARR(FNBR1,IENS,80005,"E"))
"RTN","SYNDHP11",128,0)
 S @PROBCOND@("snomedCtToIcdMapStatus")=$G(PROBARR(FNBR1,IENS,80005,"E"))
"RTN","SYNDHP11",129,0)
 S @PROBCOND@("uniqueNewTermRequestedCd")=$G(PROBARR(FNBR1,IENS,80101,"E"))
"RTN","SYNDHP11",130,0)
 S @PROBCOND@("uniqueNewTermRequested")=$G(PROBARR(FNBR1,IENS,80101,"E"))
"RTN","SYNDHP11",131,0)
 S @PROBCOND@("uniqueTermRequestComment")=$G(PROBARR(FNBR1,IENS,80102,"E"))
"RTN","SYNDHP11",132,0)
 S @PROBCOND@("dateOfInterestFM")=$G(PROBARR(FNBR1,IENS,80201,"E"))
"RTN","SYNDHP11",133,0)
 S @PROBCOND@("dateOfInterestHL7")=$G(PROBARR(FNBR1,IENS,80201,"E"))
"RTN","SYNDHP11",134,0)
 S @PROBCOND@("codingSystem")=$G(PROBARR(FNBR1,IENS,80202,"E"))
"RTN","SYNDHP11",135,0)
 N MAPTARG
"RTN","SYNDHP11",136,0)
 N IENS4 S IENS4=""
"RTN","SYNDHP11",137,0)
 F  S IENS4=$O(PROBARR(FNBR4,IENS4)) QUIT:IENS4=""  D
"RTN","SYNDHP11",138,0)
 . S MAPTARG=$NA(PROBLEM("Problem","mappingTargets","mappingTarget",+IENS4))
"RTN","SYNDHP11",139,0)
 . S @MAPTARG@("code")=$G(PROBARR(FNBR4,IENS4,.01,"E"))
"RTN","SYNDHP11",140,0)
 . S @MAPTARG@("codingSystem")=$G(PROBARR(FNBR4,IENS4,.02,"E"))
"RTN","SYNDHP11",141,0)
 . S @MAPTARG@("codeDate")=$G(PROBARR(FNBR4,IENS4,.03,"E"))
"RTN","SYNDHP11",142,0)
 . S @MAPTARG@("codeDateFM")=$G(PROBARR(FNBR4,IENS4,.03,"I"))
"RTN","SYNDHP11",143,0)
 . S @MAPTARG@("codeDateHL7")=$$FMTHL7^XLFDT($G(PROBARR(FNBR4,IENS4,.03,"I")))
"RTN","SYNDHP11",144,0)
 . S @MAPTARG@("codeDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PROBARR(FNBR4,IENS4,.03,"I")))
"RTN","SYNDHP11",145,0)
 . S @MAPTARG@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PROBIEN_S_FNBR4_S_+IENS4
"RTN","SYNDHP11",146,0)
 ;
"RTN","SYNDHP11",147,0)
 ;icd -> snomed
"RTN","SYNDHP11",148,0)
 ; PROBLEM("Problem","diagnosis")=$G(PROBARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP11",149,0)
 ;
"RTN","SYNDHP11",150,0)
 ;I $G(DEBUG) W ! ZWRITE PROBLEM
"RTN","SYNDHP11",151,0)
 ;
"RTN","SYNDHP11",152,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PROBLEM,.PROBLEMJ)
"RTN","SYNDHP11",153,0)
 ;
"RTN","SYNDHP11",154,0)
 QUIT
"RTN","SYNDHP11",155,0)
 ;
"RTN","SYNDHP12")
0^87^B125196184
"RTN","SYNDHP12",1,0)
SYNDHP12 ; HC/art - HealthConcourse - get immunization record ;03/23/2019
"RTN","SYNDHP12",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP12",3,0)
 ;;
"RTN","SYNDHP12",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP12",5,0)
 ;
"RTN","SYNDHP12",6,0)
 QUIT
"RTN","SYNDHP12",7,0)
 ;
"RTN","SYNDHP12",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP12",9,0)
 ;
"RTN","SYNDHP12",10,0)
GET1IMMUN(IMMUNIZE,IMMUNIEN,RETJSON,IMMUNIZEJ) ;get one Immunization record
"RTN","SYNDHP12",11,0)
 ;inputs: IMMUNIEN - Immunization IEN
"RTN","SYNDHP12",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP12",13,0)
 ;output: IMMUNIZE  - array of Immunization data, by reference
"RTN","SYNDHP12",14,0)
 ;        IMMUNIZEJ - JSON structure of Immunization data, by reference
"RTN","SYNDHP12",15,0)
 ;
"RTN","SYNDHP12",16,0)
 I $G(DEBUG) W !,"--------------------------- Immunize -----------------------------",!
"RTN","SYNDHP12",17,0)
 N S S S="_"
"RTN","SYNDHP12",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP12",19,0)
 N FNBR1 S FNBR1=9000010.11 ;V IMMUNIZATION
"RTN","SYNDHP12",20,0)
 N FNBR2 S FNBR2=9000010.112 ;VIS OFFERED/GIVEN TO PATIENT
"RTN","SYNDHP12",21,0)
 N FNBR3 S FNBR3=9000010.113 ;OTHER DIAGNOSIS
"RTN","SYNDHP12",22,0)
 N FNBR4 S FNBR4=9000010.1182 ;DISCLOSED TO
"RTN","SYNDHP12",23,0)
 N FNBR5 S FNBR5=9000010.1111 ;REMARKS
"RTN","SYNDHP12",24,0)
 N FNBR6 S FNBR6=9000010.1126 ;SNOMED CT
"RTN","SYNDHP12",25,0)
 N FNBR7 S FNBR7=9000010.1127 ;LOINC CODES
"RTN","SYNDHP12",26,0)
 N IENS1 S IENS1=IMMUNIEN_","
"RTN","SYNDHP12",27,0)
 ;
"RTN","SYNDHP12",28,0)
 N IMMUNIZEARR,IMMUNIZEERR
"RTN","SYNDHP12",29,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","IMMUNIZEARR","IMMUNIZEERR")
"RTN","SYNDHP12",30,0)
 ;I $G(DEBUG) W ! ZWRITE IMMUNIZEARR
"RTN","SYNDHP12",31,0)
 ;I $G(DEBUG),$D(IMMUNIZEERR) W ">>ERROR<<",! ZWRITE IMMUNIZEERR
"RTN","SYNDHP12",32,0)
 I $D(IMMUNIZEERR) D  QUIT
"RTN","SYNDHP12",33,0)
 . S IMMUNIZE("Immunize","ERROR")=IMMUNIEN
"RTN","SYNDHP12",34,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.IMMUNIZE,.IMMUNIZEJ)
"RTN","SYNDHP12",35,0)
 N IMMUNE S IMMUNE=$NA(IMMUNIZE("Immunize"))
"RTN","SYNDHP12",36,0)
 S @IMMUNE@("immunizeIen")=IMMUNIEN
"RTN","SYNDHP12",37,0)
 S @IMMUNE@("resourceType")="Immunization"
"RTN","SYNDHP12",38,0)
 S @IMMUNE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_IMMUNIEN
"RTN","SYNDHP12",39,0)
 S @IMMUNE@("immunization")=$G(IMMUNIZEARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP12",40,0)
 S @IMMUNE@("immunizationId")=$G(IMMUNIZEARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP12",41,0)
 S @IMMUNE@("patientName")=$G(IMMUNIZEARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP12",42,0)
 S @IMMUNE@("patientNameId")=$G(IMMUNIZEARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP12",43,0)
 S @IMMUNE@("patientICN")=$$GET1^DIQ(2,@IMMUNE@("patientNameId")_",",991.1)
"RTN","SYNDHP12",44,0)
 S @IMMUNE@("visit")=$G(IMMUNIZEARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP12",45,0)
 S @IMMUNE@("visitId")=$G(IMMUNIZEARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP12",46,0)
 S @IMMUNE@("visitFM")=$$GET1^DIQ(9000010,@IMMUNE@("visitId")_",",.01,"I")
"RTN","SYNDHP12",47,0)
 S @IMMUNE@("visitHL7")=$$FMTHL7^XLFDT(@IMMUNE@("visitFM"))
"RTN","SYNDHP12",48,0)
 S @IMMUNE@("visitFHIR")=$$FMTFHIR^SYNDHPUTL(@IMMUNE@("visitFM"))
"RTN","SYNDHP12",49,0)
 S @IMMUNE@("series")=$G(IMMUNIZEARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP12",50,0)
 S @IMMUNE@("seriesCd")=$G(IMMUNIZEARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP12",51,0)
 S @IMMUNE@("lot")=$G(IMMUNIZEARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP12",52,0)
 S @IMMUNE@("lotId")=$G(IMMUNIZEARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP12",53,0)
 S @IMMUNE@("reaction")=$G(IMMUNIZEARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP12",54,0)
 S @IMMUNE@("reactionCd")=$G(IMMUNIZEARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP12",55,0)
 S @IMMUNE@("contraindicated")=$G(IMMUNIZEARR(FNBR1,IENS1,.07,"E"))
"RTN","SYNDHP12",56,0)
 S @IMMUNE@("contraindicatedCd")=$G(IMMUNIZEARR(FNBR1,IENS1,.07,"I"))
"RTN","SYNDHP12",57,0)
 S @IMMUNE@("doseOverride")=$G(IMMUNIZEARR(FNBR1,IENS1,.08,"E"))
"RTN","SYNDHP12",58,0)
 S @IMMUNE@("doseOverrideCd")=$G(IMMUNIZEARR(FNBR1,IENS1,.08,"I"))
"RTN","SYNDHP12",59,0)
 S @IMMUNE@("injectionSite")=$G(IMMUNIZEARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP12",60,0)
 S @IMMUNE@("injectionSiteCd")=$G(IMMUNIZEARR(FNBR1,IENS1,.09,"I"))
"RTN","SYNDHP12",61,0)
 S @IMMUNE@("volume")=$G(IMMUNIZEARR(FNBR1,IENS1,.11,"E"))
"RTN","SYNDHP12",62,0)
 S @IMMUNE@("dateOfVacInfoStatement")=$G(IMMUNIZEARR(FNBR1,IENS1,.12,"E"))
"RTN","SYNDHP12",63,0)
 S @IMMUNE@("dateOfVacInfoStatementFM")=$G(IMMUNIZEARR(FNBR1,IENS1,.12,"I"))
"RTN","SYNDHP12",64,0)
 S @IMMUNE@("dateOfVacInfoStatementHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,.12,"I")))
"RTN","SYNDHP12",65,0)
 S @IMMUNE@("dateOfVacInfoStatementFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,.12,"I")))
"RTN","SYNDHP12",66,0)
 S @IMMUNE@("createdByVCptEntry")=$G(IMMUNIZEARR(FNBR1,IENS1,.13,"E"))
"RTN","SYNDHP12",67,0)
 S @IMMUNE@("vacEligibility")=$G(IMMUNIZEARR(FNBR1,IENS1,.14,"E"))
"RTN","SYNDHP12",68,0)
 S @IMMUNE@("vacEligibilityId")=$G(IMMUNIZEARR(FNBR1,IENS1,.14,"I"))
"RTN","SYNDHP12",69,0)
 S @IMMUNE@("importFromOutsideRegistry")=$G(IMMUNIZEARR(FNBR1,IENS1,.15,"E"))
"RTN","SYNDHP12",70,0)
 S @IMMUNE@("importFromOutsideRegistryCd")=$G(IMMUNIZEARR(FNBR1,IENS1,.15,"I"))
"RTN","SYNDHP12",71,0)
 S @IMMUNE@("ndc")=$G(IMMUNIZEARR(FNBR1,IENS1,.16,"E"))
"RTN","SYNDHP12",72,0)
 S @IMMUNE@("ndcId")=$G(IMMUNIZEARR(FNBR1,IENS1,.16,"I"))
"RTN","SYNDHP12",73,0)
 S @IMMUNE@("administrativeNotes")=$G(IMMUNIZEARR(FNBR1,IENS1,1,"E"))
"RTN","SYNDHP12",74,0)
 S @IMMUNE@("remarks")=""
"RTN","SYNDHP12",75,0)
 N Z S Z=""
"RTN","SYNDHP12",76,0)
 F  S Z=$O(IMMUNIZEARR(FNBR1,IENS1,1101,Z)) QUIT:'+Z  D
"RTN","SYNDHP12",77,0)
 . S @IMMUNE@("remarks")=@IMMUNE@("remarks")_$G(IMMUNIZEARR(FNBR1,IENS1,1101,Z))
"RTN","SYNDHP12",78,0)
 S @IMMUNE@("eventDateAndTime")=$G(IMMUNIZEARR(FNBR1,IENS1,1201,"E"))
"RTN","SYNDHP12",79,0)
 S @IMMUNE@("eventDateAndTimeFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1201,"I"))
"RTN","SYNDHP12",80,0)
 S @IMMUNE@("eventDateAndTimeHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP12",81,0)
 S @IMMUNE@("eventDateAndTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP12",82,0)
 S @IMMUNE@("orderingProvider")=$G(IMMUNIZEARR(FNBR1,IENS1,1202,"E"))
"RTN","SYNDHP12",83,0)
 S @IMMUNE@("orderingProviderId")=$G(IMMUNIZEARR(FNBR1,IENS1,1202,"I"))
"RTN","SYNDHP12",84,0)
 S @IMMUNE@("clinic")=$G(IMMUNIZEARR(FNBR1,IENS1,1203,"E"))
"RTN","SYNDHP12",85,0)
 S @IMMUNE@("clinicId")=$G(IMMUNIZEARR(FNBR1,IENS1,1203,"I"))
"RTN","SYNDHP12",86,0)
 S @IMMUNE@("encounterProvider")=$G(IMMUNIZEARR(FNBR1,IENS1,1204,"E"))
"RTN","SYNDHP12",87,0)
 S @IMMUNE@("encounterProviderId")=$G(IMMUNIZEARR(FNBR1,IENS1,1204,"I"))
"RTN","SYNDHP12",88,0)
 S @IMMUNE@("dateTimeRecorded")=$G(IMMUNIZEARR(FNBR1,IENS1,1205,"E"))
"RTN","SYNDHP12",89,0)
 S @IMMUNE@("dateTimeRecordedFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1205,"I"))
"RTN","SYNDHP12",90,0)
 S @IMMUNE@("dateTimeRecordedHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1205,"I")))
"RTN","SYNDHP12",91,0)
 S @IMMUNE@("dateTimeRecordedFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1205,"I")))
"RTN","SYNDHP12",92,0)
 S @IMMUNE@("immunizationDocumenter")=$G(IMMUNIZEARR(FNBR1,IENS1,1206,"E"))
"RTN","SYNDHP12",93,0)
 S @IMMUNE@("immunizationDocumenterId")=$G(IMMUNIZEARR(FNBR1,IENS1,1206,"I"))
"RTN","SYNDHP12",94,0)
 S @IMMUNE@("lotNumber")=$G(IMMUNIZEARR(FNBR1,IENS1,1207,"E"))
"RTN","SYNDHP12",95,0)
 S @IMMUNE@("lotNumberId")=$G(IMMUNIZEARR(FNBR1,IENS1,1207,"I"))
"RTN","SYNDHP12",96,0)
 S @IMMUNE@("parent")=$G(IMMUNIZEARR(FNBR1,IENS1,1208,"E"))
"RTN","SYNDHP12",97,0)
 S @IMMUNE@("parentId")=$G(IMMUNIZEARR(FNBR1,IENS1,1208,"I"))
"RTN","SYNDHP12",98,0)
 S @IMMUNE@("externalKey")=$G(IMMUNIZEARR(FNBR1,IENS1,1209,"E"))
"RTN","SYNDHP12",99,0)
 S @IMMUNE@("outsideProviderName")=$G(IMMUNIZEARR(FNBR1,IENS1,1210,"E"))
"RTN","SYNDHP12",100,0)
 S @IMMUNE@("ancillaryPov")=$G(IMMUNIZEARR(FNBR1,IENS1,1213,"E"))
"RTN","SYNDHP12",101,0)
 S @IMMUNE@("ancillaryPovId")=$G(IMMUNIZEARR(FNBR1,IENS1,1213,"I"))
"RTN","SYNDHP12",102,0)
 S @IMMUNE@("userLastUpdate")=$G(IMMUNIZEARR(FNBR1,IENS1,1214,"E"))
"RTN","SYNDHP12",103,0)
 S @IMMUNE@("userLastUpdateId")=$G(IMMUNIZEARR(FNBR1,IENS1,1214,"I"))
"RTN","SYNDHP12",104,0)
 S @IMMUNE@("orderingLocation")=$G(IMMUNIZEARR(FNBR1,IENS1,1215,"E"))
"RTN","SYNDHP12",105,0)
 S @IMMUNE@("orderingLocationId")=$G(IMMUNIZEARR(FNBR1,IENS1,1215,"I"))
"RTN","SYNDHP12",106,0)
 S @IMMUNE@("dateTimeEntered")=$G(IMMUNIZEARR(FNBR1,IENS1,1216,"E"))
"RTN","SYNDHP12",107,0)
 S @IMMUNE@("dateTimeEnteredFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1216,"I"))
"RTN","SYNDHP12",108,0)
 S @IMMUNE@("dateTimeEnteredHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1216,"I")))
"RTN","SYNDHP12",109,0)
 S @IMMUNE@("dateTimeEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1216,"I")))
"RTN","SYNDHP12",110,0)
 S @IMMUNE@("enteredBy")=$G(IMMUNIZEARR(FNBR1,IENS1,1217,"E"))
"RTN","SYNDHP12",111,0)
 S @IMMUNE@("enteredById")=$G(IMMUNIZEARR(FNBR1,IENS1,1217,"I"))
"RTN","SYNDHP12",112,0)
 S @IMMUNE@("dateTimeLastModified")=$G(IMMUNIZEARR(FNBR1,IENS1,1218,"E"))
"RTN","SYNDHP12",113,0)
 S @IMMUNE@("dateTimeLastModifiedFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1218,"I"))
"RTN","SYNDHP12",114,0)
 S @IMMUNE@("dateTimeLastModifiedHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1218,"I")))
"RTN","SYNDHP12",115,0)
 S @IMMUNE@("dateTimeLastModifiedFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1218,"I")))
"RTN","SYNDHP12",116,0)
 S @IMMUNE@("lastModifiedBy")=$G(IMMUNIZEARR(FNBR1,IENS1,1219,"E"))
"RTN","SYNDHP12",117,0)
 S @IMMUNE@("lastModifiedById")=$G(IMMUNIZEARR(FNBR1,IENS1,1219,"I"))
"RTN","SYNDHP12",118,0)
 S @IMMUNE@("warningAcknowledged")=$G(IMMUNIZEARR(FNBR1,IENS1,1220,"E"))
"RTN","SYNDHP12",119,0)
 S @IMMUNE@("warningAcknowledgedCd")=$G(IMMUNIZEARR(FNBR1,IENS1,1220,"I"))
"RTN","SYNDHP12",120,0)
 S @IMMUNE@("timestamp")=$G(IMMUNIZEARR(FNBR1,IENS1,1221,"E"))
"RTN","SYNDHP12",121,0)
 S @IMMUNE@("timestampFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1221,"I"))
"RTN","SYNDHP12",122,0)
 S @IMMUNE@("timestampHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1221,"I")))
"RTN","SYNDHP12",123,0)
 S @IMMUNE@("timestampFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1221,"I")))
"RTN","SYNDHP12",124,0)
 S @IMMUNE@("eventInformationSource")=$G(IMMUNIZEARR(FNBR1,IENS1,1301,"E"))
"RTN","SYNDHP12",125,0)
 S @IMMUNE@("eventInformationSourceId")=$G(IMMUNIZEARR(FNBR1,IENS1,1301,"I"))
"RTN","SYNDHP12",126,0)
 S @IMMUNE@("routeOfAdministration")=$G(IMMUNIZEARR(FNBR1,IENS1,1302,"E"))
"RTN","SYNDHP12",127,0)
 S @IMMUNE@("routeOfAdministrationId")=$G(IMMUNIZEARR(FNBR1,IENS1,1302,"I"))
"RTN","SYNDHP12",128,0)
 S @IMMUNE@("siteOfAdministrationBody")=$G(IMMUNIZEARR(FNBR1,IENS1,1303,"E"))
"RTN","SYNDHP12",129,0)
 S @IMMUNE@("siteOfAdministrationBodyId")=$G(IMMUNIZEARR(FNBR1,IENS1,1303,"I"))
"RTN","SYNDHP12",130,0)
 S @IMMUNE@("primaryDiagnosis")=$G(IMMUNIZEARR(FNBR1,IENS1,1304,"E"))
"RTN","SYNDHP12",131,0)
 S @IMMUNE@("primaryDiagnosisId")=$G(IMMUNIZEARR(FNBR1,IENS1,1304,"I"))
"RTN","SYNDHP12",132,0)
 S @IMMUNE@("dose")=$G(IMMUNIZEARR(FNBR1,IENS1,1312,"E"))
"RTN","SYNDHP12",133,0)
 S @IMMUNE@("dosage")=$G(IMMUNIZEARR(FNBR1,IENS1,1312.5,"E"))
"RTN","SYNDHP12",134,0)
 S @IMMUNE@("doseUnits")=$G(IMMUNIZEARR(FNBR1,IENS1,1313,"E"))
"RTN","SYNDHP12",135,0)
 S @IMMUNE@("doseUnitsId")=$G(IMMUNIZEARR(FNBR1,IENS1,1313,"I"))
"RTN","SYNDHP12",136,0)
 S @IMMUNE@("results")=$G(IMMUNIZEARR(FNBR1,IENS1,1401,"E"))
"RTN","SYNDHP12",137,0)
 S @IMMUNE@("resultsCd")=$G(IMMUNIZEARR(FNBR1,IENS1,1401,"I"))
"RTN","SYNDHP12",138,0)
 S @IMMUNE@("reading")=$G(IMMUNIZEARR(FNBR1,IENS1,1402,"E"))
"RTN","SYNDHP12",139,0)
 S @IMMUNE@("dateTimeRead")=$G(IMMUNIZEARR(FNBR1,IENS1,1403,"E"))
"RTN","SYNDHP12",140,0)
 S @IMMUNE@("dateTimeReadFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1403,"I"))
"RTN","SYNDHP12",141,0)
 S @IMMUNE@("dateTimeReadHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1403,"I")))
"RTN","SYNDHP12",142,0)
 S @IMMUNE@("dateTimeReadFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1403,"I")))
"RTN","SYNDHP12",143,0)
 S @IMMUNE@("reader")=$G(IMMUNIZEARR(FNBR1,IENS1,1404,"E"))
"RTN","SYNDHP12",144,0)
 S @IMMUNE@("readerId")=$G(IMMUNIZEARR(FNBR1,IENS1,1404,"I"))
"RTN","SYNDHP12",145,0)
 S @IMMUNE@("readingRecorded")=$G(IMMUNIZEARR(FNBR1,IENS1,1405,"E"))
"RTN","SYNDHP12",146,0)
 S @IMMUNE@("readingRecordedFM")=$G(IMMUNIZEARR(FNBR1,IENS1,1405,"I"))
"RTN","SYNDHP12",147,0)
 S @IMMUNE@("readingRecordedHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR1,IENS1,1405,"I")))
"RTN","SYNDHP12",148,0)
 S @IMMUNE@("readingRecordedFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR1,IENS1,1405,"I")))
"RTN","SYNDHP12",149,0)
 S @IMMUNE@("hoursReadPostInoculation")=$G(IMMUNIZEARR(FNBR1,IENS1,1406,"E"))
"RTN","SYNDHP12",150,0)
 S @IMMUNE@("readingComment")=$G(IMMUNIZEARR(FNBR1,IENS1,1501,"E"))
"RTN","SYNDHP12",151,0)
 S @IMMUNE@("warningOverrideReason")=$G(IMMUNIZEARR(FNBR1,IENS1,1601,"E"))
"RTN","SYNDHP12",152,0)
 S @IMMUNE@("editedFlag")=$G(IMMUNIZEARR(FNBR1,IENS1,80101,"E"))
"RTN","SYNDHP12",153,0)
 S @IMMUNE@("editedFlagCd")=$G(IMMUNIZEARR(FNBR1,IENS1,80101,"I"))
"RTN","SYNDHP12",154,0)
 S @IMMUNE@("auditTrail")=$G(IMMUNIZEARR(FNBR1,IENS1,80102,"E"))
"RTN","SYNDHP12",155,0)
 S @IMMUNE@("comments")=$G(IMMUNIZEARR(FNBR1,IENS1,81101,"E"))
"RTN","SYNDHP12",156,0)
 S @IMMUNE@("verified")=$G(IMMUNIZEARR(FNBR1,IENS1,81201,"E"))
"RTN","SYNDHP12",157,0)
 S @IMMUNE@("verifiedCd")=$G(IMMUNIZEARR(FNBR1,IENS1,81201,"I"))
"RTN","SYNDHP12",158,0)
 S @IMMUNE@("package")=$G(IMMUNIZEARR(FNBR1,IENS1,81202,"E"))
"RTN","SYNDHP12",159,0)
 S @IMMUNE@("packageId")=$G(IMMUNIZEARR(FNBR1,IENS1,81202,"I"))
"RTN","SYNDHP12",160,0)
 S @IMMUNE@("dataSource")=$G(IMMUNIZEARR(FNBR1,IENS1,81203,"E"))
"RTN","SYNDHP12",161,0)
 S @IMMUNE@("dataSourceId")=$G(IMMUNIZEARR(FNBR1,IENS1,81203,"I"))
"RTN","SYNDHP12",162,0)
 N OFFER
"RTN","SYNDHP12",163,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP12",164,0)
 F  S IENS2=$O(IMMUNIZEARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP12",165,0)
 . S OFFER=$NA(IMMUNIZE("Immunize","visOfferedGivenToPatients","visOfferedGivenToPatient",+IENS2))
"RTN","SYNDHP12",166,0)
 . S @OFFER@("visOfferedGivenToPatient")=$G(IMMUNIZEARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP12",167,0)
 . S @OFFER@("visOfferedGivenToPatientId")=$G(IMMUNIZEARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP12",168,0)
 . S @OFFER@("dateVisOfferedGiven")=$G(IMMUNIZEARR(FNBR2,IENS2,.02,"E"))
"RTN","SYNDHP12",169,0)
 . S @OFFER@("dateVisOfferedGivenFM")=$G(IMMUNIZEARR(FNBR2,IENS2,.02,"I"))
"RTN","SYNDHP12",170,0)
 . S @OFFER@("dateVisOfferedGivenHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR2,IENS2,.02,"I")))
"RTN","SYNDHP12",171,0)
 . S @OFFER@("dateVisOfferedGivenFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR2,IENS2,.02,"I")))
"RTN","SYNDHP12",172,0)
 . S @OFFER@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_IMMUNIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP12",173,0)
 N OTHERDX
"RTN","SYNDHP12",174,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP12",175,0)
 F  S IENS3=$O(IMMUNIZEARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP12",176,0)
 . S OTHERDX=$NA(IMMUNIZE("Immunize","otherDiagnosiss","otherDiagnosis",+IENS3))
"RTN","SYNDHP12",177,0)
 . S @OTHERDX@("otherDiagnosis")=$G(IMMUNIZEARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP12",178,0)
 . S @OTHERDX@("otherDiagnosisId")=$G(IMMUNIZEARR(FNBR3,IENS3,.01,"I"))
"RTN","SYNDHP12",179,0)
 . S @OTHERDX@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_IMMUNIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP12",180,0)
 N DISCLOSE
"RTN","SYNDHP12",181,0)
 N IENS4 S IENS4=""
"RTN","SYNDHP12",182,0)
 F  S IENS4=$O(IMMUNIZEARR(FNBR4,IENS4)) QUIT:IENS4=""  D
"RTN","SYNDHP12",183,0)
 . S DISCLOSE=$NA(IMMUNIZE("Immunize","disclosedTos","disclosedTo",+IENS4))
"RTN","SYNDHP12",184,0)
 . S @DISCLOSE@("agency")=$G(IMMUNIZEARR(FNBR4,IENS4,.01,"E"))
"RTN","SYNDHP12",185,0)
 . S @DISCLOSE@("agencyId")=$G(IMMUNIZEARR(FNBR4,IENS4,.01,"I"))
"RTN","SYNDHP12",186,0)
 . S @DISCLOSE@("disclosureDateTime")=$G(IMMUNIZEARR(FNBR4,IENS4,.02,"E"))
"RTN","SYNDHP12",187,0)
 . S @DISCLOSE@("disclosureDateTimeFM")=$G(IMMUNIZEARR(FNBR4,IENS4,.02,"I"))
"RTN","SYNDHP12",188,0)
 . S @DISCLOSE@("disclosureDateTimeHL7")=$$FMTHL7^XLFDT($G(IMMUNIZEARR(FNBR4,IENS4,.02,"I")))
"RTN","SYNDHP12",189,0)
 . S @DISCLOSE@("disclosureDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(IMMUNIZEARR(FNBR4,IENS4,.02,"I")))
"RTN","SYNDHP12",190,0)
 . S @DISCLOSE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_IMMUNIEN_S_FNBR4_S_+IENS4
"RTN","SYNDHP12",191,0)
 ;N IENS5 S IENS5="" ;Word processing field 1101 above
"RTN","SYNDHP12",192,0)
 ;F  S IENS5=$O(IMMUNIZEARR(FNBR5,IENS5)) QUIT:IENS5=""  D
"RTN","SYNDHP12",193,0)
 ;. S IMMUNIZE("Immunize","remarkss","remarks",+IENS5,"remarks")=$G(IMMUNIZEARR(FNBR5,IENS5,.01,"E"))
"RTN","SYNDHP12",194,0)
 N SNOMED
"RTN","SYNDHP12",195,0)
 N IENS6 S IENS6=""
"RTN","SYNDHP12",196,0)
 F  S IENS6=$O(IMMUNIZEARR(FNBR6,IENS6)) QUIT:IENS6=""  D
"RTN","SYNDHP12",197,0)
 . S SNOMED=$NA(IMMUNIZE("Immunize","snomedCts","snomedCt",+IENS6))
"RTN","SYNDHP12",198,0)
 . S @SNOMED@("snomedCt")=$G(IMMUNIZEARR(FNBR6,IENS6,.01,"E"))
"RTN","SYNDHP12",199,0)
 . S @SNOMED@("snomedPreferredTerm")=$G(IMMUNIZEARR(FNBR6,IENS6,.019,"E"))
"RTN","SYNDHP12",200,0)
 . S @SNOMED@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_IMMUNIEN_S_FNBR6_S_+IENS6
"RTN","SYNDHP12",201,0)
 N LOINC
"RTN","SYNDHP12",202,0)
 N IENS7 S IENS7=""
"RTN","SYNDHP12",203,0)
 F  S IENS7=$O(IMMUNIZEARR(FNBR7,IENS7)) QUIT:IENS7=""  D
"RTN","SYNDHP12",204,0)
 . S LOINC=$NA(IMMUNIZE("Immunize","loincCodess","loincCodes",+IENS7))
"RTN","SYNDHP12",205,0)
 . S @LOINC@("loincCodes")=$G(IMMUNIZEARR(FNBR7,IENS7,.01,"E"))
"RTN","SYNDHP12",206,0)
 . S @LOINC@("loincText")=$G(IMMUNIZEARR(FNBR7,IENS7,.019,"E"))
"RTN","SYNDHP12",207,0)
 . S @LOINC@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_IMMUNIEN_S_FNBR7_S_+IENS7
"RTN","SYNDHP12",208,0)
 ;
"RTN","SYNDHP12",209,0)
 ;I $G(DEBUG) W ! ZWRITE IMMUNIZE
"RTN","SYNDHP12",210,0)
 ;
"RTN","SYNDHP12",211,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.IMMUNIZE,.IMMUNIZEJ)
"RTN","SYNDHP12",212,0)
 ;
"RTN","SYNDHP12",213,0)
 QUIT
"RTN","SYNDHP12",214,0)
 ;
"RTN","SYNDHP13")
0^88^B130398518
"RTN","SYNDHP13",1,0)
SYNDHP13 ; HC/art - HealthConcourse - get visit and pov data ;03/26/2019
"RTN","SYNDHP13",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP13",3,0)
 ;;
"RTN","SYNDHP13",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP13",5,0)
 ;
"RTN","SYNDHP13",6,0)
 QUIT
"RTN","SYNDHP13",7,0)
 ;
"RTN","SYNDHP13",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP13",9,0)
 ;
"RTN","SYNDHP13",10,0)
GET1VISIT(VISIT,VISITIEN,RETJSON,VISITJ) ;get one Visit record
"RTN","SYNDHP13",11,0)
 ;inputs: VISITIEN - Visit IEN
"RTN","SYNDHP13",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP13",13,0)
 ;output: VISIT  - array of Visit data, by reference
"RTN","SYNDHP13",14,0)
 ;        VISITJ - JSON structure of Visit data, by reference
"RTN","SYNDHP13",15,0)
 ;
"RTN","SYNDHP13",16,0)
 I $G(DEBUG) W !,"--------------------------- Visit -----------------------------",!
"RTN","SYNDHP13",17,0)
 N S S S="_"
"RTN","SYNDHP13",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP13",19,0)
 N FNBR1 S FNBR1=9000010 ;VISIT
"RTN","SYNDHP13",20,0)
 N IENS1 S IENS1=VISITIEN_","
"RTN","SYNDHP13",21,0)
 N VISITARR,VISITERR
"RTN","SYNDHP13",22,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","VISITARR","VISITERR")
"RTN","SYNDHP13",23,0)
 ;I $G(DEBUG) W ! ZWRITE VISITARR
"RTN","SYNDHP13",24,0)
 ;I $G(DEBUG),$D(VISITERR) W ">>ERROR<<",! ZWRITE VISITERR
"RTN","SYNDHP13",25,0)
 I $D(VISITERR) D  QUIT
"RTN","SYNDHP13",26,0)
 . S VISIT("Visit","ERROR")=VISITIEN
"RTN","SYNDHP13",27,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VISIT,.VISITJ)
"RTN","SYNDHP13",28,0)
 S VISIT("Visit","visitIen")=VISITIEN
"RTN","SYNDHP13",29,0)
 S VISIT("Visit","resourceType")="Encounter"
"RTN","SYNDHP13",30,0)
 S VISIT("Visit","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VISITIEN
"RTN","SYNDHP13",31,0)
 S VISIT("Visit","visitAdmitDateTime")=$G(VISITARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP13",32,0)
 S VISIT("Visit","visitAdmitDateTimeFM")=$G(VISITARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP13",33,0)
 S VISIT("Visit","visitAdmitDateTimeHL7")=$$FMTHL7^XLFDT($G(VISITARR(FNBR1,IENS1,.01,"I")))
"RTN","SYNDHP13",34,0)
 S VISIT("Visit","visitAdmitDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(VISITARR(FNBR1,IENS1,.01,"I")))
"RTN","SYNDHP13",35,0)
 S VISIT("Visit","dateVisitCreated")=$G(VISITARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP13",36,0)
 S VISIT("Visit","dateVisitCreatedFM")=$G(VISITARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP13",37,0)
 S VISIT("Visit","dateVisitCreatedHL7")=$$FMTHL7^XLFDT($G(VISITARR(FNBR1,IENS1,.02,"I")))
"RTN","SYNDHP13",38,0)
 S VISIT("Visit","dateVisitCreatedFHIR")=$$FMTFHIR^SYNDHPUTL($G(VISITARR(FNBR1,IENS1,.02,"I")))
"RTN","SYNDHP13",39,0)
 S VISIT("Visit","type")=$G(VISITARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP13",40,0)
 S VISIT("Visit","typeCd")=$G(VISITARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP13",41,0)
 S VISIT("Visit","patientName")=$G(VISITARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP13",42,0)
 S VISIT("Visit","patientNameId")=$G(VISITARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP13",43,0)
 S VISIT("Visit","patientICN")=$$GET1^DIQ(2,VISIT("Visit","patientNameId")_",",991.1)
"RTN","SYNDHP13",44,0)
 S VISIT("Visit","locOfEncounter")=$G(VISITARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP13",45,0)
 S VISIT("Visit","locOfEncounterId")=$G(VISITARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP13",46,0)
 S VISIT("Visit","serviceCategory")=$G(VISITARR(FNBR1,IENS1,.07,"E"))
"RTN","SYNDHP13",47,0)
 S VISIT("Visit","serviceCategoryCd")=$G(VISITARR(FNBR1,IENS1,.07,"I"))
"RTN","SYNDHP13",48,0)
 S VISIT("Visit","dssId")=$G(VISITARR(FNBR1,IENS1,.08,"E"))
"RTN","SYNDHP13",49,0)
 S VISIT("Visit","dssIdId")=$G(VISITARR(FNBR1,IENS1,.08,"I"))
"RTN","SYNDHP13",50,0)
 S VISIT("Visit","dependentEntryCount")=$G(VISITARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP13",51,0)
 S VISIT("Visit","deleteFlag")=$G(VISITARR(FNBR1,IENS1,.11,"E"))
"RTN","SYNDHP13",52,0)
 S VISIT("Visit","deleteFlagCd")=$G(VISITARR(FNBR1,IENS1,.11,"I"))
"RTN","SYNDHP13",53,0)
 S VISIT("Visit","parentVisitLink")=$G(VISITARR(FNBR1,IENS1,.12,"E"))
"RTN","SYNDHP13",54,0)
 S VISIT("Visit","parentVisitLinkId")=$G(VISITARR(FNBR1,IENS1,.12,"I"))
"RTN","SYNDHP13",55,0)
 S VISIT("Visit","dateLastModified")=$G(VISITARR(FNBR1,IENS1,.13,"E"))
"RTN","SYNDHP13",56,0)
 S VISIT("Visit","dateLastModifiedFM")=$G(VISITARR(FNBR1,IENS1,.13,"I"))
"RTN","SYNDHP13",57,0)
 S VISIT("Visit","dateLastModifiedHL7")=$$FMTHL7^XLFDT($G(VISITARR(FNBR1,IENS1,.13,"I")))
"RTN","SYNDHP13",58,0)
 S VISIT("Visit","dateLastModifiedFHIR")=$$FMTFHIR^SYNDHPUTL($G(VISITARR(FNBR1,IENS1,.13,"I")))
"RTN","SYNDHP13",59,0)
 S VISIT("Visit","checkOutDateTime")=$G(VISITARR(FNBR1,IENS1,.18,"E"))
"RTN","SYNDHP13",60,0)
 S VISIT("Visit","checkOutDateTimeFM")=$G(VISITARR(FNBR1,IENS1,.18,"I"))
"RTN","SYNDHP13",61,0)
 S VISIT("Visit","checkOutDateTimeHL7")=$$FMTHL7^XLFDT($G(VISITARR(FNBR1,IENS1,.18,"I")))
"RTN","SYNDHP13",62,0)
 S VISIT("Visit","checkOutDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(VISITARR(FNBR1,IENS1,.18,"I")))
"RTN","SYNDHP13",63,0)
 S VISIT("Visit","eligibility")=$G(VISITARR(FNBR1,IENS1,.21,"E"))
"RTN","SYNDHP13",64,0)
 S VISIT("Visit","eligibilityId")=$G(VISITARR(FNBR1,IENS1,.21,"I"))
"RTN","SYNDHP13",65,0)
 S VISIT("Visit","hospitalLocation")=$G(VISITARR(FNBR1,IENS1,.22,"E"))
"RTN","SYNDHP13",66,0)
 S VISIT("Visit","hospitalLocationId")=$G(VISITARR(FNBR1,IENS1,.22,"I"))
"RTN","SYNDHP13",67,0)
 S VISIT("Visit","createdByUser")=$G(VISITARR(FNBR1,IENS1,.23,"E"))
"RTN","SYNDHP13",68,0)
 S VISIT("Visit","createdByUserId")=$G(VISITARR(FNBR1,IENS1,.23,"I"))
"RTN","SYNDHP13",69,0)
 S VISIT("Visit","optionUsedToCreate")=$G(VISITARR(FNBR1,IENS1,.24,"E"))
"RTN","SYNDHP13",70,0)
 S VISIT("Visit","optionUsedToCreateId")=$G(VISITARR(FNBR1,IENS1,.24,"I"))
"RTN","SYNDHP13",71,0)
 S VISIT("Visit","protocol")=$G(VISITARR(FNBR1,IENS1,.25,"E"))
"RTN","SYNDHP13",72,0)
 S VISIT("Visit","protocolId")=$G(VISITARR(FNBR1,IENS1,.25,"I"))
"RTN","SYNDHP13",73,0)
 S VISIT("Visit","pfssAccountReference")=$G(VISITARR(FNBR1,IENS1,.26,"E"))
"RTN","SYNDHP13",74,0)
 S VISIT("Visit","pfssAccountReferenceId")=$G(VISITARR(FNBR1,IENS1,.26,"I"))
"RTN","SYNDHP13",75,0)
 S VISIT("Visit","outsideLocation")=$G(VISITARR(FNBR1,IENS1,2101,"E"))
"RTN","SYNDHP13",76,0)
 S VISIT("Visit","visitId")=$G(VISITARR(FNBR1,IENS1,15001,"E"))
"RTN","SYNDHP13",77,0)
 S VISIT("Visit","patientStatusInOut")=$G(VISITARR(FNBR1,IENS1,15002,"E"))
"RTN","SYNDHP13",78,0)
 S VISIT("Visit","patientStatusInOutCd")=$G(VISITARR(FNBR1,IENS1,15002,"I"))
"RTN","SYNDHP13",79,0)
 S VISIT("Visit","encounterType")=$G(VISITARR(FNBR1,IENS1,15003,"E"))
"RTN","SYNDHP13",80,0)
 S VISIT("Visit","encounterTypeCd")=$G(VISITARR(FNBR1,IENS1,15003,"I"))
"RTN","SYNDHP13",81,0)
 S VISIT("Visit","serviceConnected")=$G(VISITARR(FNBR1,IENS1,80001,"E"))
"RTN","SYNDHP13",82,0)
 S VISIT("Visit","serviceConnectedCd")=$G(VISITARR(FNBR1,IENS1,80001,"I"))
"RTN","SYNDHP13",83,0)
 S VISIT("Visit","agentOrangeExposure")=$G(VISITARR(FNBR1,IENS1,80002,"E"))
"RTN","SYNDHP13",84,0)
 S VISIT("Visit","agentOrangeExposureCd")=$G(VISITARR(FNBR1,IENS1,80002,"I"))
"RTN","SYNDHP13",85,0)
 S VISIT("Visit","ionizingRadiationExposure")=$G(VISITARR(FNBR1,IENS1,80003,"E"))
"RTN","SYNDHP13",86,0)
 S VISIT("Visit","ionizingRadiationExposureCd")=$G(VISITARR(FNBR1,IENS1,80003,"I"))
"RTN","SYNDHP13",87,0)
 S VISIT("Visit","swAsiaConditions")=$G(VISITARR(FNBR1,IENS1,80004,"E"))
"RTN","SYNDHP13",88,0)
 S VISIT("Visit","swAsiaConditionsCd")=$G(VISITARR(FNBR1,IENS1,80004,"I"))
"RTN","SYNDHP13",89,0)
 S VISIT("Visit","militarySexualTrauma")=$G(VISITARR(FNBR1,IENS1,80005,"E"))
"RTN","SYNDHP13",90,0)
 S VISIT("Visit","militarySexualTraumaCd")=$G(VISITARR(FNBR1,IENS1,80005,"I"))
"RTN","SYNDHP13",91,0)
 S VISIT("Visit","headAndOrNeckCancer")=$G(VISITARR(FNBR1,IENS1,80006,"E"))
"RTN","SYNDHP13",92,0)
 S VISIT("Visit","headAndOrNeckCancerCd")=$G(VISITARR(FNBR1,IENS1,80006,"I"))
"RTN","SYNDHP13",93,0)
 S VISIT("Visit","combatVeteran")=$G(VISITARR(FNBR1,IENS1,80007,"E"))
"RTN","SYNDHP13",94,0)
 S VISIT("Visit","combatVeteranCd")=$G(VISITARR(FNBR1,IENS1,80007,"I"))
"RTN","SYNDHP13",95,0)
 S VISIT("Visit","proj112Shad")=$G(VISITARR(FNBR1,IENS1,80008,"E"))
"RTN","SYNDHP13",96,0)
 S VISIT("Visit","proj112ShadCd")=$G(VISITARR(FNBR1,IENS1,80008,"I"))
"RTN","SYNDHP13",97,0)
 S VISIT("Visit","serviceConnectionEditFlag")=$G(VISITARR(FNBR1,IENS1,80011,"E"))
"RTN","SYNDHP13",98,0)
 S VISIT("Visit","serviceConnectionEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80011,"I"))
"RTN","SYNDHP13",99,0)
 S VISIT("Visit","agentOrangeEditFlag")=$G(VISITARR(FNBR1,IENS1,80012,"E"))
"RTN","SYNDHP13",100,0)
 S VISIT("Visit","agentOrangeEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80012,"I"))
"RTN","SYNDHP13",101,0)
 S VISIT("Visit","ionizingRadiationEditFlag")=$G(VISITARR(FNBR1,IENS1,80013,"E"))
"RTN","SYNDHP13",102,0)
 S VISIT("Visit","ionizingRadiationEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80013,"I"))
"RTN","SYNDHP13",103,0)
 S VISIT("Visit","swAsiaConditionsEditFlag")=$G(VISITARR(FNBR1,IENS1,80014,"E"))
"RTN","SYNDHP13",104,0)
 S VISIT("Visit","swAsiaConditionsEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80014,"I"))
"RTN","SYNDHP13",105,0)
 S VISIT("Visit","mstEditFlag")=$G(VISITARR(FNBR1,IENS1,80015,"E"))
"RTN","SYNDHP13",106,0)
 S VISIT("Visit","mstEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80015,"I"))
"RTN","SYNDHP13",107,0)
 S VISIT("Visit","headAndNeckCancerEditFlag")=$G(VISITARR(FNBR1,IENS1,80016,"E"))
"RTN","SYNDHP13",108,0)
 S VISIT("Visit","headAndNeckCancerEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80016,"I"))
"RTN","SYNDHP13",109,0)
 S VISIT("Visit","combatVeteranEditFlag")=$G(VISITARR(FNBR1,IENS1,80017,"E"))
"RTN","SYNDHP13",110,0)
 S VISIT("Visit","combatVeteranEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80017,"I"))
"RTN","SYNDHP13",111,0)
 S VISIT("Visit","proj112ShadEditFlag")=$G(VISITARR(FNBR1,IENS1,80018,"E"))
"RTN","SYNDHP13",112,0)
 S VISIT("Visit","proj112ShadEditFlagCd")=$G(VISITARR(FNBR1,IENS1,80018,"I"))
"RTN","SYNDHP13",113,0)
 S VISIT("Visit","comments")=$G(VISITARR(FNBR1,IENS1,81101,"E"))
"RTN","SYNDHP13",114,0)
 S VISIT("Visit","package")=$G(VISITARR(FNBR1,IENS1,81202,"E"))
"RTN","SYNDHP13",115,0)
 S VISIT("Visit","packageId")=$G(VISITARR(FNBR1,IENS1,81202,"I"))
"RTN","SYNDHP13",116,0)
 S VISIT("Visit","dataSource")=$G(VISITARR(FNBR1,IENS1,81203,"E"))
"RTN","SYNDHP13",117,0)
 S VISIT("Visit","dataSourceId")=$G(VISITARR(FNBR1,IENS1,81203,"I"))
"RTN","SYNDHP13",118,0)
 ;
"RTN","SYNDHP13",119,0)
 ;I $G(DEBUG) W ! ZWRITE VISIT
"RTN","SYNDHP13",120,0)
 ;
"RTN","SYNDHP13",121,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VISIT,.VISITJ)
"RTN","SYNDHP13",122,0)
 ;
"RTN","SYNDHP13",123,0)
 QUIT
"RTN","SYNDHP13",124,0)
 ;
"RTN","SYNDHP13",125,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP13",126,0)
 ;
"RTN","SYNDHP13",127,0)
GET1VPOV(VPOV,VPOVIEN,RETJSON,VPOVJ) ;get one V POV record
"RTN","SYNDHP13",128,0)
 ;inputs: VPOVIEN - Vpov IEN
"RTN","SYNDHP13",129,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP13",130,0)
 ;output: VPOV  - array of V POV data, by reference
"RTN","SYNDHP13",131,0)
 ;        VPOVJ - JSON structure of V POV data, by reference
"RTN","SYNDHP13",132,0)
 ;
"RTN","SYNDHP13",133,0)
 I $G(DEBUG) W !,"--------------------------- V POV -----------------------------",!
"RTN","SYNDHP13",134,0)
 N S S S="_"
"RTN","SYNDHP13",135,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP13",136,0)
 N FNBR1 S FNBR1=9000010.07 ;V POV
"RTN","SYNDHP13",137,0)
 N IENS1 S IENS1=VPOVIEN_","
"RTN","SYNDHP13",138,0)
 N VPOVARR,VPOVERR
"RTN","SYNDHP13",139,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","VPOVARR","VPOVERR")
"RTN","SYNDHP13",140,0)
 ;I $G(DEBUG) W ! ZWRITE VPOVARR
"RTN","SYNDHP13",141,0)
 ;I $G(DEBUG),$D(VPOVERR) W ">>ERROR<<",! ZWRITE VPOVERR
"RTN","SYNDHP13",142,0)
 I $D(VPOVERR) D  QUIT
"RTN","SYNDHP13",143,0)
 . S VPOV("V POV","ERROR")=VPOVIEN
"RTN","SYNDHP13",144,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VPOV,.VPOVJ)
"RTN","SYNDHP13",145,0)
 S VPOV("V POV","vpovIen")=VPOVIEN
"RTN","SYNDHP13",146,0)
 S VPOV("V POV","resourceType")="Encounter"
"RTN","SYNDHP13",147,0)
 S VPOV("V POV","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VPOVIEN
"RTN","SYNDHP13",148,0)
 S VPOV("V POV","pov")=$G(VPOVARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP13",149,0)
 S VPOV("V POV","povId")=$G(VPOVARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP13",150,0)
 S VPOV("V POV","povDesc")=$P($$ICDDX^ICDEX(VPOV("V POV","pov")),U,4)
"RTN","SYNDHP13",151,0)
 S VPOV("V POV","icdNarrative")=$G(VPOVARR(FNBR1,IENS1,.019,"E"))
"RTN","SYNDHP13",152,0)
 S VPOV("V POV","patientName")=$G(VPOVARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP13",153,0)
 S VPOV("V POV","patientNameId")=$G(VPOVARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP13",154,0)
 S VPOV("V POV","patientICN")=$$GET1^DIQ(2,VPOV("V POV","patientNameId")_",",991.1)
"RTN","SYNDHP13",155,0)
 S VPOV("V POV","visit")=$G(VPOVARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP13",156,0)
 S VPOV("V POV","visitId")=$G(VPOVARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP13",157,0)
 S VPOV("V POV","visitFM")=$$GET1^DIQ(9000010,VPOV("V POV","visitId")_",",.01,"I")
"RTN","SYNDHP13",158,0)
 S VPOV("V POV","visitHL7")=$$FMTHL7^XLFDT(VPOV("V POV","visitFM"))
"RTN","SYNDHP13",159,0)
 S VPOV("V POV","visitFHIR")=$$FMTFHIR^SYNDHPUTL(VPOV("V POV","visitFM"))
"RTN","SYNDHP13",160,0)
 S VPOV("V POV","providerNarrative")=$G(VPOVARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP13",161,0)
 S VPOV("V POV","providerNarrativeId")=$G(VPOVARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP13",162,0)
 S VPOV("V POV","modifier")=$G(VPOVARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP13",163,0)
 S VPOV("V POV","modifierCd")=$G(VPOVARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP13",164,0)
 S VPOV("V POV","primarySecondary")=$G(VPOVARR(FNBR1,IENS1,.12,"E"))
"RTN","SYNDHP13",165,0)
 S VPOV("V POV","primarySecondaryCd")=$G(VPOVARR(FNBR1,IENS1,.12,"I"))
"RTN","SYNDHP13",166,0)
 S VPOV("V POV","dateOfInjury")=$G(VPOVARR(FNBR1,IENS1,.13,"E"))
"RTN","SYNDHP13",167,0)
 S VPOV("V POV","dateOfInjuryFM")=$G(VPOVARR(FNBR1,IENS1,.13,"I"))
"RTN","SYNDHP13",168,0)
 S VPOV("V POV","dateOfInjuryHL7")=$$FMTHL7^XLFDT($G(VPOVARR(FNBR1,IENS1,.13,"I")))
"RTN","SYNDHP13",169,0)
 S VPOV("V POV","dateOfInjuryFHIR")=$$FMTFHIR^SYNDHPUTL($G(VPOVARR(FNBR1,IENS1,.13,"I")))
"RTN","SYNDHP13",170,0)
 S VPOV("V POV","clinicalTerm")=$G(VPOVARR(FNBR1,IENS1,.15,"E"))
"RTN","SYNDHP13",171,0)
 S VPOV("V POV","clinicalTermId")=$G(VPOVARR(FNBR1,IENS1,.15,"I"))
"RTN","SYNDHP13",172,0)
 S VPOV("V POV","problemListEntry")=$G(VPOVARR(FNBR1,IENS1,.16,"E"))
"RTN","SYNDHP13",173,0)
 S VPOV("V POV","problemListEntryId")=$G(VPOVARR(FNBR1,IENS1,.16,"I"))
"RTN","SYNDHP13",174,0)
 S VPOV("V POV","orderingResulting")=$G(VPOVARR(FNBR1,IENS1,.17,"E"))
"RTN","SYNDHP13",175,0)
 S VPOV("V POV","orderingResultingCd")=$G(VPOVARR(FNBR1,IENS1,.17,"I"))
"RTN","SYNDHP13",176,0)
 S VPOV("V POV","mappedSource")=$G(VPOVARR(FNBR1,IENS1,300,"E"))
"RTN","SYNDHP13",177,0)
 S VPOV("V POV","eventDateAndTime")=$G(VPOVARR(FNBR1,IENS1,1201,"E"))
"RTN","SYNDHP13",178,0)
 S VPOV("V POV","eventDateAndTimeFM")=$G(VPOVARR(FNBR1,IENS1,1201,"I"))
"RTN","SYNDHP13",179,0)
 S VPOV("V POV","eventDateAndTimeHL7")=$$FMTHL7^XLFDT($G(VPOVARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP13",180,0)
 S VPOV("V POV","eventDateAndTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(VPOVARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP13",181,0)
 S VPOV("V POV","orderingProvider")=$G(VPOVARR(FNBR1,IENS1,1202,"E"))
"RTN","SYNDHP13",182,0)
 S VPOV("V POV","orderingProviderId")=$G(VPOVARR(FNBR1,IENS1,1202,"I"))
"RTN","SYNDHP13",183,0)
 S VPOV("V POV","encounterProvider")=$G(VPOVARR(FNBR1,IENS1,1204,"E"))
"RTN","SYNDHP13",184,0)
 S VPOV("V POV","encounterProviderId")=$G(VPOVARR(FNBR1,IENS1,1204,"I"))
"RTN","SYNDHP13",185,0)
 S VPOV("V POV","serviceConnected")=$G(VPOVARR(FNBR1,IENS1,80001,"E"))
"RTN","SYNDHP13",186,0)
 S VPOV("V POV","serviceConnectedCd")=$G(VPOVARR(FNBR1,IENS1,80001,"I"))
"RTN","SYNDHP13",187,0)
 S VPOV("V POV","agentOrangeExposure")=$G(VPOVARR(FNBR1,IENS1,80002,"E"))
"RTN","SYNDHP13",188,0)
 S VPOV("V POV","agentOrangeExposureCd")=$G(VPOVARR(FNBR1,IENS1,80002,"I"))
"RTN","SYNDHP13",189,0)
 S VPOV("V POV","ionizingRadiationExposure")=$G(VPOVARR(FNBR1,IENS1,80003,"E"))
"RTN","SYNDHP13",190,0)
 S VPOV("V POV","ionizingRadiationExposureCd")=$G(VPOVARR(FNBR1,IENS1,80003,"I"))
"RTN","SYNDHP13",191,0)
 S VPOV("V POV","swAsiaConditions")=$G(VPOVARR(FNBR1,IENS1,80004,"E"))
"RTN","SYNDHP13",192,0)
 S VPOV("V POV","swAsiaConditionsCd")=$G(VPOVARR(FNBR1,IENS1,80004,"I"))
"RTN","SYNDHP13",193,0)
 S VPOV("V POV","militarySexualTrauma")=$G(VPOVARR(FNBR1,IENS1,80005,"E"))
"RTN","SYNDHP13",194,0)
 S VPOV("V POV","militarySexualTraumaCd")=$G(VPOVARR(FNBR1,IENS1,80005,"I"))
"RTN","SYNDHP13",195,0)
 S VPOV("V POV","headAndOrNeckCancer")=$G(VPOVARR(FNBR1,IENS1,80006,"E"))
"RTN","SYNDHP13",196,0)
 S VPOV("V POV","headAndOrNeckCancerCd")=$G(VPOVARR(FNBR1,IENS1,80006,"I"))
"RTN","SYNDHP13",197,0)
 S VPOV("V POV","combatVeteran")=$G(VPOVARR(FNBR1,IENS1,80007,"E"))
"RTN","SYNDHP13",198,0)
 S VPOV("V POV","combatVeteranCd")=$G(VPOVARR(FNBR1,IENS1,80007,"I"))
"RTN","SYNDHP13",199,0)
 S VPOV("V POV","proj112Shad")=$G(VPOVARR(FNBR1,IENS1,80008,"E"))
"RTN","SYNDHP13",200,0)
 S VPOV("V POV","proj112ShadCd")=$G(VPOVARR(FNBR1,IENS1,80008,"I"))
"RTN","SYNDHP13",201,0)
 S VPOV("V POV","editedFlag")=$G(VPOVARR(FNBR1,IENS1,80101,"E"))
"RTN","SYNDHP13",202,0)
 S VPOV("V POV","editedFlagCd")=$G(VPOVARR(FNBR1,IENS1,80101,"I"))
"RTN","SYNDHP13",203,0)
 S VPOV("V POV","auditTrail")=$G(VPOVARR(FNBR1,IENS1,80102,"E"))
"RTN","SYNDHP13",204,0)
 S VPOV("V POV","providerNarrativeCategory")=$G(VPOVARR(FNBR1,IENS1,80201,"E"))
"RTN","SYNDHP13",205,0)
 S VPOV("V POV","providerNarrativeCategoryId")=$G(VPOVARR(FNBR1,IENS1,80201,"I"))
"RTN","SYNDHP13",206,0)
 S VPOV("V POV","comments")=$G(VPOVARR(FNBR1,IENS1,81101,"E"))
"RTN","SYNDHP13",207,0)
 S VPOV("V POV","verified")=$G(VPOVARR(FNBR1,IENS1,81201,"E"))
"RTN","SYNDHP13",208,0)
 S VPOV("V POV","verifiedCd")=$G(VPOVARR(FNBR1,IENS1,81201,"I"))
"RTN","SYNDHP13",209,0)
 S VPOV("V POV","package")=$G(VPOVARR(FNBR1,IENS1,81202,"E"))
"RTN","SYNDHP13",210,0)
 S VPOV("V POV","packageId")=$G(VPOVARR(FNBR1,IENS1,81202,"I"))
"RTN","SYNDHP13",211,0)
 S VPOV("V POV","dataSource")=$G(VPOVARR(FNBR1,IENS1,81203,"E"))
"RTN","SYNDHP13",212,0)
 S VPOV("V POV","dataSourceId")=$G(VPOVARR(FNBR1,IENS1,81203,"I"))
"RTN","SYNDHP13",213,0)
 ;
"RTN","SYNDHP13",214,0)
 ;get SCT code
"RTN","SYNDHP13",215,0)
 N MAPPING S MAPPING=$S(VPOV("V POV","visitFM")>3150930:"sct2icd",1:"sct2icdnine")
"RTN","SYNDHP13",216,0)
 N SNOMED S SNOMED=$$MAP^SYNDHPMP(MAPPING,VPOV("V POV","pov"),"I")
"RTN","SYNDHP13",217,0)
 S VPOV("V POV","povSCT")=$S(+SNOMED=-1:"",1:$P(SNOMED,U,2))
"RTN","SYNDHP13",218,0)
 ;
"RTN","SYNDHP13",219,0)
 ;I $G(DEBUG) W ! ZWRITE VPOV
"RTN","SYNDHP13",220,0)
 ;
"RTN","SYNDHP13",221,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VPOV,.VPOVJ)
"RTN","SYNDHP13",222,0)
 ;
"RTN","SYNDHP13",223,0)
 QUIT
"RTN","SYNDHP13",224,0)
 ;
"RTN","SYNDHP14")
0^89^B68521679
"RTN","SYNDHP14",1,0)
SYNDHP14 ; HC/art - HealthConcourse - get visit data ;03/21/2019
"RTN","SYNDHP14",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP14",3,0)
 ;;
"RTN","SYNDHP14",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP14",5,0)
 ;
"RTN","SYNDHP14",6,0)
 QUIT
"RTN","SYNDHP14",7,0)
 ;
"RTN","SYNDHP14",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP14",9,0)
 ;
"RTN","SYNDHP14",10,0)
GET1VSCODE(VSCODE,VSCODEIEN,RETJSON,VSCODEJ) ;get one V Standard Codes record
"RTN","SYNDHP14",11,0)
 ;inputs: VSCODEIEN - V Standard Codes IEN
"RTN","SYNDHP14",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP14",13,0)
 ;output: VSCODE  - array of V Standard Codes data, by reference
"RTN","SYNDHP14",14,0)
 ;        VSCODEJ - JSON structure of V Standard Codes data, by reference
"RTN","SYNDHP14",15,0)
 ;
"RTN","SYNDHP14",16,0)
 I $G(DEBUG) W !,"V Standard Codes",!
"RTN","SYNDHP14",17,0)
 N S S S="_"
"RTN","SYNDHP14",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP14",19,0)
 N FNBR1 S FNBR1=9000010.71 ;V STANDARD CODES
"RTN","SYNDHP14",20,0)
 N IENS1 S IENS1=VSCODEIEN_","
"RTN","SYNDHP14",21,0)
 ;
"RTN","SYNDHP14",22,0)
 N VSCODEARR,VSCODEERR
"RTN","SYNDHP14",23,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","VSCODEARR","VSCODEERR")
"RTN","SYNDHP14",24,0)
 ;I $G(DEBUG) W ! ZWRITE VSCODEARR
"RTN","SYNDHP14",25,0)
 ;I $G(DEBUG),$D(VSCODEERR) W ">>ERROR<<",! ZWRITE VSCODEERR
"RTN","SYNDHP14",26,0)
 I $D(VSCODEERR) S VSCODE("Vscode","ERROR")=VSCODEIEN QUIT
"RTN","SYNDHP14",27,0)
 I $D(VSCODEERR) D  QUIT
"RTN","SYNDHP14",28,0)
 . S VSCODE("Vscode","ERROR")=VSCODEIEN
"RTN","SYNDHP14",29,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VSCODE,.VSCODEJ)
"RTN","SYNDHP14",30,0)
 S VSCODE("Vscode","vscodeIen")=VSCODEIEN
"RTN","SYNDHP14",31,0)
 S VSCODE("Vscode","resourceType")="Encounter"
"RTN","SYNDHP14",32,0)
 S VSCODE("Vscode","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VSCODEIEN
"RTN","SYNDHP14",33,0)
 S VSCODE("Vscode","code")=$G(VSCODEARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP14",34,0)
 S VSCODE("Vscode","patientName")=$G(VSCODEARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP14",35,0)
 S VSCODE("Vscode","patientNameId")=$G(VSCODEARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP14",36,0)
 S VSCODE("Vscode","patientICN")=$$GET1^DIQ(2,VSCODE("Vscode","patientNameId")_",",991.1)
"RTN","SYNDHP14",37,0)
 S VSCODE("Vscode","visit")=$G(VSCODEARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP14",38,0)
 S VSCODE("Vscode","visitId")=$G(VSCODEARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP14",39,0)
 S VSCODE("Vscode","visitFM")=$$GET1^DIQ(9000010,VSCODE("Vscode","visitId")_",",.01,"I")
"RTN","SYNDHP14",40,0)
 S VSCODE("Vscode","visitHL7")=$$FMTHL7^XLFDT(VSCODE("Vscode","visitFM"))
"RTN","SYNDHP14",41,0)
 S VSCODE("Vscode","visitFHIR")=$$FMTFHIR^SYNDHPUTL(VSCODE("Vscode","visitFM"))
"RTN","SYNDHP14",42,0)
 S VSCODE("Vscode","codingSystem")=$G(VSCODEARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP14",43,0)
 S VSCODE("Vscode","problemListEntry")=$G(VSCODEARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP14",44,0)
 S VSCODE("Vscode","problemListEntryId")=$G(VSCODEARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP14",45,0)
 S VSCODE("Vscode","magnitude")=$G(VSCODEARR(FNBR1,IENS1,220,"E"))
"RTN","SYNDHP14",46,0)
 S VSCODE("Vscode","ucumCode")=$G(VSCODEARR(FNBR1,IENS1,221,"E"))
"RTN","SYNDHP14",47,0)
 S VSCODE("Vscode","ucumCodeId")=$G(VSCODEARR(FNBR1,IENS1,221,"I"))
"RTN","SYNDHP14",48,0)
 S VSCODE("Vscode","mappedSource")=$G(VSCODEARR(FNBR1,IENS1,300,"E"))
"RTN","SYNDHP14",49,0)
 S VSCODE("Vscode","eventDateAndTime")=$G(VSCODEARR(FNBR1,IENS1,1201,"E"))
"RTN","SYNDHP14",50,0)
 S VSCODE("Vscode","eventDateAndTimeFM")=$G(VSCODEARR(FNBR1,IENS1,1201,"I"))
"RTN","SYNDHP14",51,0)
 S VSCODE("Vscode","eventDateAndTimeHL7")=$$FMTHL7^XLFDT($G(VSCODEARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP14",52,0)
 S VSCODE("Vscode","eventDateAndTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(VSCODEARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP14",53,0)
 S VSCODE("Vscode","orderingProvider")=$G(VSCODEARR(FNBR1,IENS1,1202,"E"))
"RTN","SYNDHP14",54,0)
 S VSCODE("Vscode","orderingProviderId")=$G(VSCODEARR(FNBR1,IENS1,1202,"I"))
"RTN","SYNDHP14",55,0)
 S VSCODE("Vscode","encounterProvider")=$G(VSCODEARR(FNBR1,IENS1,1204,"E"))
"RTN","SYNDHP14",56,0)
 S VSCODE("Vscode","encounterProviderId")=$G(VSCODEARR(FNBR1,IENS1,1204,"I"))
"RTN","SYNDHP14",57,0)
 S VSCODE("Vscode","editedFlag")=$G(VSCODEARR(FNBR1,IENS1,80101,"E"))
"RTN","SYNDHP14",58,0)
 S VSCODE("Vscode","editedFlagCd")=$G(VSCODEARR(FNBR1,IENS1,80101,"I"))
"RTN","SYNDHP14",59,0)
 S VSCODE("Vscode","auditTrail")=$G(VSCODEARR(FNBR1,IENS1,80102,"E"))
"RTN","SYNDHP14",60,0)
 S VSCODE("Vscode","comments")=$G(VSCODEARR(FNBR1,IENS1,81101,"E"))
"RTN","SYNDHP14",61,0)
 S VSCODE("Vscode","verified")=$G(VSCODEARR(FNBR1,IENS1,81201,"E"))
"RTN","SYNDHP14",62,0)
 S VSCODE("Vscode","verifiedCd")=$G(VSCODEARR(FNBR1,IENS1,81201,"I"))
"RTN","SYNDHP14",63,0)
 S VSCODE("Vscode","package")=$G(VSCODEARR(FNBR1,IENS1,81202,"E"))
"RTN","SYNDHP14",64,0)
 S VSCODE("Vscode","packageId")=$G(VSCODEARR(FNBR1,IENS1,81202,"I"))
"RTN","SYNDHP14",65,0)
 S VSCODE("Vscode","dataSource")=$G(VSCODEARR(FNBR1,IENS1,81203,"E"))
"RTN","SYNDHP14",66,0)
 S VSCODE("Vscode","dataSourceId")=$G(VSCODEARR(FNBR1,IENS1,81203,"I"))
"RTN","SYNDHP14",67,0)
 ;
"RTN","SYNDHP14",68,0)
 ;I $G(DEBUG) W ! ZWRITE VSCODE
"RTN","SYNDHP14",69,0)
 ;
"RTN","SYNDHP14",70,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VSCODE,.VSCODEJ)
"RTN","SYNDHP14",71,0)
 ;
"RTN","SYNDHP14",72,0)
 QUIT
"RTN","SYNDHP14",73,0)
 ;
"RTN","SYNDHP14",74,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP14",75,0)
 ;
"RTN","SYNDHP14",76,0)
GET1VCPT(VCPT,VCPTIEN,RETJSON,VCPTJ) ;get one V CPT record
"RTN","SYNDHP14",77,0)
 ;inputs: VCPTIEN - V CPT IEN
"RTN","SYNDHP14",78,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP14",79,0)
 ;output: VCPT  - array of V CPT data, by reference
"RTN","SYNDHP14",80,0)
 ;        VCPTJ - JSON structure of V CPT data, by reference
"RTN","SYNDHP14",81,0)
 ;
"RTN","SYNDHP14",82,0)
 I $G(DEBUG) W !,"V CPT",!
"RTN","SYNDHP14",83,0)
 N S S S="_"
"RTN","SYNDHP14",84,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP14",85,0)
 N FNBR1 S FNBR1=9000010.18 ;V CPT
"RTN","SYNDHP14",86,0)
 N FNBR2 S FNBR2=9000010.181 ;CPT MODIFIER
"RTN","SYNDHP14",87,0)
 N IENS1 S IENS1=VCPTIEN_","
"RTN","SYNDHP14",88,0)
 ;
"RTN","SYNDHP14",89,0)
 N VCPTARR,VCPTERR
"RTN","SYNDHP14",90,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","VCPTARR","VCPTERR")
"RTN","SYNDHP14",91,0)
 ;I $G(DEBUG) W ! ZWRITE VCPTARR
"RTN","SYNDHP14",92,0)
 ;I $G(DEBUG),$D(VCPTERR) W ">>ERROR<<",! ZWRITE VCPTERR
"RTN","SYNDHP14",93,0)
 I $D(VCPTERR) D  QUIT
"RTN","SYNDHP14",94,0)
 . S VCPT("Vcpt","ERROR")=VCPTIEN
"RTN","SYNDHP14",95,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VCPT,.VCPTJ)
"RTN","SYNDHP14",96,0)
 S VCPT("Vcpt","vcptIen")=VCPTIEN
"RTN","SYNDHP14",97,0)
 S VCPT("Vcpt","resourceType")="Encounter"
"RTN","SYNDHP14",98,0)
 S VCPT("Vcpt","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VCPTIEN
"RTN","SYNDHP14",99,0)
 S VCPT("Vcpt","cpt")=$G(VCPTARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP14",100,0)
 S VCPT("Vcpt","cptId")=$G(VCPTARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP14",101,0)
 S VCPT("Vcpt","cptName")=$$GET1^DIQ(81,VCPT("Vcpt","cptId")_",",2)
"RTN","SYNDHP14",102,0)
 S VCPT("Vcpt","patientName")=$G(VCPTARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP14",103,0)
 S VCPT("Vcpt","patientNameId")=$G(VCPTARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP14",104,0)
 S VCPT("Vcpt","patientICN")=$$GET1^DIQ(2,VCPT("Vcpt","patientNameId")_",",991.1)
"RTN","SYNDHP14",105,0)
 S VCPT("Vcpt","visit")=$G(VCPTARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP14",106,0)
 S VCPT("Vcpt","visitId")=$G(VCPTARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP14",107,0)
 S VCPT("Vcpt","visitFM")=$$GET1^DIQ(9000010,VCPT("Vcpt","visitId")_",",.01,"I")
"RTN","SYNDHP14",108,0)
 S VCPT("Vcpt","visitHL7")=$$FMTHL7^XLFDT(VCPT("Vcpt","visitFM"))
"RTN","SYNDHP14",109,0)
 S VCPT("Vcpt","visitFHIR")=$$FMTFHIR^SYNDHPUTL(VCPT("Vcpt","visitFM"))
"RTN","SYNDHP14",110,0)
 S VCPT("Vcpt","providerNarrative")=$G(VCPTARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP14",111,0)
 S VCPT("Vcpt","providerNarrativeId")=$G(VCPTARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP14",112,0)
 S VCPT("Vcpt","diagnosis")=$G(VCPTARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP14",113,0)
 S VCPT("Vcpt","diagnosisId")=$G(VCPTARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP14",114,0)
 S VCPT("Vcpt","principalProcedure")=$G(VCPTARR(FNBR1,IENS1,.07,"E"))
"RTN","SYNDHP14",115,0)
 S VCPT("Vcpt","principalProcedureCd")=$G(VCPTARR(FNBR1,IENS1,.07,"I"))
"RTN","SYNDHP14",116,0)
 S VCPT("Vcpt","diagnosis2")=$G(VCPTARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP14",117,0)
 S VCPT("Vcpt","diagnosis2Id")=$G(VCPTARR(FNBR1,IENS1,.09,"I"))
"RTN","SYNDHP14",118,0)
 S VCPT("Vcpt","diagnosis3")=$G(VCPTARR(FNBR1,IENS1,.1,"E"))
"RTN","SYNDHP14",119,0)
 S VCPT("Vcpt","diagnosis3Id")=$G(VCPTARR(FNBR1,IENS1,.1,"I"))
"RTN","SYNDHP14",120,0)
 S VCPT("Vcpt","diagnosis4")=$G(VCPTARR(FNBR1,IENS1,.11,"E"))
"RTN","SYNDHP14",121,0)
 S VCPT("Vcpt","diagnosis4Id")=$G(VCPTARR(FNBR1,IENS1,.11,"I"))
"RTN","SYNDHP14",122,0)
 S VCPT("Vcpt","diagnosis5")=$G(VCPTARR(FNBR1,IENS1,.12,"E"))
"RTN","SYNDHP14",123,0)
 S VCPT("Vcpt","diagnosis5Id")=$G(VCPTARR(FNBR1,IENS1,.12,"I"))
"RTN","SYNDHP14",124,0)
 S VCPT("Vcpt","diagnosis6")=$G(VCPTARR(FNBR1,IENS1,.13,"E"))
"RTN","SYNDHP14",125,0)
 S VCPT("Vcpt","diagnosis6Id")=$G(VCPTARR(FNBR1,IENS1,.13,"I"))
"RTN","SYNDHP14",126,0)
 S VCPT("Vcpt","diagnosis7")=$G(VCPTARR(FNBR1,IENS1,.14,"E"))
"RTN","SYNDHP14",127,0)
 S VCPT("Vcpt","diagnosis7Id")=$G(VCPTARR(FNBR1,IENS1,.14,"I"))
"RTN","SYNDHP14",128,0)
 S VCPT("Vcpt","diagnosis8")=$G(VCPTARR(FNBR1,IENS1,.15,"E"))
"RTN","SYNDHP14",129,0)
 S VCPT("Vcpt","diagnosis8Id")=$G(VCPTARR(FNBR1,IENS1,.15,"I"))
"RTN","SYNDHP14",130,0)
 S VCPT("Vcpt","quantity")=$G(VCPTARR(FNBR1,IENS1,.16,"E"))
"RTN","SYNDHP14",131,0)
 S VCPT("Vcpt","orderReference")=$G(VCPTARR(FNBR1,IENS1,.17,"E"))
"RTN","SYNDHP14",132,0)
 S VCPT("Vcpt","orderReferenceId")=$G(VCPTARR(FNBR1,IENS1,.17,"I"))
"RTN","SYNDHP14",133,0)
 S VCPT("Vcpt","departmentCode")=$G(VCPTARR(FNBR1,IENS1,.19,"E"))
"RTN","SYNDHP14",134,0)
 S VCPT("Vcpt","pfssChargeId")=$G(VCPTARR(FNBR1,IENS1,.2,"E"))
"RTN","SYNDHP14",135,0)
 S VCPT("Vcpt","mappedSource")=$G(VCPTARR(FNBR1,IENS1,300,"E"))
"RTN","SYNDHP14",136,0)
 S VCPT("Vcpt","eventDateAndTime")=$G(VCPTARR(FNBR1,IENS1,1201,"E"))
"RTN","SYNDHP14",137,0)
 S VCPT("Vcpt","eventDateAndTimeFM")=$G(VCPTARR(FNBR1,IENS1,1201,"I"))
"RTN","SYNDHP14",138,0)
 S VCPT("Vcpt","eventDateAndTimeHL7")=$$FMTHL7^XLFDT($G(VCPTARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP14",139,0)
 S VCPT("Vcpt","eventDateAndTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(VCPTARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP14",140,0)
 S VCPT("Vcpt","orderingProvider")=$G(VCPTARR(FNBR1,IENS1,1202,"E"))
"RTN","SYNDHP14",141,0)
 S VCPT("Vcpt","orderingProviderId")=$G(VCPTARR(FNBR1,IENS1,1202,"I"))
"RTN","SYNDHP14",142,0)
 S VCPT("Vcpt","encounterProvider")=$G(VCPTARR(FNBR1,IENS1,1204,"E"))
"RTN","SYNDHP14",143,0)
 S VCPT("Vcpt","encounterProviderId")=$G(VCPTARR(FNBR1,IENS1,1204,"I"))
"RTN","SYNDHP14",144,0)
 S VCPT("Vcpt","editedFlag")=$G(VCPTARR(FNBR1,IENS1,80101,"E"))
"RTN","SYNDHP14",145,0)
 S VCPT("Vcpt","editedFlagCd")=$G(VCPTARR(FNBR1,IENS1,80101,"I"))
"RTN","SYNDHP14",146,0)
 S VCPT("Vcpt","auditTrail")=$G(VCPTARR(FNBR1,IENS1,80102,"E"))
"RTN","SYNDHP14",147,0)
 S VCPT("Vcpt","providerNarrativeCategory")=$G(VCPTARR(FNBR1,IENS1,80201,"E"))
"RTN","SYNDHP14",148,0)
 S VCPT("Vcpt","providerNarrativeCategoryId")=$G(VCPTARR(FNBR1,IENS1,80201,"I"))
"RTN","SYNDHP14",149,0)
 S VCPT("Vcpt","comments")=$G(VCPTARR(FNBR1,IENS1,81101,"E"))
"RTN","SYNDHP14",150,0)
 S VCPT("Vcpt","verified")=$G(VCPTARR(FNBR1,IENS1,81201,"E"))
"RTN","SYNDHP14",151,0)
 S VCPT("Vcpt","verifiedCd")=$G(VCPTARR(FNBR1,IENS1,81201,"I"))
"RTN","SYNDHP14",152,0)
 S VCPT("Vcpt","package")=$G(VCPTARR(FNBR1,IENS1,81202,"E"))
"RTN","SYNDHP14",153,0)
 S VCPT("Vcpt","packageId")=$G(VCPTARR(FNBR1,IENS1,81202,"I"))
"RTN","SYNDHP14",154,0)
 S VCPT("Vcpt","dataSource")=$G(VCPTARR(FNBR1,IENS1,81203,"E"))
"RTN","SYNDHP14",155,0)
 S VCPT("Vcpt","dataSourceId")=$G(VCPTARR(FNBR1,IENS1,81203,"I"))
"RTN","SYNDHP14",156,0)
 N CPTMOD
"RTN","SYNDHP14",157,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP14",158,0)
 F  S IENS2=$O(VCPTARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP14",159,0)
 . S CPTMOD=$NA(VCPT("Vcpt","cptModifiers","cptModifier",+IENS2))
"RTN","SYNDHP14",160,0)
 . S @CPTMOD@("cptModifier")=$G(VCPTARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP14",161,0)
 . S @CPTMOD@("cptModifierId")=$G(VCPTARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP14",162,0)
 . S @CPTMOD@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VCPTIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP14",163,0)
 ;
"RTN","SYNDHP14",164,0)
 ;I $G(DEBUG) W ! ZWRITE VCPT
"RTN","SYNDHP14",165,0)
 ;
"RTN","SYNDHP14",166,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VCPT,.VCPTJ)
"RTN","SYNDHP14",167,0)
 ;
"RTN","SYNDHP14",168,0)
 QUIT
"RTN","SYNDHP14",169,0)
 ;
"RTN","SYNDHP15")
0^90^B159077808
"RTN","SYNDHP15",1,0)
SYNDHP15 ; HC/art - HealthConcourse - get care plan data ;03/01/2019
"RTN","SYNDHP15",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP15",3,0)
 ;;
"RTN","SYNDHP15",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP15",5,0)
 ;
"RTN","SYNDHP15",6,0)
 QUIT
"RTN","SYNDHP15",7,0)
 ;
"RTN","SYNDHP15",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP15",9,0)
 ;
"RTN","SYNDHP15",10,0)
GET1HLF(HLFACT,HLFIEN,CP,RETJSON,HLFACTJ) ;get one Health Factor
"RTN","SYNDHP15",11,0)
 ;inputs: HLFIEN - Health Factor IEN
"RTN","SYNDHP15",12,0)
 ;        CP     - 0=get all records
"RTN","SYNDHP15",13,0)
 ;                 1= + SYN care plan data elements
"RTN","SYNDHP15",14,0)
 ;        RETJSON - J or F = Return JSON
"RTN","SYNDHP15",15,0)
 ;output: HLFACT  - array of Health Factor data, by reference
"RTN","SYNDHP15",16,0)
 ;        HLFACTJ - JSON structure of Health Factor data, by reference
"RTN","SYNDHP15",17,0)
 ;
"RTN","SYNDHP15",18,0)
 I $G(DEBUG) W !,"----------------------------- Health Factor -----------------------------",!
"RTN","SYNDHP15",19,0)
 N FNBR1 S FNBR1=9000010.23 ;V HEALTH FACTORS
"RTN","SYNDHP15",20,0)
 N S S S="_"
"RTN","SYNDHP15",21,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP15",22,0)
 N IENS S IENS=HLFIEN_","
"RTN","SYNDHP15",23,0)
 N HLFARR,HLFERR
"RTN","SYNDHP15",24,0)
 D GETS^DIQ(FNBR1,IENS,"**","EI","HLFARR","HLFERR")
"RTN","SYNDHP15",25,0)
 ;I $G(DEBUG) W ! ZWRITE HLFARR
"RTN","SYNDHP15",26,0)
 ;I $G(DEBUG),$D(HLFERR) W ">>ERROR<<",! ZWRITE HLFERR
"RTN","SYNDHP15",27,0)
 I $D(HLFERR) D  QUIT
"RTN","SYNDHP15",28,0)
 . S HLFACT("HealthFactor","ERROR")=HLFIEN
"RTN","SYNDHP15",29,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.HLFACT,.HLFACTJ)
"RTN","SYNDHP15",30,0)
 N HLFACTOR S HLFACTOR=$NA(HLFACT("HealthFactor"))
"RTN","SYNDHP15",31,0)
 S @HLFACTOR@("hlfIen")=HLFIEN
"RTN","SYNDHP15",32,0)
 S @HLFACTOR@("resourceType")="HealthFactor"
"RTN","SYNDHP15",33,0)
 S @HLFACTOR@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HLFIEN
"RTN","SYNDHP15",34,0)
 S @HLFACTOR@("visitId")=$G(HLFARR(FNBR1,IENS,.03,"I"))
"RTN","SYNDHP15",35,0)
 S @HLFACTOR@("visit")=$G(HLFARR(FNBR1,IENS,.03,"E"))
"RTN","SYNDHP15",36,0)
 S @HLFACTOR@("visitFM")=$$GET1^DIQ(9000010,@HLFACTOR@("visitId")_",",.01,"I")
"RTN","SYNDHP15",37,0)
 S @HLFACTOR@("visitHL7")=$$FMTHL7^XLFDT(@HLFACTOR@("visitFM"))
"RTN","SYNDHP15",38,0)
 S @HLFACTOR@("visitFHIR")=$$FMTFHIR^SYNDHPUTL(@HLFACTOR@("visitFM"))
"RTN","SYNDHP15",39,0)
 S @HLFACTOR@("hlfNameId")=$G(HLFARR(FNBR1,IENS,.01,"I"))
"RTN","SYNDHP15",40,0)
 S @HLFACTOR@("hlfName")=$G(HLFARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP15",41,0)
 QUIT:$G(CP)&($E(@HLFACTOR@("hlfName"),1,4)'="SYN ")
"RTN","SYNDHP15",42,0)
 S @HLFACTOR@("hlfCategory")=$$GET1^DIQ(9999999.64,@HLFACTOR@("hlfNameId")_",",.03,"E")
"RTN","SYNDHP15",43,0)
 S @HLFACTOR@("hlfCategoryId")=$$GET1^DIQ(9999999.64,@HLFACTOR@("hlfNameId")_",",.03,"I")
"RTN","SYNDHP15",44,0)
 S @HLFACTOR@("patientNameId")=$G(HLFARR(FNBR1,IENS,.02,"I"))
"RTN","SYNDHP15",45,0)
 S @HLFACTOR@("patientName")=$G(HLFARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP15",46,0)
 S @HLFACTOR@("patientICN")=$$GET1^DIQ(2,@HLFACTOR@("patientNameId")_",",991.1)
"RTN","SYNDHP15",47,0)
 S @HLFACTOR@("levelSeverityCd")=$G(HLFARR(FNBR1,IENS,.04,"I"))
"RTN","SYNDHP15",48,0)
 S @HLFACTOR@("levelSeverity")=$G(HLFARR(FNBR1,IENS,.04,"E"))
"RTN","SYNDHP15",49,0)
 S @HLFACTOR@("magnitude")=$G(HLFARR(FNBR1,IENS,220,"E"))
"RTN","SYNDHP15",50,0)
 S @HLFACTOR@("ucumCode")=$G(HLFARR(FNBR1,IENS,221,"I"))
"RTN","SYNDHP15",51,0)
 S @HLFACTOR@("ucumCode")=$G(HLFARR(FNBR1,IENS,221,"E"))
"RTN","SYNDHP15",52,0)
 S @HLFACTOR@("eventDateTime")=$G(HLFARR(FNBR1,IENS,1201,"E"))
"RTN","SYNDHP15",53,0)
 S @HLFACTOR@("eventDateTimeFM")=$G(HLFARR(FNBR1,IENS,1201,"I"))
"RTN","SYNDHP15",54,0)
 S @HLFACTOR@("eventDateTimeHL7")=$$FMTHL7^XLFDT($G(HLFARR(FNBR1,IENS,1201,"I")))
"RTN","SYNDHP15",55,0)
 S @HLFACTOR@("eventDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(HLFARR(FNBR1,IENS,1201,"I")))
"RTN","SYNDHP15",56,0)
 S @HLFACTOR@("orderingProviderId")=$G(HLFARR(FNBR1,IENS,1202,"I"))
"RTN","SYNDHP15",57,0)
 S @HLFACTOR@("orderingProvider")=$G(HLFARR(FNBR1,IENS,1202,"E"))
"RTN","SYNDHP15",58,0)
 S @HLFACTOR@("encounterProviderId")=$G(HLFARR(FNBR1,IENS,1204,"I"))
"RTN","SYNDHP15",59,0)
 S @HLFACTOR@("encounterProvider")=$G(HLFARR(FNBR1,IENS,1204,"E"))
"RTN","SYNDHP15",60,0)
 S @HLFACTOR@("editedCd")=$G(HLFARR(FNBR1,IENS,80101,"I"))
"RTN","SYNDHP15",61,0)
 S @HLFACTOR@("edited")=$G(HLFARR(FNBR1,IENS,80101,"E"))
"RTN","SYNDHP15",62,0)
 S @HLFACTOR@("auditTrail")=$G(HLFARR(FNBR1,IENS,80102,"E"))
"RTN","SYNDHP15",63,0)
 S @HLFACTOR@("comments")=$G(HLFARR(FNBR1,IENS,81101,"E"))
"RTN","SYNDHP15",64,0)
 S @HLFACTOR@("verifiedCd")=$G(HLFARR(FNBR1,IENS,81201,"I"))
"RTN","SYNDHP15",65,0)
 S @HLFACTOR@("verified")=$G(HLFARR(FNBR1,IENS,81201,"E"))
"RTN","SYNDHP15",66,0)
 S @HLFACTOR@("packageId")=$G(HLFARR(FNBR1,IENS,81202,"I"))
"RTN","SYNDHP15",67,0)
 S @HLFACTOR@("package")=$G(HLFARR(FNBR1,IENS,81202,"E"))
"RTN","SYNDHP15",68,0)
 S @HLFACTOR@("dataSourceId")=$G(HLFARR(FNBR1,IENS,81203,"I"))
"RTN","SYNDHP15",69,0)
 S @HLFACTOR@("dataSource")=$G(HLFARR(FNBR1,IENS,81203,"E"))
"RTN","SYNDHP15",70,0)
 ;
"RTN","SYNDHP15",71,0)
 ;care plan record
"RTN","SYNDHP15",72,0)
 I $E(@HLFACTOR@("hlfName"),1,7)="SYN CP " D
"RTN","SYNDHP15",73,0)
 . S @HLFACTOR@("cpStart")=+($$STRIP^XLFSTR($P(@HLFACTOR@("comments"),":",2)," "))
"RTN","SYNDHP15",74,0)
 . I @HLFACTOR@("cpStart")=0 S @HLFACTOR@("cpStart")=""
"RTN","SYNDHP15",75,0)
 . S @HLFACTOR@("cpStartHL7")=$$FMTHL7^XLFDT(@HLFACTOR@("cpStart"))
"RTN","SYNDHP15",76,0)
 . S @HLFACTOR@("cpStartFHIR")=$$FMTFHIR^SYNDHPUTL(@HLFACTOR@("cpStart"))
"RTN","SYNDHP15",77,0)
 . S @HLFACTOR@("cpEnd")=+($$STRIP^XLFSTR($P(@HLFACTOR@("comments"),":",3)," "))
"RTN","SYNDHP15",78,0)
 . I @HLFACTOR@("cpEnd")=0 S @HLFACTOR@("cpEnd")=""
"RTN","SYNDHP15",79,0)
 . S @HLFACTOR@("cpEndHL7")=$$FMTHL7^XLFDT(@HLFACTOR@("cpEnd"))
"RTN","SYNDHP15",80,0)
 . S @HLFACTOR@("cpEndFHIR")=$$FMTFHIR^SYNDHPUTL(@HLFACTOR@("cpEnd"))
"RTN","SYNDHP15",81,0)
 . S @HLFACTOR@("cpState")=$$STRIP^XLFSTR($P(@HLFACTOR@("comments"),":",4)," ")
"RTN","SYNDHP15",82,0)
 . S @HLFACTOR@("cpIntent")="plan"
"RTN","SYNDHP15",83,0)
 ;
"RTN","SYNDHP15",84,0)
 I $G(CP) D
"RTN","SYNDHP15",85,0)
 . S @HLFACTOR@("cpType")=$$GETTYPE(@HLFACTOR@("hlfName"))
"RTN","SYNDHP15",86,0)
 . S @HLFACTOR@("hlfNameSCT")=$$GETSCT(@HLFACTOR@("hlfName"))
"RTN","SYNDHP15",87,0)
 . S @HLFACTOR@("cpState")=$$STRIP^XLFSTR($P(@HLFACTOR@("comments"),":",4)," ")
"RTN","SYNDHP15",88,0)
 . S @HLFACTOR@("cpResourceType")="CarePlan"
"RTN","SYNDHP15",89,0)
 ;
"RTN","SYNDHP15",90,0)
 I '$G(CP) D
"RTN","SYNDHP15",91,0)
 . ;get snomed
"RTN","SYNDHP15",92,0)
 . N SCT S SCT=""
"RTN","SYNDHP15",93,0)
 . I @HLFACTOR@("hlfNameId")'="" D
"RTN","SYNDHP15",94,0)
 . . S SCT=$$MAP^SYNDHPMP("sct2hf",@HLFACTOR@("hlfNameId"),"I")
"RTN","SYNDHP15",95,0)
 . . S @HLFACTOR@("hlfNameSCT")=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP15",96,0)
 ;
"RTN","SYNDHP15",97,0)
 ;I $G(DEBUG) W ! ZWRITE HLFACT
"RTN","SYNDHP15",98,0)
 ;
"RTN","SYNDHP15",99,0)
 D:$G(RETJSON)="J"!($G(RETJSON)="F") TOJASON^SYNDHPUTL(.HLFACT,.HLFACTJ)
"RTN","SYNDHP15",100,0)
 ;
"RTN","SYNDHP15",101,0)
 QUIT
"RTN","SYNDHP15",102,0)
 ;
"RTN","SYNDHP15",103,0)
GETTYPE(HFNAME) ;
"RTN","SYNDHP15",104,0)
 ;
"RTN","SYNDHP15",105,0)
 QUIT $S($E(HFNAME,1,7)="SYN CP ":"careplan",$E(HFNAME,1,8)="SYN ADDR":"addresses",$E(HFNAME,1,8)="SYN ACT ":"activity",$E(HFNAME,1,9)="SYN GOAL ":"goal",1:"")
"RTN","SYNDHP15",106,0)
 ;
"RTN","SYNDHP15",107,0)
GETSCT(HFNAME) ;
"RTN","SYNDHP15",108,0)
 ;
"RTN","SYNDHP15",109,0)
 QUIT $P($P(HFNAME,"SCT:",2),")",1)
"RTN","SYNDHP15",110,0)
 ;
"RTN","SYNDHP15",111,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP15",112,0)
 ;
"RTN","SYNDHP15",113,0)
GET1NCP(NCP,NCPIEN,RETJSON,NCPJ) ;get one nursing care plan
"RTN","SYNDHP15",114,0)
 ;inputs: HLFIEN - Health Factor IEN
"RTN","SYNDHP15",115,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP15",116,0)
 ;output: NCP  - array of nursing care plan, by reference
"RTN","SYNDHP15",117,0)
 ;        NCPJ - JSON structure of nursing care plan data, by reference
"RTN","SYNDHP15",118,0)
 ;
"RTN","SYNDHP15",119,0)
 I $G(DEBUG) W !,"----------------------------- Nursing Care Plan -----------------------------",!
"RTN","SYNDHP15",120,0)
 N FNBR1 S FNBR1=216.8 ;NURS CARE PLAN
"RTN","SYNDHP15",121,0)
 N FNBR2 S FNBR2=216.81 ;NURS CARE PLAN:NURSING PROBLEM LIST
"RTN","SYNDHP15",122,0)
 N FNBR3 S FNBR3=216.82 ;NURS CARE PLAN:EVALUATION DATE
"RTN","SYNDHP15",123,0)
 N FNBR4 S FNBR4=216.83 ;NURS CARE PLAN:TARGET DATE
"RTN","SYNDHP15",124,0)
 N FNBR5 S FNBR5=216.84 ;NURS CARE PLAN:ORDER INFO
"RTN","SYNDHP15",125,0)
 N S S S="_"
"RTN","SYNDHP15",126,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP15",127,0)
 N IENS S IENS=NCPIEN_","
"RTN","SYNDHP15",128,0)
 N NCPARR,NCPERR
"RTN","SYNDHP15",129,0)
 D GETS^DIQ(FNBR1,IENS,"**","EI","NCPARR","NCPERR")
"RTN","SYNDHP15",130,0)
 ;I $G(DEBUG) W ! ZWRITE NCPARR
"RTN","SYNDHP15",131,0)
 ;I $G(DEBUG),$D(NCPERR) W ">>ERROR<<",! ZWRITE NCPERR
"RTN","SYNDHP15",132,0)
 I $D(NCPERR) D  QUIT
"RTN","SYNDHP15",133,0)
 . S NCP("NurseCarePlan","ERROR")=NCPIEN
"RTN","SYNDHP15",134,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.NCP,.NCPJ)
"RTN","SYNDHP15",135,0)
 N CAREPLAN S CAREPLAN=$NA(NCP("NurseCarePlan"))
"RTN","SYNDHP15",136,0)
 S @CAREPLAN@("ncpIen")=NCPIEN
"RTN","SYNDHP15",137,0)
 S @CAREPLAN@("resourceType")="NurseCarePlan"
"RTN","SYNDHP15",138,0)
 S @CAREPLAN@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_NCPIEN
"RTN","SYNDHP15",139,0)
 S @CAREPLAN@("textFileEntryId")=$G(NCPARR(FNBR1,IENS,.01,"I"))
"RTN","SYNDHP15",140,0)
 S @CAREPLAN@("textFileEntry")=$G(NCPARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP15",141,0)
 ;
"RTN","SYNDHP15",142,0)
 N PROB S PROB=""
"RTN","SYNDHP15",143,0)
 F  S PROB=$O(NCPARR(FNBR2,PROB)) QUIT:PROB=""  D
"RTN","SYNDHP15",144,0)
 . N FIEN S FIEN=+PROB
"RTN","SYNDHP15",145,0)
 . N PROBLIST S PROBLIST=$NA(NCP("NurseCarePlan","problemLists","problemList",FIEN))
"RTN","SYNDHP15",146,0)
 . S @PROBLIST@("problemId")=$G(NCPARR(FNBR2,PROB,.01,"I"))
"RTN","SYNDHP15",147,0)
 . S @PROBLIST@("problem")=$G(NCPARR(FNBR2,PROB,.01,"E"))
"RTN","SYNDHP15",148,0)
 . S @PROBLIST@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_NCPIEN_S_FNBR2_S_FIEN
"RTN","SYNDHP15",149,0)
 ;
"RTN","SYNDHP15",150,0)
 N EVAL S EVAL=""
"RTN","SYNDHP15",151,0)
 F  S EVAL=$O(NCPARR(FNBR3,EVAL)) QUIT:EVAL=""  D
"RTN","SYNDHP15",152,0)
 . N FIEN S FIEN=+EVAL
"RTN","SYNDHP15",153,0)
 . N EVALDATE S EVALDATE=$NA(NCP("NurseCarePlan","evaluationDates","evaluationDate",FIEN))
"RTN","SYNDHP15",154,0)
 . S @EVALDATE@("dateTimeEntered")=$G(NCPARR(FNBR3,EVAL,.01,"E"))
"RTN","SYNDHP15",155,0)
 . S @EVALDATE@("dateTimeEnteredFM")=$G(NCPARR(FNBR3,EVAL,.01,"I"))
"RTN","SYNDHP15",156,0)
 . S @EVALDATE@("dateTimeEnteredHL7")=$$FMTHL7^XLFDT($G(NCPARR(FNBR3,EVAL,.01,"I")))
"RTN","SYNDHP15",157,0)
 . S @EVALDATE@("dateTimeEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(NCPARR(FNBR3,EVAL,.01,"I")))
"RTN","SYNDHP15",158,0)
 . S @EVALDATE@("problemId")=$G(NCPARR(FNBR3,EVAL,.02,"I"))
"RTN","SYNDHP15",159,0)
 . S @EVALDATE@("problem")=$G(NCPARR(FNBR3,EVAL,.02,"E"))
"RTN","SYNDHP15",160,0)
 . S @EVALDATE@("userWhoEvaluatedId")=$G(NCPARR(FNBR3,EVAL,1,"I"))
"RTN","SYNDHP15",161,0)
 . S @EVALDATE@("userWhoEvaluated")=$G(NCPARR(FNBR3,EVAL,1,"E"))
"RTN","SYNDHP15",162,0)
 . S @EVALDATE@("problemStatusCd")=$G(NCPARR(FNBR3,EVAL,2,"I"))
"RTN","SYNDHP15",163,0)
 . S @EVALDATE@("problemStatus")=$G(NCPARR(FNBR3,EVAL,2,"E"))
"RTN","SYNDHP15",164,0)
 . S @EVALDATE@("evaluationDate")=$G(NCPARR(FNBR3,EVAL,3,"E"))
"RTN","SYNDHP15",165,0)
 . S @EVALDATE@("evaluationDateFM")=$G(NCPARR(FNBR3,EVAL,3,"I"))
"RTN","SYNDHP15",166,0)
 . S @EVALDATE@("evaluationDateHL7")=$$FMTHL7^XLFDT($G(NCPARR(FNBR3,EVAL,3,"I")))
"RTN","SYNDHP15",167,0)
 . S @EVALDATE@("evaluationDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(NCPARR(FNBR3,EVAL,3,"I")))
"RTN","SYNDHP15",168,0)
 . S @EVALDATE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_NCPIEN_S_FNBR3_S_FIEN
"RTN","SYNDHP15",169,0)
 ;
"RTN","SYNDHP15",170,0)
 N TARG S TARG=""
"RTN","SYNDHP15",171,0)
 F  S TARG=$O(NCPARR(FNBR4,TARG)) QUIT:TARG=""  D
"RTN","SYNDHP15",172,0)
 . N FIEN S FIEN=+TARG
"RTN","SYNDHP15",173,0)
 . N TARGDATE S TARGDATE=$NA(NCP("NurseCarePlan","targetDates","targetDate",FIEN))
"RTN","SYNDHP15",174,0)
 . S @TARGDATE@("dateTimeEntered")=$G(NCPARR(FNBR4,TARG,.01,"E"))
"RTN","SYNDHP15",175,0)
 . S @TARGDATE@("dateTimeEnteredFM")=$G(NCPARR(FNBR4,TARG,.01,"I"))
"RTN","SYNDHP15",176,0)
 . S @TARGDATE@("dateTimeEnteredHL7")=$$FMTHL7^XLFDT($G(NCPARR(FNBR4,TARG,.01,"I")))
"RTN","SYNDHP15",177,0)
 . S @TARGDATE@("dateTimeEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(NCPARR(FNBR4,TARG,.01,"I")))
"RTN","SYNDHP15",178,0)
 . S @TARGDATE@("goalExpectedOutcomeId")=$G(NCPARR(FNBR4,TARG,.03,"I"))
"RTN","SYNDHP15",179,0)
 . S @TARGDATE@("goalExpectedOutcome")=$G(NCPARR(FNBR4,TARG,.03,"E"))
"RTN","SYNDHP15",180,0)
 . S @TARGDATE@("userWhoEnteredId")=$G(NCPARR(FNBR4,TARG,1,"I"))
"RTN","SYNDHP15",181,0)
 . S @TARGDATE@("userWhoEntered")=$G(NCPARR(FNBR4,TARG,1,"E"))
"RTN","SYNDHP15",182,0)
 . S @TARGDATE@("goalMetDcdCd")=$G(NCPARR(FNBR4,TARG,2,"I"))
"RTN","SYNDHP15",183,0)
 . S @TARGDATE@("goalMetDcd")=$G(NCPARR(FNBR4,TARG,2,"E"))
"RTN","SYNDHP15",184,0)
 . S @TARGDATE@("targetDate")=$G(NCPARR(FNBR4,TARG,3,"E"))
"RTN","SYNDHP15",185,0)
 . S @TARGDATE@("targetDateFM")=$G(NCPARR(FNBR4,TARG,3,"I"))
"RTN","SYNDHP15",186,0)
 . S @TARGDATE@("targetDateHL7")=$$FMTHL7^XLFDT($G(NCPARR(FNBR4,TARG,3,"I")))
"RTN","SYNDHP15",187,0)
 . S @TARGDATE@("targetDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(NCPARR(FNBR4,TARG,3,"I")))
"RTN","SYNDHP15",188,0)
 . S @TARGDATE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_NCPIEN_S_FNBR4_S_FIEN
"RTN","SYNDHP15",189,0)
 ;
"RTN","SYNDHP15",190,0)
 N ORD S ORD=""
"RTN","SYNDHP15",191,0)
 F  S ORD=$O(NCPARR(FNBR5,ORD)) QUIT:ORD=""  D
"RTN","SYNDHP15",192,0)
 . N FIEN S FIEN=+ORD
"RTN","SYNDHP15",193,0)
 . N ORDINFO S ORDINFO=$NA(NCP("NurseCarePlan","ordersInfo","orderInfo",FIEN))
"RTN","SYNDHP15",194,0)
 . S @ORDINFO@("statusCd")=$G(NCPARR(FNBR5,ORD,1,"I"))
"RTN","SYNDHP15",195,0)
 . S @ORDINFO@("status")=$G(NCPARR(FNBR5,ORD,1,"E"))
"RTN","SYNDHP15",196,0)
 . S @ORDINFO@("userModifyingId")=$G(NCPARR(FNBR5,ORD,2,"I"))
"RTN","SYNDHP15",197,0)
 . S @ORDINFO@("userModifying")=$G(NCPARR(FNBR5,ORD,2,"E"))
"RTN","SYNDHP15",198,0)
 . S @ORDINFO@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_NCPIEN_S_FNBR5_S_FIEN
"RTN","SYNDHP15",199,0)
 ;
"RTN","SYNDHP15",200,0)
 ;I $G(DEBUG) W ! ZWRITE NCP
"RTN","SYNDHP15",201,0)
 ;
"RTN","SYNDHP15",202,0)
 D:$G(RETJSON)="J"!($G(RETJSON)="F") TOJASON^SYNDHPUTL(.NCP,.NCPJ)
"RTN","SYNDHP15",203,0)
 ;
"RTN","SYNDHP15",204,0)
 QUIT
"RTN","SYNDHP15",205,0)
 ;
"RTN","SYNDHP15",206,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP15",207,0)
 ;
"RTN","SYNDHP15",208,0)
GET1GMR(GMRTEXT,GMRIEN,RETJSON,GMRTEXTJ) ;get one GMR Text record
"RTN","SYNDHP15",209,0)
 ;inputs: GMRIEN - GMR Text IEN
"RTN","SYNDHP15",210,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP15",211,0)
 ;output: GMRTEXT  - array of GMR Text data, by reference
"RTN","SYNDHP15",212,0)
 ;        GMRTEXTJ - JSON structure of GMR Text data, by reference
"RTN","SYNDHP15",213,0)
 ;
"RTN","SYNDHP15",214,0)
 I $G(DEBUG) W !,"----------------------------- GMR Text -----------------------------",!
"RTN","SYNDHP15",215,0)
 N FNBR1 S FNBR1=124.3 ;GMR TEXT
"RTN","SYNDHP15",216,0)
 N FNBR2 S FNBR2=124.31 ;GMR TEXT:SELECTION
"RTN","SYNDHP15",217,0)
 N FNBR3 S FNBR3=124.313 ;GMR TEXT:SELECTION:AUDIT TRAIL
"RTN","SYNDHP15",218,0)
 N S S S="_"
"RTN","SYNDHP15",219,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP15",220,0)
 N IENS S IENS=GMRIEN_","
"RTN","SYNDHP15",221,0)
 N GMRARR,GMRERR
"RTN","SYNDHP15",222,0)
 D GETS^DIQ(FNBR1,IENS,"**","EI","GMRARR","GMRERR")
"RTN","SYNDHP15",223,0)
 ;I $G(DEBUG) W ! ZWRITE GMRARR
"RTN","SYNDHP15",224,0)
 ;I $G(DEBUG),$D(GMRERR) W ">>ERROR<<",! ZWRITE GMRERR
"RTN","SYNDHP15",225,0)
 I $D(GMRERR) D  QUIT
"RTN","SYNDHP15",226,0)
 . S GMRTEXT("GMRtext","ERROR")=GMRIEN
"RTN","SYNDHP15",227,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.GMRTEXT,.GMRTEXTJ)
"RTN","SYNDHP15",228,0)
 N GMRTXT S GMRTXT=$NA(GMRTEXT("GMRtext"))
"RTN","SYNDHP15",229,0)
 S @GMRTXT@("GMRIen")=GMRIEN
"RTN","SYNDHP15",230,0)
 S @GMRTXT@("resourceType")="GMRtext"
"RTN","SYNDHP15",231,0)
 S @GMRTXT@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_GMRIEN
"RTN","SYNDHP15",232,0)
 S @GMRTXT@("textBlockId")=$G(GMRARR(FNBR1,IENS,.01,"I"))
"RTN","SYNDHP15",233,0)
 S @GMRTXT@("textBlock")=$G(GMRARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP15",234,0)
 S @GMRTXT@("patientId")=$G(GMRARR(FNBR1,IENS,.02,"I"))
"RTN","SYNDHP15",235,0)
 S @GMRTXT@("patient")=$G(GMRARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP15",236,0)
 S @GMRTXT@("patientICN")=$$GET1^DIQ(2,@GMRTXT@("patientId")_",",991.1)
"RTN","SYNDHP15",237,0)
 S @GMRTXT@("dateCreated")=$G(GMRARR(FNBR1,IENS,.03,"E"))
"RTN","SYNDHP15",238,0)
 S @GMRTXT@("dateCreatedFM")=$G(GMRARR(FNBR1,IENS,.03,"I"))
"RTN","SYNDHP15",239,0)
 S @GMRTXT@("dateCreatedHL7")=$$FMTHL7^XLFDT($G(GMRARR(FNBR1,IENS,.03,"I")))
"RTN","SYNDHP15",240,0)
 S @GMRTXT@("dateCreatedFHIR")=$$FMTFHIR^SYNDHPUTL($G(GMRARR(FNBR1,IENS,.03,"I")))
"RTN","SYNDHP15",241,0)
 S @GMRTXT@("authorId")=$G(GMRARR(FNBR1,IENS,3,"I"))
"RTN","SYNDHP15",242,0)
 S @GMRTXT@("author")=$G(GMRARR(FNBR1,IENS,3,"E"))
"RTN","SYNDHP15",243,0)
 S @GMRTXT@("enteredInErrorCd")=$G(GMRARR(FNBR1,IENS,5,"I"))
"RTN","SYNDHP15",244,0)
 S @GMRTXT@("enteredInError")=$G(GMRARR(FNBR1,IENS,5,"E"))
"RTN","SYNDHP15",245,0)
 S @GMRTXT@("dateEnteredInError")=$G(GMRARR(FNBR1,IENS,5.1,"E"))
"RTN","SYNDHP15",246,0)
 S @GMRTXT@("dateEnteredInErrorFM")=$G(GMRARR(FNBR1,IENS,5.1,"I"))
"RTN","SYNDHP15",247,0)
 S @GMRTXT@("dateEnteredInErrorHL7")=$$FMTHL7^XLFDT($G(GMRARR(FNBR1,IENS,5.1,"I")))
"RTN","SYNDHP15",248,0)
 S @GMRTXT@("dateEnteredInErrorFHIR")=$$FMTFHIR^SYNDHPUTL($G(GMRARR(FNBR1,IENS,5.1,"I")))
"RTN","SYNDHP15",249,0)
 S @GMRTXT@("userEnteringInErrorId")=$G(GMRARR(FNBR1,IENS,5.2,"I"))
"RTN","SYNDHP15",250,0)
 S @GMRTXT@("userEnteringInError")=$G(GMRARR(FNBR1,IENS,5.2,"E"))
"RTN","SYNDHP15",251,0)
 S @GMRTXT@("dateLastUpdated")=$G(GMRARR(FNBR1,IENS,6,"E"))
"RTN","SYNDHP15",252,0)
 S @GMRTXT@("dateLastUpdatedFM")=$G(GMRARR(FNBR1,IENS,6,"I"))
"RTN","SYNDHP15",253,0)
 S @GMRTXT@("dateLastUpdatedHL7")=$$FMTHL7^XLFDT($G(GMRARR(FNBR1,IENS,6,"I")))
"RTN","SYNDHP15",254,0)
 S @GMRTXT@("dateLastUpdatedFHIR")=$$FMTFHIR^SYNDHPUTL($G(GMRARR(FNBR1,IENS,6,"I")))
"RTN","SYNDHP15",255,0)
 ;
"RTN","SYNDHP15",256,0)
 N SEL S SEL=""
"RTN","SYNDHP15",257,0)
 F  S SEL=$O(GMRARR(FNBR2,SEL)) QUIT:SEL=""  D
"RTN","SYNDHP15",258,0)
 . N FIEN S FIEN=+SEL
"RTN","SYNDHP15",259,0)
 . N SELECTION S SELECTION=$NA(GMRTEXT("GMRtext","selections","selection",FIEN))
"RTN","SYNDHP15",260,0)
 . S @SELECTION@("selectionId")=$G(GMRARR(FNBR2,SEL,.01,"I"))
"RTN","SYNDHP15",261,0)
 . S @SELECTION@("selection")=$G(GMRARR(FNBR2,SEL,.01,"E"))
"RTN","SYNDHP15",262,0)
 . S @SELECTION@("appendedInternalText")=$G(GMRARR(FNBR2,SEL,1,"E"))
"RTN","SYNDHP15",263,0)
 . S @SELECTION@("additionalText")=$G(GMRARR(FNBR2,SEL,2,"E"))
"RTN","SYNDHP15",264,0)
 . S @SELECTION@("added")=$G(GMRARR(FNBR2,SEL,4,"E"))
"RTN","SYNDHP15",265,0)
 . S @SELECTION@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_GMRIEN_S_FNBR2_S_FIEN
"RTN","SYNDHP15",266,0)
 . N AUDIT S AUDIT=""
"RTN","SYNDHP15",267,0)
 . F  S AUDIT=$O(GMRARR(FNBR3,AUDIT)) QUIT:AUDIT=""  D
"RTN","SYNDHP15",268,0)
 . . N AIEN S AIEN=+AUDIT
"RTN","SYNDHP15",269,0)
 . . N AUDIT S AUDIT=$NA(GMRTEXT("GMRtext","selections","selection",FIEN,"auditTrails","auditTrail",AIEN))
"RTN","SYNDHP15",270,0)
 . . S @AUDIT@("auditTrailDateTime")=$G(GMRARR(FNBR3,AUDIT,.01,"E"))
"RTN","SYNDHP15",271,0)
 . . S @AUDIT@("auditTrailDateTimeFM")=$G(GMRARR(FNBR3,AUDIT,.01,"I"))
"RTN","SYNDHP15",272,0)
 . . S @AUDIT@("auditTrailDateTimeHL7")=$$FMTHL7^XLFDT($G(GMRARR(FNBR3,AUDIT,.01,"I")))
"RTN","SYNDHP15",273,0)
 . . S @AUDIT@("auditTrailDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(GMRARR(FNBR3,AUDIT,.01,"I")))
"RTN","SYNDHP15",274,0)
 . . S @AUDIT@("modification")=$G(GMRARR(FNBR3,AUDIT,1,"E"))
"RTN","SYNDHP15",275,0)
 . . S @AUDIT@("userWhoModifiedId")=$G(GMRARR(FNBR3,AUDIT,2,"I"))
"RTN","SYNDHP15",276,0)
 . . S @AUDIT@("userWhoModified")=$G(GMRARR(FNBR3,AUDIT,2,"E"))
"RTN","SYNDHP15",277,0)
 . . S @AUDIT@("appendedInternalText")=$G(GMRARR(FNBR3,AUDIT,3,"E"))
"RTN","SYNDHP15",278,0)
 . . S @AUDIT@("additionalText")=$G(GMRARR(FNBR3,AUDIT,4,"E"))
"RTN","SYNDHP15",279,0)
 . . S @AUDIT@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_GMRIEN_S_FNBR2_S_FIEN_S_FNBR3_S_AIEN
"RTN","SYNDHP15",280,0)
 ;
"RTN","SYNDHP15",281,0)
 ;I $G(DEBUG) W ! ZWRITE GMRTEXT
"RTN","SYNDHP15",282,0)
 ;
"RTN","SYNDHP15",283,0)
 D:$G(RETJSON)="J"!($G(RETJSON)="F") TOJASON^SYNDHPUTL(.GMRTEXT,.GMRTEXTJ)
"RTN","SYNDHP15",284,0)
 ;
"RTN","SYNDHP15",285,0)
 QUIT
"RTN","SYNDHP15",286,0)
 ;
"RTN","SYNDHP16")
0^91^B128773413
"RTN","SYNDHP16",1,0)
SYNDHP16 ; HC/art - HealthConcourse - get Allergy, Vitals, data ;03/01/2019
"RTN","SYNDHP16",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP16",3,0)
 ;;
"RTN","SYNDHP16",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP16",5,0)
 ;
"RTN","SYNDHP16",6,0)
 QUIT
"RTN","SYNDHP16",7,0)
 ;
"RTN","SYNDHP16",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP16",9,0)
 ;
"RTN","SYNDHP16",10,0)
GET1ALLERGY(ALLERGY,ALLERGYIEN,RETJSON,ALLERGYJ) ;get one Allergy record
"RTN","SYNDHP16",11,0)
 ;inputs: ALLERGYIEN - Allergy IEN
"RTN","SYNDHP16",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP16",13,0)
 ;output: ALLERGY  - array of Allergy data, by reference
"RTN","SYNDHP16",14,0)
 ;        ALLERGYJ - JSON structure of Allergy data, by reference
"RTN","SYNDHP16",15,0)
 ;
"RTN","SYNDHP16",16,0)
 I $G(DEBUG) W !,"--------------------------- Allergy -----------------------------",!
"RTN","SYNDHP16",17,0)
 N S S S="_"
"RTN","SYNDHP16",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP16",19,0)
 N FNBR1 S FNBR1=120.8 ;PATIENT ALLERGIES
"RTN","SYNDHP16",20,0)
 N FNBR2 S FNBR2=120.81 ;REACTIONS
"RTN","SYNDHP16",21,0)
 N FNBR3 S FNBR3=120.813 ;CHART MARKED
"RTN","SYNDHP16",22,0)
 N FNBR4 S FNBR4=120.814 ;ID BAND MARKED
"RTN","SYNDHP16",23,0)
 N FNBR5 S FNBR5=120.826 ;COMMENTS
"RTN","SYNDHP16",24,0)
 N IENS1 S IENS1=ALLERGYIEN_","
"RTN","SYNDHP16",25,0)
 ;
"RTN","SYNDHP16",26,0)
 N ALLERGYARR,ALLERGYERR,ALLERGYN
"RTN","SYNDHP16",27,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","ALLERGYARR","ALLERGYERR")
"RTN","SYNDHP16",28,0)
 ;I $G(DEBUG) W ! ZWRITE ALLERGYARR
"RTN","SYNDHP16",29,0)
 ;I $G(DEBUG),$D(ALLERGYERR) W ">>ERROR<<",! ZWRITE ALLERGYERR
"RTN","SYNDHP16",30,0)
 I $D(ALLERGYERR) D  QUIT
"RTN","SYNDHP16",31,0)
 . S ALLERGY("Allergy","ERROR")=ALLERGYIEN
"RTN","SYNDHP16",32,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.ALLERGY,.ALLERGYJ)
"RTN","SYNDHP16",33,0)
 S ALLERGYN=$NA(ALLERGY("Allergy"))
"RTN","SYNDHP16",34,0)
 S @ALLERGYN@("allergyIen")=ALLERGYIEN
"RTN","SYNDHP16",35,0)
 S @ALLERGYN@("resourceType")="AllergyIntolerance"
"RTN","SYNDHP16",36,0)
 S @ALLERGYN@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_ALLERGYIEN
"RTN","SYNDHP16",37,0)
 S @ALLERGYN@("patient")=$G(ALLERGYARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP16",38,0)
 S @ALLERGYN@("patientId")=$G(ALLERGYARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP16",39,0)
 S @ALLERGYN@("patientICN")=$$GET1^DIQ(2,@ALLERGYN@("patientId")_",",991.1)
"RTN","SYNDHP16",40,0)
 S @ALLERGYN@("reactant")=$G(ALLERGYARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP16",41,0)
 S @ALLERGYN@("reactantSCT")=$$MAPR^SYNDHPMP(@ALLERGYN@("reactant"),"T","A")
"RTN","SYNDHP16",42,0)
 S @ALLERGYN@("gmrAllergy")=$G(ALLERGYARR(FNBR1,IENS1,1,"E"))
"RTN","SYNDHP16",43,0)
 S @ALLERGYN@("gmrAllergyId")=$G(ALLERGYARR(FNBR1,IENS1,1,"I"))
"RTN","SYNDHP16",44,0)
 S @ALLERGYN@("allergyType")=$G(ALLERGYARR(FNBR1,IENS1,3.1,"E"))
"RTN","SYNDHP16",45,0)
 S @ALLERGYN@("allergyTypeFHIR")=$$CNVTTYPE(@ALLERGYN@("allergyType"))
"RTN","SYNDHP16",46,0)
 S @ALLERGYN@("originationDateTime")=$G(ALLERGYARR(FNBR1,IENS1,4,"E"))
"RTN","SYNDHP16",47,0)
 S @ALLERGYN@("originationDateTimeFM")=$G(ALLERGYARR(FNBR1,IENS1,4,"I"))
"RTN","SYNDHP16",48,0)
 S @ALLERGYN@("originationDateTimeHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR1,IENS1,4,"I")))
"RTN","SYNDHP16",49,0)
 S @ALLERGYN@("originationDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR1,IENS1,4,"I")))
"RTN","SYNDHP16",50,0)
 S @ALLERGYN@("originator")=$G(ALLERGYARR(FNBR1,IENS1,5,"E"))
"RTN","SYNDHP16",51,0)
 S @ALLERGYN@("originatorId")=$G(ALLERGYARR(FNBR1,IENS1,5,"I"))
"RTN","SYNDHP16",52,0)
 S @ALLERGYN@("observedHistorical")=$G(ALLERGYARR(FNBR1,IENS1,6,"E"))
"RTN","SYNDHP16",53,0)
 S @ALLERGYN@("observedHistoricalCd")=$G(ALLERGYARR(FNBR1,IENS1,6,"I"))
"RTN","SYNDHP16",54,0)
 S @ALLERGYN@("reportable")=$G(ALLERGYARR(FNBR1,IENS1,7,"E"))
"RTN","SYNDHP16",55,0)
 S @ALLERGYN@("reportableCd")=$G(ALLERGYARR(FNBR1,IENS1,7,"I"))
"RTN","SYNDHP16",56,0)
 S @ALLERGYN@("originatorSignOff")=$G(ALLERGYARR(FNBR1,IENS1,15,"E"))
"RTN","SYNDHP16",57,0)
 S @ALLERGYN@("originatorSignOffCd")=$G(ALLERGYARR(FNBR1,IENS1,15,"I"))
"RTN","SYNDHP16",58,0)
 S @ALLERGYN@("mechanism")=$G(ALLERGYARR(FNBR1,IENS1,17,"E"))
"RTN","SYNDHP16",59,0)
 S @ALLERGYN@("mechanismCd")=$G(ALLERGYARR(FNBR1,IENS1,17,"I"))
"RTN","SYNDHP16",60,0)
 S @ALLERGYN@("verified")=$G(ALLERGYARR(FNBR1,IENS1,19,"E"))
"RTN","SYNDHP16",61,0)
 S @ALLERGYN@("verifiedCd")=$G(ALLERGYARR(FNBR1,IENS1,19,"I"))
"RTN","SYNDHP16",62,0)
 S @ALLERGYN@("verificationDateTime")=$G(ALLERGYARR(FNBR1,IENS1,20,"E"))
"RTN","SYNDHP16",63,0)
 S @ALLERGYN@("verificationDateTimeFM")=$G(ALLERGYARR(FNBR1,IENS1,20,"I"))
"RTN","SYNDHP16",64,0)
 S @ALLERGYN@("verificationDateTimeHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR1,IENS1,20,"I")))
"RTN","SYNDHP16",65,0)
 S @ALLERGYN@("verificationDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR1,IENS1,20,"I")))
"RTN","SYNDHP16",66,0)
 S @ALLERGYN@("verifier")=$G(ALLERGYARR(FNBR1,IENS1,21,"E"))
"RTN","SYNDHP16",67,0)
 S @ALLERGYN@("verifierId")=$G(ALLERGYARR(FNBR1,IENS1,21,"I"))
"RTN","SYNDHP16",68,0)
 S @ALLERGYN@("enteredInError")=$G(ALLERGYARR(FNBR1,IENS1,22,"E"))
"RTN","SYNDHP16",69,0)
 S @ALLERGYN@("enteredInErrorCd")=$G(ALLERGYARR(FNBR1,IENS1,22,"I"))
"RTN","SYNDHP16",70,0)
 S @ALLERGYN@("dateTimeEnteredInError")=$G(ALLERGYARR(FNBR1,IENS1,23,"E"))
"RTN","SYNDHP16",71,0)
 S @ALLERGYN@("dateTimeEnteredInErrorFM")=$G(ALLERGYARR(FNBR1,IENS1,23,"I"))
"RTN","SYNDHP16",72,0)
 S @ALLERGYN@("dateTimeEnteredInErrorHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR1,IENS1,23,"I")))
"RTN","SYNDHP16",73,0)
 S @ALLERGYN@("dateTimeEnteredInErrorFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR1,IENS1,23,"I")))
"RTN","SYNDHP16",74,0)
 S @ALLERGYN@("userEnteringInError")=$G(ALLERGYARR(FNBR1,IENS1,24,"E"))
"RTN","SYNDHP16",75,0)
 S @ALLERGYN@("userEnteringInErrorId")=$G(ALLERGYARR(FNBR1,IENS1,24,"I"))
"RTN","SYNDHP16",76,0)
 N REACTION
"RTN","SYNDHP16",77,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP16",78,0)
 F  S IENS2=$O(ALLERGYARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP16",79,0)
 . S REACTION=$NA(ALLERGY("Allergy","reactionss","reactions",+IENS2))
"RTN","SYNDHP16",80,0)
 . S @REACTION@("reaction")=$G(ALLERGYARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP16",81,0)
 . S @REACTION@("reactionId")=$G(ALLERGYARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP16",82,0)
 . S @REACTION@("reactionSCT")=$$MAPR^SYNDHPMP($G(ALLERGYARR(FNBR2,IENS2,.01,"E")),"T","R")
"RTN","SYNDHP16",83,0)
 . S @REACTION@("otherReaction")=$G(ALLERGYARR(FNBR2,IENS2,1,"E"))
"RTN","SYNDHP16",84,0)
 . S @REACTION@("enteredBy")=$G(ALLERGYARR(FNBR2,IENS2,2,"E"))
"RTN","SYNDHP16",85,0)
 . S @REACTION@("enteredById")=$G(ALLERGYARR(FNBR2,IENS2,2,"I"))
"RTN","SYNDHP16",86,0)
 . S @REACTION@("dateEntered")=$G(ALLERGYARR(FNBR2,IENS2,3,"E"))
"RTN","SYNDHP16",87,0)
 . S @REACTION@("dateEnteredFM")=$G(ALLERGYARR(FNBR2,IENS2,3,"I"))
"RTN","SYNDHP16",88,0)
 . S @REACTION@("dateEnteredHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR2,IENS2,3,"I")))
"RTN","SYNDHP16",89,0)
 . S @REACTION@("dateEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR2,IENS2,3,"I")))
"RTN","SYNDHP16",90,0)
 . S @REACTION@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_ALLERGYIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP16",91,0)
 N CHART
"RTN","SYNDHP16",92,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP16",93,0)
 F  S IENS3=$O(ALLERGYARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP16",94,0)
 . S CHART=$NA(ALLERGY("Allergy","chartMarkeds","chartMarked",+IENS3))
"RTN","SYNDHP16",95,0)
 . S @CHART@("dateTime")=$G(ALLERGYARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP16",96,0)
 . S @CHART@("dateTimeFM")=$G(ALLERGYARR(FNBR3,IENS3,.01,"I"))
"RTN","SYNDHP16",97,0)
 . S @CHART@("dateTimeHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR3,IENS3,.01,"I")))
"RTN","SYNDHP16",98,0)
 . S @CHART@("dateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR3,IENS3,.01,"I")))
"RTN","SYNDHP16",99,0)
 . S @CHART@("userEntering")=$G(ALLERGYARR(FNBR3,IENS3,1,"E"))
"RTN","SYNDHP16",100,0)
 . S @CHART@("userEnteringId")=$G(ALLERGYARR(FNBR3,IENS3,1,"I"))
"RTN","SYNDHP16",101,0)
 . S @CHART@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_ALLERGYIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP16",102,0)
 N IDBAND
"RTN","SYNDHP16",103,0)
 N IENS4 S IENS4=""
"RTN","SYNDHP16",104,0)
 F  S IENS4=$O(ALLERGYARR(FNBR4,IENS4)) QUIT:IENS4=""  D
"RTN","SYNDHP16",105,0)
 . S IDBAND=$NA(ALLERGY("Allergy","idBandMarkeds","idBandMarked",+IENS4))
"RTN","SYNDHP16",106,0)
 . S @IDBAND@("dateTime")=$G(ALLERGYARR(FNBR4,IENS4,.01,"E"))
"RTN","SYNDHP16",107,0)
 . S @IDBAND@("dateTimeFM")=$G(ALLERGYARR(FNBR4,IENS4,.01,"I"))
"RTN","SYNDHP16",108,0)
 . S @IDBAND@("dateTimeHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR4,IENS4,.01,"I")))
"RTN","SYNDHP16",109,0)
 . S @IDBAND@("dateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR4,IENS4,.01,"I")))
"RTN","SYNDHP16",110,0)
 . S @IDBAND@("userEntering")=$G(ALLERGYARR(FNBR4,IENS4,1,"E"))
"RTN","SYNDHP16",111,0)
 . S @IDBAND@("userEnteringId")=$G(ALLERGYARR(FNBR4,IENS4,1,"I"))
"RTN","SYNDHP16",112,0)
 . S @IDBAND@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_ALLERGYIEN_S_FNBR4_S_+IENS4
"RTN","SYNDHP16",113,0)
 N COMMENTS
"RTN","SYNDHP16",114,0)
 N IENS5 S IENS5=""
"RTN","SYNDHP16",115,0)
 F  S IENS5=$O(ALLERGYARR(FNBR5,IENS5)) QUIT:IENS5=""  D
"RTN","SYNDHP16",116,0)
 . S COMMENTS=$NA(ALLERGY("Allergy","commentss","comments",+IENS5))
"RTN","SYNDHP16",117,0)
 . S @COMMENTS@("dateTimeCommentEntered")=$G(ALLERGYARR(FNBR5,IENS5,.01,"E"))
"RTN","SYNDHP16",118,0)
 . S @COMMENTS@("dateTimeCommentEnteredFM")=$G(ALLERGYARR(FNBR5,IENS5,.01,"I"))
"RTN","SYNDHP16",119,0)
 . S @COMMENTS@("dateTimeCommentEnteredHL7")=$$FMTHL7^XLFDT($G(ALLERGYARR(FNBR5,IENS5,.01,"I")))
"RTN","SYNDHP16",120,0)
 . S @COMMENTS@("dateTimeCommentEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(ALLERGYARR(FNBR5,IENS5,.01,"I")))
"RTN","SYNDHP16",121,0)
 . S @COMMENTS@("userEntering")=$G(ALLERGYARR(FNBR5,IENS5,1,"E"))
"RTN","SYNDHP16",122,0)
 . S @COMMENTS@("userEnteringId")=$G(ALLERGYARR(FNBR5,IENS5,1,"I"))
"RTN","SYNDHP16",123,0)
 . S @COMMENTS@("commentType")=$G(ALLERGYARR(FNBR5,IENS5,1.5,"E"))
"RTN","SYNDHP16",124,0)
 . S @COMMENTS@("commentTypeCd")=$G(ALLERGYARR(FNBR5,IENS5,1.5,"I"))
"RTN","SYNDHP16",125,0)
 . S @COMMENTS@("comments")=$G(ALLERGYARR(FNBR5,IENS5,2,"E"))
"RTN","SYNDHP16",126,0)
 . S @COMMENTS@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_ALLERGYIEN_S_FNBR5_S_+IENS5
"RTN","SYNDHP16",127,0)
 ;
"RTN","SYNDHP16",128,0)
 ;I $G(DEBUG) W ! ZWRITE ALLERGY W !
"RTN","SYNDHP16",129,0)
 ;
"RTN","SYNDHP16",130,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.ALLERGY,.ALLERGYJ)
"RTN","SYNDHP16",131,0)
 ;
"RTN","SYNDHP16",132,0)
 QUIT
"RTN","SYNDHP16",133,0)
 ;
"RTN","SYNDHP16",134,0)
CNVTTYPE(TYPE) ;convert allery type to fhir values
"RTN","SYNDHP16",135,0)
 ;input: TYPE - VistA allergy type
"RTN","SYNDHP16",136,0)
 ;returns: FHIR allery type
"RTN","SYNDHP16",137,0)
 ;
"RTN","SYNDHP16",138,0)
 N IDX,TYPES,ALLTYPES
"RTN","SYNDHP16",139,0)
 F IDX=1:1 S TYPES=$P($T(TYPES+IDX),";;",2) QUIT:TYPES="zzzzz"  D
"RTN","SYNDHP16",140,0)
 . S ALLTYPES($P(TYPES,U,1))=$P(TYPES,U,2)
"RTN","SYNDHP16",141,0)
 ;
"RTN","SYNDHP16",142,0)
 I $G(TYPE)="" QUIT ""
"RTN","SYNDHP16",143,0)
 I $D(ALLTYPES(TYPE)) QUIT ALLTYPES(TYPE)
"RTN","SYNDHP16",144,0)
 QUIT ""
"RTN","SYNDHP16",145,0)
 ;
"RTN","SYNDHP16",146,0)
TYPES ;
"RTN","SYNDHP16",147,0)
  ;;FOOD^food
"RTN","SYNDHP16",148,0)
  ;;DRUG^medication
"RTN","SYNDHP16",149,0)
  ;;OTHER^environment
"RTN","SYNDHP16",150,0)
  ;;FOOD, DRUG^food:medication
"RTN","SYNDHP16",151,0)
  ;;DRUG, FOOD^medication:food
"RTN","SYNDHP16",152,0)
  ;;FOOD, OTHER^food:environment
"RTN","SYNDHP16",153,0)
  ;;DRUG, OTHER^medication:environment
"RTN","SYNDHP16",154,0)
  ;;FOOD, DRUG, OTHER^food:medication:environment
"RTN","SYNDHP16",155,0)
  ;;DRUG, FOOD, OTHER^medication:food:environment
"RTN","SYNDHP16",156,0)
  ;;F^food
"RTN","SYNDHP16",157,0)
  ;;D^medication
"RTN","SYNDHP16",158,0)
  ;;O^environment
"RTN","SYNDHP16",159,0)
  ;;FD^food:medication
"RTN","SYNDHP16",160,0)
  ;;DF^medication:food
"RTN","SYNDHP16",161,0)
  ;;FO^food:environment
"RTN","SYNDHP16",162,0)
  ;;DO^medication:environment
"RTN","SYNDHP16",163,0)
  ;;FDO^food:medication:environment
"RTN","SYNDHP16",164,0)
  ;;DFO^medication:food:environment
"RTN","SYNDHP16",165,0)
  ;;zzzzz
"RTN","SYNDHP16",166,0)
 ;
"RTN","SYNDHP16",167,0)
GET1VITALS(VITALS,VITALSIEN,RETJSON,VITALSJ) ;get one Vitals record
"RTN","SYNDHP16",168,0)
 ;inputs: VITALSIEN - Vitals IEN
"RTN","SYNDHP16",169,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP16",170,0)
 ;output: VITALS  - array of Vitals data, by reference
"RTN","SYNDHP16",171,0)
 ;        VITALSJ - JSON structure of Vitals data, by reference
"RTN","SYNDHP16",172,0)
 ;
"RTN","SYNDHP16",173,0)
 I $G(DEBUG) W !,"--------------------------- Vitals -----------------------------",!
"RTN","SYNDHP16",174,0)
 N S S S="_"
"RTN","SYNDHP16",175,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP16",176,0)
 N FNBR1 S FNBR1=120.5 ;GMRV VITAL MEASUREMENT
"RTN","SYNDHP16",177,0)
 N FNBR2 S FNBR2=120.506 ;REASON ENTERED IN ERROR
"RTN","SYNDHP16",178,0)
 N FNBR3 S FNBR3=120.505 ;QUALIFIER
"RTN","SYNDHP16",179,0)
 N IENS1 S IENS1=VITALSIEN_","
"RTN","SYNDHP16",180,0)
 ;
"RTN","SYNDHP16",181,0)
 N VITALSARR,VITALSERR
"RTN","SYNDHP16",182,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","VITALSARR","VITALSERR")
"RTN","SYNDHP16",183,0)
 ;I $G(DEBUG) W ! ZWRITE VITALSARR
"RTN","SYNDHP16",184,0)
 ;I $G(DEBUG),$D(VITALSERR) W ">>ERROR<<" ZWRITE VITALSERR
"RTN","SYNDHP16",185,0)
 I $D(VITALSERR) D  QUIT
"RTN","SYNDHP16",186,0)
 . S VITALS("Vitals","ERROR")=VITALSIEN
"RTN","SYNDHP16",187,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VITALS,.VITALSJ)
"RTN","SYNDHP16",188,0)
 S VITALS("Vitals","vitalsIen")=VITALSIEN
"RTN","SYNDHP16",189,0)
 S VITALS("Vitals","resourceType")="Observation"
"RTN","SYNDHP16",190,0)
 S VITALS("Vitals","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VITALSIEN
"RTN","SYNDHP16",191,0)
 S VITALS("Vitals","dateTimeVitalsTaken")=$G(VITALSARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP16",192,0)
 S VITALS("Vitals","dateTimeVitalsTakenFM")=$G(VITALSARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP16",193,0)
 S VITALS("Vitals","dateTimeVitalsTakenHL7")=$$FMTHL7^XLFDT($G(VITALSARR(FNBR1,IENS1,.01,"I")))
"RTN","SYNDHP16",194,0)
 S VITALS("Vitals","dateTimeVitalsTakenFHIR")=$$FMTFHIR^SYNDHPUTL($G(VITALSARR(FNBR1,IENS1,.01,"I")))
"RTN","SYNDHP16",195,0)
 S VITALS("Vitals","patient")=$G(VITALSARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP16",196,0)
 S VITALS("Vitals","patientId")=$G(VITALSARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP16",197,0)
 S VITALS("Vitals","patientICN")=$$GET1^DIQ(2,VITALS("Vitals","patientId")_",",991.1)
"RTN","SYNDHP16",198,0)
 S VITALS("Vitals","vitalType")=$G(VITALSARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP16",199,0)
 S VITALS("Vitals","vitalTypeSc")=$$SENTENCE^XLFSTR(VITALS("Vitals","vitalType"))
"RTN","SYNDHP16",200,0)
 S VITALS("Vitals","vitalTypeId")=$G(VITALSARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP16",201,0)
 S VITALS("Vitals","dateTimeVitalsEntered")=$G(VITALSARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP16",202,0)
 S VITALS("Vitals","dateTimeVitalsEnteredFM")=$G(VITALSARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP16",203,0)
 S VITALS("Vitals","dateTimeVitalsEnteredHL7")=$$FMTHL7^XLFDT($G(VITALSARR(FNBR1,IENS1,.04,"I")))
"RTN","SYNDHP16",204,0)
 S VITALS("Vitals","dateTimeVitalsEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(VITALSARR(FNBR1,IENS1,.04,"I")))
"RTN","SYNDHP16",205,0)
 S VITALS("Vitals","hospitalLocation")=$G(VITALSARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP16",206,0)
 S VITALS("Vitals","hospitalLocationId")=$G(VITALSARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP16",207,0)
 S VITALS("Vitals","enteredBy")=$G(VITALSARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP16",208,0)
 S VITALS("Vitals","enteredById")=$G(VITALSARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP16",209,0)
 S VITALS("Vitals","rate")=$G(VITALSARR(FNBR1,IENS1,1.2,"E"))
"RTN","SYNDHP16",210,0)
 S VITALS("Vitals","supplementalO2")=$G(VITALSARR(FNBR1,IENS1,1.4,"E"))
"RTN","SYNDHP16",211,0)
 S VITALS("Vitals","enteredInError")=$G(VITALSARR(FNBR1,IENS1,2,"E"))
"RTN","SYNDHP16",212,0)
 S VITALS("Vitals","enteredInErrorCd")=$G(VITALSARR(FNBR1,IENS1,2,"I"))
"RTN","SYNDHP16",213,0)
 S VITALS("Vitals","errorEnteredBy")=$G(VITALSARR(FNBR1,IENS1,3,"E"))
"RTN","SYNDHP16",214,0)
 S VITALS("Vitals","errorEnteredById")=$G(VITALSARR(FNBR1,IENS1,3,"I"))
"RTN","SYNDHP16",215,0)
 N REASERR
"RTN","SYNDHP16",216,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP16",217,0)
 F  S IENS2=$O(VITALSARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP16",218,0)
 . S REASERR=$NA(VITALS("Vitals","reasonEnteredInErrors","reasonEnteredInError",+IENS2))
"RTN","SYNDHP16",219,0)
 . S @REASERR@("reasonEnteredInError")=$G(VITALSARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP16",220,0)
 . S @REASERR@("reasonEnteredInErrorCd")=$G(VITALSARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP16",221,0)
 . S @REASERR@("dateReasonEnteredInError")=$G(VITALSARR(FNBR2,IENS2,.02,"E"))
"RTN","SYNDHP16",222,0)
 . S @REASERR@("dateReasonEnteredInErrorFM")=$G(VITALSARR(FNBR2,IENS2,.02,"I"))
"RTN","SYNDHP16",223,0)
 . S @REASERR@("dateReasonEnteredInErrorHL7")=$$FMTHL7^XLFDT($G(VITALSARR(FNBR2,IENS2,.02,"I")))
"RTN","SYNDHP16",224,0)
 . S @REASERR@("dateReasonEnteredInErrorFHIR")=$$FMTFHIR^SYNDHPUTL($G(VITALSARR(FNBR2,IENS2,.02,"I")))
"RTN","SYNDHP16",225,0)
 . S @REASERR@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VITALSIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP16",226,0)
 N QUALIFY
"RTN","SYNDHP16",227,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP16",228,0)
 F  S IENS3=$O(VITALSARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP16",229,0)
 . S QUALIFY=$NA(VITALS("Vitals","qualifiers","qualifier",+IENS3))
"RTN","SYNDHP16",230,0)
 . S @QUALIFY@("qualifier")=$G(VITALSARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP16",231,0)
 . S @QUALIFY@("qualifierId")=$G(VITALSARR(FNBR3,IENS3,.01,"I"))
"RTN","SYNDHP16",232,0)
 . S @QUALIFY@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VITALSIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP16",233,0)
 ;
"RTN","SYNDHP16",234,0)
 ;get snomed
"RTN","SYNDHP16",235,0)
 N SCT S SCT=""
"RTN","SYNDHP16",236,0)
 S SCT=$$MAP^SYNDHPMP("sct2vit",VITALS("Vitals","vitalTypeId"),"I")
"RTN","SYNDHP16",237,0)
 S VITALS("Vitals","vitalTypeSCT")=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP16",238,0)
 ;
"RTN","SYNDHP16",239,0)
 ;I $G(DEBUG) W ! ZWRITE VITALS
"RTN","SYNDHP16",240,0)
 ;
"RTN","SYNDHP16",241,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VITALS,.VITALSJ)
"RTN","SYNDHP16",242,0)
 ;
"RTN","SYNDHP16",243,0)
 QUIT
"RTN","SYNDHP16",244,0)
 ;
"RTN","SYNDHP17")
0^92^B47657021
"RTN","SYNDHP17",1,0)
SYNDHP17 ; HC/art - HealthConcourse - get MH Diagnosis, Flags data ;05/08/2019
"RTN","SYNDHP17",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP17",3,0)
 ;;
"RTN","SYNDHP17",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP17",5,0)
 ;
"RTN","SYNDHP17",6,0)
 QUIT
"RTN","SYNDHP17",7,0)
 ;
"RTN","SYNDHP17",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP17",9,0)
 ;
"RTN","SYNDHP17",10,0)
GET1MHDX(MHDX,MHDXIEN,RETJSON,MHDXJ) ;get one Mental Health Diagnosis record
"RTN","SYNDHP17",11,0)
 ;inputs: MHDXIEN - Mental Health Diagnosis IEN
"RTN","SYNDHP17",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP17",13,0)
 ;output: MHDX  - array of Mental Health Diagnosis data, by reference
"RTN","SYNDHP17",14,0)
 ;        MHDXJ - JSON structure of Mental Health Diagnosis data, by reference
"RTN","SYNDHP17",15,0)
 ;
"RTN","SYNDHP17",16,0)
 I $G(DEBUG) W !,"--------------------------- Mental Health Diagnosis ----------------------------",!
"RTN","SYNDHP17",17,0)
 N S S S="_"
"RTN","SYNDHP17",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP17",19,0)
 N FNBR1 S FNBR1=627.8 ;DIAGNOSTIC RESULTS - MENTAL HEALTH
"RTN","SYNDHP17",20,0)
 N FNBR2 S FNBR2=627.82 ;MODIFIERS
"RTN","SYNDHP17",21,0)
 N FNBR3 S FNBR3=627.81 ;COMMENT
"RTN","SYNDHP17",22,0)
 N IENS1 S IENS1=MHDXIEN_","
"RTN","SYNDHP17",23,0)
 ;
"RTN","SYNDHP17",24,0)
 N MHDXARR,MHDXERR
"RTN","SYNDHP17",25,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","MHDXARR","MHDXERR")
"RTN","SYNDHP17",26,0)
 I $G(DEBUG) W ! ZWRITE MHDXARR
"RTN","SYNDHP17",27,0)
 I $G(DEBUG),$D(MHDXERR) W !,">>ERROR<<" W ! ZWRITE MHDXERR
"RTN","SYNDHP17",28,0)
 I $D(MHDXERR) D  QUIT
"RTN","SYNDHP17",29,0)
 . S MHDX("Mhdiag","ERROR")=MHDXIEN
"RTN","SYNDHP17",30,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.MHDX,.MHDXJ)
"RTN","SYNDHP17",31,0)
 S MHDX("Mhdiag","mhdiagIen")=MHDXIEN
"RTN","SYNDHP17",32,0)
 S MHDX("Mhdiag","resourceType")="Observation"
"RTN","SYNDHP17",33,0)
 S MHDX("Mhdiag","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_MHDXIEN
"RTN","SYNDHP17",34,0)
 S MHDX("Mhdiag","fileEntryDate")=$G(MHDXARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP17",35,0)
 S MHDX("Mhdiag","fileEntryDateFM")=$G(MHDXARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP17",36,0)
 S MHDX("Mhdiag","fileEntryDateHL7")=$$FMTHL7^XLFDT($G(MHDXARR(FNBR1,IENS1,.01,"I")))
"RTN","SYNDHP17",37,0)
 S MHDX("Mhdiag","fileEntryDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(MHDXARR(FNBR1,IENS1,.01,"I")))
"RTN","SYNDHP17",38,0)
 S MHDX("Mhdiag","patientName")=$G(MHDXARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP17",39,0)
 S MHDX("Mhdiag","patientNameId")=$G(MHDXARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP17",40,0)
 S MHDX("Mhdiag","dateTimeOfDiagnosis")=$G(MHDXARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP17",41,0)
 S MHDX("Mhdiag","dateTimeOfDiagnosisFM")=$G(MHDXARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP17",42,0)
 S MHDX("Mhdiag","dateTimeOfDiagnosisHL7")=$$FMTHL7^XLFDT($G(MHDXARR(FNBR1,IENS1,.03,"I")))
"RTN","SYNDHP17",43,0)
 S MHDX("Mhdiag","dateTimeOfDiagnosisFHIR")=$$FMTFHIR^SYNDHPUTL($G(MHDXARR(FNBR1,IENS1,.03,"I")))
"RTN","SYNDHP17",44,0)
 S MHDX("Mhdiag","diagnosisBy")=$G(MHDXARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP17",45,0)
 S MHDX("Mhdiag","diagnosisById")=$G(MHDXARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP17",46,0)
 S MHDX("Mhdiag","transcriber")=$G(MHDXARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP17",47,0)
 S MHDX("Mhdiag","transcriberId")=$G(MHDXARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP17",48,0)
 S MHDX("Mhdiag","diagnosis")=$G(MHDXARR(FNBR1,IENS1,1,"E"))
"RTN","SYNDHP17",49,0)
 S MHDX("Mhdiag","diagnosisId")=$G(MHDXARR(FNBR1,IENS1,1,"I"))
"RTN","SYNDHP17",50,0)
 S MHDX("Mhdiag","statusVPRINRu")=$G(MHDXARR(FNBR1,IENS1,5,"E"))
"RTN","SYNDHP17",51,0)
 S MHDX("Mhdiag","statusVPRINRuCd")=$G(MHDXARR(FNBR1,IENS1,5,"I"))
"RTN","SYNDHP17",52,0)
 S MHDX("Mhdiag","condition")=$G(MHDXARR(FNBR1,IENS1,7,"E"))
"RTN","SYNDHP17",53,0)
 S MHDX("Mhdiag","conditionCd")=$G(MHDXARR(FNBR1,IENS1,7,"I"))
"RTN","SYNDHP17",54,0)
 S MHDX("Mhdiag","inactivatedDate")=$G(MHDXARR(FNBR1,IENS1,8,"E"))
"RTN","SYNDHP17",55,0)
 S MHDX("Mhdiag","inactivatedDateFM")=$G(MHDXARR(FNBR1,IENS1,8,"I"))
"RTN","SYNDHP17",56,0)
 S MHDX("Mhdiag","inactivatedDateHL7")=$$FMTHL7^XLFDT($G(MHDXARR(FNBR1,IENS1,8,"I")))
"RTN","SYNDHP17",57,0)
 S MHDX("Mhdiag","inactivatedDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(MHDXARR(FNBR1,IENS1,8,"I")))
"RTN","SYNDHP17",58,0)
 S MHDX("Mhdiag","statusChanged")=$G(MHDXARR(FNBR1,IENS1,9,"E"))
"RTN","SYNDHP17",59,0)
 S MHDX("Mhdiag","statusChangedCd")=$G(MHDXARR(FNBR1,IENS1,9,"I"))
"RTN","SYNDHP17",60,0)
 S MHDX("Mhdiag","dxls")=$G(MHDXARR(FNBR1,IENS1,10,"E"))
"RTN","SYNDHP17",61,0)
 S MHDX("Mhdiag","dxlsCd")=$G(MHDXARR(FNBR1,IENS1,10,"I"))
"RTN","SYNDHP17",62,0)
 S MHDX("Mhdiag","psychosocialStressor")=$G(MHDXARR(FNBR1,IENS1,60,"E"))
"RTN","SYNDHP17",63,0)
 S MHDX("Mhdiag","severityCode")=$G(MHDXARR(FNBR1,IENS1,61,"E"))
"RTN","SYNDHP17",64,0)
 S MHDX("Mhdiag","severityCodeCd")=$G(MHDXARR(FNBR1,IENS1,61,"I"))
"RTN","SYNDHP17",65,0)
 S MHDX("Mhdiag","axis5")=$G(MHDXARR(FNBR1,IENS1,65,"E"))
"RTN","SYNDHP17",66,0)
 S MHDX("Mhdiag","patientType")=$G(MHDXARR(FNBR1,IENS1,66,"E"))
"RTN","SYNDHP17",67,0)
 S MHDX("Mhdiag","patientTypeCd")=$G(MHDXARR(FNBR1,IENS1,66,"I"))
"RTN","SYNDHP17",68,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP17",69,0)
 F  S IENS2=$O(MHDXARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP17",70,0)
 . N MOD S MOD=$NA(MHDX("Mhdiag","modifierss","modifiers",+IENS2))
"RTN","SYNDHP17",71,0)
 . S @MOD@("modifier")=$G(MHDXARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP17",72,0)
 . S @MOD@("modifierId")=$G(MHDXARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP17",73,0)
 . S @MOD@("numberOfAnswer")=$G(MHDXARR(FNBR2,IENS2,1,"E"))
"RTN","SYNDHP17",74,0)
 . S @MOD@("standsFor")=$G(MHDXARR(FNBR2,IENS2,2,"E"))
"RTN","SYNDHP17",75,0)
 . S @MOD@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_MHDXIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP17",76,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP17",77,0)
 F  S IENS3=$O(MHDXARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP17",78,0)
 . N COMMENT S COMMENT=$NA(MHDX("Mhdiag","comments","comment",+IENS3))
"RTN","SYNDHP17",79,0)
 . S @COMMENT@("comment")=$G(MHDXARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP17",80,0)
 . S @COMMENT@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_MHDXIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP17",81,0)
 ;
"RTN","SYNDHP17",82,0)
 ;get SCT code
"RTN","SYNDHP17",83,0)
 S MHDX("Mhdiag","diagnosisSCT")=""
"RTN","SYNDHP17",84,0)
 I MHDX("Mhdiag","diagnosis")'="" D
"RTN","SYNDHP17",85,0)
 . N DATE S DATE=$S(MHDX("Mhdiag","dateTimeOfDiagnosisFM")'="":MHDX("Mhdiag","dateTimeOfDiagnosisFM"),1:MHDX("Mhdiag","fileEntryDateFM"))
"RTN","SYNDHP17",86,0)
 . N MAPPING S MAPPING=$S(DATE>3150930:"sct2icd",1:"sct2icdnine")
"RTN","SYNDHP17",87,0)
 . N SNOMED S SNOMED=$$MAP^SYNDHPMP(MAPPING,MHDX("Mhdiag","diagnosis"),"I")
"RTN","SYNDHP17",88,0)
 . S MHDX("Mhdiag","diagnosisSCT")=$S(+SNOMED=-1:"",1:$P(SNOMED,U,2))
"RTN","SYNDHP17",89,0)
 ;
"RTN","SYNDHP17",90,0)
 ;I $G(DEBUG) W ! ZWRITE DXMH
"RTN","SYNDHP17",91,0)
 ;
"RTN","SYNDHP17",92,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.MHDX,.MHDXJ)
"RTN","SYNDHP17",93,0)
 ;
"RTN","SYNDHP17",94,0)
 QUIT
"RTN","SYNDHP17",95,0)
 ;
"RTN","SYNDHP17",96,0)
GET1FLAG(FLAG,FLAGIEN,RETJSON,FLAGJ) ;get one Flag record
"RTN","SYNDHP17",97,0)
 ;inputs: FLAGIEN - Flag IEN
"RTN","SYNDHP17",98,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP17",99,0)
 ;output: FLAG  - array of Flag data, by reference
"RTN","SYNDHP17",100,0)
 ;        FLAGJ - JSON structure of Flag data, by reference
"RTN","SYNDHP17",101,0)
 ;
"RTN","SYNDHP17",102,0)
 I $G(DEBUG) W !,"--------------------------- Flag -----------------------------",!
"RTN","SYNDHP17",103,0)
 N S S S="_"
"RTN","SYNDHP17",104,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP17",105,0)
 N FNBR1 S FNBR1=26.13 ;PRF ASSIGNMENT
"RTN","SYNDHP17",106,0)
 N FNBR2 S FNBR2=26.132 ;ASSIGNMENT NARRATIVE
"RTN","SYNDHP17",107,0)
 N IENS1 S IENS1=FLAGIEN_","
"RTN","SYNDHP17",108,0)
 ;
"RTN","SYNDHP17",109,0)
 N FLAGARR,FLAGERR
"RTN","SYNDHP17",110,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","FLAGARR","FLAGERR")
"RTN","SYNDHP17",111,0)
 ;I $G(DEBUG) W ! ZWRITE FLAGARR
"RTN","SYNDHP17",112,0)
 ;I $G(DEBUG),$D(FLAGERR) W ">>ERROR<<" ZWRITE FLAGERR
"RTN","SYNDHP17",113,0)
 I $D(FLAGERR) D  QUIT
"RTN","SYNDHP17",114,0)
 . S FLAG("Flag","ERROR")=FLAGIEN
"RTN","SYNDHP17",115,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.FLAG,.FLAGJ)
"RTN","SYNDHP17",116,0)
 S FLAG("Flag","flagIen")=FLAGIEN
"RTN","SYNDHP17",117,0)
 S FLAG("Flag","resourceType")="Observation"
"RTN","SYNDHP17",118,0)
 S FLAG("Flag","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_FLAGIEN
"RTN","SYNDHP17",119,0)
 S FLAG("Flag","number")=$G(FLAGARR(FNBR1,IENS1,.001,"E"))
"RTN","SYNDHP17",120,0)
 S FLAG("Flag","patientName")=$G(FLAGARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP17",121,0)
 S FLAG("Flag","patientNameId")=$G(FLAGARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP17",122,0)
 S FLAG("Flag","patientICN")=$$GET1^DIQ(2,FLAG("Flag","patientNameId")_",",991.1)
"RTN","SYNDHP17",123,0)
 S FLAG("Flag","flagName")=$G(FLAGARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP17",124,0)
 S FLAG("Flag","flagNameId")=$G(FLAGARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP17",125,0)
 S FLAG("Flag","status")=$G(FLAGARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP17",126,0)
 S FLAG("Flag","statusCd")=$G(FLAGARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP17",127,0)
 S FLAG("Flag","ownerSite")=$G(FLAGARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP17",128,0)
 S FLAG("Flag","ownerSiteId")=$G(FLAGARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP17",129,0)
 S FLAG("Flag","originatingSite")=$G(FLAGARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP17",130,0)
 S FLAG("Flag","originatingSiteId")=$G(FLAGARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP17",131,0)
 S FLAG("Flag","reviewDate")=$G(FLAGARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP17",132,0)
 S FLAG("Flag","reviewDateFM")=$G(FLAGARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP17",133,0)
 S FLAG("Flag","reviewDateHL7")=$$FMTHL7^XLFDT($G(FLAGARR(FNBR1,IENS1,.06,"I")))
"RTN","SYNDHP17",134,0)
 S FLAG("Flag","reviewDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(FLAGARR(FNBR1,IENS1,.06,"I")))
"RTN","SYNDHP17",135,0)
 S FLAG("Flag","assignmentNarrative")=""
"RTN","SYNDHP17",136,0)
 N x S x=""
"RTN","SYNDHP17",137,0)
 F  S x=$O(FLAGARR(FNBR1,IENS1,1,x)) QUIT:'+x  D
"RTN","SYNDHP17",138,0)
 . S FLAG("Flag","assignmentNarrative")=FLAG("Flag","assignmentNarrative")_$G(FLAGARR(FNBR1,IENS1,1,x))
"RTN","SYNDHP17",139,0)
 ;
"RTN","SYNDHP17",140,0)
 ;get snomed
"RTN","SYNDHP17",141,0)
 N SCT
"RTN","SYNDHP17",142,0)
 S SCT=$$MAP^SYNDHPMP("flag2sct",FLAG("Flag","flagName"),"D")
"RTN","SYNDHP17",143,0)
 S FLAG("Flag","flagSCT")=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP17",144,0)
 ;
"RTN","SYNDHP17",145,0)
 ;I $G(DEBUG) W ! ZWRITE FLAG
"RTN","SYNDHP17",146,0)
 ;
"RTN","SYNDHP17",147,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.FLAG,.FLAGJ)
"RTN","SYNDHP17",148,0)
 ;
"RTN","SYNDHP17",149,0)
 QUIT
"RTN","SYNDHP17",150,0)
 ;
"RTN","SYNDHP18")
0^93^B118565363
"RTN","SYNDHP18",1,0)
SYNDHP18 ; HC/art - HealthConcourse - get care team data ;03/27/2019
"RTN","SYNDHP18",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP18",3,0)
 ;;
"RTN","SYNDHP18",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP18",5,0)
 ;
"RTN","SYNDHP18",6,0)
 ;The authoratative source for VA care team data is PCMM Web. (currently no connection is available.)
"RTN","SYNDHP18",7,0)
 ; PCMM Web updates VistA files on a regular basis.
"RTN","SYNDHP18",8,0)
 ;
"RTN","SYNDHP18",9,0)
 QUIT
"RTN","SYNDHP18",10,0)
 ;
"RTN","SYNDHP18",11,0)
GET1TEAM(TEAM,TEAMIEN,RETJSON,TEAMJ) ;get one care team
"RTN","SYNDHP18",12,0)
 ;inputs: TEAMIEN - team IEN
"RTN","SYNDHP18",13,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP18",14,0)
 ;                  null or any other value = Return array (default)
"RTN","SYNDHP18",15,0)
 ;output: TEAM    - array of team data, by reference
"RTN","SYNDHP18",16,0)
 ;        TEAMJ   - JSON structure of team data, by reference
"RTN","SYNDHP18",17,0)
 ;
"RTN","SYNDHP18",18,0)
 N FNBR1 S FNBR1=404.51 ;TEAM
"RTN","SYNDHP18",19,0)
 N FNBR2 S FNBR2=404.58 ;TEAM HISTORY
"RTN","SYNDHP18",20,0)
 N S S S="_"
"RTN","SYNDHP18",21,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP18",22,0)
 N IENS S IENS=TEAMIEN_","
"RTN","SYNDHP18",23,0)
 N TMARR,TMERR
"RTN","SYNDHP18",24,0)
 D GETS^DIQ(FNBR1,IENS,"**","EI","TMARR","TMERR")
"RTN","SYNDHP18",25,0)
 ;I $G(DEBUG) W ! ZWRITE TMARR
"RTN","SYNDHP18",26,0)
 ;I $G(DEBUG),$D(TMERR) W !,">>ERROR<<" ZWRITE TMERR
"RTN","SYNDHP18",27,0)
 I $D(TMERR) D  QUIT
"RTN","SYNDHP18",28,0)
 . S TEAM("Team","ERROR")=TEAMIEN
"RTN","SYNDHP18",29,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.TEAM,.TEAMJ)
"RTN","SYNDHP18",30,0)
 S TEAM("Team","resourceType")="CareTeam"
"RTN","SYNDHP18",31,0)
 S TEAM("Team","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_TEAMIEN
"RTN","SYNDHP18",32,0)
 S TEAM("Team","teamName")=$G(TMARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP18",33,0)
 S TEAM("Team","fhirTeamType")="longitudinal"
"RTN","SYNDHP18",34,0)
 S TEAM("Team","teamPhone")=$G(TMARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP18",35,0)
 S TEAM("Team","teamPurposeId")=$G(TMARR(FNBR1,IENS,.03,"I"))
"RTN","SYNDHP18",36,0)
 S TEAM("Team","teamPurpose")=$G(TMARR(FNBR1,IENS,.03,"E"))
"RTN","SYNDHP18",37,0)
 S TEAM("Team","teamPrinterId")=$G(TMARR(FNBR1,IENS,.04,"I"))
"RTN","SYNDHP18",38,0)
 S TEAM("Team","teamPrinter")=$G(TMARR(FNBR1,IENS,.04,"E"))
"RTN","SYNDHP18",39,0)
 S TEAM("Team","canBePcCd")=$G(TMARR(FNBR1,IENS,.05,"I"))
"RTN","SYNDHP18",40,0)
 S TEAM("Team","canBePC")=$G(TMARR(FNBR1,IENS,.05,"E"))
"RTN","SYNDHP18",41,0)
 S TEAM("Team","serviceDeptId")=$G(TMARR(FNBR1,IENS,.06,"I"))
"RTN","SYNDHP18",42,0)
 S TEAM("Team","serviceDept")=$G(TMARR(FNBR1,IENS,.06,"E"))
"RTN","SYNDHP18",43,0)
 S TEAM("Team","institutionId")=$G(TMARR(FNBR1,IENS,.07,"I"))
"RTN","SYNDHP18",44,0)
 S TEAM("Team","institution")=$G(TMARR(FNBR1,IENS,.07,"E"))
"RTN","SYNDHP18",45,0)
 S TEAM("Team","maxPatients")=$G(TMARR(FNBR1,IENS,.08,"E"))
"RTN","SYNDHP18",46,0)
 S TEAM("Team","max%PCPatients")=$G(TMARR(FNBR1,IENS,.09,"E"))
"RTN","SYNDHP18",47,0)
 S TEAM("Team","closeToFutureAssignId")=$G(TMARR(FNBR1,IENS,.1,"I"))
"RTN","SYNDHP18",48,0)
 S TEAM("Team","closeToFutureAssign")=$G(TMARR(FNBR1,IENS,.1,"E"))
"RTN","SYNDHP18",49,0)
 S TEAM("Team","autoAssignId")=$G(TMARR(FNBR1,IENS,.11,"I"))
"RTN","SYNDHP18",50,0)
 S TEAM("Team","autoAssign")=$G(TMARR(FNBR1,IENS,.11,"E"))
"RTN","SYNDHP18",51,0)
 S TEAM("Team","autoDischargeId")=$G(TMARR(FNBR1,IENS,.12,"I"))
"RTN","SYNDHP18",52,0)
 S TEAM("Team","autoDischarge")=$G(TMARR(FNBR1,IENS,.12,"E"))
"RTN","SYNDHP18",53,0)
 S TEAM("Team","restrictConsultsId")=$G(TMARR(FNBR1,IENS,.13,"I"))
"RTN","SYNDHP18",54,0)
 S TEAM("Team","restrictConsults")=$G(TMARR(FNBR1,IENS,.13,"E"))
"RTN","SYNDHP18",55,0)
 S TEAM("Team","description")=$G(TMARR(FNBR1,IENS,50,1))_$G(TMARR(FNBR1,IENS,50,2)) ;<<<
"RTN","SYNDHP18",56,0)
 S TEAM("Team","current#PatientsC")=$G(TMARR(FNBR1,IENS,201,"E"))
"RTN","SYNDHP18",57,0)
 S TEAM("Team","currentStatusC")=$G(TMARR(FNBR1,IENS,202,"E"))
"RTN","SYNDHP18",58,0)
 S TEAM("Team","currentEffectiveDateC")=$G(TMARR(FNBR1,IENS,203,"E"))
"RTN","SYNDHP18",59,0)
 S TEAM("Team","currentEffectiveDateCFM")=$$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,203,"E")))
"RTN","SYNDHP18",60,0)
 S TEAM("Team","currentEffectiveDateCHL7")=$$FMTHL7^XLFDT($$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,203,"E"))))
"RTN","SYNDHP18",61,0)
 S TEAM("Team","currentEffectiveDateCFHIR")=$$FMTFHIR^SYNDHPUTL($$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,203,"E"))))
"RTN","SYNDHP18",62,0)
 S TEAM("Team","currentActivationDateC")=$G(TMARR(FNBR1,IENS,204,"E"))
"RTN","SYNDHP18",63,0)
 S TEAM("Team","currentActivationDateCFM")=$$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,204,"E")))
"RTN","SYNDHP18",64,0)
 S TEAM("Team","currentActivationDateCHL7")=$$FMTHL7^XLFDT($$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,204,"E"))))
"RTN","SYNDHP18",65,0)
 S TEAM("Team","currentActivationDateCFHIR")=$$FMTFHIR^SYNDHPUTL($$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,204,"E"))))
"RTN","SYNDHP18",66,0)
 S TEAM("Team","currentInactivationDateC")=$G(TMARR(FNBR1,IENS,205,"E"))
"RTN","SYNDHP18",67,0)
 S TEAM("Team","currentInactivationDateCFM")=$$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,205,"E")))
"RTN","SYNDHP18",68,0)
 S TEAM("Team","currentInactivationDateCHL7")=$$FMTHL7^XLFDT($$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,205,"E"))))
"RTN","SYNDHP18",69,0)
 S TEAM("Team","currentInactivationDateCFHIR")=$$FMTFHIR^SYNDHPUTL($$DATECNVT^SYNDHPUTL($G(TMARR(FNBR1,IENS,205,"E"))))
"RTN","SYNDHP18",70,0)
 ;
"RTN","SYNDHP18",71,0)
 N STATIEN S STATIEN=0
"RTN","SYNDHP18",72,0)
 F  S STATIEN=$O(^SCTM(FNBR2,"B",TEAMIEN,STATIEN)) QUIT:+STATIEN=0  D
"RTN","SYNDHP18",73,0)
 . N IENS2 S IENS2=STATIEN_","
"RTN","SYNDHP18",74,0)
 . N STATARR,STATERR
"RTN","SYNDHP18",75,0)
 . D GETS^DIQ(FNBR2,IENS2,"**","EI","STATARR","STATERR")
"RTN","SYNDHP18",76,0)
 . ;I $G(DEBUG) W ! ZWRITE STATARR
"RTN","SYNDHP18",77,0)
 . ;I $G(DEBUG),$D(STATERR) W !,">>ERROR<<" ZWRITE STATERR
"RTN","SYNDHP18",78,0)
 . I $D(STATERR) D  QUIT
"RTN","SYNDHP18",79,0)
 . . S TEAM("Team","teamStatus","status",STATIEN,"ERROR")=STATIEN
"RTN","SYNDHP18",80,0)
 . . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.TEAM,.TEAMJ)
"RTN","SYNDHP18",81,0)
 . N TEAMSTAT S TEAMSTAT=$NA(TEAM("Team","teamStatus","status",STATIEN))
"RTN","SYNDHP18",82,0)
 . S @TEAMSTAT@("statusCd")=$G(STATARR(FNBR2,IENS2,.03,"I"))
"RTN","SYNDHP18",83,0)
 . S @TEAMSTAT@("status")=$G(STATARR(FNBR2,IENS2,.03,"E"))
"RTN","SYNDHP18",84,0)
 . S @TEAMSTAT@("effectiveDate")=$G(STATARR(FNBR2,IENS2,.02,"E"))
"RTN","SYNDHP18",85,0)
 . S @TEAMSTAT@("effectiveDateFM")=$G(STATARR(FNBR2,IENS2,.02,"I"))
"RTN","SYNDHP18",86,0)
 . S @TEAMSTAT@("effectiveDateHL7")=$$FMTHL7^XLFDT($G(STATARR(FNBR2,IENS2,.02,"I")))
"RTN","SYNDHP18",87,0)
 . S @TEAMSTAT@("effectiveDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(STATARR(FNBR2,IENS2,.02,"I")))
"RTN","SYNDHP18",88,0)
 . S @TEAMSTAT@("statusReasonId")=$G(STATARR(FNBR2,IENS2,.04,"I"))
"RTN","SYNDHP18",89,0)
 . S @TEAMSTAT@("statusReason")=$G(STATARR(FNBR2,IENS2,.04,"E"))
"RTN","SYNDHP18",90,0)
 . S @TEAMSTAT@("statusRecordId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR2_S_STATIEN
"RTN","SYNDHP18",91,0)
 ;
"RTN","SYNDHP18",92,0)
 N POSITION
"RTN","SYNDHP18",93,0)
 D TEAMPOS(.POSITION,TEAMIEN,0)
"RTN","SYNDHP18",94,0)
 M TEAM("Team","positions")=POSITION
"RTN","SYNDHP18",95,0)
 ;I $G(DEBUG) W ! ZWRITE TEAM
"RTN","SYNDHP18",96,0)
 ;
"RTN","SYNDHP18",97,0)
 I $G(RETJSON)="J" D
"RTN","SYNDHP18",98,0)
 . N TEAMS M TEAMS("Teams",TEAMIEN)=TEAM
"RTN","SYNDHP18",99,0)
 . D TOJASON^SYNDHPUTL(.TEAMS,.TEAMJ)
"RTN","SYNDHP18",100,0)
 . ;I $G(DEBUG) W ! ZWRITE TEAM
"RTN","SYNDHP18",101,0)
 ;
"RTN","SYNDHP18",102,0)
 QUIT
"RTN","SYNDHP18",103,0)
 ;
"RTN","SYNDHP18",104,0)
TEAMPOS(POSITION,TEAMIEN,RETJSON,POSITIONJ) ;get team positions
"RTN","SYNDHP18",105,0)
 ;inputs: TEAMIEN - team IEN
"RTN","SYNDHP18",106,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP18",107,0)
 ;                  null or any other value = Return array (default)
"RTN","SYNDHP18",108,0)
 ;Output: POSITION - an array of position data, by reference
"RTN","SYNDHP18",109,0)
 ;        POSITIONJ - JSON structure, by reference
"RTN","SYNDHP18",110,0)
 ;
"RTN","SYNDHP18",111,0)
 N FNBR1 S FNBR1=404.57 ;TEAM POSITION
"RTN","SYNDHP18",112,0)
 N FNBR2 S FNBR2=404.575 ;TEAM POSITION:ASSOCIATED CLINICS
"RTN","SYNDHP18",113,0)
 N FNBR3 S FNBR3=404.59 ;TEAM POSITION HISTORY
"RTN","SYNDHP18",114,0)
 N S S S="_"
"RTN","SYNDHP18",115,0)
 N ROLENAME
"RTN","SYNDHP18",116,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP18",117,0)
 N POSIEN S POSIEN=0
"RTN","SYNDHP18",118,0)
 F  S POSIEN=$O(^SCTM(FNBR1,"C",TEAMIEN,POSIEN)) QUIT:+POSIEN=0  D
"RTN","SYNDHP18",119,0)
 . N IENS S IENS=POSIEN_","
"RTN","SYNDHP18",120,0)
 . N POSARR,POSERR
"RTN","SYNDHP18",121,0)
 . D GETS^DIQ(FNBR1,IENS,"**","EI","POSARR","POSERR")
"RTN","SYNDHP18",122,0)
 . ;I $G(DEBUG) W ! ZWRITE POSARR
"RTN","SYNDHP18",123,0)
 . ;I $G(DEBUG),$D(POSERR) W !,">>ERROR<<" ZWRITE POSERR
"RTN","SYNDHP18",124,0)
 . I $D(POSERR) D  QUIT
"RTN","SYNDHP18",125,0)
 . . S POSITION("position",POSIEN,"ERROR")=POSIEN
"RTN","SYNDHP18",126,0)
 . . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.POSITION,.POSITIONJ)
"RTN","SYNDHP18",127,0)
 . N TEAMPOS S TEAMPOS=$NA(POSITION("position",POSIEN))
"RTN","SYNDHP18",128,0)
 . S @TEAMPOS@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_POSIEN
"RTN","SYNDHP18",129,0)
 . S @TEAMPOS@("positionIen")=POSIEN
"RTN","SYNDHP18",130,0)
 . S @TEAMPOS@("positionName")=$G(POSARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP18",131,0)
 . S @TEAMPOS@("teamId")=$G(POSARR(FNBR1,IENS,.02,"I"))
"RTN","SYNDHP18",132,0)
 . S @TEAMPOS@("team")=$G(POSARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP18",133,0)
 . S @TEAMPOS@("standRoleNameId")=$G(POSARR(FNBR1,IENS,.03,"I"))
"RTN","SYNDHP18",134,0)
 . S @TEAMPOS@("standRoleName")=$G(POSARR(FNBR1,IENS,.03,"E"))
"RTN","SYNDHP18",135,0)
 . S ROLENAME=$G(POSARR(FNBR1,IENS,.03,"E")) ;used below for SCT lookup
"RTN","SYNDHP18",136,0)
 . S @TEAMPOS@("possPrimPractId")=$G(POSARR(FNBR1,IENS,.04,"I"))
"RTN","SYNDHP18",137,0)
 . S @TEAMPOS@("possPrimPract")=$G(POSARR(FNBR1,IENS,.04,"E"))
"RTN","SYNDHP18",138,0)
 . S @TEAMPOS@("max#patients")=$G(POSARR(FNBR1,IENS,.08,"E"))
"RTN","SYNDHP18",139,0)
 . ;S @TEAMPOS@("NAassocClinic")=$G(POSARR(FNBR1,IENS,.09,"E")) ;field is no longer used
"RTN","SYNDHP18",140,0)
 . S @TEAMPOS@("beeperNbr")=$G(POSARR(FNBR1,IENS,.11,"E"))
"RTN","SYNDHP18",141,0)
 . S @TEAMPOS@("canBePreceptor")=$G(POSARR(FNBR1,IENS,.12,"E"))
"RTN","SYNDHP18",142,0)
 . S @TEAMPOS@("userClass")=$G(POSARR(FNBR1,IENS,.13,"E"))
"RTN","SYNDHP18",143,0)
 . S @TEAMPOS@("description")=$G(POSARR(FNBR1,IENS,1,1))_$G(POSARR(FNBR1,IENS,1,2)) ;<<<
"RTN","SYNDHP18",144,0)
 . S @TEAMPOS@("deathMsg")=$G(POSARR(FNBR1,IENS,2.01,"E"))
"RTN","SYNDHP18",145,0)
 . S @TEAMPOS@("inpatientMsg")=$G(POSARR(FNBR1,IENS,2.02,"E"))
"RTN","SYNDHP18",146,0)
 . S @TEAMPOS@("teamMsg")=$G(POSARR(FNBR1,IENS,2.03,"E"))
"RTN","SYNDHP18",147,0)
 . S @TEAMPOS@("consultMsg")=$G(POSARR(FNBR1,IENS,2.04,"E"))
"RTN","SYNDHP18",148,0)
 . S @TEAMPOS@("precepDeathMsg")=$G(POSARR(FNBR1,IENS,2.05,"E"))
"RTN","SYNDHP18",149,0)
 . S @TEAMPOS@("precepInpatientMsg")=$G(POSARR(FNBR1,IENS,2.06,"E"))
"RTN","SYNDHP18",150,0)
 . S @TEAMPOS@("precepTeamMsg")=$G(POSARR(FNBR1,IENS,2.07,"E"))
"RTN","SYNDHP18",151,0)
 . S @TEAMPOS@("precepConsultMsg")=$G(POSARR(FNBR1,IENS,2.08,"E"))
"RTN","SYNDHP18",152,0)
 . S @TEAMPOS@("autoInactMsg")=$G(POSARR(FNBR1,IENS,2.09,"E"))
"RTN","SYNDHP18",153,0)
 . S @TEAMPOS@("precepInactMsg")=$G(POSARR(FNBR1,IENS,2.1,"E"))
"RTN","SYNDHP18",154,0)
 . N IENS2 S IENS2=""
"RTN","SYNDHP18",155,0)
 . F  S IENS2=$O(POSARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP18",156,0)
 . . N TEAMCLIN S TEAMCLIN=$NA(POSITION("position",POSIEN,"associatedClinics","clinic",+IENS2))
"RTN","SYNDHP18",157,0)
 . . S @TEAMCLIN@("assocClincId")=$G(POSARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP18",158,0)
 . . S @TEAMCLIN@("assocClinc")=$G(POSARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP18",159,0)
 . . S @TEAMCLIN@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_POSIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP18",160,0)
 . S @TEAMPOS@("curr#PCpatsC")=$G(POSARR(FNBR1,IENS,200,"E"))
"RTN","SYNDHP18",161,0)
 . S @TEAMPOS@("curr#PatientsC")=$G(POSARR(FNBR1,IENS,201,"E"))
"RTN","SYNDHP18",162,0)
 . S @TEAMPOS@("future#PCpatsC")=$G(POSARR(FNBR1,IENS,202,"E"))
"RTN","SYNDHP18",163,0)
 . S @TEAMPOS@("future#PatientsC")=$G(POSARR(FNBR1,IENS,203,"E"))
"RTN","SYNDHP18",164,0)
 . S @TEAMPOS@("currStatusC")=$G(POSARR(FNBR1,IENS,300,"E"))
"RTN","SYNDHP18",165,0)
 . S @TEAMPOS@("currEffectDateC")=$G(POSARR(FNBR1,IENS,301,"E"))
"RTN","SYNDHP18",166,0)
 . S @TEAMPOS@("currEffectDateCFM")=$$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,301,"E")))
"RTN","SYNDHP18",167,0)
 . S @TEAMPOS@("currEffectDateCHL7")=$$FMTHL7^XLFDT($$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,301,"E"))))
"RTN","SYNDHP18",168,0)
 . S @TEAMPOS@("currEffectDateCFHIR")=$$FMTFHIR^SYNDHPUTL($$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,301,"E"))))
"RTN","SYNDHP18",169,0)
 . S @TEAMPOS@("currActDateC")=$G(POSARR(FNBR1,IENS,302,"E"))
"RTN","SYNDHP18",170,0)
 . S @TEAMPOS@("currActDateCFM")=$$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,302,"E")))
"RTN","SYNDHP18",171,0)
 . S @TEAMPOS@("currActDateCHL7")=$$FMTHL7^XLFDT($$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,302,"E"))))
"RTN","SYNDHP18",172,0)
 . S @TEAMPOS@("currActDateCFHIR")=$$FMTFHIR^SYNDHPUTL($$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,302,"E"))))
"RTN","SYNDHP18",173,0)
 . S @TEAMPOS@("currInactDateC")=$G(POSARR(FNBR1,IENS,303,"E"))
"RTN","SYNDHP18",174,0)
 . S @TEAMPOS@("currInactDateCFM")=$$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,303,"E")))
"RTN","SYNDHP18",175,0)
 . S @TEAMPOS@("currInactDateCHL7")=$$FMTHL7^XLFDT($$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,303,"E"))))
"RTN","SYNDHP18",176,0)
 . S @TEAMPOS@("currInactDateFHIR")=$$FMTFHIR^SYNDHPUTL($$DATECNVT^SYNDHPUTL($G(POSARR(FNBR1,IENS,303,"E"))))
"RTN","SYNDHP18",177,0)
 . S @TEAMPOS@("currPractitionerC")=$G(POSARR(FNBR1,IENS,304,"E"))
"RTN","SYNDHP18",178,0)
 . S @TEAMPOS@("currPrecptorPosC")=$G(POSARR(FNBR1,IENS,305,"E"))
"RTN","SYNDHP18",179,0)
 . S @TEAMPOS@("currPreceptorC")=$G(POSARR(FNBR1,IENS,306,"E"))
"RTN","SYNDHP18",180,0)
 . S @TEAMPOS@("activePreceptsC")=$G(POSARR(FNBR1,IENS,307,"E"))
"RTN","SYNDHP18",181,0)
 . S @TEAMPOS@("allowPreceptedChngC")=$G(POSARR(FNBR1,IENS,400,"E"))
"RTN","SYNDHP18",182,0)
 . S @TEAMPOS@("allowPreceptorChngC")=$G(POSARR(FNBR1,IENS,401,"E"))
"RTN","SYNDHP18",183,0)
 . S @TEAMPOS@("inconsistentReasonC")=$G(POSARR(FNBR1,IENS,402,"E"))
"RTN","SYNDHP18",184,0)
 . ;team position history
"RTN","SYNDHP18",185,0)
 . N STATIEN S STATIEN=0
"RTN","SYNDHP18",186,0)
 . F  S STATIEN=$O(^SCTM(FNBR3,"B",POSIEN,STATIEN)) QUIT:+STATIEN=0  D
"RTN","SYNDHP18",187,0)
 . . N IENS3 S IENS3=STATIEN_","
"RTN","SYNDHP18",188,0)
 . . N STATARR,STATERR
"RTN","SYNDHP18",189,0)
 . . D GETS^DIQ(FNBR3,IENS3,"**","EI","STATARR","STATERR")
"RTN","SYNDHP18",190,0)
 . . ;I $G(DEBUG) W ! ZWRITE STATARR
"RTN","SYNDHP18",191,0)
 . . ;I $G(DEBUG),$D(STATERR) W !,">>ERROR<<" ZWRITE STATERR
"RTN","SYNDHP18",192,0)
 . . I $D(STATERR) S POSITION("position",POSIEN,"positionStatus","status",STATIEN,"ERROR")=STATIEN QUIT
"RTN","SYNDHP18",193,0)
 . . N POSSTAT S POSSTAT=$NA(POSITION("position",POSIEN,"positionStatus","status",STATIEN))
"RTN","SYNDHP18",194,0)
 . . S @POSSTAT@("statusCd")=$G(STATARR(FNBR3,IENS3,.03,"I"))
"RTN","SYNDHP18",195,0)
 . . S @POSSTAT@("status")=$G(STATARR(FNBR3,IENS3,.03,"E"))
"RTN","SYNDHP18",196,0)
 . . S @POSSTAT@("effectiveDate")=$G(STATARR(FNBR3,IENS3,.02,"E"))
"RTN","SYNDHP18",197,0)
 . . S @POSSTAT@("effectiveDateFM")=$G(STATARR(FNBR3,IENS3,.02,"I"))
"RTN","SYNDHP18",198,0)
 . . S @POSSTAT@("effectiveDateHL7")=$$FMTHL7^XLFDT($G(STATARR(FNBR3,IENS3,.02,"I")))
"RTN","SYNDHP18",199,0)
 . . S @POSSTAT@("effectiveDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(STATARR(FNBR3,IENS3,.02,"I")))
"RTN","SYNDHP18",200,0)
 . . S @POSSTAT@("statusReasonId")=$G(STATARR(FNBR3,IENS3,.04,"I"))
"RTN","SYNDHP18",201,0)
 . . S @POSSTAT@("statusReason")=$G(STATARR(FNBR3,IENS3,.04,"E"))
"RTN","SYNDHP18",202,0)
 . . S @POSSTAT@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR3_S_STATIEN
"RTN","SYNDHP18",203,0)
 . ;
"RTN","SYNDHP18",204,0)
 . N SCT S SCT=$$MAP^SYNDHPMP("ctpos2sct",ROLENAME,"D")
"RTN","SYNDHP18",205,0)
 . S POSITION("position",POSIEN,"standRoleSct")=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP18",206,0)
 . ;
"RTN","SYNDHP18",207,0)
 . ;position assignment history
"RTN","SYNDHP18",208,0)
 . N ASGNHIST,ASGNHISTJ
"RTN","SYNDHP18",209,0)
 . D ASGNHIST^SYNDHP19(.ASGNHIST,TEAMIEN,0)
"RTN","SYNDHP18",210,0)
 . M POSITION("position",POSIEN,"positionAssignmentHistory")=ASGNHIST
"RTN","SYNDHP18",211,0)
 . ;
"RTN","SYNDHP18",212,0)
 . ;preceptor assignment history
"RTN","SYNDHP18",213,0)
 . N PRECHIST,PRECHISTJ
"RTN","SYNDHP18",214,0)
 . D PRECHIST^SYNDHP19(.PRECHIST,POSIEN,0)
"RTN","SYNDHP18",215,0)
 . M POSITION("position",POSIEN,"preceptorAssignmentHistory")=PRECHIST
"RTN","SYNDHP18",216,0)
 . ;
"RTN","SYNDHP18",217,0)
 . ;I $G(DEBUG) W ! ZWRITE POSITION
"RTN","SYNDHP18",218,0)
 ;
"RTN","SYNDHP18",219,0)
 I $G(RETJSON)="J" D
"RTN","SYNDHP18",220,0)
 . N POSITIONS M POSITIONS("TeamPositions")=POSITION
"RTN","SYNDHP18",221,0)
 . D TOJASON^SYNDHPUTL(.POSITIONS,.POSITIONJ)
"RTN","SYNDHP18",222,0)
 . ;I $G(DEBUG) W ! ZWRITE POSITIONSJ
"RTN","SYNDHP18",223,0)
 ;
"RTN","SYNDHP18",224,0)
 QUIT
"RTN","SYNDHP18",225,0)
 ;
"RTN","SYNDHP19")
0^94^B43797002
"RTN","SYNDHP19",1,0)
SYNDHP19 ; HC/art - HealthConcourse - get care team data ;03/27/2019
"RTN","SYNDHP19",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP19",3,0)
 ;;
"RTN","SYNDHP19",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP19",5,0)
 ;
"RTN","SYNDHP19",6,0)
 ;The authoratative source for care team data is PCMM Web. (currently no connection is available.)
"RTN","SYNDHP19",7,0)
 ; PCMM Web updates VistA files on a regular basis.
"RTN","SYNDHP19",8,0)
 ;
"RTN","SYNDHP19",9,0)
 QUIT
"RTN","SYNDHP19",10,0)
 ;
"RTN","SYNDHP19",11,0)
ASGNHIST(ASGNHIST,POSIEN,RETJSON,ASGNHISTJ) ;get team position assignment history
"RTN","SYNDHP19",12,0)
 ;inputs: POSIEN - team position IEN
"RTN","SYNDHP19",13,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP19",14,0)
 ;                  null or any other value = Return array (default)
"RTN","SYNDHP19",15,0)
 ;Output: ASGNHIST - an array of position assignment history data, by reference
"RTN","SYNDHP19",16,0)
 ;        ASGNHISTJ - JSON structure, by reference
"RTN","SYNDHP19",17,0)
 ;
"RTN","SYNDHP19",18,0)
 N FNBR1 S FNBR1=404.52 ;POSITION ASSIGNMENT HISTORY
"RTN","SYNDHP19",19,0)
 N FNBR2 S FNBR2=404.521 ;POSITION ASSIGNMENT HISTORY:FTEE HISTORY
"RTN","SYNDHP19",20,0)
 N S S S="_"
"RTN","SYNDHP19",21,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP19",22,0)
 N HISTIEN S HISTIEN=0
"RTN","SYNDHP19",23,0)
 F  S HISTIEN=$O(^SCTM(FNBR1,"B",POSIEN,HISTIEN)) QUIT:+HISTIEN=0  D
"RTN","SYNDHP19",24,0)
 . N IENS S IENS=HISTIEN_","
"RTN","SYNDHP19",25,0)
 . N HISTARR,HISTERR
"RTN","SYNDHP19",26,0)
 . D GETS^DIQ(FNBR1,IENS,"**","EI","HISTARR","HISTERR")
"RTN","SYNDHP19",27,0)
 . ;I $G(DEBUG) W ! ZWRITE HISTARR
"RTN","SYNDHP19",28,0)
 . ;I $G(DEBUG),$D(HISTERR) W !,">>ERROR<<" ZWRITE HISTERR
"RTN","SYNDHP19",29,0)
 . I $D(HISTERR) D  QUIT
"RTN","SYNDHP19",30,0)
 . . S ASGNHIST("posAssignHist",HISTIEN,"ERROR")=HISTIEN
"RTN","SYNDHP19",31,0)
 . . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.ASGNHIST,.ASGNHISTJ)
"RTN","SYNDHP19",32,0)
 . N AHIST S AHIST=$NA(ASGNHIST("posAssignHist",HISTIEN))
"RTN","SYNDHP19",33,0)
 . S @AHIST@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HISTIEN
"RTN","SYNDHP19",34,0)
 . S @AHIST@("assignHistIen")=HISTIEN
"RTN","SYNDHP19",35,0)
 . S @AHIST@("teamPositionId")=$G(HISTARR(FNBR1,IENS,.01,"I"))
"RTN","SYNDHP19",36,0)
 . S @AHIST@("teamPositionName")=$G(HISTARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP19",37,0)
 . S @AHIST@("effectiveDate")=$G(HISTARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP19",38,0)
 . S @AHIST@("effectiveDateFM")=$G(HISTARR(FNBR1,IENS,.02,"I"))
"RTN","SYNDHP19",39,0)
 . S @AHIST@("effectiveDateHL7")=$$FMTHL7^XLFDT($G(HISTARR(FNBR1,IENS,.02,"I")))
"RTN","SYNDHP19",40,0)
 . S @AHIST@("effectiveDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(HISTARR(FNBR1,IENS,.02,"I")))
"RTN","SYNDHP19",41,0)
 . S @AHIST@("practitionerId")=$G(HISTARR(FNBR1,IENS,.03,"I"))
"RTN","SYNDHP19",42,0)
 . S @AHIST@("practitioner")=$G(HISTARR(FNBR1,IENS,.03,"E"))
"RTN","SYNDHP19",43,0)
 . S @AHIST@("statusCd")=$G(HISTARR(FNBR1,IENS,.04,"I"))
"RTN","SYNDHP19",44,0)
 . S @AHIST@("status")=$G(HISTARR(FNBR1,IENS,.04,"E"))
"RTN","SYNDHP19",45,0)
 . S @AHIST@("statusReasonId")=$G(HISTARR(FNBR1,IENS,.05,"I"))
"RTN","SYNDHP19",46,0)
 . S @AHIST@("statusReason")=$G(HISTARR(FNBR1,IENS,.05,"E"))
"RTN","SYNDHP19",47,0)
 . S @AHIST@("userEnteringId")=$G(HISTARR(FNBR1,IENS,.07,"I"))
"RTN","SYNDHP19",48,0)
 . S @AHIST@("userEntering")=$G(HISTARR(FNBR1,IENS,.07,"E"))
"RTN","SYNDHP19",49,0)
 . S @AHIST@("dateTimeEntered")=$G(HISTARR(FNBR1,IENS,.08,"E"))
"RTN","SYNDHP19",50,0)
 . S @AHIST@("dateTimeEnteredFM")=$G(HISTARR(FNBR1,IENS,.08,"I"))
"RTN","SYNDHP19",51,0)
 . S @AHIST@("dateTimeEnteredHL7")=$$FMTHL7^XLFDT($G(HISTARR(FNBR1,IENS,.08,"I")))
"RTN","SYNDHP19",52,0)
 . S @AHIST@("dateTimeEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(HISTARR(FNBR1,IENS,.08,"I")))
"RTN","SYNDHP19",53,0)
 . S @AHIST@("fteeEquivalent")=$G(HISTARR(FNBR1,IENS,.09,"E"))
"RTN","SYNDHP19",54,0)
 . S @AHIST@("dateFlagedInactivation")=$G(HISTARR(FNBR1,IENS,.091,"E"))
"RTN","SYNDHP19",55,0)
 . S @AHIST@("dateFlagedInactivationFM")=$G(HISTARR(FNBR1,IENS,.091,"I"))
"RTN","SYNDHP19",56,0)
 . S @AHIST@("dateFlagedInactivationHL7")=$$FMTHL7^XLFDT($G(HISTARR(FNBR1,IENS,.091,"I")))
"RTN","SYNDHP19",57,0)
 . S @AHIST@("dateFlagedInactivationFHIR")=$$FMTFHIR^SYNDHPUTL($G(HISTARR(FNBR1,IENS,.091,"I")))
"RTN","SYNDHP19",58,0)
 . S @AHIST@("availablePositionsC")=$G(HISTARR(FNBR1,IENS,.096,"E"))
"RTN","SYNDHP19",59,0)
 . S @AHIST@("max#PatientsC")=$G(HISTARR(FNBR1,IENS,.097,"E"))
"RTN","SYNDHP19",60,0)
 . S @AHIST@("currActivePatientsC")=$G(HISTARR(FNBR1,IENS,.098,"E"))
"RTN","SYNDHP19",61,0)
 . S @AHIST@("adjustedPanelSizeC")=$G(HISTARR(FNBR1,IENS,.099,"E"))
"RTN","SYNDHP19",62,0)
 . S @AHIST@("inactivatedAutomaticlyCd")=$G(HISTARR(FNBR1,IENS,.011,"I"))
"RTN","SYNDHP19",63,0)
 . S @AHIST@("inactivatedAutomaticly")=$G(HISTARR(FNBR1,IENS,.011,"E"))
"RTN","SYNDHP19",64,0)
 . S @AHIST@("teamletPositionCd")=$G(HISTARR(FNBR1,IENS,.012,"I"))
"RTN","SYNDHP19",65,0)
 . S @AHIST@("teamletPosition")=$G(HISTARR(FNBR1,IENS,.012,"E"))
"RTN","SYNDHP19",66,0)
 . N FTEE S FTEE=""
"RTN","SYNDHP19",67,0)
 . F  S FTEE=$O(HISTARR(FNBR2,FTEE)) QUIT:FTEE=""  D
"RTN","SYNDHP19",68,0)
 . . N FIEN S FIEN=+FTEE
"RTN","SYNDHP19",69,0)
 . . N FTEEHIST S FTEEHIST=$NA(ASGNHIST("posAssignHist",HISTIEN,"fteeHistory","fteeHist",FIEN))
"RTN","SYNDHP19",70,0)
 . . S @FTEEHIST@("fteeHistoryDate")=$G(HISTARR(FNBR2,FTEE,.01,"E"))
"RTN","SYNDHP19",71,0)
 . . S @FTEEHIST@("fteeHistoryDateFM")=$G(HISTARR(FNBR2,FTEE,.01,"I"))
"RTN","SYNDHP19",72,0)
 . . S @FTEEHIST@("fteeHistoryDateHL7")=$$FMTHL7^XLFDT($G(HISTARR(FNBR2,FTEE,.01,"I")))
"RTN","SYNDHP19",73,0)
 . . S @FTEEHIST@("fteeHistoryDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(HISTARR(FNBR2,FTEE,.01,"I")))
"RTN","SYNDHP19",74,0)
 . . S @FTEEHIST@("value")=$G(HISTARR(FNBR2,FTEE,.02,"I"))
"RTN","SYNDHP19",75,0)
 . . S @FTEEHIST@("userId")=$G(HISTARR(FNBR2,FTEE,.03,"I"))
"RTN","SYNDHP19",76,0)
 . . S @FTEEHIST@("user")=$G(HISTARR(FNBR2,FTEE,.03,"E"))
"RTN","SYNDHP19",77,0)
 . . S @FTEEHIST@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HISTIEN_S_FNBR2_S_FTEE
"RTN","SYNDHP19",78,0)
 ;
"RTN","SYNDHP19",79,0)
 ;I $G(DEBUG) W ! ZWRITE ASGNHIST
"RTN","SYNDHP19",80,0)
 ;
"RTN","SYNDHP19",81,0)
 I $G(RETJSON)="J" D
"RTN","SYNDHP19",82,0)
 . N ASGNHISTS M ASGNHISTS("TeamPositionAssignmentHistory")=ASGNHIST
"RTN","SYNDHP19",83,0)
 . D TOJASON^SYNDHPUTL(.ASGNHISTS,.ASGNHISTJ)
"RTN","SYNDHP19",84,0)
 . ;I $G(DEBUG) W ! ZWRITE ASGNHISTSJ
"RTN","SYNDHP19",85,0)
 ;
"RTN","SYNDHP19",86,0)
 QUIT
"RTN","SYNDHP19",87,0)
 ;
"RTN","SYNDHP19",88,0)
PRECHIST(PRECHIST,POSIEN,RETJSON,PRECHISTJ) ;get preceptor assignment history
"RTN","SYNDHP19",89,0)
 ;inputs: POSIEN - team position IEN
"RTN","SYNDHP19",90,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP19",91,0)
 ;                  null or any other value = Return array (default)
"RTN","SYNDHP19",92,0)
 ;Output: PRECHIST - an array of preceptor history data, by reference
"RTN","SYNDHP19",93,0)
 ;        PRECHISTJ - JSON structure, by reference
"RTN","SYNDHP19",94,0)
 ;
"RTN","SYNDHP19",95,0)
 ;   >>>>>>>>>>>>>>>>>>>>>> UNTESTED, NO DATA IN OUR VISTA <<<<<<<<<<<<<<<<<<<<<<<<<<<<
"RTN","SYNDHP19",96,0)
 ;
"RTN","SYNDHP19",97,0)
 N FNBR1 S FNBR1=404.53 ;PRECEPTOR ASSIGNMENT HISTORY
"RTN","SYNDHP19",98,0)
 N S S S="_"
"RTN","SYNDHP19",99,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP19",100,0)
 N PRECIEN S PRECIEN=0
"RTN","SYNDHP19",101,0)
 F  S PRECIEN=$O(^SCTM(FNBR1,"B",POSIEN,PRECIEN)) QUIT:+PRECIEN=0  D
"RTN","SYNDHP19",102,0)
 . N IENS S IENS=PRECIEN_","
"RTN","SYNDHP19",103,0)
 . N HISTARR,HISTERR
"RTN","SYNDHP19",104,0)
 . D GETS^DIQ(FNBR1,IENS,"**","EI","HISTARR","HISTERR")
"RTN","SYNDHP19",105,0)
 . ;I $G(DEBUG) W ! ZWRITE HISTARR
"RTN","SYNDHP19",106,0)
 . ;I $G(DEBUG),$D(HISTERR) W !,">>ERROR<<" ZWRITE HISTERR
"RTN","SYNDHP19",107,0)
 . I $D(HISTERR) D  QUIT
"RTN","SYNDHP19",108,0)
 . . S PRECHIST("preceptorAssignHist",PRECIEN,"ERROR")=PRECIEN
"RTN","SYNDHP19",109,0)
 . . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PRECHIST,.PRECHISTJ)
"RTN","SYNDHP19",110,0)
 . N PHIST S PHIST=$NA(PRECHIST("preceptorAssignHist",PRECIEN))
"RTN","SYNDHP19",111,0)
 . S @PHIST@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PRECIEN
"RTN","SYNDHP19",112,0)
 . S @PHIST@("preceptorHistoryIen")=PRECIEN
"RTN","SYNDHP19",113,0)
 . S @PHIST@("teamPositionId")=$G(HISTARR(FNBR1,IENS,.01,"I"))
"RTN","SYNDHP19",114,0)
 . S @PHIST@("teamPositionName")=$G(HISTARR(FNBR1,IENS,.01,"E"))
"RTN","SYNDHP19",115,0)
 . S @PHIST@("effectiveDate")=$G(HISTARR(FNBR1,IENS,.02,"E"))
"RTN","SYNDHP19",116,0)
 . S @PHIST@("effectiveDateFM")=$G(HISTARR(FNBR1,IENS,.02,"I"))
"RTN","SYNDHP19",117,0)
 . S @PHIST@("effectiveDateHL7")=$$FMTHL7^XLFDT($G(HISTARR(FNBR1,IENS,.02,"I")))
"RTN","SYNDHP19",118,0)
 . S @PHIST@("effectiveDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(HISTARR(FNBR1,IENS,.02,"I")))
"RTN","SYNDHP19",119,0)
 . S @PHIST@("statusCd")=$G(HISTARR(FNBR1,IENS,.04,"I"))
"RTN","SYNDHP19",120,0)
 . S @PHIST@("statusReason")=$G(HISTARR(FNBR1,IENS,.05,"E"))
"RTN","SYNDHP19",121,0)
 . S @PHIST@("PreceptorTeamPositionId")=$G(HISTARR(FNBR1,IENS,.06,"I"))
"RTN","SYNDHP19",122,0)
 . S @PHIST@("PreceptorTeamPosition")=$G(HISTARR(FNBR1,IENS,.06,"E"))
"RTN","SYNDHP19",123,0)
 . S @PHIST@("userEnteringId")=$G(HISTARR(FNBR1,IENS,.07,"I"))
"RTN","SYNDHP19",124,0)
 . S @PHIST@("userEntering")=$G(HISTARR(FNBR1,IENS,.07,"E"))
"RTN","SYNDHP19",125,0)
 . S @PHIST@("dateTimeEntered")=$G(HISTARR(FNBR1,IENS,.08,"E"))
"RTN","SYNDHP19",126,0)
 . S @PHIST@("dateTimeEnteredFM")=$G(HISTARR(FNBR1,IENS,.08,"I"))
"RTN","SYNDHP19",127,0)
 . S @PHIST@("dateTimeEnteredHL7")=$$FMTHL7^XLFDT($G(HISTARR(FNBR1,IENS,.08,"I")))
"RTN","SYNDHP19",128,0)
 . S @PHIST@("dateTimeEnteredFHIR")=$$FMTFHIR^SYNDHPUTL($G(HISTARR(FNBR1,IENS,.08,"I")))
"RTN","SYNDHP19",129,0)
 . S @PHIST@("preceptorNameC")=$G(HISTARR(FNBR1,IENS,200,"E"))
"RTN","SYNDHP19",130,0)
 ;
"RTN","SYNDHP19",131,0)
 ;I $G(DEBUG) W ! ZWRITE PRECHIST
"RTN","SYNDHP19",132,0)
 ;
"RTN","SYNDHP19",133,0)
 I $G(RETJSON)="J" D
"RTN","SYNDHP19",134,0)
 . N PRECHISTS M PRECHISTS("TeamPreceptorHistory")=PRECHIST
"RTN","SYNDHP19",135,0)
 . D TOJASON^SYNDHPUTL(.PRECHISTS,.PRECHISTJ)
"RTN","SYNDHP19",136,0)
 . ;I $G(DEBUG) W ! ZWRITE PRECHISTSJ
"RTN","SYNDHP19",137,0)
 ;
"RTN","SYNDHP19",138,0)
 QUIT
"RTN","SYNDHP19",139,0)
 ;
"RTN","SYNDHP20")
0^95^B137306202
"RTN","SYNDHP20",1,0)
SYNDHP20 ; HC/art - HealthConcourse - get patient demographic data ;03/01/2019
"RTN","SYNDHP20",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP20",3,0)
 ;;
"RTN","SYNDHP20",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP20",5,0)
 ;
"RTN","SYNDHP20",6,0)
 QUIT
"RTN","SYNDHP20",7,0)
 ;
"RTN","SYNDHP20",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP20",9,0)
 ;
"RTN","SYNDHP20",10,0)
GETPATIENT(PATIENT,PATIENTIEN,RETJSON,PATIENTJ) ;get one Patient record
"RTN","SYNDHP20",11,0)
 ; This API does not include all data in the Patient file. Only select patient demographic data are included.
"RTN","SYNDHP20",12,0)
 ;inputs: PATIENTIEN - Patient IEN
"RTN","SYNDHP20",13,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP20",14,0)
 ;output: PATIENT  - array of Patient Demographic data, by reference
"RTN","SYNDHP20",15,0)
 ;        PATIENTJ - JSON structure of Patient Demographic data, by reference
"RTN","SYNDHP20",16,0)
 ;
"RTN","SYNDHP20",17,0)
 I $G(DEBUG) W !,"--------------------------- Patient Demographic -----------------------------",!
"RTN","SYNDHP20",18,0)
 N S S S="_"
"RTN","SYNDHP20",19,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP20",20,0)
 N FNBR1 S FNBR1=2 ;PATIENT
"RTN","SYNDHP20",21,0)
 N FNBR2 S FNBR2=2.141 ;CONFIDENTIAL ADDRESS CATEGORY
"RTN","SYNDHP20",22,0)
 N FNBR3 S FNBR3=2.01 ;ALIAS
"RTN","SYNDHP20",23,0)
 N FNBR4 S FNBR4=2.02 ;RACE INFORMATION
"RTN","SYNDHP20",24,0)
 N FNBR5 S FNBR5=2.06 ;ETHNICITY INFORMATION
"RTN","SYNDHP20",25,0)
 N IENS1 S IENS1=PATIENTIEN_","
"RTN","SYNDHP20",26,0)
 ;
"RTN","SYNDHP20",27,0)
 N PATIENTARR,PATIENTERR
"RTN","SYNDHP20",28,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","PATIENTARR","PATIENTERR")
"RTN","SYNDHP20",29,0)
 ;I $G(DEBUG) W ! ZWRITE PATIENTARR
"RTN","SYNDHP20",30,0)
 ;I $G(DEBUG),$D(PATIENTERR) W !,">>ERROR<<" ZWRITE PATIENTERR
"RTN","SYNDHP20",31,0)
 I $D(PATIENTERR) D  QUIT
"RTN","SYNDHP20",32,0)
 . S PATIENT("Patient","ERROR")=PATIENTIEN
"RTN","SYNDHP20",33,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PATIENT,.PATIENTJ)
"RTN","SYNDHP20",34,0)
 S PATIENT("Patient","patientIen")=PATIENTIEN
"RTN","SYNDHP20",35,0)
 S PATIENT("Patient","resourceType")="Patient"
"RTN","SYNDHP20",36,0)
 S PATIENT("Patient","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIENTIEN
"RTN","SYNDHP20",37,0)
 S PATIENT("Patient","name")=$G(PATIENTARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP20",38,0)
 S PATIENT("Patient","sex")=$G(PATIENTARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP20",39,0)
 S PATIENT("Patient","sexCd")=$G(PATIENTARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP20",40,0)
 S PATIENT("Patient","selfIdentifiedGender")=$G(PATIENTARR(FNBR1,IENS1,.024,"E"))
"RTN","SYNDHP20",41,0)
 S PATIENT("Patient","selfIdentifiedGenderCd")=$G(PATIENTARR(FNBR1,IENS1,.024,"I"))
"RTN","SYNDHP20",42,0)
 S PATIENT("Patient","dateOfBirth")=$G(PATIENTARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP20",43,0)
 S PATIENT("Patient","dateOfBirthFM")=$G(PATIENTARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP20",44,0)
 S PATIENT("Patient","dateOfBirthHL7")=$$FMTHL7^XLFDT($G(PATIENTARR(FNBR1,IENS1,.03,"I")))
"RTN","SYNDHP20",45,0)
 S PATIENT("Patient","dateOfBirthFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATIENTARR(FNBR1,IENS1,.03,"I")))
"RTN","SYNDHP20",46,0)
 S PATIENT("Patient","age")=$G(PATIENTARR(FNBR1,IENS1,.033,"E"))
"RTN","SYNDHP20",47,0)
 S PATIENT("Patient","maritalStatus")=$G(PATIENTARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP20",48,0)
 S PATIENT("Patient","maritalStatusId")=$G(PATIENTARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP20",49,0)
 S PATIENT("Patient","race")=$G(PATIENTARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP20",50,0)
 S PATIENT("Patient","raceId")=$G(PATIENTARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP20",51,0)
 S PATIENT("Patient","occupation")=$G(PATIENTARR(FNBR1,IENS1,.07,"E"))
"RTN","SYNDHP20",52,0)
 S PATIENT("Patient","religiousPreference")=$G(PATIENTARR(FNBR1,IENS1,.08,"E"))
"RTN","SYNDHP20",53,0)
 S PATIENT("Patient","socialSecurityNumber")=$G(PATIENTARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP20",54,0)
 S PATIENT("Patient","terminalDigitOfSsn")=$G(PATIENTARR(FNBR1,IENS1,.0901,"E"))
"RTN","SYNDHP20",55,0)
 S PATIENT("Patient","initlast4")=$G(PATIENTARR(FNBR1,IENS1,.0905,"E"))
"RTN","SYNDHP20",56,0)
 S PATIENT("Patient","remarks")=$G(PATIENTARR(FNBR1,IENS1,.091,"E"))
"RTN","SYNDHP20",57,0)
 S PATIENT("Patient","placeOfBirthCity")=$G(PATIENTARR(FNBR1,IENS1,.092,"E"))
"RTN","SYNDHP20",58,0)
 S PATIENT("Patient","placeOfBirthState")=$G(PATIENTARR(FNBR1,IENS1,.093,"E"))
"RTN","SYNDHP20",59,0)
 S PATIENT("Patient","placeOfBirthStateId")=$G(PATIENTARR(FNBR1,IENS1,.093,"I"))
"RTN","SYNDHP20",60,0)
 S PATIENT("Patient","streetAddressLine1")=$G(PATIENTARR(FNBR1,IENS1,.111,"E"))
"RTN","SYNDHP20",61,0)
 S PATIENT("Patient","streetAddressLine2")=$G(PATIENTARR(FNBR1,IENS1,.112,"E"))
"RTN","SYNDHP20",62,0)
 S PATIENT("Patient","streetAddressLine3")=$G(PATIENTARR(FNBR1,IENS1,.113,"E"))
"RTN","SYNDHP20",63,0)
 S PATIENT("Patient","city")=$G(PATIENTARR(FNBR1,IENS1,.114,"E"))
"RTN","SYNDHP20",64,0)
 S PATIENT("Patient","state")=$G(PATIENTARR(FNBR1,IENS1,.115,"E"))
"RTN","SYNDHP20",65,0)
 S PATIENT("Patient","stateId")=$G(PATIENTARR(FNBR1,IENS1,.115,"I"))
"RTN","SYNDHP20",66,0)
 S PATIENT("Patient","zipCode")=$G(PATIENTARR(FNBR1,IENS1,.116,"E"))
"RTN","SYNDHP20",67,0)
 S PATIENT("Patient","zip4")=$G(PATIENTARR(FNBR1,IENS1,.1112,"E"))
"RTN","SYNDHP20",68,0)
 S PATIENT("Patient","county")=$G(PATIENTARR(FNBR1,IENS1,.117,"E"))
"RTN","SYNDHP20",69,0)
 S PATIENT("Patient","province")=$G(PATIENTARR(FNBR1,IENS1,.1171,"E"))
"RTN","SYNDHP20",70,0)
 S PATIENT("Patient","postalCode")=$G(PATIENTARR(FNBR1,IENS1,.1172,"E"))
"RTN","SYNDHP20",71,0)
 S PATIENT("Patient","country")=$G(PATIENTARR(FNBR1,IENS1,.1173,"E"))
"RTN","SYNDHP20",72,0)
 S PATIENT("Patient","countryId")=$G(PATIENTARR(FNBR1,IENS1,.1173,"I"))
"RTN","SYNDHP20",73,0)
 S PATIENT("Patient","phoneNumberResidence")=$G(PATIENTARR(FNBR1,IENS1,.131,"E"))
"RTN","SYNDHP20",74,0)
 S PATIENT("Patient","phoneNumberWork")=$G(PATIENTARR(FNBR1,IENS1,.132,"E"))
"RTN","SYNDHP20",75,0)
 S PATIENT("Patient","emailAddress")=$G(PATIENTARR(FNBR1,IENS1,.133,"E"))
"RTN","SYNDHP20",76,0)
 S PATIENT("Patient","phoneNumberCellular")=$G(PATIENTARR(FNBR1,IENS1,.134,"E"))
"RTN","SYNDHP20",77,0)
 S PATIENT("Patient","pagerNumber")=$G(PATIENTARR(FNBR1,IENS1,.135,"E"))
"RTN","SYNDHP20",78,0)
 S PATIENT("Patient","tempAddressActive")=$G(PATIENTARR(FNBR1,IENS1,.12105,"E"))
"RTN","SYNDHP20",79,0)
 S PATIENT("Patient","tempAddressActiveCd")=$G(PATIENTARR(FNBR1,IENS1,.12105,"I"))
"RTN","SYNDHP20",80,0)
 S PATIENT("Patient","tempStreetLine1")=$G(PATIENTARR(FNBR1,IENS1,.1211,"E"))
"RTN","SYNDHP20",81,0)
 S PATIENT("Patient","tempStreetLine2")=$G(PATIENTARR(FNBR1,IENS1,.1212,"E"))
"RTN","SYNDHP20",82,0)
 S PATIENT("Patient","tempStreetLine3")=$G(PATIENTARR(FNBR1,IENS1,.1213,"E"))
"RTN","SYNDHP20",83,0)
 S PATIENT("Patient","tempCity")=$G(PATIENTARR(FNBR1,IENS1,.1214,"E"))
"RTN","SYNDHP20",84,0)
 S PATIENT("Patient","tempState")=$G(PATIENTARR(FNBR1,IENS1,.1215,"E"))
"RTN","SYNDHP20",85,0)
 S PATIENT("Patient","tempStateId")=$G(PATIENTARR(FNBR1,IENS1,.1215,"I"))
"RTN","SYNDHP20",86,0)
 S PATIENT("Patient","tempZipCode")=$G(PATIENTARR(FNBR1,IENS1,.1216,"E"))
"RTN","SYNDHP20",87,0)
 S PATIENT("Patient","tempZip4")=$G(PATIENTARR(FNBR1,IENS1,.12112,"E"))
"RTN","SYNDHP20",88,0)
 S PATIENT("Patient","tempAddressCounty")=$G(PATIENTARR(FNBR1,IENS1,.12111,"E"))
"RTN","SYNDHP20",89,0)
 S PATIENT("Patient","tempAddressProvince")=$G(PATIENTARR(FNBR1,IENS1,.1221,"E"))
"RTN","SYNDHP20",90,0)
 S PATIENT("Patient","tempAddressPostalCode")=$G(PATIENTARR(FNBR1,IENS1,.1222,"E"))
"RTN","SYNDHP20",91,0)
 S PATIENT("Patient","tempAddressCountry")=$G(PATIENTARR(FNBR1,IENS1,.1223,"E"))
"RTN","SYNDHP20",92,0)
 S PATIENT("Patient","tempAddressCountryId")=$G(PATIENTARR(FNBR1,IENS1,.1223,"I"))
"RTN","SYNDHP20",93,0)
 S PATIENT("Patient","tempPhoneNumber")=$G(PATIENTARR(FNBR1,IENS1,.1219,"E"))
"RTN","SYNDHP20",94,0)
 S PATIENT("Patient","tempAddressStartDate")=$G(PATIENTARR(FNBR1,IENS1,.1217,"E"))
"RTN","SYNDHP20",95,0)
 S PATIENT("Patient","tempAddressStartDateFM")=$G(PATIENTARR(FNBR1,IENS1,.1217,"I"))
"RTN","SYNDHP20",96,0)
 S PATIENT("Patient","tempAddressStartDateHL7")=$$FMTHL7^XLFDT($G(PATIENTARR(FNBR1,IENS1,.1217,"I")))
"RTN","SYNDHP20",97,0)
 S PATIENT("Patient","tempAddressStartDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATIENTARR(FNBR1,IENS1,.1217,"I")))
"RTN","SYNDHP20",98,0)
 S PATIENT("Patient","tempAddressEndDate")=$G(PATIENTARR(FNBR1,IENS1,.1218,"E"))
"RTN","SYNDHP20",99,0)
 S PATIENT("Patient","tempAddressEndDateFM")=$G(PATIENTARR(FNBR1,IENS1,.1218,"I"))
"RTN","SYNDHP20",100,0)
 S PATIENT("Patient","tempAddressEndDateHL7")=$$FMTHL7^XLFDT($G(PATIENTARR(FNBR1,IENS1,.1218,"I")))
"RTN","SYNDHP20",101,0)
 S PATIENT("Patient","tempAddressEndDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATIENTARR(FNBR1,IENS1,.1218,"I")))
"RTN","SYNDHP20",102,0)
 S PATIENT("Patient","emergencyResponseIndicator")=$G(PATIENTARR(FNBR1,IENS1,.181,"E"))
"RTN","SYNDHP20",103,0)
 S PATIENT("Patient","emergencyResponseIndicatorCd")=$G(PATIENTARR(FNBR1,IENS1,.181,"I"))
"RTN","SYNDHP20",104,0)
 S PATIENT("Patient","kNameOfPrimaryNok")=$G(PATIENTARR(FNBR1,IENS1,.211,"E"))
"RTN","SYNDHP20",105,0)
 S PATIENT("Patient","kRelationshipToPatient")=$G(PATIENTARR(FNBR1,IENS1,.212,"E"))
"RTN","SYNDHP20",106,0)
 S PATIENT("Patient","kAddressSameAsPatientS")=$G(PATIENTARR(FNBR1,IENS1,.2125,"E"))
"RTN","SYNDHP20",107,0)
 S PATIENT("Patient","kAddressSameAsPatientSCd")=$G(PATIENTARR(FNBR1,IENS1,.2125,"I"))
"RTN","SYNDHP20",108,0)
 S PATIENT("Patient","kStreetAddressLine1")=$G(PATIENTARR(FNBR1,IENS1,.213,"E"))
"RTN","SYNDHP20",109,0)
 S PATIENT("Patient","kStreetAddressLine2")=$G(PATIENTARR(FNBR1,IENS1,.214,"E"))
"RTN","SYNDHP20",110,0)
 S PATIENT("Patient","kStreetAddressLine3")=$G(PATIENTARR(FNBR1,IENS1,.215,"E"))
"RTN","SYNDHP20",111,0)
 S PATIENT("Patient","kCity")=$G(PATIENTARR(FNBR1,IENS1,.216,"E"))
"RTN","SYNDHP20",112,0)
 S PATIENT("Patient","kState")=$G(PATIENTARR(FNBR1,IENS1,.217,"E"))
"RTN","SYNDHP20",113,0)
 S PATIENT("Patient","kStateId")=$G(PATIENTARR(FNBR1,IENS1,.217,"I"))
"RTN","SYNDHP20",114,0)
 S PATIENT("Patient","kZipCode")=$G(PATIENTARR(FNBR1,IENS1,.218,"E"))
"RTN","SYNDHP20",115,0)
 S PATIENT("Patient","kZip4")=$G(PATIENTARR(FNBR1,IENS1,.2207,"E"))
"RTN","SYNDHP20",116,0)
 S PATIENT("Patient","kPhoneNumber")=$G(PATIENTARR(FNBR1,IENS1,.219,"E"))
"RTN","SYNDHP20",117,0)
 S PATIENT("Patient","kWorkPhoneNumber")=$G(PATIENTARR(FNBR1,IENS1,.21011,"E"))
"RTN","SYNDHP20",118,0)
 S PATIENT("Patient","fatherSName")=$G(PATIENTARR(FNBR1,IENS1,.2401,"E"))
"RTN","SYNDHP20",119,0)
 S PATIENT("Patient","motherSName")=$G(PATIENTARR(FNBR1,IENS1,.2402,"E"))
"RTN","SYNDHP20",120,0)
 S PATIENT("Patient","motherSMaidenName")=$G(PATIENTARR(FNBR1,IENS1,.2403,"E"))
"RTN","SYNDHP20",121,0)
 S PATIENT("Patient","employerName")=$G(PATIENTARR(FNBR1,IENS1,.3111,"E"))
"RTN","SYNDHP20",122,0)
 S PATIENT("Patient","employmentStatus")=$G(PATIENTARR(FNBR1,IENS1,.31115,"E"))
"RTN","SYNDHP20",123,0)
 S PATIENT("Patient","employmentStatusCd")=$G(PATIENTARR(FNBR1,IENS1,.31115,"I"))
"RTN","SYNDHP20",124,0)
 S PATIENT("Patient","governmentAgency")=$G(PATIENTARR(FNBR1,IENS1,.3112,"E"))
"RTN","SYNDHP20",125,0)
 S PATIENT("Patient","governmentAgencyCd")=$G(PATIENTARR(FNBR1,IENS1,.3112,"I"))
"RTN","SYNDHP20",126,0)
 S PATIENT("Patient","employerStreetLine1")=$G(PATIENTARR(FNBR1,IENS1,.3113,"E"))
"RTN","SYNDHP20",127,0)
 S PATIENT("Patient","employerStreetLine2")=$G(PATIENTARR(FNBR1,IENS1,.3114,"E"))
"RTN","SYNDHP20",128,0)
 S PATIENT("Patient","employerStreetLine3")=$G(PATIENTARR(FNBR1,IENS1,.3115,"E"))
"RTN","SYNDHP20",129,0)
 S PATIENT("Patient","employerCity")=$G(PATIENTARR(FNBR1,IENS1,.3116,"E"))
"RTN","SYNDHP20",130,0)
 S PATIENT("Patient","employerState")=$G(PATIENTARR(FNBR1,IENS1,.3117,"E"))
"RTN","SYNDHP20",131,0)
 S PATIENT("Patient","employerStateId")=$G(PATIENTARR(FNBR1,IENS1,.3117,"I"))
"RTN","SYNDHP20",132,0)
 S PATIENT("Patient","employerZipCode")=$G(PATIENTARR(FNBR1,IENS1,.3118,"E"))
"RTN","SYNDHP20",133,0)
 S PATIENT("Patient","employerZip4")=$G(PATIENTARR(FNBR1,IENS1,.2205,"E"))
"RTN","SYNDHP20",134,0)
 S PATIENT("Patient","employerPhoneNumber")=$G(PATIENTARR(FNBR1,IENS1,.3119,"E"))
"RTN","SYNDHP20",135,0)
 S PATIENT("Patient","emrContactSameAsNok")=$G(PATIENTARR(FNBR1,IENS1,.3305,"E"))
"RTN","SYNDHP20",136,0)
 S PATIENT("Patient","emrContactSameAsNokCd")=$G(PATIENTARR(FNBR1,IENS1,.3305,"I"))
"RTN","SYNDHP20",137,0)
 S PATIENT("Patient","emrName")=$G(PATIENTARR(FNBR1,IENS1,.331,"E"))
"RTN","SYNDHP20",138,0)
 S PATIENT("Patient","emrRelationshipToPatient")=$G(PATIENTARR(FNBR1,IENS1,.332,"E"))
"RTN","SYNDHP20",139,0)
 S PATIENT("Patient","emrStreetAddressLine1")=$G(PATIENTARR(FNBR1,IENS1,.333,"E"))
"RTN","SYNDHP20",140,0)
 S PATIENT("Patient","emrStreetAddressLine2")=$G(PATIENTARR(FNBR1,IENS1,.334,"E"))
"RTN","SYNDHP20",141,0)
 S PATIENT("Patient","emrStreetAddressLine3")=$G(PATIENTARR(FNBR1,IENS1,.335,"E"))
"RTN","SYNDHP20",142,0)
 S PATIENT("Patient","emrCity")=$G(PATIENTARR(FNBR1,IENS1,.336,"E"))
"RTN","SYNDHP20",143,0)
 S PATIENT("Patient","emrState")=$G(PATIENTARR(FNBR1,IENS1,.337,"E"))
"RTN","SYNDHP20",144,0)
 S PATIENT("Patient","emrStateId")=$G(PATIENTARR(FNBR1,IENS1,.337,"I"))
"RTN","SYNDHP20",145,0)
 S PATIENT("Patient","emrZipCode")=$G(PATIENTARR(FNBR1,IENS1,.338,"E"))
"RTN","SYNDHP20",146,0)
 S PATIENT("Patient","emrZip4")=$G(PATIENTARR(FNBR1,IENS1,.2201,"E"))
"RTN","SYNDHP20",147,0)
 S PATIENT("Patient","emrPhoneNumber")=$G(PATIENTARR(FNBR1,IENS1,.339,"E"))
"RTN","SYNDHP20",148,0)
 S PATIENT("Patient","emrWorkPhoneNumber")=$G(PATIENTARR(FNBR1,IENS1,.33011,"E"))
"RTN","SYNDHP20",149,0)
 S PATIENT("Patient","dateOfDeath")=$G(PATIENTARR(FNBR1,IENS1,.351,"E"))
"RTN","SYNDHP20",150,0)
 S PATIENT("Patient","dateOfDeathFM")=$G(PATIENTARR(FNBR1,IENS1,.351,"I"))
"RTN","SYNDHP20",151,0)
 S PATIENT("Patient","dateOfDeathHL7")=$$FMTHL7^XLFDT($G(PATIENTARR(FNBR1,IENS1,.351,"I")))
"RTN","SYNDHP20",152,0)
 S PATIENT("Patient","dateOfDeathFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATIENTARR(FNBR1,IENS1,.351,"I")))
"RTN","SYNDHP20",153,0)
 S PATIENT("Patient","deathEnteredBy")=$G(PATIENTARR(FNBR1,IENS1,.352,"E"))
"RTN","SYNDHP20",154,0)
 S PATIENT("Patient","deathEnteredById")=$G(PATIENTARR(FNBR1,IENS1,.352,"I"))
"RTN","SYNDHP20",155,0)
 S PATIENT("Patient","testPatientIndicator")=$G(PATIENTARR(FNBR1,IENS1,.6,"E"))
"RTN","SYNDHP20",156,0)
 S PATIENT("Patient","testPatientIndicatorCd")=$G(PATIENTARR(FNBR1,IENS1,.6,"I"))
"RTN","SYNDHP20",157,0)
 S PATIENT("Patient","preferredFacility")=$G(PATIENTARR(FNBR1,IENS1,27.02,"E"))
"RTN","SYNDHP20",158,0)
 S PATIENT("Patient","preferredFacilityId")=$G(PATIENTARR(FNBR1,IENS1,27.02,"I"))
"RTN","SYNDHP20",159,0)
 S PATIENT("Patient","integrationControlNumber")=$G(PATIENTARR(FNBR1,IENS1,991.01,"E"))
"RTN","SYNDHP20",160,0)
 S PATIENT("Patient","icnChecksum")=$G(PATIENTARR(FNBR1,IENS1,991.02,"E"))
"RTN","SYNDHP20",161,0)
 S PATIENT("Patient","fullICN")=$G(PATIENTARR(FNBR1,IENS1,991.1,"E"))
"RTN","SYNDHP20",162,0)
 S PATIENT("Patient","multipleBirthIndicator")=$G(PATIENTARR(FNBR1,IENS1,994,"E"))
"RTN","SYNDHP20",163,0)
 S PATIENT("Patient","multipleBirthIndicatorCd")=$G(PATIENTARR(FNBR1,IENS1,994,"I"))
"RTN","SYNDHP20",164,0)
 S PATIENT("Patient","veteranYN")=$G(PATIENTARR(FNBR1,IENS1,1901,"E"))
"RTN","SYNDHP20",165,0)
 S PATIENT("Patient","veteranYNCd")=$G(PATIENTARR(FNBR1,IENS1,1901,"I"))
"RTN","SYNDHP20",166,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP20",167,0)
 F  S IENS2=$O(PATIENTARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP20",168,0)
 . N CONFADRS S CONFADRS=$NA(PATIENT("Patient","confidentialAddressCategorys","confidentialAddressCategory",+IENS2))
"RTN","SYNDHP20",169,0)
 . S @CONFADRS@("confidentialAddressCategory")=$G(PATIENTARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP20",170,0)
 . S @CONFADRS@("confidentialAddressCategoryCd")=$G(PATIENTARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP20",171,0)
 . S @CONFADRS@("confidentialCategoryActive")=$G(PATIENTARR(FNBR2,IENS2,1,"E"))
"RTN","SYNDHP20",172,0)
 . S @CONFADRS@("confidentialCategoryActiveCd")=$G(PATIENTARR(FNBR2,IENS2,1,"I"))
"RTN","SYNDHP20",173,0)
 . S @CONFADRS@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIENTIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP20",174,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP20",175,0)
 F  S IENS3=$O(PATIENTARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP20",176,0)
 . N ALIAS S ALIAS=$NA(PATIENT("Patient","aliass","alias",+IENS3))
"RTN","SYNDHP20",177,0)
 . S @ALIAS@("alias")=$G(PATIENTARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP20",178,0)
 . S @ALIAS@("aliasSsn")=$G(PATIENTARR(FNBR3,IENS3,1,"E"))
"RTN","SYNDHP20",179,0)
 . S @ALIAS@("aliasComponents")=$G(PATIENTARR(FNBR3,IENS3,100.03,"E"))
"RTN","SYNDHP20",180,0)
 . S @ALIAS@("aliasComponentsId")=$G(PATIENTARR(FNBR3,IENS3,100.03,"I"))
"RTN","SYNDHP20",181,0)
 . S @ALIAS@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIENTIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP20",182,0)
 N IENS4 S IENS4=""
"RTN","SYNDHP20",183,0)
 F  S IENS4=$O(PATIENTARR(FNBR4,IENS4)) QUIT:IENS4=""  D
"RTN","SYNDHP20",184,0)
 . N RACE S RACE=$NA(PATIENT("Patient","raceInformations","raceInformation",+IENS4))
"RTN","SYNDHP20",185,0)
 . S @RACE@("raceInformation")=$G(PATIENTARR(FNBR4,IENS4,.01,"E"))
"RTN","SYNDHP20",186,0)
 . S @RACE@("raceInformationId")=$G(PATIENTARR(FNBR4,IENS4,.01,"I"))
"RTN","SYNDHP20",187,0)
 . S @RACE@("methodOfCollection")=$G(PATIENTARR(FNBR4,IENS4,.02,"E"))
"RTN","SYNDHP20",188,0)
 . S @RACE@("methodOfCollectionId")=$G(PATIENTARR(FNBR4,IENS4,.02,"I"))
"RTN","SYNDHP20",189,0)
 . S @RACE@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIENTIEN_S_FNBR4_S_+IENS4
"RTN","SYNDHP20",190,0)
 N IENS5 S IENS5=""
"RTN","SYNDHP20",191,0)
 F  S IENS5=$O(PATIENTARR(FNBR5,IENS5)) QUIT:IENS5=""  D
"RTN","SYNDHP20",192,0)
 . N ETHNIC S ETHNIC=$NA(PATIENT("Patient","ethnicityInformations","ethnicityInformation",+IENS5))
"RTN","SYNDHP20",193,0)
 . S @ETHNIC@("ethnicityInformation")=$G(PATIENTARR(FNBR5,IENS5,.01,"E"))
"RTN","SYNDHP20",194,0)
 . S @ETHNIC@("ethnicityInformationId")=$G(PATIENTARR(FNBR5,IENS5,.01,"I"))
"RTN","SYNDHP20",195,0)
 . S @ETHNIC@("methodOfCollection")=$G(PATIENTARR(FNBR5,IENS5,.02,"E"))
"RTN","SYNDHP20",196,0)
 . S @ETHNIC@("methodOfCollectionId")=$G(PATIENTARR(FNBR5,IENS5,.02,"I"))
"RTN","SYNDHP20",197,0)
 . S @ETHNIC@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIENTIEN_S_FNBR5_S_+IENS5
"RTN","SYNDHP20",198,0)
 ;
"RTN","SYNDHP20",199,0)
 ;I $G(DEBUG) W ! ZWRITE PATIENT
"RTN","SYNDHP20",200,0)
 ;
"RTN","SYNDHP20",201,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PATIENT,.PATIENTJ)
"RTN","SYNDHP20",202,0)
 ;
"RTN","SYNDHP20",203,0)
 QUIT
"RTN","SYNDHP20",204,0)
 ;
"RTN","SYNDHP21")
0^105^B55720482
"RTN","SYNDHP21",1,0)
SYNDHP21 ; HC/art - HealthConcourse - get patient lab data ;03/28/2019
"RTN","SYNDHP21",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP21",3,0)
 ;;
"RTN","SYNDHP21",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP21",5,0)
 ;
"RTN","SYNDHP21",6,0)
 QUIT
"RTN","SYNDHP21",7,0)
 ;
"RTN","SYNDHP21",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP21",9,0)
 ;
"RTN","SYNDHP21",10,0)
GETLABS(LABS,LABREF,RETJSON,LABSJ) ;get Patient Labs records
"RTN","SYNDHP21",11,0)
 ;inputs: LABREF - Labs IEN (patient LRDFN)
"RTN","SYNDHP21",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP21",13,0)
 ;output: LABS  - array of Labs data, by reference
"RTN","SYNDHP21",14,0)
 ;        LABSJ - JSON structure of Labs data, by reference
"RTN","SYNDHP21",15,0)
 ;
"RTN","SYNDHP21",16,0)
 I $G(DEBUG) W !,"--------------------------- Labs -----------------------------",!
"RTN","SYNDHP21",17,0)
 N S S S="_"
"RTN","SYNDHP21",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP21",19,0)
 N FNBR1 S FNBR1=63 ;LAB DATA
"RTN","SYNDHP21",20,0)
 N FNBR2 S FNBR2=63.04 ;CHEM, HEM, TOX, RIA, SER, etc.
"RTN","SYNDHP21",21,0)
 N FNBR3 S FNBR3=63.07 ;ORDERED TEST
"RTN","SYNDHP21",22,0)
 N IENS1 S IENS1=LABREF_","
"RTN","SYNDHP21",23,0)
 ;
"RTN","SYNDHP21",24,0)
 N LABSARR,LABSERR,INVDT,RESULT,LOINC
"RTN","SYNDHP21",25,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","LABSARR","LABSERR")
"RTN","SYNDHP21",26,0)
 ;I $G(DEBUG) W ! ZWRITE LABSARR
"RTN","SYNDHP21",27,0)
 ;I $G(DEBUG),$D(LABSERR) W !,">>ERROR<<" ZWRITE LABSERR
"RTN","SYNDHP21",28,0)
 I $D(LABSERR) D  QUIT
"RTN","SYNDHP21",29,0)
 . S LABS("Lab","ERROR")=LABREF
"RTN","SYNDHP21",30,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.LABS,.LABSJ)
"RTN","SYNDHP21",31,0)
 S LABS("Lab","labsIen")=LABREF
"RTN","SYNDHP21",32,0)
 S LABS("Lab","resourceType")="Laboratory"
"RTN","SYNDHP21",33,0)
 S LABS("Lab","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_LABREF
"RTN","SYNDHP21",34,0)
 S LABS("Lab","lrDfn")=$G(LABSARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP21",35,0)
 S LABS("Lab","patientName")=$G(LABSARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP21",36,0)
 S LABS("Lab","patientNameId")=$G(LABSARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP21",37,0)
 S LABS("Lab","patientIcn")=$$ICN^SYNDHPUTL(LABS("Lab","patientNameId"))
"RTN","SYNDHP21",38,0)
 S LABS("Lab","doNotTransfuse")=$G(LABSARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP21",39,0)
 S LABS("Lab","doNotTransfuseCd")=$G(LABSARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP21",40,0)
 S LABS("Lab","aboGroup")=$G(LABSARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP21",41,0)
 S LABS("Lab","aboGroupCd")=$G(LABSARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP21",42,0)
 S LABS("Lab","rhType")=$G(LABSARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP21",43,0)
 S LABS("Lab","rhTypeCd")=$G(LABSARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP21",44,0)
 S LABS("Lab","hospitalId")=$G(LABSARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP21",45,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP21",46,0)
 F  S IENS2=$O(LABSARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP21",47,0)
 . N CHEMLABS S CHEMLABS=$NA(LABS("Lab","chemHemToxRiaSerEtcs","chemHemToxRiaSerEtc",+IENS2))
"RTN","SYNDHP21",48,0)
 . S @CHEMLABS@("dateTimeSpecimenTaken")=$G(LABSARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP21",49,0)
 . S @CHEMLABS@("dateTimeSpecimenTakenFM")=$G(LABSARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP21",50,0)
 . S @CHEMLABS@("dateTimeSpecimenTakenHL7")=$$FMTHL7^XLFDT($G(LABSARR(FNBR2,IENS2,.01,"I")))
"RTN","SYNDHP21",51,0)
 . S @CHEMLABS@("dateTimeSpecimenTakenFHIR")=$$FMTFHIR^SYNDHPUTL($G(LABSARR(FNBR2,IENS2,.01,"I")))
"RTN","SYNDHP21",52,0)
 . S @CHEMLABS@("dateTimeObtainedInexact")=$G(LABSARR(FNBR2,IENS2,.02,"E"))
"RTN","SYNDHP21",53,0)
 . S @CHEMLABS@("dateTimeObtainedInexactCd")=$G(LABSARR(FNBR2,IENS2,.02,"I"))
"RTN","SYNDHP21",54,0)
 . S @CHEMLABS@("dateReportCompleted")=$G(LABSARR(FNBR2,IENS2,.03,"E"))
"RTN","SYNDHP21",55,0)
 . S @CHEMLABS@("dateReportCompletedFM")=$G(LABSARR(FNBR2,IENS2,.03,"I"))
"RTN","SYNDHP21",56,0)
 . S @CHEMLABS@("dateReportCompletedHL7")=$$FMTHL7^XLFDT($G(LABSARR(FNBR2,IENS2,.03,"I")))
"RTN","SYNDHP21",57,0)
 . S @CHEMLABS@("dateReportCompletedFHIR")=$$FMTFHIR^SYNDHPUTL($G(LABSARR(FNBR2,IENS2,.03,"I")))
"RTN","SYNDHP21",58,0)
 . S @CHEMLABS@("verifyPerson")=$G(LABSARR(FNBR2,IENS2,.04,"E"))
"RTN","SYNDHP21",59,0)
 . S @CHEMLABS@("verifyPersonId")=$G(LABSARR(FNBR2,IENS2,.04,"I"))
"RTN","SYNDHP21",60,0)
 . S @CHEMLABS@("specimenType")=$G(LABSARR(FNBR2,IENS2,.05,"E"))
"RTN","SYNDHP21",61,0)
 . S @CHEMLABS@("specimenTypeId")=$G(LABSARR(FNBR2,IENS2,.05,"I"))
"RTN","SYNDHP21",62,0)
 . S @CHEMLABS@("accession")=$G(LABSARR(FNBR2,IENS2,.06,"E"))
"RTN","SYNDHP21",63,0)
 . S @CHEMLABS@("volume")=$G(LABSARR(FNBR2,IENS2,.07,"E"))
"RTN","SYNDHP21",64,0)
 . S @CHEMLABS@("methodOrSite")=$G(LABSARR(FNBR2,IENS2,.08,"E"))
"RTN","SYNDHP21",65,0)
 . S @CHEMLABS@("sumReportNum")=$G(LABSARR(FNBR2,IENS2,.09,"E"))
"RTN","SYNDHP21",66,0)
 . S @CHEMLABS@("requestingPerson")=$G(LABSARR(FNBR2,IENS2,.1,"E"))
"RTN","SYNDHP21",67,0)
 . S @CHEMLABS@("requestingPersonId")=$G(LABSARR(FNBR2,IENS2,.1,"I"))
"RTN","SYNDHP21",68,0)
 . S @CHEMLABS@("requestingLocation")=$G(LABSARR(FNBR2,IENS2,.11,"E"))
"RTN","SYNDHP21",69,0)
 . S @CHEMLABS@("requestingLocDiv")=$G(LABSARR(FNBR2,IENS2,.111,"E"))
"RTN","SYNDHP21",70,0)
 . S @CHEMLABS@("requestingLocDivId")=$G(LABSARR(FNBR2,IENS2,.111,"I"))
"RTN","SYNDHP21",71,0)
 . S @CHEMLABS@("accessioningInstitution")=$G(LABSARR(FNBR2,IENS2,.112,"E"))
"RTN","SYNDHP21",72,0)
 . S @CHEMLABS@("accessioningInstitutionId")=$G(LABSARR(FNBR2,IENS2,.112,"I"))
"RTN","SYNDHP21",73,0)
 . S @CHEMLABS@("uid")=$G(LABSARR(FNBR2,IENS2,.31,"E"))
"RTN","SYNDHP21",74,0)
 . S @CHEMLABS@("orderingSite")=$G(LABSARR(FNBR2,IENS2,.32,"E"))
"RTN","SYNDHP21",75,0)
 . S @CHEMLABS@("orderingSiteId")=$G(LABSARR(FNBR2,IENS2,.32,"I"))
"RTN","SYNDHP21",76,0)
 . S @CHEMLABS@("collectingSite")=$G(LABSARR(FNBR2,IENS2,.33,"E"))
"RTN","SYNDHP21",77,0)
 . S @CHEMLABS@("collectingSiteId")=$G(LABSARR(FNBR2,IENS2,.33,"I"))
"RTN","SYNDHP21",78,0)
 . S @CHEMLABS@("hostUid")=$G(LABSARR(FNBR2,IENS2,.34,"E"))
"RTN","SYNDHP21",79,0)
 . S @CHEMLABS@("orderingSiteUid")=$G(LABSARR(FNBR2,IENS2,.342,"E"))
"RTN","SYNDHP21",80,0)
 . S @CHEMLABS@("releasingSite")=$G(LABSARR(FNBR2,IENS2,.345,"E"))
"RTN","SYNDHP21",81,0)
 . S @CHEMLABS@("releasingSiteId")=$G(LABSARR(FNBR2,IENS2,.345,"I"))
"RTN","SYNDHP21",82,0)
 . S @CHEMLABS@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_LABREF_S_FNBR2_S_+IENS2
"RTN","SYNDHP21",83,0)
 . ;"secret" data in the results field
"RTN","SYNDHP21",84,0)
 . S INVDT=9999999-@CHEMLABS@("dateTimeSpecimenTakenFM")
"RTN","SYNDHP21",85,0)
 . N RESULT
"RTN","SYNDHP21",86,0)
 . D GETRESLT(LABREF,INVDT,.RESULT)
"RTN","SYNDHP21",87,0)
 . S @CHEMLABS@("labTestId")=$G(RESULT("labTestId"))
"RTN","SYNDHP21",88,0)
 . S @CHEMLABS@("labTestName")=$G(RESULT("labTestName"))
"RTN","SYNDHP21",89,0)
 . S @CHEMLABS@("result")=$G(RESULT("result"))
"RTN","SYNDHP21",90,0)
 . S @CHEMLABS@("flag")=$G(RESULT("flag"))
"RTN","SYNDHP21",91,0)
 . S @CHEMLABS@("referenceHigh")=$G(RESULT("referenceHigh"))
"RTN","SYNDHP21",92,0)
 . S @CHEMLABS@("referenceLow")=$G(RESULT("referenceLow"))
"RTN","SYNDHP21",93,0)
 . S @CHEMLABS@("criticalHigh")=$G(RESULT("criticalHigh"))
"RTN","SYNDHP21",94,0)
 . S @CHEMLABS@("criticalLow")=$G(RESULT("criticalLow"))
"RTN","SYNDHP21",95,0)
 . S @CHEMLABS@("units")=$G(RESULT("units"))
"RTN","SYNDHP21",96,0)
 . S @CHEMLABS@("typographyId")=$G(RESULT("typographyId"))
"RTN","SYNDHP21",97,0)
 . S @CHEMLABS@("typography")=$G(RESULT("typography"))
"RTN","SYNDHP21",98,0)
 . S @CHEMLABS@("workloadCd")=$G(RESULT("workloadCd"))
"RTN","SYNDHP21",99,0)
 . S @CHEMLABS@("workloadProcedure")=$G(RESULT("workloadProcedure"))
"RTN","SYNDHP21",100,0)
 . ;get loinc
"RTN","SYNDHP21",101,0)
 . S LOINC=$$GETLOINC(@CHEMLABS@("labTestId"),@CHEMLABS@("labTestName"),@CHEMLABS@("typographyId"))
"RTN","SYNDHP21",102,0)
 . S @CHEMLABS@("loincCode")=$P(LOINC,U,1)
"RTN","SYNDHP21",103,0)
 . S @CHEMLABS@("loincName")=$P(LOINC,U,2)
"RTN","SYNDHP21",104,0)
 ;
"RTN","SYNDHP21",105,0)
 ;I $G(DEBUG) W ! ZWRITE LABS
"RTN","SYNDHP21",106,0)
 ;
"RTN","SYNDHP21",107,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.LABS,.LABSJ)
"RTN","SYNDHP21",108,0)
 ;
"RTN","SYNDHP21",109,0)
 QUIT
"RTN","SYNDHP21",110,0)
 ;
"RTN","SYNDHP21",111,0)
GETRESLT(lrDfn,invDate,ret) ;get chem lab test result
"RTN","SYNDHP21",112,0)
 quit:('$get(lrDfn))!('$get(invDate))
"RTN","SYNDHP21",113,0)
 ;
"RTN","SYNDHP21",114,0)
 new node
"RTN","SYNDHP21",115,0)
 new fieldnbr set fieldnbr=$order(^LR(lrDfn,"CH",invDate,1))
"RTN","SYNDHP21",116,0)
 if fieldnbr'="",$data(^LR(lrDfn,"CH",invDate,fieldnbr)) do
"RTN","SYNDHP21",117,0)
 . set ret("resultFor")=$piece($get(^DD(63.04,fieldnbr,0)),U,1)
"RTN","SYNDHP21",118,0)
 . set node=^LR(lrDfn,"CH",invDate,fieldnbr)
"RTN","SYNDHP21",119,0)
 . set ret("result")=$piece(node,U,1)
"RTN","SYNDHP21",120,0)
 . set ret("flag")=$piece(node,U,2)
"RTN","SYNDHP21",121,0)
 . set ret("workloadCd")=$piece($piece(node,U,3),"!",1)
"RTN","SYNDHP21",122,0)
 . if ret("workloadCd")'="" set ret("workloadProcedure")=$$GET1^DIQ(64,$order(^LAM("C",ret("workloadCd")_" ",""))_",",.01)
"RTN","SYNDHP21",123,0)
 . set ret("labTestId")=$piece($piece(node,U,3),"!",7)
"RTN","SYNDHP21",124,0)
 . set ret("labTestName")=$$GET1^DIQ(60,ret("labTestId")_",",.01)
"RTN","SYNDHP21",125,0)
 . set ret("verifyById")=$piece(node,U,4)
"RTN","SYNDHP21",126,0)
 . set ret("verifyBy")=$$GET1^DIQ(200,ret("verifyById")_",",.01)
"RTN","SYNDHP21",127,0)
 . set ret("typographyId")=$piece($piece(node,U,5),"!",1)
"RTN","SYNDHP21",128,0)
 . set ret("typography")=$$GET1^DIQ(61,ret("typographyId")_",",.01)
"RTN","SYNDHP21",129,0)
 . set ret("referenceLow")=$piece($piece(node,U,5),"!",2)
"RTN","SYNDHP21",130,0)
 . set ret("referenceHigh")=$piece($piece(node,U,5),"!",3)
"RTN","SYNDHP21",131,0)
 . set ret("criticalLow")=$piece($piece(node,U,5),"!",4)
"RTN","SYNDHP21",132,0)
 . set ret("criticalHigh")=$piece($piece(node,U,5),"!",5)
"RTN","SYNDHP21",133,0)
 . set ret("units")=$piece($piece(node,U,5),"!",7)
"RTN","SYNDHP21",134,0)
 . set ret("institutionId")=$piece(node,U,9)
"RTN","SYNDHP21",135,0)
 . set ret("institution")=$$GET1^DIQ(4,ret("institutionId")_",",.01)
"RTN","SYNDHP21",136,0)
 ;2)="110^^84330.0000!!!!!!175^1^72!60!110!50!300!!mg/dL!!!^^^^500"
"RTN","SYNDHP21",137,0)
 quit
"RTN","SYNDHP21",138,0)
 ;
"RTN","SYNDHP21",139,0)
GETLOINC(TESTIEN,TESTNAME,TYPE) ; get loinc code for test
"RTN","SYNDHP21",140,0)
 ;returns - loinc code ^ loinc code name (or test name)
"RTN","SYNDHP21",141,0)
 ;
"RTN","SYNDHP21",142,0)
 N IENS S IENS=TYPE_","_TESTIEN_","
"RTN","SYNDHP21",143,0)
 N LOINCCD S LOINCCD=$$GET1^DIQ(60.01,IENS,95.3) ;loinc code from laboratory test:site/specimen (60:100)
"RTN","SYNDHP21",144,0)
 N LOINCNM S LOINCNM=$$GET1^DIQ(95.3,+LOINCCD_",",80) ;loinc fully specified name
"RTN","SYNDHP21",145,0)
 ;if not found in Vista, then use SYNGRAPH below
"RTN","SYNDHP21",146,0)
 I LOINCCD="" D
"RTN","SYNDHP21",147,0)
 . S LOINCCD=$$graphmap^SYNGRAPH("loinc-lab-map",TESTNAME,"LOINC")
"RTN","SYNDHP21",148,0)
 . I +LOINCCD=-1 D
"RTN","SYNDHP21",149,0)
 . . S LOINCCD=""
"RTN","SYNDHP21",150,0)
 . . S LOINCNM=TESTNAME
"RTN","SYNDHP21",151,0)
 . E  D
"RTN","SYNDHP21",152,0)
 . . S LOINCNM=$$GET1^DIQ(95.3,+LOINCCD_",",80) ;loinc fully specified name
"RTN","SYNDHP21",153,0)
 ;
"RTN","SYNDHP21",154,0)
 QUIT LOINCCD_U_LOINCNM
"RTN","SYNDHP21",155,0)
 ;
"RTN","SYNDHP22")
0^109^B41410082
"RTN","SYNDHP22",1,0)
SYNDHP22 ; HC/art - HealthConcourse - get hospital location data ;03/26/2019
"RTN","SYNDHP22",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP22",3,0)
 ;;
"RTN","SYNDHP22",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP22",5,0)
 ;
"RTN","SYNDHP22",6,0)
 QUIT
"RTN","SYNDHP22",7,0)
 ;
"RTN","SYNDHP22",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP22",9,0)
 ;
"RTN","SYNDHP22",10,0)
GETHLOC(HOSPLOC,HLOCIEN,RETJSON,HOSPLOCJ) ;get one Hospital Location record
"RTN","SYNDHP22",11,0)
 ; This API does not return all Hospital Location fields. In general, fields related to appointments are omitted
"RTN","SYNDHP22",12,0)
 ;inputs: HLOCIEN - Hospital Location IEN
"RTN","SYNDHP22",13,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP22",14,0)
 ;output: HOSPLOC  - array of Hospital Location data, by reference
"RTN","SYNDHP22",15,0)
 ;        HOSPLOCJ - JSON structure of Hospital Location data, by reference
"RTN","SYNDHP22",16,0)
 ;
"RTN","SYNDHP22",17,0)
 I $G(DEBUG) W !,"--------------------------- Hospital Location -----------------------------",!
"RTN","SYNDHP22",18,0)
 N S S S="_"
"RTN","SYNDHP22",19,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP22",20,0)
 N FNBR1 S FNBR1=44 ;HOSPITAL LOCATION
"RTN","SYNDHP22",21,0)
 N FNBR2 S FNBR2=44.01 ;SYNONYM
"RTN","SYNDHP22",22,0)
 N FNBR3 S FNBR3=44.101 ;ASSOCIATED LOCATION TYPES
"RTN","SYNDHP22",23,0)
 N FNBR4 S FNBR4=44.1 ;PROVIDER
"RTN","SYNDHP22",24,0)
 N IENS1 S IENS1=HLOCIEN_","
"RTN","SYNDHP22",25,0)
 N FIELDS S FIELDS=".01:4;7:10;13*;14:16;23;42;99;99.1;101*;1916;1920.9;2502;2503:2506;2600*"
"RTN","SYNDHP22",26,0)
 ;
"RTN","SYNDHP22",27,0)
 N HOSPLOCARR,HOSPLOCERR
"RTN","SYNDHP22",28,0)
 D GETS^DIQ(FNBR1,IENS1,FIELDS,"EI","HOSPLOCARR","HOSPLOCERR")
"RTN","SYNDHP22",29,0)
 ;I $G(DEBUG) W ! ZWRITE HOSPLOCARR
"RTN","SYNDHP22",30,0)
 ;I $G(DEBUG),$D(HOSPLOCERR) W !,">>ERROR<<" ZWRITE HOSPLOCERR
"RTN","SYNDHP22",31,0)
 I $D(HOSPLOCERR) D  QUIT
"RTN","SYNDHP22",32,0)
 . S HOSPLOC("Hosploc","ERROR")=HLOCIEN
"RTN","SYNDHP22",33,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.HOSPLOC,.HOSPLOCJ)
"RTN","SYNDHP22",34,0)
 N HLOC S HLOC=$NA(HOSPLOC("Hosploc"))
"RTN","SYNDHP22",35,0)
 S @HLOC@("hosplocIen")=HLOCIEN
"RTN","SYNDHP22",36,0)
 S @HLOC@("resourceType")="Organization"
"RTN","SYNDHP22",37,0)
 S @HLOC@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HLOCIEN
"RTN","SYNDHP22",38,0)
 S @HLOC@("name")=$G(HOSPLOCARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP22",39,0)
 S @HLOC@("abbreviation")=$G(HOSPLOCARR(FNBR1,IENS1,1,"E"))
"RTN","SYNDHP22",40,0)
 S @HLOC@("type")=$G(HOSPLOCARR(FNBR1,IENS1,2,"E"))
"RTN","SYNDHP22",41,0)
 S @HLOC@("typeCd")=$G(HOSPLOCARR(FNBR1,IENS1,2,"I"))
"RTN","SYNDHP22",42,0)
 S @HLOC@("typeExtension")=$G(HOSPLOCARR(FNBR1,IENS1,2.1,"E"))
"RTN","SYNDHP22",43,0)
 S @HLOC@("typeExtensionId")=$G(HOSPLOCARR(FNBR1,IENS1,2.1,"I"))
"RTN","SYNDHP22",44,0)
 S @HLOC@("institution")=$G(HOSPLOCARR(FNBR1,IENS1,3,"E"))
"RTN","SYNDHP22",45,0)
 S @HLOC@("institutionId")=$G(HOSPLOCARR(FNBR1,IENS1,3,"I"))
"RTN","SYNDHP22",46,0)
 S @HLOC@("division")=$G(HOSPLOCARR(FNBR1,IENS1,3.5,"E"))
"RTN","SYNDHP22",47,0)
 S @HLOC@("divisionId")=$G(HOSPLOCARR(FNBR1,IENS1,3.5,"I"))
"RTN","SYNDHP22",48,0)
 S @HLOC@("module")=$G(HOSPLOCARR(FNBR1,IENS1,4,"E"))
"RTN","SYNDHP22",49,0)
 S @HLOC@("moduleId")=$G(HOSPLOCARR(FNBR1,IENS1,4,"I"))
"RTN","SYNDHP22",50,0)
 S @HLOC@("visitLocation")=$G(HOSPLOCARR(FNBR1,IENS1,7,"E"))
"RTN","SYNDHP22",51,0)
 S @HLOC@("stopCodeNumber")=$G(HOSPLOCARR(FNBR1,IENS1,8,"E"))
"RTN","SYNDHP22",52,0)
 S @HLOC@("stopCodeNumberId")=$G(HOSPLOCARR(FNBR1,IENS1,8,"I"))
"RTN","SYNDHP22",53,0)
 S @HLOC@("prvYearStopCode")=$G(HOSPLOCARR(FNBR1,IENS1,8.1,"E"))
"RTN","SYNDHP22",54,0)
 S @HLOC@("prvYearStopCodeId")=$G(HOSPLOCARR(FNBR1,IENS1,8.1,"I"))
"RTN","SYNDHP22",55,0)
 S @HLOC@("service")=$G(HOSPLOCARR(FNBR1,IENS1,9,"E"))
"RTN","SYNDHP22",56,0)
 S @HLOC@("serviceCd")=$G(HOSPLOCARR(FNBR1,IENS1,9,"I"))
"RTN","SYNDHP22",57,0)
 S @HLOC@("treatingSpecialty")=$G(HOSPLOCARR(FNBR1,IENS1,9.5,"E"))
"RTN","SYNDHP22",58,0)
 S @HLOC@("treatingSpecialtyId")=$G(HOSPLOCARR(FNBR1,IENS1,9.5,"I"))
"RTN","SYNDHP22",59,0)
 S @HLOC@("physicalLocation")=$G(HOSPLOCARR(FNBR1,IENS1,10,"E"))
"RTN","SYNDHP22",60,0)
 S @HLOC@("specialAmisStop")=$G(HOSPLOCARR(FNBR1,IENS1,14,"E"))
"RTN","SYNDHP22",61,0)
 S @HLOC@("specialAmisStopCd")=$G(HOSPLOCARR(FNBR1,IENS1,14,"I"))
"RTN","SYNDHP22",62,0)
 S @HLOC@("categoryOfVisit")=$G(HOSPLOCARR(FNBR1,IENS1,15,"E"))
"RTN","SYNDHP22",63,0)
 S @HLOC@("defaultProvider")=$G(HOSPLOCARR(FNBR1,IENS1,16,"E"))
"RTN","SYNDHP22",64,0)
 S @HLOC@("defaultProviderId")=$G(HOSPLOCARR(FNBR1,IENS1,16,"I"))
"RTN","SYNDHP22",65,0)
 S @HLOC@("agency")=$G(HOSPLOCARR(FNBR1,IENS1,23,"E"))
"RTN","SYNDHP22",66,0)
 S @HLOC@("agencyId")=$G(HOSPLOCARR(FNBR1,IENS1,23,"I"))
"RTN","SYNDHP22",67,0)
 S @HLOC@("wardLocationFilePointer")=$G(HOSPLOCARR(FNBR1,IENS1,42,"E"))
"RTN","SYNDHP22",68,0)
 S @HLOC@("wardLocationFilePointerId")=$G(HOSPLOCARR(FNBR1,IENS1,42,"I"))
"RTN","SYNDHP22",69,0)
 S @HLOC@("telephone")=$G(HOSPLOCARR(FNBR1,IENS1,99,"E"))
"RTN","SYNDHP22",70,0)
 S @HLOC@("telephoneExtension")=$G(HOSPLOCARR(FNBR1,IENS1,99.1,"E"))
"RTN","SYNDHP22",71,0)
 S @HLOC@("principalClinic")=$G(HOSPLOCARR(FNBR1,IENS1,1916,"E"))
"RTN","SYNDHP22",72,0)
 S @HLOC@("principalClinicId")=$G(HOSPLOCARR(FNBR1,IENS1,1916,"I"))
"RTN","SYNDHP22",73,0)
 S @HLOC@("availabilityFlag")=$G(HOSPLOCARR(FNBR1,IENS1,1920.9,"E"))
"RTN","SYNDHP22",74,0)
 S @HLOC@("availabilityFlagFM")=$G(HOSPLOCARR(FNBR1,IENS1,1920.9,"I"))
"RTN","SYNDHP22",75,0)
 S @HLOC@("availabilityFlagHL7")=$$FMTHL7^XLFDT($G(HOSPLOCARR(FNBR1,IENS1,1920.9,"I")))
"RTN","SYNDHP22",76,0)
 S @HLOC@("availabilityFlagFHIR")=$$FMTFHIR^SYNDHPUTL($G(HOSPLOCARR(FNBR1,IENS1,1920.9,"I")))
"RTN","SYNDHP22",77,0)
 S @HLOC@("nonCountClinicYOrN")=$G(HOSPLOCARR(FNBR1,IENS1,2502,"E"))
"RTN","SYNDHP22",78,0)
 S @HLOC@("nonCountClinicYOrNCd")=$G(HOSPLOCARR(FNBR1,IENS1,2502,"I"))
"RTN","SYNDHP22",79,0)
 S @HLOC@("creditStopCode")=$G(HOSPLOCARR(FNBR1,IENS1,2503,"E"))
"RTN","SYNDHP22",80,0)
 S @HLOC@("creditStopCodeId")=$G(HOSPLOCARR(FNBR1,IENS1,2503,"I"))
"RTN","SYNDHP22",81,0)
 S @HLOC@("prvYearCreditStopCode")=$G(HOSPLOCARR(FNBR1,IENS1,2503.1,"E"))
"RTN","SYNDHP22",82,0)
 S @HLOC@("prvYearCreditStopCodeId")=$G(HOSPLOCARR(FNBR1,IENS1,2503.1,"I"))
"RTN","SYNDHP22",83,0)
 S @HLOC@("clinicMeetsAtThisFacility")=$G(HOSPLOCARR(FNBR1,IENS1,2504,"E"))
"RTN","SYNDHP22",84,0)
 S @HLOC@("clinicMeetsAtThisFacilityCd")=$G(HOSPLOCARR(FNBR1,IENS1,2504,"I"))
"RTN","SYNDHP22",85,0)
 S @HLOC@("inactivateDate")=$G(HOSPLOCARR(FNBR1,IENS1,2505,"E"))
"RTN","SYNDHP22",86,0)
 S @HLOC@("inactivateDateFM")=$G(HOSPLOCARR(FNBR1,IENS1,2505,"I"))
"RTN","SYNDHP22",87,0)
 S @HLOC@("inactivateDateHL7")=$$FMTHL7^XLFDT($G(HOSPLOCARR(FNBR1,IENS1,2505,"I")))
"RTN","SYNDHP22",88,0)
 S @HLOC@("inactivateDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(HOSPLOCARR(FNBR1,IENS1,2505,"I")))
"RTN","SYNDHP22",89,0)
 S @HLOC@("reactivateDate")=$G(HOSPLOCARR(FNBR1,IENS1,2506,"E"))
"RTN","SYNDHP22",90,0)
 S @HLOC@("reactivateDateFM")=$G(HOSPLOCARR(FNBR1,IENS1,2506,"I"))
"RTN","SYNDHP22",91,0)
 S @HLOC@("reactivateDateHL7")=$$FMTHL7^XLFDT($G(HOSPLOCARR(FNBR1,IENS1,2506,"I")))
"RTN","SYNDHP22",92,0)
 S @HLOC@("reactivateDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(HOSPLOCARR(FNBR1,IENS1,2506,"I")))
"RTN","SYNDHP22",93,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP22",94,0)
 F  S IENS2=$O(HOSPLOCARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP22",95,0)
 . N SYNONYM S SYNONYM=$NA(HOSPLOC("Hosploc","synonyms","synonym",+IENS2))
"RTN","SYNDHP22",96,0)
 . S @SYNONYM@("synonym")=$G(HOSPLOCARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP22",97,0)
 . S @SYNONYM@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HLOCIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP22",98,0)
 N IENS3 S IENS3=""
"RTN","SYNDHP22",99,0)
 F  S IENS3=$O(HOSPLOCARR(FNBR3,IENS3)) QUIT:IENS3=""  D
"RTN","SYNDHP22",100,0)
 . N ASSLOCTP S ASSLOCTP=$NA(HOSPLOC("Hosploc","associatedLocationTypess","associatedLocationTypes",+IENS3))
"RTN","SYNDHP22",101,0)
 . S @ASSLOCTP@("associatedLocationTypes")=$G(HOSPLOCARR(FNBR3,IENS3,.01,"E"))
"RTN","SYNDHP22",102,0)
 . S @ASSLOCTP@("associatedLocationTypesId")=$G(HOSPLOCARR(FNBR3,IENS3,.01,"I"))
"RTN","SYNDHP22",103,0)
 . S @ASSLOCTP@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HLOCIEN_S_FNBR3_S_+IENS3
"RTN","SYNDHP22",104,0)
 N IENS4 S IENS4=""
"RTN","SYNDHP22",105,0)
 F  S IENS4=$O(HOSPLOCARR(FNBR4,IENS4)) QUIT:IENS4=""  D
"RTN","SYNDHP22",106,0)
 . N PROVIDER S PROVIDER=$NA(HOSPLOC("Hosploc","providers","provider",+IENS4))
"RTN","SYNDHP22",107,0)
 . S @PROVIDER@("provider")=$G(HOSPLOCARR(FNBR4,IENS4,.01,"E"))
"RTN","SYNDHP22",108,0)
 . S @PROVIDER@("providerId")=$G(HOSPLOCARR(FNBR4,IENS4,.01,"I"))
"RTN","SYNDHP22",109,0)
 . S @PROVIDER@("defaultProvider")=$G(HOSPLOCARR(FNBR4,IENS4,.02,"E"))
"RTN","SYNDHP22",110,0)
 . S @PROVIDER@("defaultProviderCd")=$G(HOSPLOCARR(FNBR4,IENS4,.02,"I"))
"RTN","SYNDHP22",111,0)
 . S @PROVIDER@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_HLOCIEN_S_FNBR4_S_+IENS4
"RTN","SYNDHP22",112,0)
 ;
"RTN","SYNDHP22",113,0)
 ;I $G(DEBUG) W ! ZWRITE HOSPLOC
"RTN","SYNDHP22",114,0)
 ;
"RTN","SYNDHP22",115,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.HOSPLOC,.HOSPLOCJ)
"RTN","SYNDHP22",116,0)
 ;
"RTN","SYNDHP22",117,0)
 QUIT
"RTN","SYNDHP22",118,0)
 ;
"RTN","SYNDHP23")
0^110^B15447210
"RTN","SYNDHP23",1,0)
SYNDHP23 ; HC/art - HealthConcourse - get visit provider data ;03/26/2019
"RTN","SYNDHP23",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP23",3,0)
 ;;
"RTN","SYNDHP23",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP23",5,0)
 ;
"RTN","SYNDHP23",6,0)
 QUIT
"RTN","SYNDHP23",7,0)
 ;
"RTN","SYNDHP23",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP23",9,0)
 ;
"RTN","SYNDHP23",10,0)
GET1VPROV(VPROV,VPROVIEN,RETJSON,VPROVJ) ;get one V Provider record
"RTN","SYNDHP23",11,0)
 ;inputs: VPROVIEN - V Provider IEN
"RTN","SYNDHP23",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP23",13,0)
 ;output: VPROV  - array of V Provider data, by reference
"RTN","SYNDHP23",14,0)
 ;        VPROVJ - JSON structure of V Provider data, by reference
"RTN","SYNDHP23",15,0)
 ;
"RTN","SYNDHP23",16,0)
 I $G(DEBUG) W !,"--------------------------- V Provider -----------------------------",!
"RTN","SYNDHP23",17,0)
 N S S S="_"
"RTN","SYNDHP23",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP23",19,0)
 N FNBR1 S FNBR1=9000010.06 ;V PROVIDER
"RTN","SYNDHP23",20,0)
 N IENS1 S IENS1=VPROVIEN_","
"RTN","SYNDHP23",21,0)
 ;
"RTN","SYNDHP23",22,0)
 N VPROVARR,VPROVERR
"RTN","SYNDHP23",23,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","VPROVARR","VPROVERR")
"RTN","SYNDHP23",24,0)
 ;I $G(DEBUG) W ! ZWRITE VPROVARR
"RTN","SYNDHP23",25,0)
 ;I $G(DEBUG),$D(VPROVERR) W ">>ERROR<<",! ZWRITE VPROVERR
"RTN","SYNDHP23",26,0)
 I $D(VPROVERR) D  QUIT
"RTN","SYNDHP23",27,0)
 . S VPROV("Vprov","ERROR")=VPROVIEN
"RTN","SYNDHP23",28,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VPROV,.VPROVJ)
"RTN","SYNDHP23",29,0)
 S VPROV("Vprov","vprovIen")=VPROVIEN
"RTN","SYNDHP23",30,0)
 S VPROV("Vprov","resourceType")="Encounter"
"RTN","SYNDHP23",31,0)
 S VPROV("Vprov","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_VPROVIEN
"RTN","SYNDHP23",32,0)
 S VPROV("Vprov","provider")=$G(VPROVARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP23",33,0)
 S VPROV("Vprov","providerId")=$G(VPROVARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP23",34,0)
 S VPROV("Vprov","patientName")=$G(VPROVARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP23",35,0)
 S VPROV("Vprov","patientNameId")=$G(VPROVARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP23",36,0)
 S VPROV("Vprov","patientICN")=$$GET1^DIQ(2,VPROV("Vprov","patientNameId")_",",991.1)
"RTN","SYNDHP23",37,0)
 S VPROV("Vprov","visit")=$G(VPROVARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP23",38,0)
 S VPROV("Vprov","visitId")=$G(VPROVARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP23",39,0)
 S VPROV("Vprov","visitFM")=$$GET1^DIQ(9000010,VPROV("Vprov","visitId")_",",.01,"I")
"RTN","SYNDHP23",40,0)
 S VPROV("Vprov","visitHL7")=$$FMTHL7^XLFDT(VPROV("Vprov","visitFM"))
"RTN","SYNDHP23",41,0)
 S VPROV("Vprov","visitFHIR")=$$FMTFHIR^SYNDHPUTL(VPROV("Vprov","visitFM"))
"RTN","SYNDHP23",42,0)
 S VPROV("Vprov","primarySecondary")=$G(VPROVARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP23",43,0)
 S VPROV("Vprov","primarySecondaryCd")=$G(VPROVARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP23",44,0)
 S VPROV("Vprov","primarySecondarySc")=$$SENTENCE^XLFSTR(VPROV("Vprov","primarySecondary"))
"RTN","SYNDHP23",45,0)
 S VPROV("Vprov","operatingAttending")=$G(VPROVARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP23",46,0)
 S VPROV("Vprov","operatingAttendingCd")=$G(VPROVARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP23",47,0)
 S VPROV("Vprov","personClass")=$G(VPROVARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP23",48,0)
 S VPROV("Vprov","personClassId")=$G(VPROVARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP23",49,0)
 S VPROV("Vprov","eventDateAndTime")=$G(VPROVARR(FNBR1,IENS1,1201,"E"))
"RTN","SYNDHP23",50,0)
 S VPROV("Vprov","eventDateAndTimeFM")=$G(VPROVARR(FNBR1,IENS1,1201,"I"))
"RTN","SYNDHP23",51,0)
 S VPROV("Vprov","eventDateAndTimeHL7")=$$FMTHL7^XLFDT($G(VPROVARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP23",52,0)
 S VPROV("Vprov","eventDateAndTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(VPROVARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP23",53,0)
 S VPROV("Vprov","editedFlag")=$G(VPROVARR(FNBR1,IENS1,80101,"E"))
"RTN","SYNDHP23",54,0)
 S VPROV("Vprov","editedFlagCd")=$G(VPROVARR(FNBR1,IENS1,80101,"I"))
"RTN","SYNDHP23",55,0)
 S VPROV("Vprov","auditTrail")=$G(VPROVARR(FNBR1,IENS1,80102,"E"))
"RTN","SYNDHP23",56,0)
 S VPROV("Vprov","comments")=$G(VPROVARR(FNBR1,IENS1,81101,"E"))
"RTN","SYNDHP23",57,0)
 S VPROV("Vprov","verified")=$G(VPROVARR(FNBR1,IENS1,81201,"E"))
"RTN","SYNDHP23",58,0)
 S VPROV("Vprov","verifiedCd")=$G(VPROVARR(FNBR1,IENS1,81201,"I"))
"RTN","SYNDHP23",59,0)
 S VPROV("Vprov","package")=$G(VPROVARR(FNBR1,IENS1,81202,"E"))
"RTN","SYNDHP23",60,0)
 S VPROV("Vprov","packageId")=$G(VPROVARR(FNBR1,IENS1,81202,"I"))
"RTN","SYNDHP23",61,0)
 S VPROV("Vprov","dataSource")=$G(VPROVARR(FNBR1,IENS1,81203,"E"))
"RTN","SYNDHP23",62,0)
 S VPROV("Vprov","dataSourceId")=$G(VPROVARR(FNBR1,IENS1,81203,"I"))
"RTN","SYNDHP23",63,0)
 ;
"RTN","SYNDHP23",64,0)
 ;I $G(DEBUG) W ! ZWRITE VPROV
"RTN","SYNDHP23",65,0)
 ;
"RTN","SYNDHP23",66,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.VPROV,.VPROVJ)
"RTN","SYNDHP23",67,0)
 ;
"RTN","SYNDHP23",68,0)
 QUIT
"RTN","SYNDHP23",69,0)
 ;
"RTN","SYNDHP24")
0^117^B129210012
"RTN","SYNDHP24",1,0)
SYNDHP24 ; HC/art - HealthConcourse - get TIU note data ;04/25/2019
"RTN","SYNDHP24",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP24",3,0)
 ;;
"RTN","SYNDHP24",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP24",5,0)
 ;
"RTN","SYNDHP24",6,0)
 QUIT
"RTN","SYNDHP24",7,0)
 ;
"RTN","SYNDHP24",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP24",9,0)
 ;
"RTN","SYNDHP24",10,0)
GET1TIU(TIU,TIUIEN,RETJSON,TIUJ) ;get one TIU record
"RTN","SYNDHP24",11,0)
 ;inputs: TIUIEN - TIU IEN
"RTN","SYNDHP24",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP24",13,0)
 ;output: TIU  - array of TIU data, by reference
"RTN","SYNDHP24",14,0)
 ;        TIUJ - JSON structure of TIU data, by reference
"RTN","SYNDHP24",15,0)
 ;
"RTN","SYNDHP24",16,0)
 I $G(DEBUG) W !,"--------------------------- TIU -----------------------------",!
"RTN","SYNDHP24",17,0)
 N S S S="_"
"RTN","SYNDHP24",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP24",19,0)
 N FNBR1 S FNBR1=8925 ;TIU DOCUMENT
"RTN","SYNDHP24",20,0)
 N FNBR2 S FNBR2=8925.02 ;REPORT TEXT
"RTN","SYNDHP24",21,0)
 N IENS1 S IENS1=TIUIEN_","
"RTN","SYNDHP24",22,0)
 ;
"RTN","SYNDHP24",23,0)
 N TIUARR,TIUERR
"RTN","SYNDHP24",24,0)
 D GETS^DIQ(FNBR1,IENS1,"**","EI","TIUARR","TIUERR")
"RTN","SYNDHP24",25,0)
 ;I $G(DEBUG) W ! ZWRITE TIUARR
"RTN","SYNDHP24",26,0)
 ;I $G(DEBUG),$D(TIUERR) W !,">>ERROR<<" W ! ZWRITE TIUERR
"RTN","SYNDHP24",27,0)
 I $D(TIUERR) D  QUIT
"RTN","SYNDHP24",28,0)
 . S TIU("Tiu","ERROR")=TIUIEN
"RTN","SYNDHP24",29,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.TIU,.TIUJ)
"RTN","SYNDHP24",30,0)
 S TIU("Tiu","tiuIen")=TIUIEN
"RTN","SYNDHP24",31,0)
 S TIU("Tiu","resourceType")="TiuNote"
"RTN","SYNDHP24",32,0)
 S TIU("Tiu","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_TIUIEN
"RTN","SYNDHP24",33,0)
 S TIU("Tiu","documentType")=$G(TIUARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP24",34,0)
 S TIU("Tiu","documentTypeId")=$G(TIUARR(FNBR1,IENS1,.01,"I"))
"RTN","SYNDHP24",35,0)
 S TIU("Tiu","patient")=$G(TIUARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP24",36,0)
 S TIU("Tiu","patientId")=$G(TIUARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP24",37,0)
 S TIU("Tiu","visit")=$G(TIUARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP24",38,0)
 S TIU("Tiu","visitId")=$G(TIUARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP24",39,0)
 S TIU("Tiu","visitFM")=$$GET1^DIQ(9000010,TIU("Tiu","visitId")_",",.01,"I")
"RTN","SYNDHP24",40,0)
 S TIU("Tiu","visitHL7")=$$FMTHL7^XLFDT(TIU("Tiu","visitFM"))
"RTN","SYNDHP24",41,0)
 S TIU("Tiu","visitFHIR")=$$FMTFHIR^SYNDHPUTL(TIU("Tiu","visitFM"))
"RTN","SYNDHP24",42,0)
 S TIU("Tiu","parentDocumentType")=$G(TIUARR(FNBR1,IENS1,.04,"E"))
"RTN","SYNDHP24",43,0)
 S TIU("Tiu","parentDocumentTypeId")=$G(TIUARR(FNBR1,IENS1,.04,"I"))
"RTN","SYNDHP24",44,0)
 S TIU("Tiu","status")=$G(TIUARR(FNBR1,IENS1,.05,"E"))
"RTN","SYNDHP24",45,0)
 S TIU("Tiu","statusId")=$G(TIUARR(FNBR1,IENS1,.05,"I"))
"RTN","SYNDHP24",46,0)
 S TIU("Tiu","parent")=$G(TIUARR(FNBR1,IENS1,.06,"E"))
"RTN","SYNDHP24",47,0)
 S TIU("Tiu","parentId")=$G(TIUARR(FNBR1,IENS1,.06,"I"))
"RTN","SYNDHP24",48,0)
 S TIU("Tiu","episodeBeginDateTime")=$G(TIUARR(FNBR1,IENS1,.07,"E"))
"RTN","SYNDHP24",49,0)
 S TIU("Tiu","episodeBeginDateTimeFM")=$G(TIUARR(FNBR1,IENS1,.07,"I"))
"RTN","SYNDHP24",50,0)
 S TIU("Tiu","episodeBeginDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,.07,"I")))
"RTN","SYNDHP24",51,0)
 S TIU("Tiu","episodeBeginDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,.07,"I")))
"RTN","SYNDHP24",52,0)
 S TIU("Tiu","episodeEndDateTime")=$G(TIUARR(FNBR1,IENS1,.08,"E"))
"RTN","SYNDHP24",53,0)
 S TIU("Tiu","episodeEndDateTimeFM")=$G(TIUARR(FNBR1,IENS1,.08,"I"))
"RTN","SYNDHP24",54,0)
 S TIU("Tiu","episodeEndDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,.08,"I")))
"RTN","SYNDHP24",55,0)
 S TIU("Tiu","episodeEndDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,.08,"I")))
"RTN","SYNDHP24",56,0)
 S TIU("Tiu","urgency")=$G(TIUARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP24",57,0)
 S TIU("Tiu","urgencyCd")=$G(TIUARR(FNBR1,IENS1,.09,"I"))
"RTN","SYNDHP24",58,0)
 S TIU("Tiu","lineCount")=$G(TIUARR(FNBR1,IENS1,.1,"E"))
"RTN","SYNDHP24",59,0)
 S TIU("Tiu","creditStopCodeOnCompletion")=$G(TIUARR(FNBR1,IENS1,.11,"E"))
"RTN","SYNDHP24",60,0)
 S TIU("Tiu","creditStopCodeOnCompletionCd")=$G(TIUARR(FNBR1,IENS1,.11,"I"))
"RTN","SYNDHP24",61,0)
 S TIU("Tiu","markDischDtForCorrection")=$G(TIUARR(FNBR1,IENS1,.12,"E"))
"RTN","SYNDHP24",62,0)
 S TIU("Tiu","markDischDtForCorrectionCd")=$G(TIUARR(FNBR1,IENS1,.12,"I"))
"RTN","SYNDHP24",63,0)
 S TIU("Tiu","visitType")=$G(TIUARR(FNBR1,IENS1,.13,"E"))
"RTN","SYNDHP24",64,0)
 S TIU("Tiu","reportText")=""
"RTN","SYNDHP24",65,0)
 N Z S Z=""
"RTN","SYNDHP24",66,0)
 F  S Z=$O(TIUARR(FNBR1,IENS1,2,Z)) QUIT:'+Z  D
"RTN","SYNDHP24",67,0)
 . S TIU("Tiu","reportText")=TIU("Tiu","reportText")_$G(TIUARR(FNBR1,IENS1,2,Z))
"RTN","SYNDHP24",68,0)
 S TIU("Tiu","entryDateTime")=$G(TIUARR(FNBR1,IENS1,1201,"E"))
"RTN","SYNDHP24",69,0)
 S TIU("Tiu","entryDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1201,"I"))
"RTN","SYNDHP24",70,0)
 S TIU("Tiu","entryDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP24",71,0)
 S TIU("Tiu","entryDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1201,"I")))
"RTN","SYNDHP24",72,0)
 S TIU("Tiu","authorDictator")=$G(TIUARR(FNBR1,IENS1,1202,"E"))
"RTN","SYNDHP24",73,0)
 S TIU("Tiu","authorDictatorId")=$G(TIUARR(FNBR1,IENS1,1202,"I"))
"RTN","SYNDHP24",74,0)
 S TIU("Tiu","clinic")=$G(TIUARR(FNBR1,IENS1,1203,"E"))
"RTN","SYNDHP24",75,0)
 S TIU("Tiu","clinicId")=$G(TIUARR(FNBR1,IENS1,1203,"I"))
"RTN","SYNDHP24",76,0)
 S TIU("Tiu","expectedSigner")=$G(TIUARR(FNBR1,IENS1,1204,"E"))
"RTN","SYNDHP24",77,0)
 S TIU("Tiu","expectedSignerId")=$G(TIUARR(FNBR1,IENS1,1204,"I"))
"RTN","SYNDHP24",78,0)
 S TIU("Tiu","hospitalLocation")=$G(TIUARR(FNBR1,IENS1,1205,"E"))
"RTN","SYNDHP24",79,0)
 S TIU("Tiu","hospitalLocationId")=$G(TIUARR(FNBR1,IENS1,1205,"I"))
"RTN","SYNDHP24",80,0)
 S TIU("Tiu","serviceCreditStop")=$G(TIUARR(FNBR1,IENS1,1206,"E"))
"RTN","SYNDHP24",81,0)
 S TIU("Tiu","serviceCreditStopId")=$G(TIUARR(FNBR1,IENS1,1206,"I"))
"RTN","SYNDHP24",82,0)
 S TIU("Tiu","secondaryVisit")=$G(TIUARR(FNBR1,IENS1,1207,"E"))
"RTN","SYNDHP24",83,0)
 S TIU("Tiu","secondaryVisitId")=$G(TIUARR(FNBR1,IENS1,1207,"I"))
"RTN","SYNDHP24",84,0)
 S TIU("Tiu","expectedCosigner")=$G(TIUARR(FNBR1,IENS1,1208,"E"))
"RTN","SYNDHP24",85,0)
 S TIU("Tiu","expectedCosignerId")=$G(TIUARR(FNBR1,IENS1,1208,"I"))
"RTN","SYNDHP24",86,0)
 S TIU("Tiu","attendingPhysician")=$G(TIUARR(FNBR1,IENS1,1209,"E"))
"RTN","SYNDHP24",87,0)
 S TIU("Tiu","attendingPhysicianId")=$G(TIUARR(FNBR1,IENS1,1209,"I"))
"RTN","SYNDHP24",88,0)
 S TIU("Tiu","orderNumber")=$G(TIUARR(FNBR1,IENS1,1210,"E"))
"RTN","SYNDHP24",89,0)
 S TIU("Tiu","orderNumberId")=$G(TIUARR(FNBR1,IENS1,1210,"I"))
"RTN","SYNDHP24",90,0)
 S TIU("Tiu","visitLocation")=$G(TIUARR(FNBR1,IENS1,1211,"E"))
"RTN","SYNDHP24",91,0)
 S TIU("Tiu","visitLocationId")=$G(TIUARR(FNBR1,IENS1,1211,"I"))
"RTN","SYNDHP24",92,0)
 S TIU("Tiu","division")=$G(TIUARR(FNBR1,IENS1,1212,"E"))
"RTN","SYNDHP24",93,0)
 S TIU("Tiu","divisionId")=$G(TIUARR(FNBR1,IENS1,1212,"I"))
"RTN","SYNDHP24",94,0)
 S TIU("Tiu","referenceDate")=$G(TIUARR(FNBR1,IENS1,1301,"E"))
"RTN","SYNDHP24",95,0)
 S TIU("Tiu","referenceDateFM")=$G(TIUARR(FNBR1,IENS1,1301,"I"))
"RTN","SYNDHP24",96,0)
 S TIU("Tiu","referenceDateHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1301,"I")))
"RTN","SYNDHP24",97,0)
 S TIU("Tiu","referenceDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1301,"I")))
"RTN","SYNDHP24",98,0)
 S TIU("Tiu","enteredBy")=$G(TIUARR(FNBR1,IENS1,1302,"E"))
"RTN","SYNDHP24",99,0)
 S TIU("Tiu","enteredById")=$G(TIUARR(FNBR1,IENS1,1302,"I"))
"RTN","SYNDHP24",100,0)
 S TIU("Tiu","captureMethod")=$G(TIUARR(FNBR1,IENS1,1303,"E"))
"RTN","SYNDHP24",101,0)
 S TIU("Tiu","captureMethodCd")=$G(TIUARR(FNBR1,IENS1,1303,"I"))
"RTN","SYNDHP24",102,0)
 S TIU("Tiu","releaseDateTime")=$G(TIUARR(FNBR1,IENS1,1304,"E"))
"RTN","SYNDHP24",103,0)
 S TIU("Tiu","releaseDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1304,"I"))
"RTN","SYNDHP24",104,0)
 S TIU("Tiu","releaseDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1304,"I")))
"RTN","SYNDHP24",105,0)
 S TIU("Tiu","releaseDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1304,"I")))
"RTN","SYNDHP24",106,0)
 S TIU("Tiu","verificationDateTime")=$G(TIUARR(FNBR1,IENS1,1305,"E"))
"RTN","SYNDHP24",107,0)
 S TIU("Tiu","verificationDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1305,"I"))
"RTN","SYNDHP24",108,0)
 S TIU("Tiu","verificationDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1305,"I")))
"RTN","SYNDHP24",109,0)
 S TIU("Tiu","verificationDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1305,"I")))
"RTN","SYNDHP24",110,0)
 S TIU("Tiu","verifiedBy")=$G(TIUARR(FNBR1,IENS1,1306,"E"))
"RTN","SYNDHP24",111,0)
 S TIU("Tiu","verifiedById")=$G(TIUARR(FNBR1,IENS1,1306,"I"))
"RTN","SYNDHP24",112,0)
 S TIU("Tiu","dictationDate")=$G(TIUARR(FNBR1,IENS1,1307,"E"))
"RTN","SYNDHP24",113,0)
 S TIU("Tiu","dictationDateFM")=$G(TIUARR(FNBR1,IENS1,1307,"I"))
"RTN","SYNDHP24",114,0)
 S TIU("Tiu","dictationDateHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1307,"I")))
"RTN","SYNDHP24",115,0)
 S TIU("Tiu","dictationDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1307,"I")))
"RTN","SYNDHP24",116,0)
 S TIU("Tiu","suspenseDateTime")=$G(TIUARR(FNBR1,IENS1,1308,"E"))
"RTN","SYNDHP24",117,0)
 S TIU("Tiu","suspenseDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1308,"I"))
"RTN","SYNDHP24",118,0)
 S TIU("Tiu","suspenseDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1308,"I")))
"RTN","SYNDHP24",119,0)
 S TIU("Tiu","suspenseDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1308,"I")))
"RTN","SYNDHP24",120,0)
 S TIU("Tiu","patientMovementRecord")=$G(TIUARR(FNBR1,IENS1,1401,"E"))
"RTN","SYNDHP24",121,0)
 S TIU("Tiu","patientMovementRecordId")=$G(TIUARR(FNBR1,IENS1,1401,"I"))
"RTN","SYNDHP24",122,0)
 S TIU("Tiu","treatingSpecialty")=$G(TIUARR(FNBR1,IENS1,1402,"E"))
"RTN","SYNDHP24",123,0)
 S TIU("Tiu","treatingSpecialtyId")=$G(TIUARR(FNBR1,IENS1,1402,"I"))
"RTN","SYNDHP24",124,0)
 S TIU("Tiu","irtRecord")=$G(TIUARR(FNBR1,IENS1,1403,"E"))
"RTN","SYNDHP24",125,0)
 S TIU("Tiu","irtRecordId")=$G(TIUARR(FNBR1,IENS1,1403,"I"))
"RTN","SYNDHP24",126,0)
 S TIU("Tiu","service")=$G(TIUARR(FNBR1,IENS1,1404,"E"))
"RTN","SYNDHP24",127,0)
 S TIU("Tiu","serviceId")=$G(TIUARR(FNBR1,IENS1,1404,"I"))
"RTN","SYNDHP24",128,0)
 S TIU("Tiu","requestingPackageReference")=$G(TIUARR(FNBR1,IENS1,1405,"E"))
"RTN","SYNDHP24",129,0)
 S TIU("Tiu","requestingPackageReferenceId")=$G(TIUARR(FNBR1,IENS1,1405,"I"))
"RTN","SYNDHP24",130,0)
 S TIU("Tiu","retractedOriginal")=$G(TIUARR(FNBR1,IENS1,1406,"E"))
"RTN","SYNDHP24",131,0)
 S TIU("Tiu","retractedOriginalId")=$G(TIUARR(FNBR1,IENS1,1406,"I"))
"RTN","SYNDHP24",132,0)
 S TIU("Tiu","prfFlagAction")=$G(TIUARR(FNBR1,IENS1,1407,"E"))
"RTN","SYNDHP24",133,0)
 S TIU("Tiu","signatureDateTime")=$G(TIUARR(FNBR1,IENS1,1501,"E"))
"RTN","SYNDHP24",134,0)
 S TIU("Tiu","signatureDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1501,"I"))
"RTN","SYNDHP24",135,0)
 S TIU("Tiu","signatureDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1501,"I")))
"RTN","SYNDHP24",136,0)
 S TIU("Tiu","signatureDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1501,"I")))
"RTN","SYNDHP24",137,0)
 S TIU("Tiu","signedBy")=$G(TIUARR(FNBR1,IENS1,1502,"E"))
"RTN","SYNDHP24",138,0)
 S TIU("Tiu","signedById")=$G(TIUARR(FNBR1,IENS1,1502,"I"))
"RTN","SYNDHP24",139,0)
 S TIU("Tiu","signatureBlockName")=$G(TIUARR(FNBR1,IENS1,1503,"E"))
"RTN","SYNDHP24",140,0)
 S TIU("Tiu","signatureBlockTitle")=$G(TIUARR(FNBR1,IENS1,1504,"E"))
"RTN","SYNDHP24",141,0)
 S TIU("Tiu","signatureMode")=$G(TIUARR(FNBR1,IENS1,1505,"E"))
"RTN","SYNDHP24",142,0)
 S TIU("Tiu","signatureModeCd")=$G(TIUARR(FNBR1,IENS1,1505,"I"))
"RTN","SYNDHP24",143,0)
 S TIU("Tiu","cosignatureNeeded")=$G(TIUARR(FNBR1,IENS1,1506,"E"))
"RTN","SYNDHP24",144,0)
 S TIU("Tiu","cosignatureNeededCd")=$G(TIUARR(FNBR1,IENS1,1506,"I"))
"RTN","SYNDHP24",145,0)
 S TIU("Tiu","cosignatureDateTime")=$G(TIUARR(FNBR1,IENS1,1507,"E"))
"RTN","SYNDHP24",146,0)
 S TIU("Tiu","cosignatureDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1507,"I"))
"RTN","SYNDHP24",147,0)
 S TIU("Tiu","cosignatureDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1507,"I")))
"RTN","SYNDHP24",148,0)
 S TIU("Tiu","cosignatureDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1507,"I")))
"RTN","SYNDHP24",149,0)
 S TIU("Tiu","cosignedBy")=$G(TIUARR(FNBR1,IENS1,1508,"E"))
"RTN","SYNDHP24",150,0)
 S TIU("Tiu","cosignedById")=$G(TIUARR(FNBR1,IENS1,1508,"I"))
"RTN","SYNDHP24",151,0)
 S TIU("Tiu","cosignatureBlockName")=$G(TIUARR(FNBR1,IENS1,1509,"E"))
"RTN","SYNDHP24",152,0)
 S TIU("Tiu","cosignatureBlockTitle")=$G(TIUARR(FNBR1,IENS1,1510,"E"))
"RTN","SYNDHP24",153,0)
 S TIU("Tiu","cosignatureMode")=$G(TIUARR(FNBR1,IENS1,1511,"E"))
"RTN","SYNDHP24",154,0)
 S TIU("Tiu","cosignatureModeCd")=$G(TIUARR(FNBR1,IENS1,1511,"I"))
"RTN","SYNDHP24",155,0)
 S TIU("Tiu","markedSignedOnChartBy")=$G(TIUARR(FNBR1,IENS1,1512,"E"))
"RTN","SYNDHP24",156,0)
 S TIU("Tiu","markedSignedOnChartById")=$G(TIUARR(FNBR1,IENS1,1512,"I"))
"RTN","SYNDHP24",157,0)
 S TIU("Tiu","markedCosignedOnChartBy")=$G(TIUARR(FNBR1,IENS1,1513,"E"))
"RTN","SYNDHP24",158,0)
 S TIU("Tiu","markedCosignedOnChartById")=$G(TIUARR(FNBR1,IENS1,1513,"I"))
"RTN","SYNDHP24",159,0)
 S TIU("Tiu","amendmentDateTime")=$G(TIUARR(FNBR1,IENS1,1601,"E"))
"RTN","SYNDHP24",160,0)
 S TIU("Tiu","amendmentDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1601,"I"))
"RTN","SYNDHP24",161,0)
 S TIU("Tiu","amendmentDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1601,"I")))
"RTN","SYNDHP24",162,0)
 S TIU("Tiu","amendmentDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1601,"I")))
"RTN","SYNDHP24",163,0)
 S TIU("Tiu","amendedBy")=$G(TIUARR(FNBR1,IENS1,1602,"E"))
"RTN","SYNDHP24",164,0)
 S TIU("Tiu","amendedById")=$G(TIUARR(FNBR1,IENS1,1602,"I"))
"RTN","SYNDHP24",165,0)
 S TIU("Tiu","amendmentSigned")=$G(TIUARR(FNBR1,IENS1,1603,"E"))
"RTN","SYNDHP24",166,0)
 S TIU("Tiu","amendmentSignedFM")=$G(TIUARR(FNBR1,IENS1,1603,"I"))
"RTN","SYNDHP24",167,0)
 S TIU("Tiu","amendmentSignedHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1603,"I")))
"RTN","SYNDHP24",168,0)
 S TIU("Tiu","amendmentSignedFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1603,"I")))
"RTN","SYNDHP24",169,0)
 S TIU("Tiu","amendmentSignBlockName")=$G(TIUARR(FNBR1,IENS1,1604,"E"))
"RTN","SYNDHP24",170,0)
 S TIU("Tiu","amendmentSignBlockTitle")=$G(TIUARR(FNBR1,IENS1,1605,"E"))
"RTN","SYNDHP24",171,0)
 S TIU("Tiu","administrativeClosureDate")=$G(TIUARR(FNBR1,IENS1,1606,"E"))
"RTN","SYNDHP24",172,0)
 S TIU("Tiu","administrativeClosureDateFM")=$G(TIUARR(FNBR1,IENS1,1606,"I"))
"RTN","SYNDHP24",173,0)
 S TIU("Tiu","administrativeClosureDateHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1606,"I")))
"RTN","SYNDHP24",174,0)
 S TIU("Tiu","administrativeClosureDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1606,"I")))
"RTN","SYNDHP24",175,0)
 S TIU("Tiu","adminClosureSigBlockName")=$G(TIUARR(FNBR1,IENS1,1607,"E"))
"RTN","SYNDHP24",176,0)
 S TIU("Tiu","adminClosureSigBlockTitle")=$G(TIUARR(FNBR1,IENS1,1608,"E"))
"RTN","SYNDHP24",177,0)
 S TIU("Tiu","archivePurgeDateTime")=$G(TIUARR(FNBR1,IENS1,1609,"E"))
"RTN","SYNDHP24",178,0)
 S TIU("Tiu","archivePurgeDateTimeFM")=$G(TIUARR(FNBR1,IENS1,1609,"I"))
"RTN","SYNDHP24",179,0)
 S TIU("Tiu","archivePurgeDateTimeHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1609,"I")))
"RTN","SYNDHP24",180,0)
 S TIU("Tiu","archivePurgeDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1609,"I")))
"RTN","SYNDHP24",181,0)
 S TIU("Tiu","deletedBy")=$G(TIUARR(FNBR1,IENS1,1610,"E"))
"RTN","SYNDHP24",182,0)
 S TIU("Tiu","deletedById")=$G(TIUARR(FNBR1,IENS1,1610,"I"))
"RTN","SYNDHP24",183,0)
 S TIU("Tiu","deletionDate")=$G(TIUARR(FNBR1,IENS1,1611,"E"))
"RTN","SYNDHP24",184,0)
 S TIU("Tiu","deletionDateFM")=$G(TIUARR(FNBR1,IENS1,1611,"I"))
"RTN","SYNDHP24",185,0)
 S TIU("Tiu","deletionDateHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,1611,"I")))
"RTN","SYNDHP24",186,0)
 S TIU("Tiu","deletionDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,1611,"I")))
"RTN","SYNDHP24",187,0)
 S TIU("Tiu","reasonForDeletion")=$G(TIUARR(FNBR1,IENS1,1612,"E"))
"RTN","SYNDHP24",188,0)
 S TIU("Tiu","reasonForDeletionCd")=$G(TIUARR(FNBR1,IENS1,1612,"I"))
"RTN","SYNDHP24",189,0)
 S TIU("Tiu","administrativeClosureMode")=$G(TIUARR(FNBR1,IENS1,1613,"E"))
"RTN","SYNDHP24",190,0)
 S TIU("Tiu","administrativeClosureModeCd")=$G(TIUARR(FNBR1,IENS1,1613,"I"))
"RTN","SYNDHP24",191,0)
 S TIU("Tiu","subjectOptionalDescription")=$G(TIUARR(FNBR1,IENS1,1701,"E"))
"RTN","SYNDHP24",192,0)
 S TIU("Tiu","vbcLineCount")=$G(TIUARR(FNBR1,IENS1,1801,"E"))
"RTN","SYNDHP24",193,0)
 S TIU("Tiu","idParent")=$G(TIUARR(FNBR1,IENS1,2101,"E"))
"RTN","SYNDHP24",194,0)
 S TIU("Tiu","idParentId")=$G(TIUARR(FNBR1,IENS1,2101,"I"))
"RTN","SYNDHP24",195,0)
 S TIU("Tiu","visitId")=$G(TIUARR(FNBR1,IENS1,15001,"E"))
"RTN","SYNDHP24",196,0)
 S TIU("Tiu","procedureSummaryCode")=$G(TIUARR(FNBR1,IENS1,70201,"E"))
"RTN","SYNDHP24",197,0)
 S TIU("Tiu","procedureSummaryCodeCd")=$G(TIUARR(FNBR1,IENS1,70201,"I"))
"RTN","SYNDHP24",198,0)
 S TIU("Tiu","dateTimePerformed")=$G(TIUARR(FNBR1,IENS1,70202,"E"))
"RTN","SYNDHP24",199,0)
 S TIU("Tiu","dateTimePerformedFM")=$G(TIUARR(FNBR1,IENS1,70202,"I"))
"RTN","SYNDHP24",200,0)
 S TIU("Tiu","dateTimePerformedHL7")=$$FMTHL7^XLFDT($G(TIUARR(FNBR1,IENS1,70202,"I")))
"RTN","SYNDHP24",201,0)
 S TIU("Tiu","dateTimePerformedFHIR")=$$FMTFHIR^SYNDHPUTL($G(TIUARR(FNBR1,IENS1,70202,"I")))
"RTN","SYNDHP24",202,0)
 S TIU("Tiu","vhaEnterpriseStandardTitle")=$G(TIUARR(FNBR1,IENS1,89261,"E"))
"RTN","SYNDHP24",203,0)
 ;
"RTN","SYNDHP24",204,0)
 ;
"RTN","SYNDHP24",205,0)
 ;I $G(DEBUG) W ! ZWRITE TIU
"RTN","SYNDHP24",206,0)
 ;
"RTN","SYNDHP24",207,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.TIU,.TIUJ)
"RTN","SYNDHP24",208,0)
 ;
"RTN","SYNDHP24",209,0)
 QUIT
"RTN","SYNDHP24",210,0)
 ;
"RTN","SYNDHP25")
0^118^B68600664
"RTN","SYNDHP25",1,0)
SYNDHP25 ; HC/art - HealthConcourse - get patient appointment data ;05/08/2019
"RTN","SYNDHP25",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP25",3,0)
 ;;
"RTN","SYNDHP25",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP25",5,0)
 ;
"RTN","SYNDHP25",6,0)
 QUIT
"RTN","SYNDHP25",7,0)
 ;
"RTN","SYNDHP25",8,0)
 ;-------------------------------------------------------------
"RTN","SYNDHP25",9,0)
 ;
"RTN","SYNDHP25",10,0)
GETPATAPPT(PATAPPT,PATIEN,RETJSON,PATAPPTJ) ;get patient appointment records
"RTN","SYNDHP25",11,0)
 ;inputs: PATIEN - Patient IEN
"RTN","SYNDHP25",12,0)
 ;        RETJSON - J = Return JSON
"RTN","SYNDHP25",13,0)
 ;output: PATAPPT  - array of patient appointment data, by reference
"RTN","SYNDHP25",14,0)
 ;        PATAPPTJ - JSON structure of patient appointment data, by reference
"RTN","SYNDHP25",15,0)
 ;
"RTN","SYNDHP25",16,0)
 I $G(DEBUG) W !,"--------------------------- patient appointments -----------------------------",!
"RTN","SYNDHP25",17,0)
 N S S S="_"
"RTN","SYNDHP25",18,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP25",19,0)
 N FNBR1 S FNBR1=2 ;PATIENT
"RTN","SYNDHP25",20,0)
 N FNBR2 S FNBR2=2.98 ;APPOINTMENT
"RTN","SYNDHP25",21,0)
 N IENS1 S IENS1=PATIEN_","
"RTN","SYNDHP25",22,0)
 N FIELDS S FIELDS=".01:.03;.09;991.1;1900*"
"RTN","SYNDHP25",23,0)
 ;
"RTN","SYNDHP25",24,0)
 N PATAPPTARR,PATAPPTERR
"RTN","SYNDHP25",25,0)
 D GETS^DIQ(FNBR1,IENS1,FIELDS,"EI","PATAPPTARR","PATAPPTERR")
"RTN","SYNDHP25",26,0)
 I $G(DEBUG) W ! ZWRITE PATAPPTARR
"RTN","SYNDHP25",27,0)
 I $G(DEBUG),$D(PATAPPTERR) W !,">>ERROR<<" W ! ZWRITE PATAPPTERR
"RTN","SYNDHP25",28,0)
 I $D(PATAPPTERR) D  QUIT
"RTN","SYNDHP25",29,0)
 . S PATAPPT("Patappt","ERROR")=PATIEN
"RTN","SYNDHP25",30,0)
 . D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PATAPPT,.PATAPPTJ)
"RTN","SYNDHP25",31,0)
 S PATAPPT("Patappt","patIen")=PATIEN
"RTN","SYNDHP25",32,0)
 S PATAPPT("Patappt","resourceType")="Appointment"
"RTN","SYNDHP25",33,0)
 S PATAPPT("Patappt","resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIEN
"RTN","SYNDHP25",34,0)
 S PATAPPT("Patappt","name")=$G(PATAPPTARR(FNBR1,IENS1,.01,"E"))
"RTN","SYNDHP25",35,0)
 S PATAPPT("Patappt","sex")=$G(PATAPPTARR(FNBR1,IENS1,.02,"E"))
"RTN","SYNDHP25",36,0)
 S PATAPPT("Patappt","sexCd")=$G(PATAPPTARR(FNBR1,IENS1,.02,"I"))
"RTN","SYNDHP25",37,0)
 S PATAPPT("Patappt","genderFHIR")=$S(PATAPPT("Patappt","sexCd")="M":"male",PATAPPT("Patappt","sexCd")="F":"female",1:"unknown")
"RTN","SYNDHP25",38,0)
 S PATAPPT("Patappt","selfIdentifiedGender")=$G(PATAPPTARR(FNBR1,IENS1,.024,"E"))
"RTN","SYNDHP25",39,0)
 S PATAPPT("Patappt","selfIdentifiedGenderCd")=$G(PATAPPTARR(FNBR1,IENS1,.024,"I"))
"RTN","SYNDHP25",40,0)
 S PATAPPT("Patappt","dateOfBirth")=$G(PATAPPTARR(FNBR1,IENS1,.03,"E"))
"RTN","SYNDHP25",41,0)
 S PATAPPT("Patappt","dateOfBirthFM")=$G(PATAPPTARR(FNBR1,IENS1,.03,"I"))
"RTN","SYNDHP25",42,0)
 S PATAPPT("Patappt","dateOfBirthHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR1,IENS1,.03,"I")))
"RTN","SYNDHP25",43,0)
 S PATAPPT("Patappt","dateOfBirthFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR1,IENS1,.03,"I")))
"RTN","SYNDHP25",44,0)
 S PATAPPT("Patappt","socialSecurityNumber")=$G(PATAPPTARR(FNBR1,IENS1,.09,"E"))
"RTN","SYNDHP25",45,0)
 S PATAPPT("Patappt","fullIcn")=$G(PATAPPTARR(FNBR1,IENS1,991.1,"E"))
"RTN","SYNDHP25",46,0)
 N IENS2 S IENS2=""
"RTN","SYNDHP25",47,0)
 F  S IENS2=$O(PATAPPTARR(FNBR2,IENS2)) QUIT:IENS2=""  D
"RTN","SYNDHP25",48,0)
 . N APPOINT S APPOINT=$NA(PATAPPT("Patappt","appointments","appointment",+IENS2))
"RTN","SYNDHP25",49,0)
 . S @APPOINT@("appointmentDateTime")=$G(PATAPPTARR(FNBR2,IENS2,.001,"E"))
"RTN","SYNDHP25",50,0)
 . S @APPOINT@("appointmentDateTimeFM")=$G(PATAPPTARR(FNBR2,IENS2,.001,"I"))
"RTN","SYNDHP25",51,0)
 . S @APPOINT@("appointmentDateTimeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,.001,"I")))
"RTN","SYNDHP25",52,0)
 . S @APPOINT@("appointmentDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,.001,"I")))
"RTN","SYNDHP25",53,0)
 . S @APPOINT@("clinic")=$G(PATAPPTARR(FNBR2,IENS2,.01,"E"))
"RTN","SYNDHP25",54,0)
 . S @APPOINT@("clinicId")=$G(PATAPPTARR(FNBR2,IENS2,.01,"I"))
"RTN","SYNDHP25",55,0)
 . S @APPOINT@("telephoneOfClinic")=$G(PATAPPTARR(FNBR2,IENS2,.02,"E"))
"RTN","SYNDHP25",56,0)
 . S @APPOINT@("status")=$G(PATAPPTARR(FNBR2,IENS2,3,"E"))
"RTN","SYNDHP25",57,0)
 . S @APPOINT@("statusCd")=$G(PATAPPTARR(FNBR2,IENS2,3,"I"))
"RTN","SYNDHP25",58,0)
 . N STATUS S STATUS=$G(PATAPPTARR(FNBR2,IENS2,3,"I"))
"RTN","SYNDHP25",59,0)
 . S @APPOINT@("statusFHIR")=$S(STATUS="":"booked",STATUS["C":"cancelled",STATUS="I":"booked",STATUS="N":"noshow",STATUS="NA":"noshow",STATUS="NT":"booked",1:"entered-in-error")
"RTN","SYNDHP25",60,0)
 . S @APPOINT@("realAppointment")=$G(PATAPPTARR(FNBR2,IENS2,4,"E"))
"RTN","SYNDHP25",61,0)
 . S @APPOINT@("labDateTime")=$G(PATAPPTARR(FNBR2,IENS2,5,"E"))
"RTN","SYNDHP25",62,0)
 . S @APPOINT@("labDateTimeFM")=$G(PATAPPTARR(FNBR2,IENS2,5,"I"))
"RTN","SYNDHP25",63,0)
 . S @APPOINT@("labDateTimeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,5,"I")))
"RTN","SYNDHP25",64,0)
 . S @APPOINT@("labDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,5,"I")))
"RTN","SYNDHP25",65,0)
 . S @APPOINT@("xRayDateTime")=$G(PATAPPTARR(FNBR2,IENS2,6,"E"))
"RTN","SYNDHP25",66,0)
 . S @APPOINT@("xRayDateTimeFM")=$G(PATAPPTARR(FNBR2,IENS2,6,"I"))
"RTN","SYNDHP25",67,0)
 . S @APPOINT@("xRayDateTimeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,6,"I")))
"RTN","SYNDHP25",68,0)
 . S @APPOINT@("xRayDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,6,"I")))
"RTN","SYNDHP25",69,0)
 . S @APPOINT@("ekgDateTime")=$G(PATAPPTARR(FNBR2,IENS2,7,"E"))
"RTN","SYNDHP25",70,0)
 . S @APPOINT@("ekgDateTimeFM")=$G(PATAPPTARR(FNBR2,IENS2,7,"I"))
"RTN","SYNDHP25",71,0)
 . S @APPOINT@("ekgDateTimeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,7,"I")))
"RTN","SYNDHP25",72,0)
 . S @APPOINT@("ekgDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,7,"I")))
"RTN","SYNDHP25",73,0)
 . S @APPOINT@("routingSlipPrinted")=$G(PATAPPTARR(FNBR2,IENS2,8,"E"))
"RTN","SYNDHP25",74,0)
 . S @APPOINT@("routingSlipPrintedCd")=$G(PATAPPTARR(FNBR2,IENS2,8,"I"))
"RTN","SYNDHP25",75,0)
 . S @APPOINT@("routingSlipPrintDate")=$G(PATAPPTARR(FNBR2,IENS2,8.5,"E"))
"RTN","SYNDHP25",76,0)
 . S @APPOINT@("routingSlipPrintDateFM")=$G(PATAPPTARR(FNBR2,IENS2,8.5,"I"))
"RTN","SYNDHP25",77,0)
 . S @APPOINT@("routingSlipPrintDateHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,8.5,"I")))
"RTN","SYNDHP25",78,0)
 . S @APPOINT@("routingSlipPrintDateFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,8.5,"I")))
"RTN","SYNDHP25",79,0)
 . S @APPOINT@("purposeOfVisit")=$G(PATAPPTARR(FNBR2,IENS2,9,"E"))
"RTN","SYNDHP25",80,0)
 . S @APPOINT@("purposeOfVisitCd")=$G(PATAPPTARR(FNBR2,IENS2,9,"I"))
"RTN","SYNDHP25",81,0)
 . N POV S POV=$G(PATAPPTARR(FNBR2,IENS2,9,"I"))
"RTN","SYNDHP25",82,0)
 . S @APPOINT@("appointmentTypeFHIR")=$S(POV="4":"WALKIN",1:"ROUTINE")
"RTN","SYNDHP25",83,0)
 . S @APPOINT@("appointmentType")=$G(PATAPPTARR(FNBR2,IENS2,9.5,"E"))
"RTN","SYNDHP25",84,0)
 . S @APPOINT@("appointmentTypeId")=$G(PATAPPTARR(FNBR2,IENS2,9.5,"I"))
"RTN","SYNDHP25",85,0)
 . S @APPOINT@("specialSurveyDisposition")=$G(PATAPPTARR(FNBR2,IENS2,10,"E"))
"RTN","SYNDHP25",86,0)
 . S @APPOINT@("numberOfCollateralSeen")=$G(PATAPPTARR(FNBR2,IENS2,11,"E"))
"RTN","SYNDHP25",87,0)
 . S @APPOINT@("autoRebookedApptDateTime")=$G(PATAPPTARR(FNBR2,IENS2,12,"E"))
"RTN","SYNDHP25",88,0)
 . S @APPOINT@("autoRebookedApptDateTimeFM")=$G(PATAPPTARR(FNBR2,IENS2,12,"I"))
"RTN","SYNDHP25",89,0)
 . S @APPOINT@("autoRebookedApptDateTimeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,12,"I")))
"RTN","SYNDHP25",90,0)
 . S @APPOINT@("autoRebookedApptDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,12,"I")))
"RTN","SYNDHP25",91,0)
 . S @APPOINT@("collateralVisit")=$G(PATAPPTARR(FNBR2,IENS2,13,"E"))
"RTN","SYNDHP25",92,0)
 . S @APPOINT@("collateralVisitCd")=$G(PATAPPTARR(FNBR2,IENS2,13,"I"))
"RTN","SYNDHP25",93,0)
 . S @APPOINT@("noShowCancelledBy")=$G(PATAPPTARR(FNBR2,IENS2,14,"E"))
"RTN","SYNDHP25",94,0)
 . S @APPOINT@("noShowCancelledById")=$G(PATAPPTARR(FNBR2,IENS2,14,"I"))
"RTN","SYNDHP25",95,0)
 . S @APPOINT@("noShowCancelDateTime")=$G(PATAPPTARR(FNBR2,IENS2,15,"E"))
"RTN","SYNDHP25",96,0)
 . S @APPOINT@("noShowCancelDateTimeFM")=$G(PATAPPTARR(FNBR2,IENS2,15,"I"))
"RTN","SYNDHP25",97,0)
 . S @APPOINT@("noShowCancelDateTimeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,15,"I")))
"RTN","SYNDHP25",98,0)
 . S @APPOINT@("noShowCancelDateTimeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,15,"I")))
"RTN","SYNDHP25",99,0)
 . S @APPOINT@("cancellationReason")=$G(PATAPPTARR(FNBR2,IENS2,16,"E"))
"RTN","SYNDHP25",100,0)
 . S @APPOINT@("cancellationReasonId")=$G(PATAPPTARR(FNBR2,IENS2,16,"I"))
"RTN","SYNDHP25",101,0)
 . S @APPOINT@("cancellationRemarks")=$G(PATAPPTARR(FNBR2,IENS2,17,"E"))
"RTN","SYNDHP25",102,0)
 . S @APPOINT@("apptCancelled")=$G(PATAPPTARR(FNBR2,IENS2,18,"E"))
"RTN","SYNDHP25",103,0)
 . S @APPOINT@("apptCancelledId")=$G(PATAPPTARR(FNBR2,IENS2,18,"I"))
"RTN","SYNDHP25",104,0)
 . S @APPOINT@("dataEntryClerk")=$G(PATAPPTARR(FNBR2,IENS2,19,"E"))
"RTN","SYNDHP25",105,0)
 . S @APPOINT@("dataEntryClerkId")=$G(PATAPPTARR(FNBR2,IENS2,19,"I"))
"RTN","SYNDHP25",106,0)
 . S @APPOINT@("dateApptMade")=$G(PATAPPTARR(FNBR2,IENS2,20,"E"))
"RTN","SYNDHP25",107,0)
 . S @APPOINT@("dateApptMadeFM")=$G(PATAPPTARR(FNBR2,IENS2,20,"I"))
"RTN","SYNDHP25",108,0)
 . S @APPOINT@("dateApptMadeHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,20,"I")))
"RTN","SYNDHP25",109,0)
 . S @APPOINT@("dateApptMadeFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,20,"I")))
"RTN","SYNDHP25",110,0)
 . S @APPOINT@("outpatientEncounter")=$G(PATAPPTARR(FNBR2,IENS2,21,"E"))
"RTN","SYNDHP25",111,0)
 . S @APPOINT@("outpatientEncounterId")=$G(PATAPPTARR(FNBR2,IENS2,21,"I"))
"RTN","SYNDHP25",112,0)
 . S @APPOINT@("encounterFormsPrinted")=$G(PATAPPTARR(FNBR2,IENS2,22,"E"))
"RTN","SYNDHP25",113,0)
 . S @APPOINT@("encounterFormsPrintedCd")=$G(PATAPPTARR(FNBR2,IENS2,22,"I"))
"RTN","SYNDHP25",114,0)
 . S @APPOINT@("encounterFormsAsAddOns")=$G(PATAPPTARR(FNBR2,IENS2,23,"E"))
"RTN","SYNDHP25",115,0)
 . S @APPOINT@("encounterFormsAsAddOnsCd")=$G(PATAPPTARR(FNBR2,IENS2,23,"I"))
"RTN","SYNDHP25",116,0)
 . S @APPOINT@("encounterConversionStatus")=$G(PATAPPTARR(FNBR2,IENS2,23.1,"E"))
"RTN","SYNDHP25",117,0)
 . S @APPOINT@("encounterConversionStatusCd")=$G(PATAPPTARR(FNBR2,IENS2,23.1,"I"))
"RTN","SYNDHP25",118,0)
 . S @APPOINT@("appointmentTypeSubCategory")=$G(PATAPPTARR(FNBR2,IENS2,24,"E"))
"RTN","SYNDHP25",119,0)
 . S @APPOINT@("appointmentTypeSubCategoryId")=$G(PATAPPTARR(FNBR2,IENS2,24,"I"))
"RTN","SYNDHP25",120,0)
 . S @APPOINT@("schedulingRequestType")=$G(PATAPPTARR(FNBR2,IENS2,25,"E"))
"RTN","SYNDHP25",121,0)
 . S @APPOINT@("schedulingRequestTypeCd")=$G(PATAPPTARR(FNBR2,IENS2,25,"I"))
"RTN","SYNDHP25",122,0)
 . S @APPOINT@("nextAvaApptIndicator")=$G(PATAPPTARR(FNBR2,IENS2,26,"E"))
"RTN","SYNDHP25",123,0)
 . S @APPOINT@("nextAvaApptIndicatorCd")=$G(PATAPPTARR(FNBR2,IENS2,26,"I"))
"RTN","SYNDHP25",124,0)
 . S @APPOINT@("desiredDateOfAppointment")=$G(PATAPPTARR(FNBR2,IENS2,27,"E"))
"RTN","SYNDHP25",125,0)
 . S @APPOINT@("desiredDateOfAppointmentFM")=$G(PATAPPTARR(FNBR2,IENS2,27,"I"))
"RTN","SYNDHP25",126,0)
 . S @APPOINT@("desiredDateOfAppointmentHL7")=$$FMTHL7^XLFDT($G(PATAPPTARR(FNBR2,IENS2,27,"I")))
"RTN","SYNDHP25",127,0)
 . S @APPOINT@("desiredDateOfAppointmentFHIR")=$$FMTFHIR^SYNDHPUTL($G(PATAPPTARR(FNBR2,IENS2,27,"I")))
"RTN","SYNDHP25",128,0)
 . S @APPOINT@("followUpVisit")=$G(PATAPPTARR(FNBR2,IENS2,28,"E"))
"RTN","SYNDHP25",129,0)
 . S @APPOINT@("followUpVisitCd")=$G(PATAPPTARR(FNBR2,IENS2,28,"I"))
"RTN","SYNDHP25",130,0)
 . S @APPOINT@("currentStatus")=$G(PATAPPTARR(FNBR2,IENS2,100,"E"))
"RTN","SYNDHP25",131,0)
 . S @APPOINT@("resourceId")=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIEN_S_FNBR2_S_+IENS2
"RTN","SYNDHP25",132,0)
 ;
"RTN","SYNDHP25",133,0)
 ;I $G(DEBUG) W ! ZWRITE PATAPPT
"RTN","SYNDHP25",134,0)
 ;
"RTN","SYNDHP25",135,0)
 D:$G(RETJSON)="J" TOJASON^SYNDHPUTL(.PATAPPT,.PATAPPTJ)
"RTN","SYNDHP25",136,0)
 ;
"RTN","SYNDHP25",137,0)
 QUIT
"RTN","SYNDHP25",138,0)
 ;
"RTN","SYNDHP40")
0^106^B22154311
"RTN","SYNDHP40",1,0)
SYNDHP40 ; HC/fjf/art - HealthConcourse - retrieve patient encounters ;05/04/2019
"RTN","SYNDHP40",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP40",3,0)
 ;;
"RTN","SYNDHP40",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP40",5,0)
 ;
"RTN","SYNDHP40",6,0)
 QUIT
"RTN","SYNDHP40",7,0)
 ;
"RTN","SYNDHP40",8,0)
 ; ---------------- Get patient encounters ----------------------------
"RTN","SYNDHP40",9,0)
 ;
"RTN","SYNDHP40",10,0)
PATENCI(RETSTA,DHPICN,FRDAT,TODAT) ; Patient primary encounters for ICN
"RTN","SYNDHP40",11,0)
 ;
"RTN","SYNDHP40",12,0)
 ; Return primary encounters/visits for a given patient ICN
"RTN","SYNDHP40",13,0)
 ;
"RTN","SYNDHP40",14,0)
 ; Input:
"RTN","SYNDHP40",15,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP40",16,0)
 ;   FRDAT   - from date (inclusive), optional, compared to .01 VISIT/ADMIT DATE&TIME
"RTN","SYNDHP40",17,0)
 ;   TODAT   - to date (inclusive), optional, compared to .01 VISIT/ADMIT DATE&TIME
"RTN","SYNDHP40",18,0)
 ; Output:
"RTN","SYNDHP40",19,0)
 ;   RETSTA  - a delimited string that lists the following information
"RTN","SYNDHP40",20,0)
 ;      PatientICN ^ RESOURSE ID ^ TYPE ^ ENCOUNTER DATE ^ REASON ^ ICD DIAGNOSIS CODE ; ICD DIAGNOSIS NAME 
"RTN","SYNDHP40",21,0)
 ;      ^ SERVICE CATEGORY ^ SOURCE ^  
"RTN","SYNDHP40",22,0)
 ;      ^ LOCATION OF ENCOUNTER , LOCATION ADDRESS SEPARATED BY SEMICOLONS ^ HOSPITAL LOCATION
"RTN","SYNDHP40",23,0)
 ;      ^ PROVIDER(S) SEPARATED BY SEMICOLONS
"RTN","SYNDHP40",24,0)
 ;
"RTN","SYNDHP40",25,0)
 ;   Identifier will be "V_"_SITE ID_"_"_FILE #_"_"_FILE IEN   i.e. V_500_9000010_930
"RTN","SYNDHP40",26,0)
 ;
"RTN","SYNDHP40",27,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP40",28,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP40",29,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP40",30,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP40",31,0)
 ;
"RTN","SYNDHP40",32,0)
 ; validate ICN
"RTN","SYNDHP40",33,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP40",34,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP40",35,0)
 ;
"RTN","SYNDHP40",36,0)
 N C,ACU,P,S,IDENT,ENCDT,ENCDTI,TYPE,SERV,SOURCE,LOC,HLOC,LOCI,LOCD,LOCA,SITE,CONIEN
"RTN","SYNDHP40",37,0)
 N DIAGC,DIAGN,ENFLG,DATEN,DISD,PROV,REASON,PROV,PROV1,PATIEN,RETDESC,PERIOD,PERIODFM
"RTN","SYNDHP40",38,0)
 N DIEN
"RTN","SYNDHP40",39,0)
 S C=",",P="|",S=";"
"RTN","SYNDHP40",40,0)
 S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP40",41,0)
 ;
"RTN","SYNDHP40",42,0)
 ; get patient IEN from ICN
"RTN","SYNDHP40",43,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP40",44,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP40",45,0)
 S RETDESC=""
"RTN","SYNDHP40",46,0)
 ;
"RTN","SYNDHP40",47,0)
 S DIEN=""
"RTN","SYNDHP40",48,0)
 F  S DIEN=$O(^AUPNVSIT("C",PATIEN,DIEN)) QUIT:DIEN=""  D
"RTN","SYNDHP40",49,0)
 . N VISITX,VISITE
"RTN","SYNDHP40",50,0)
 . D GETS^DIQ(9000010,DIEN_",",".01;.05;.06;.07;.22;15002;15003;81203","EIN","VISITX","VISITE")
"RTN","SYNDHP40",51,0)
 . QUIT:$D(VISITE)
"RTN","SYNDHP40",52,0)
 . I $G(VISITX(9000010,DIEN_",",15003,"I"))'="P" QUIT
"RTN","SYNDHP40",53,0)
 . N IDENT,PERIOD,ENCDTI,TYPE,SERV,SOURCE,LOC,HLOC,LOCI,LOCD,LOCA,CONIEN,DIAGC,DIAGN
"RTN","SYNDHP40",54,0)
 . N PDO,ENFLG,DATEN,DISD,PROV,REASON,DIAGC,PROV1,PROV
"RTN","SYNDHP40",55,0)
 . S IDENT=$$RESID^SYNDHP69("V",SITE)_"_9000010_"_DIEN
"RTN","SYNDHP40",56,0)
 . S PERIODFM=$G(VISITX(9000010,DIEN_",",.01,"I"))   ; encounter date/time
"RTN","SYNDHP40",57,0)
 . QUIT:((PERIODFM\1)<FRDAT)!((PERIODFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP40",58,0)
 . S PERIOD=$$FMTHL7^XLFDT($G(VISITX(9000010,DIEN_",",.01,"I")))   ; date/time, HL7 format
"RTN","SYNDHP40",59,0)
 . S ENCDTI=$P($G(VISITX(9000010,DIEN_",",.01,"I")),".",1)
"RTN","SYNDHP40",60,0)
 . S ENFLG=0,CONIEN=""
"RTN","SYNDHP40",61,0)
 . F  S CONIEN=$O(^AUPNPROB("AC",PATIEN,CONIEN)) QUIT:CONIEN=""  D  QUIT:ENFLG=1  ;get first diagnosis for patient
"RTN","SYNDHP40",62,0)
 .. S DATEN=$$GET1^DIQ(9000011,CONIEN_",",.08,"I") QUIT:DATEN'=$P($G(ENCDTI),".",1)  ;date/time must equal date entered
"RTN","SYNDHP40",63,0)
 .. S REASON=$$GET1^DIQ(9000011,CONIEN_",",1.01)   ; reason
"RTN","SYNDHP40",64,0)
 .. S DIAGC=$$GET1^DIQ(9000011,CONIEN_",",.01,"I") ; condition
"RTN","SYNDHP40",65,0)
 .. S DIAGN=$G(^ICD9(DIAGC,68,1,1))           ; diagnosis
"RTN","SYNDHP40",66,0)
 .. S ENFLG=1    ;set flag to know we have data and can move on
"RTN","SYNDHP40",67,0)
 . S:$D(VISITX(9000010,DIEN_",",15002,"E")) TYPE=$G(VISITX(9000010,DIEN_",",15002,"E"))    ; encounter type
"RTN","SYNDHP40",68,0)
 . S:$D(VISITX(9000010,DIEN_",",15003,"E")) DISD=$G(VISITX(9000010,DIEN_",",15003,"E"))    ; discharge disposition
"RTN","SYNDHP40",69,0)
 . S:$D(VISITX(9000010,DIEN_",",.06,"E")) LOC=$G(VISITX(9000010,DIEN_",",.06,"E")),LOCI=$G(VISITX(9000010,DIEN_",",.06,"I")) ; location
"RTN","SYNDHP40",70,0)
 . I $G(LOCI)'="" D
"RTN","SYNDHP40",71,0)
 .. S LOCD=$G(^DIC(4,LOCI,1))
"RTN","SYNDHP40",72,0)
 .. S LOCA=$P(LOCD,U,1)_S_$P(LOCD,U,2)_S_$P(LOCD,U,3)_S_$P(LOCD,U,4) ; location address
"RTN","SYNDHP40",73,0)
 . S:$D(VISITX(9000010,DIEN_",",.07,"E")) SERV=$G(VISITX(9000010,DIEN_",",.07,"E"))        ; service category
"RTN","SYNDHP40",74,0)
 . S:$D(VISITX(9000010,DIEN_",",.22,"E")) HLOC=$G(VISITX(9000010,DIEN_",",.22,"E"))        ; hospital location
"RTN","SYNDHP40",75,0)
 . S:$D(VISITX(9000010,DIEN_",",81203,"E")) SOURCE=$G(VISITX(9000010,DIEN_",",81203,"E"))  ; Source
"RTN","SYNDHP40",76,0)
 . S PDO=0,(PROV1,PROV)=""
"RTN","SYNDHP40",77,0)
 . F  S PDO=$O(^AUPNVPRV("AD",DIEN,PDO)) Q:PDO=""  D
"RTN","SYNDHP40",78,0)
 .. S PROV1=$P(^AUPNVPRV(PDO,0),U,1)
"RTN","SYNDHP40",79,0)
 .. S PROV=PROV_$$GET1^DIQ(200,PROV1_",",.01)_S
"RTN","SYNDHP40",80,0)
 . S RETDESC=RETDESC_$G(IDENT)_U_$G(TYPE)_U_$G(PERIOD)_U_$G(REASON)_U_$G(DIAGC)_S_$G(DIAGN)_U_$G(SERV)_U_$G(SOURCE)_U_$G(LOC)_C_$G(LOCA)_U_$G(HLOC)_U_PROV_P
"RTN","SYNDHP40",81,0)
 S RETSTA=DHPICN_U_RETDESC
"RTN","SYNDHP40",82,0)
 ;
"RTN","SYNDHP40",83,0)
 QUIT
"RTN","SYNDHP40",84,0)
 ;
"RTN","SYNDHP40",85,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP40",86,0)
T1 ;
"RTN","SYNDHP40",87,0)
 N ICN S ICN="2676604935V204585"
"RTN","SYNDHP40",88,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP40",89,0)
 N TODAT S TODAT=""
"RTN","SYNDHP40",90,0)
 N RETSTA
"RTN","SYNDHP40",91,0)
 D PATENCI(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP40",92,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP40",93,0)
 QUIT
"RTN","SYNDHP40",94,0)
 ;
"RTN","SYNDHP41")
0^107^B11397025
"RTN","SYNDHP41",1,0)
SYNDHP41 ; HC/rdb/art - HealthConcourse - retrieve patient appointments ;05/04/2019
"RTN","SYNDHP41",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP41",3,0)
 ;;
"RTN","SYNDHP41",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP41",5,0)
 ;
"RTN","SYNDHP41",6,0)
 QUIT
"RTN","SYNDHP41",7,0)
 ;
"RTN","SYNDHP41",8,0)
 ; ---------------- Get patient appointment information ------------------------------
"RTN","SYNDHP41",9,0)
 ;
"RTN","SYNDHP41",10,0)
PATAPTI(RETSTA,DHPICN,FRDAT,TODAT) ; Patient appointments for ICN
"RTN","SYNDHP41",11,0)
 ;
"RTN","SYNDHP41",12,0)
 ; Return patient appointments for a given patient ICN
"RTN","SYNDHP41",13,0)
 ; Returns a patient's appointments from PATIENT:APPOINTMENT (2:1900)
"RTN","SYNDHP41",14,0)
 ;
"RTN","SYNDHP41",15,0)
 ; Input:
"RTN","SYNDHP41",16,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP41",17,0)
 ;   FRDAT   - from date (inclusive), optional, compared to appointment date/time
"RTN","SYNDHP41",18,0)
 ;   TODAT   - to date (inclusive), optional, compared to appointment date/time
"RTN","SYNDHP41",19,0)
 ; Output:
"RTN","SYNDHP41",20,0)
 ;   RETSTA  - a delimited string that lists patient appointment information
"RTN","SYNDHP41",21,0)
 ;          ICN ^ Patient IEN _ Appt Date (HL7) | Clinic | Appt Status | purpose of visit | Appt Type | Resource ID ^...
"RTN","SYNDHP41",22,0)
 ;
"RTN","SYNDHP41",23,0)
 ; bypass for CQM
"RTN","SYNDHP41",24,0)
 ; 
"RTN","SYNDHP41",25,0)
 ; ***********
"RTN","SYNDHP41",26,0)
 ; *********** Important Note for open source community
"RTN","SYNDHP41",27,0)
 ; ***********
"RTN","SYNDHP41",28,0)
 ; *********** Perspecta - who developed this source code and have released it to the open source
"RTN","SYNDHP41",29,0)
 ; *********** need the following six lines to remain intact
"RTN","SYNDHP41",30,0)
 ; 
"RTN","SYNDHP41",31,0)
 ;I DHPICN="1686299845V246594" D  Q
"RTN","SYNDHP41",32,0)
 ;.S RETSTA="1686299845V246594^101916_201704281200-0500|GENERAL MEDICINE||UNSCHED. VISIT|REGULAR"
"RTN","SYNDHP41",33,0)
 ;
"RTN","SYNDHP41",34,0)
 ; *********** the above lines will be redacted by Perspecta at some suitable juncture to 
"RTN","SYNDHP41",35,0)
 ; *********** be determined by Perspecta
"RTN","SYNDHP41",36,0)
 ; ***********
"RTN","SYNDHP41",37,0)
 ; *********** End of Important Note for open source community
"RTN","SYNDHP41",38,0)
 ;
"RTN","SYNDHP41",39,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP41",40,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP41",41,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP41",42,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP41",43,0)
 ;
"RTN","SYNDHP41",44,0)
 ; validate ICN
"RTN","SYNDHP41",45,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP41",46,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP41",47,0)
 ; 
"RTN","SYNDHP41",48,0)
 ; get patient IEN from ICN
"RTN","SYNDHP41",49,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP41",50,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP41",51,0)
 ;
"RTN","SYNDHP41",52,0)
 S RETSTA=$$APPTS(PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP41",53,0)
 Q
"RTN","SYNDHP41",54,0)
 ;
"RTN","SYNDHP41",55,0)
APPTS(PATIEN,DHPICN,FRDAT,TODAT) ; get appointments for a patient
"RTN","SYNDHP41",56,0)
 ;
"RTN","SYNDHP41",57,0)
 N HLFCTS,FNUM,SITE,APPTDTTM,PTAPTID,CLNAM,APDTDISP,APPTSTAT,APPTPURP,APPTTYPE,ZARR
"RTN","SYNDHP41",58,0)
 N C,P,S
"RTN","SYNDHP41",59,0)
 S C=",",P="|",S="_"
"RTN","SYNDHP41",60,0)
 S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP41",61,0)
 S FNUM=2.98      ;  patient appointment sub-file
"RTN","SYNDHP41",62,0)
 ; scan PATIENT "S" index for Appointments
"RTN","SYNDHP41",63,0)
 S APPTDTTM=0
"RTN","SYNDHP41",64,0)
 F  S APPTDTTM=$O(^DPT(PATIEN,"S",APPTDTTM)) Q:APPTDTTM=""  D
"RTN","SYNDHP41",65,0)
 .QUIT:((APPTDTTM\1)<FRDAT)!((APPTDTTM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP41",66,0)
 .S PTAPTID=$$RESID^SYNDHP69("V",SITE)_S_2_S_PATIEN_S_FNUM_S_APPTDTTM
"RTN","SYNDHP41",67,0)
 .S CLNAM=$$GET1^DIQ(FNUM,APPTDTTM_","_PATIEN,.01) ;clinic
"RTN","SYNDHP41",68,0)
 .S APDTDISP=$$FMTHL7^XLFDT(APPTDTTM) ;appt. date/time
"RTN","SYNDHP41",69,0)
 .S APPTSTAT=$$GET1^DIQ(FNUM,APPTDTTM_","_PATIEN,3) ;status
"RTN","SYNDHP41",70,0)
 .S APPTPURP=$$GET1^DIQ(FNUM,APPTDTTM_","_PATIEN,9) ;purpose of visit
"RTN","SYNDHP41",71,0)
 .S APPTTYPE=$$GET1^DIQ(FNUM,APPTDTTM_","_PATIEN,9.5) ;appt. type
"RTN","SYNDHP41",72,0)
 .S ZARR(DHPICN,APPTDTTM)=PATIEN_S_APDTDISP_P_CLNAM_P_APPTSTAT_P_APPTPURP_P_APPTTYPE_P_PTAPTID
"RTN","SYNDHP41",73,0)
 ; serialize data
"RTN","SYNDHP41",74,0)
 S APPTDTTM=""
"RTN","SYNDHP41",75,0)
 N APPTREC
"RTN","SYNDHP41",76,0)
 S HLFCTS=DHPICN
"RTN","SYNDHP41",77,0)
 F  S APPTDTTM=$O(ZARR(DHPICN,APPTDTTM)) Q:APPTDTTM=""  D
"RTN","SYNDHP41",78,0)
 .S APPTREC=ZARR(DHPICN,APPTDTTM)
"RTN","SYNDHP41",79,0)
 .S HLFCTS=HLFCTS_U_APPTREC
"RTN","SYNDHP41",80,0)
 Q HLFCTS
"RTN","SYNDHP41",81,0)
 ;
"RTN","SYNDHP41",82,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP41",83,0)
T1 ;
"RTN","SYNDHP41",84,0)
 N ICN S ICN="1198013374V588739"
"RTN","SYNDHP41",85,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP41",86,0)
 N TODAT S TODAT=""
"RTN","SYNDHP41",87,0)
 N RETSTA
"RTN","SYNDHP41",88,0)
 D PATAPTI(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP41",89,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP41",90,0)
 QUIT
"RTN","SYNDHP41",91,0)
 ;
"RTN","SYNDHP43")
0^1^B11341406
"RTN","SYNDHP43",1,0)
SYNDHP43 ; HC/fjf/art - HealthConcourse - validate a patient's traits ;05/04/2019
"RTN","SYNDHP43",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP43",3,0)
 ;;
"RTN","SYNDHP43",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP43",5,0)
 ;
"RTN","SYNDHP43",6,0)
 QUIT
"RTN","SYNDHP43",7,0)
 ;
"RTN","SYNDHP43",8,0)
PATVAL(RETSTA,NAME,SSN,DOB,GENDER,MMDNM) ; validate patient for DHP
"RTN","SYNDHP43",9,0)
 ; 
"RTN","SYNDHP43",10,0)
 ; this API validates a patient
"RTN","SYNDHP43",11,0)
 ; all the input criteria must be satisfied for the patient to be identified as a valid patient
"RTN","SYNDHP43",12,0)
 ;
"RTN","SYNDHP43",13,0)
 ; Input:
"RTN","SYNDHP43",14,0)
 ; NAME is the patient Name                   - REQUIRED 
"RTN","SYNDHP43",15,0)
 ; SSN is the patient Social Security Number  - REQUIRED
"RTN","SYNDHP43",16,0)
 ; DOB is the patient Date of Birth           - REQUIRED
"RTN","SYNDHP43",17,0)
 ; GENDER is the patient gender               - REQUIRED
"RTN","SYNDHP43",18,0)
 ; MMDNM is the patient Mother's Maiden Name  - optional
"RTN","SYNDHP43",19,0)
 ;
"RTN","SYNDHP43",20,0)
 ; Output:
"RTN","SYNDHP43",21,0)
 ; RETSTA is the name of the return array
"RTN","SYNDHP43",22,0)
 ;   RETSTA(0)=STATUS^REASON^ICN
"RTN","SYNDHP43",23,0)
 ;             STATUS = 1 - valid match found
"RTN","SYNDHP43",24,0)
 ;             STATUS = 0 - no match found
"RTN","SYNDHP43",25,0)
 ;
"RTN","SYNDHP43",26,0)
 N SSNA,RZN,N,TX,IEN
"RTN","SYNDHP43",27,0)
 I $G(NAME)="" S RETSTA="-1^Patient Name not specified" Q
"RTN","SYNDHP43",28,0)
 I $G(SSN)="" S RETSTA="-1^Patient SSN not specified" Q
"RTN","SYNDHP43",29,0)
 I $G(DOB)="" S RETSTA="-1^Patient DOB not specified" Q
"RTN","SYNDHP43",30,0)
 I $G(GENDER)="" S RETSTA="-1^Patient Gender not specified" Q
"RTN","SYNDHP43",31,0)
 ;I $G(MMDNM)="" S RETSTA="-1^Mother's Maiden Name not specified" Q
"RTN","SYNDHP43",32,0)
 S MMDNM=$G(MMDNM)
"RTN","SYNDHP43",33,0)
 ;
"RTN","SYNDHP43",34,0)
 ; do some validation for above traits and determine if patient is valid
"RTN","SYNDHP43",35,0)
 ; 
"RTN","SYNDHP43",36,0)
 ; check to see if SSN is recognised by VistA system
"RTN","SYNDHP43",37,0)
 I '+$$SSNCHK(SSN) S RETSTA="-1^Patient SSN not recognised" Q
"RTN","SYNDHP43",38,0)
 ;
"RTN","SYNDHP43",39,0)
 ; otherwise we have at least one patient for the SSN
"RTN","SYNDHP43",40,0)
 ; check each patient for a match
"RTN","SYNDHP43",41,0)
 S N=""
"RTN","SYNDHP43",42,0)
 S RETSTA="0^Invalid patient"
"RTN","SYNDHP43",43,0)
 F  S N=$O(SSNA(N)) Q:N=""  D
"RTN","SYNDHP43",44,0)
 .S TX=SSNA(N)
"RTN","SYNDHP43",45,0)
 .S IEN=$P(TX,"^",2)
"RTN","SYNDHP43",46,0)
 .I $$NAMCHK(IEN),$$DOBCHK(IEN),$$GENCHK(IEN),$$MDNCHK(IEN) S RETSTA="1^Valid patient^"_$$ICN(IEN)
"RTN","SYNDHP43",47,0)
 I +RETSTA Q
"RTN","SYNDHP43",48,0)
 I $D(RZN) S RETSTA="-1^Invalid "_RZN Q
"RTN","SYNDHP43",49,0)
 Q
"RTN","SYNDHP43",50,0)
 ;
"RTN","SYNDHP43",51,0)
SSNCHK(SSN) ; SSN check
"RTN","SYNDHP43",52,0)
 ; find all patients that match SSN
"RTN","SYNDHP43",53,0)
 K SSNA
"RTN","SYNDHP43",54,0)
 N IEN S IEN=""
"RTN","SYNDHP43",55,0)
 F  S IEN=$O(^DPT("SSN",SSN,IEN)) Q:IEN=""  D
"RTN","SYNDHP43",56,0)
 .S SSNA(IEN)=SSN_U_IEN
"RTN","SYNDHP43",57,0)
 I '$D(SSNA) Q 0
"RTN","SYNDHP43",58,0)
 Q 1
"RTN","SYNDHP43",59,0)
 ;
"RTN","SYNDHP43",60,0)
NAMCHK(IEN) ; name check
"RTN","SYNDHP43",61,0)
 I $P(NAME," ")'=$P($$GET1^DIQ(2,IEN_",",.01,"I")," ") S RZN="patient name" Q 0
"RTN","SYNDHP43",62,0)
 Q 1
"RTN","SYNDHP43",63,0)
 ;
"RTN","SYNDHP43",64,0)
DOBCHK(IEN) ; DOB check
"RTN","SYNDHP43",65,0)
 I $$HL7TFM^XLFDT(DOB)'=$$GET1^DIQ(2,IEN_",",.03,"I") S RZN="DOB" Q 0
"RTN","SYNDHP43",66,0)
 Q 1
"RTN","SYNDHP43",67,0)
 ;
"RTN","SYNDHP43",68,0)
GENCHK(IEN) ; gender check
"RTN","SYNDHP43",69,0)
 I GENDER'=$$GET1^DIQ(2,IEN_",",.02,"I") S RZN="gender" Q 0
"RTN","SYNDHP43",70,0)
 Q 1
"RTN","SYNDHP43",71,0)
 ;
"RTN","SYNDHP43",72,0)
MDNCHK(IEN) ; mother's maiden name check
"RTN","SYNDHP43",73,0)
 Q:MMDNM="" 1
"RTN","SYNDHP43",74,0)
 I MMDNM'=$P($$GET1^DIQ(2,IEN_",",.2403),",") S RZN="mother maiden name" Q 0
"RTN","SYNDHP43",75,0)
 Q 1
"RTN","SYNDHP43",76,0)
 ;
"RTN","SYNDHP43",77,0)
ICN(IEN) ; obtain ICN
"RTN","SYNDHP43",78,0)
 N ICN
"RTN","SYNDHP43",79,0)
 S ICN=$$GET1^DIQ(2,IEN_",",991.1)
"RTN","SYNDHP43",80,0)
 I ICN="" D
"RTN","SYNDHP43",81,0)
 . S ICN=$$GET1^DIQ(2,IEN_",",991.01)_"V"_$$GET1^DIQ(2,IEN_",",991.02)
"RTN","SYNDHP43",82,0)
 Q ICN
"RTN","SYNDHP43",83,0)
 ;
"RTN","SYNDHP43",84,0)
TESTP ;
"RTN","SYNDHP43",85,0)
 D PATVAL(.RETSTA,"ZERO,PATIENT",666000000,19350505,"M","SCHMIDT")
"RTN","SYNDHP43",86,0)
 Q
"RTN","SYNDHP43",87,0)
 ;
"RTN","SYNDHP43",88,0)
TESTF1 ; SSN fail
"RTN","SYNDHP43",89,0)
 D PATVAL(.RETSTA,"ZERO,PATIENT",566000000,19350505,"M","SCHMIDT")
"RTN","SYNDHP43",90,0)
 Q
"RTN","SYNDHP43",91,0)
 ;
"RTN","SYNDHP43",92,0)
TESTF2 ; name fail
"RTN","SYNDHP43",93,0)
 D PATVAL(.RETSTA,"FRAUNOFER,PATIENT",666000000,19350505,"M","SCHMIDT")
"RTN","SYNDHP43",94,0)
 Q
"RTN","SYNDHP43",95,0)
 ;
"RTN","SYNDHP43",96,0)
TESTF3 ; DOB fail
"RTN","SYNDHP43",97,0)
 D PATVAL(.RETSTA,"ZERO,PATIENT",666000000,19270928,"M","SCHMIDT")
"RTN","SYNDHP43",98,0)
 Q
"RTN","SYNDHP43",99,0)
 ;
"RTN","SYNDHP43",100,0)
TESTF4 ; gender fail
"RTN","SYNDHP43",101,0)
 D PATVAL(.RETSTA,"ZERO,PATIENT",666000000,19350505,"F","SCHMIDT")
"RTN","SYNDHP43",102,0)
 Q
"RTN","SYNDHP43",103,0)
 ;
"RTN","SYNDHP43",104,0)
TESTF5 ; mother's maiden name fail
"RTN","SYNDHP43",105,0)
 D PATVAL(.RETSTA,"ZERO,PATIENT",666000000,19350505,"M","SCHROEDINGER")
"RTN","SYNDHP43",106,0)
 Q
"RTN","SYNDHP43",107,0)
 ;
"RTN","SYNDHP43",108,0)
T3 ;
"RTN","SYNDHP43",109,0)
 S NAME="COPD,PATIENT MALE"
"RTN","SYNDHP43",110,0)
 S SSN=666111957
"RTN","SYNDHP43",111,0)
 S DOB=19800530
"RTN","SYNDHP43",112,0)
 S GENDER="M"
"RTN","SYNDHP43",113,0)
 N RETSTA
"RTN","SYNDHP43",114,0)
 D PATVAL(.RETSTA,NAME,SSN,DOB,GENDER) 
"RTN","SYNDHP43",115,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP43",116,0)
 QUIT
"RTN","SYNDHP43",117,0)
 ;
"RTN","SYNDHP47")
0^2^B42834722
"RTN","SYNDHP47",1,0)
SYNDHP47 ; HC/fjf/art - HealthConcourse - retrieve patient demographics ;05/07/2019
"RTN","SYNDHP47",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP47",3,0)
 ;;
"RTN","SYNDHP47",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP47",5,0)
 ;
"RTN","SYNDHP47",6,0)
 QUIT
"RTN","SYNDHP47",7,0)
 ;
"RTN","SYNDHP47",8,0)
 ; ----------------  Get Patient Demographics  ----------------------  
"RTN","SYNDHP47",9,0)
 ;
"RTN","SYNDHP47",10,0)
PATDEM(RETSTA,NAME,SSN,DOB,GENDER,RETJSON) ; get demographics for a patient by traits
"RTN","SYNDHP47",11,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP47",12,0)
 QUIT
"RTN","SYNDHP47",13,0)
 ; Return patient demographics for name, SSN, DOB, and gender
"RTN","SYNDHP47",14,0)
 ;
"RTN","SYNDHP47",15,0)
 ; Input:
"RTN","SYNDHP47",16,0)
 ;   NAME    - patient name
"RTN","SYNDHP47",17,0)
 ;   SSN     - social security number
"RTN","SYNDHP47",18,0)
 ;   DOB     - date of birth
"RTN","SYNDHP47",19,0)
 ;   GENDER  - gender
"RTN","SYNDHP47",20,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP47",21,0)
 ;             F = Return FHIR
"RTN","SYNDHP47",22,0)
 ;             0 or null = Return patient demographics string (default)
"RTN","SYNDHP47",23,0)
 ; Output:
"RTN","SYNDHP47",24,0)
 ;   RETSTA  - a delimited string that has the following
"RTN","SYNDHP47",25,0)
 ;             ICN^Name^Phone Number^Gender^Date of Birth^Address1,Address2,Address3,^City^State^ZIP^resID
"RTN","SYNDHP47",26,0)
 ;          or patient demographics in JSON format
"RTN","SYNDHP47",27,0)
 ;
"RTN","SYNDHP47",28,0)
 ; validate patient
"RTN","SYNDHP47",29,0)
 N ICNST
"RTN","SYNDHP47",30,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP47",31,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP47",32,0)
 S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP47",33,0)
 ; get patient IEN from ICN
"RTN","SYNDHP47",34,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP47",35,0)
 ;
"RTN","SYNDHP47",36,0)
 ; get patient demographics
"RTN","SYNDHP47",37,0)
 N PATARRAY
"RTN","SYNDHP47",38,0)
 S RETSTA=$$GETPATS(.PATARRAY,PATIEN)
"RTN","SYNDHP47",39,0)
 ;
"RTN","SYNDHP47",40,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP47",41,0)
 ;
"RTN","SYNDHP47",42,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP47",43,0)
 . S RETSTA=""
"RTN","SYNDHP47",44,0)
 . D TOJASON^SYNDHPUTL(.PATARRAY,.RETSTA)
"RTN","SYNDHP47",45,0)
 ;
"RTN","SYNDHP47",46,0)
 QUIT
"RTN","SYNDHP47",47,0)
 ;
"RTN","SYNDHP47",48,0)
 ; ----------------  Get Patient Demographics  ----------------------  
"RTN","SYNDHP47",49,0)
 ;
"RTN","SYNDHP47",50,0)
PATDEMI(RETSTA,DHPICN,RETJSON) ; get demographics for patient by ICN
"RTN","SYNDHP47",51,0)
 ; 
"RTN","SYNDHP47",52,0)
 ; Return patient demographics for given patient ICN
"RTN","SYNDHP47",53,0)
 ; 
"RTN","SYNDHP47",54,0)
 ; Input:
"RTN","SYNDHP47",55,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP47",56,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP47",57,0)
 ;             F = Return FHIR
"RTN","SYNDHP47",58,0)
 ;             0 or null = Return patient demographics string (default)
"RTN","SYNDHP47",59,0)
 ; Output:
"RTN","SYNDHP47",60,0)
 ;   RETSTA  - a delimited string that has the following
"RTN","SYNDHP47",61,0)
 ;             ICN^Name^Phone Number^Gender^Date of Birth^Address1,Address2,Address3,^City^State^ZIP^resID
"RTN","SYNDHP47",62,0)
 ;          or patient demographics in JSON format
"RTN","SYNDHP47",63,0)
 ;
"RTN","SYNDHP47",64,0)
 ; validate ICN
"RTN","SYNDHP47",65,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP47",66,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP47",67,0)
 ; get patient IEN from ICN
"RTN","SYNDHP47",68,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP47",69,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP47",70,0)
 ;
"RTN","SYNDHP47",71,0)
 ; get patient demographics
"RTN","SYNDHP47",72,0)
 N PATARRAY
"RTN","SYNDHP47",73,0)
 S RETSTA=$$GETPATS(.PATARRAY,PATIEN)
"RTN","SYNDHP47",74,0)
 ;
"RTN","SYNDHP47",75,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP47",76,0)
 ;
"RTN","SYNDHP47",77,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP47",78,0)
 . S RETSTA=""
"RTN","SYNDHP47",79,0)
 . D TOJASON^SYNDHPUTL(.PATARRAY,.RETSTA)
"RTN","SYNDHP47",80,0)
 ;
"RTN","SYNDHP47",81,0)
 QUIT
"RTN","SYNDHP47",82,0)
 ; 
"RTN","SYNDHP47",83,0)
GETPATS(PATARRAY,PATIEN) ; get demographics for patient
"RTN","SYNDHP47",84,0)
 ; 
"RTN","SYNDHP47",85,0)
 N C,S,RESID,NAME,PHONE,SEX,DOB,ADRS1,ADRS2,ADRS3,CITY,STATE,ZIP,ICN
"RTN","SYNDHP47",86,0)
 S C=","
"RTN","SYNDHP47",87,0)
 S S="_"
"RTN","SYNDHP47",88,0)
 ;
"RTN","SYNDHP47",89,0)
 N PATIENT
"RTN","SYNDHP47",90,0)
 D GETPATIENT^SYNDHP20(.PATIENT,PATIEN,0,"")
"RTN","SYNDHP47",91,0)
 I $D(PATIENT("Patient","ERROR")) QUIT "-1^error reading patient file"
"RTN","SYNDHP47",92,0)
 S RESID=PATIENT("Patient","resourceId")
"RTN","SYNDHP47",93,0)
 S NAME=PATIENT("Patient","name")
"RTN","SYNDHP47",94,0)
 S PHONE=PATIENT("Patient","phoneNumberResidence")
"RTN","SYNDHP47",95,0)
 S SEX=PATIENT("Patient","sex")
"RTN","SYNDHP47",96,0)
 S DOB=PATIENT("Patient","dateOfBirthHL7")
"RTN","SYNDHP47",97,0)
 S ADRS1=PATIENT("Patient","streetAddressLine1")
"RTN","SYNDHP47",98,0)
 S ADRS2=PATIENT("Patient","streetAddressLine2")
"RTN","SYNDHP47",99,0)
 S ADRS3=PATIENT("Patient","streetAddressLine3")
"RTN","SYNDHP47",100,0)
 S CITY=PATIENT("Patient","city")
"RTN","SYNDHP47",101,0)
 S STATE=PATIENT("Patient","state")
"RTN","SYNDHP47",102,0)
 S ZIP=PATIENT("Patient","zipCode")
"RTN","SYNDHP47",103,0)
 S ICN=PATIENT("Patient","fullICN")
"RTN","SYNDHP47",104,0)
 S PATSTR=ICN_U_NAME_U_PHONE_U_SEX_U_DOB_U_ADRS1_C_ADRS2_C_ADRS3_C_U_CITY_U_STATE_U_ZIP_U_RESID
"RTN","SYNDHP47",105,0)
 M PATARRAY("Patients",PATIEN)=PATIENT
"RTN","SYNDHP47",106,0)
 ;
"RTN","SYNDHP47",107,0)
 QUIT PATSTR
"RTN","SYNDHP47",108,0)
 ; 
"RTN","SYNDHP47",109,0)
PATDEMAL(RETSTA,DHPICN,RETJSON) ; get demographics for all patients
"RTN","SYNDHP47",110,0)
 ; 
"RTN","SYNDHP47",111,0)
 ; Return patient demographics for all patients
"RTN","SYNDHP47",112,0)
 ; 
"RTN","SYNDHP47",113,0)
 ; Input:
"RTN","SYNDHP47",114,0)
 ;   DHPICN - "ALL"
"RTN","SYNDHP47",115,0)
 ;   RETJSON - J = Return JSON (JSON is not currently supported for this call)
"RTN","SYNDHP47",116,0)
 ;             F = Return FHIR
"RTN","SYNDHP47",117,0)
 ;             0 or null = Return patient demographics string (default)
"RTN","SYNDHP47",118,0)
 ; Output:
"RTN","SYNDHP47",119,0)
 ;   RETSTA  - a delimited string that has the following data elements for each patient
"RTN","SYNDHP47",120,0)
 ;             ICN^Name^Phone Number^Gender^Date of Birth^Address1,Address2,Address3,^City^State^ZIP^resID|...
"RTN","SYNDHP47",121,0)
 ;             data for each patient is separated by "|"
"RTN","SYNDHP47",122,0)
 ;          or patient demographics in JSON format
"RTN","SYNDHP47",123,0)
 ;
"RTN","SYNDHP47",124,0)
 I $G(DHPICN)'="ALL" S RETSTA="-1^please specify ICN=ALL" QUIT
"RTN","SYNDHP47",125,0)
 I ($G(RETJSON)="J"!($G(RETJSON)="F")) S RETSTA="-1^JSON for all patients is currently not supported" QUIT
"RTN","SYNDHP47",126,0)
 ;
"RTN","SYNDHP47",127,0)
 N C,S,CT
"RTN","SYNDHP47",128,0)
 S C=","
"RTN","SYNDHP47",129,0)
 S S="_"
"RTN","SYNDHP47",130,0)
 S CT=0
"RTN","SYNDHP47",131,0)
 K ^TMP("DHPPATALL",$J)
"RTN","SYNDHP47",132,0)
 S ^TMP("DHPPATALL",$J)=""
"RTN","SYNDHP47",133,0)
 K ^SYNDHPTMP("DHPCOUNT")
"RTN","SYNDHP47",134,0)
 ;
"RTN","SYNDHP47",135,0)
 N PATARRAY,PATSTR
"RTN","SYNDHP47",136,0)
 N PATIEN S PATIEN=0
"RTN","SYNDHP47",137,0)
 F  S PATIEN=$O(^DPT(PATIEN)) Q:+PATIEN=0  D
"RTN","SYNDHP47",138,0)
 .S PATSTR=$$GETPATS(.PATARRAY,PATIEN)
"RTN","SYNDHP47",139,0)
 .S ^TMP("DHPPATALL",$J)=^TMP("DHPPATALL",$J)_PATSTR_"|"
"RTN","SYNDHP47",140,0)
 .S CT=CT+1
"RTN","SYNDHP47",141,0)
 .S ^SYNDHPTMP("DHPCOUNT",$J,CT)=PATSTR
"RTN","SYNDHP47",142,0)
 S RETSTA=^TMP("DHPPATALL",$J)
"RTN","SYNDHP47",143,0)
 ;
"RTN","SYNDHP47",144,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP47",145,0)
 ;
"RTN","SYNDHP47",146,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP47",147,0)
 . S RETSTA=""
"RTN","SYNDHP47",148,0)
 . D TOJASON^SYNDHPUTL(.PATARRAY,.RETSTA)
"RTN","SYNDHP47",149,0)
 ;
"RTN","SYNDHP47",150,0)
 Q
"RTN","SYNDHP47",151,0)
 ;
"RTN","SYNDHP47",152,0)
PATDEMRNG(RETSTA,DHPPATS,RETJSON) ; get demographics for range of patients
"RTN","SYNDHP47",153,0)
 ; 
"RTN","SYNDHP47",154,0)
 ; Return patient demographics for a range of patients
"RTN","SYNDHP47",155,0)
 ; 
"RTN","SYNDHP47",156,0)
 ; Input:
"RTN","SYNDHP47",157,0)
 ;   DHPPATS - mmmmRnnnn where nnnn and mmmm are patient DFNs, mmmm<nnnn (limited 1000 patients for JSON)
"RTN","SYNDHP47",158,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP47",159,0)
 ;             F = Return FHIR
"RTN","SYNDHP47",160,0)
 ;             0 or null = Return patient demographics string (default)
"RTN","SYNDHP47",161,0)
 ; Output:
"RTN","SYNDHP47",162,0)
 ;   RETSTA  - a delimited string that has the following
"RTN","SYNDHP47",163,0)
 ;             ICN^Name^Phone Number^Gender^Date of Birth^Address1,Address2,Address3,^City^State^ZIP^resID|...
"RTN","SYNDHP47",164,0)
 ;          or patient demographics in JSON format
"RTN","SYNDHP47",165,0)
 ;
"RTN","SYNDHP47",166,0)
 ;
"RTN","SYNDHP47",167,0)
 N C,M,S,SOR,EOR,N,NOPATS,FPATIEN,PTNTS,DHPICN,PATSTR,I,RESID
"RTN","SYNDHP47",168,0)
 S C=",",M="R"
"RTN","SYNDHP47",169,0)
 S S="_"
"RTN","SYNDHP47",170,0)
 N SITE S SITE=$P($$SITE^VASITE,U,3)
"RTN","SYNDHP47",171,0)
 ;
"RTN","SYNDHP47",172,0)
 S CT=0
"RTN","SYNDHP47",173,0)
 K ^TMP("DHPPATRNG",$J) S ^TMP("DHPPATRNG",$J)=""
"RTN","SYNDHP47",174,0)
 K ^SYNDHPTMP("DHPCOUNT")
"RTN","SYNDHP47",175,0)
 N PATARRAY
"RTN","SYNDHP47",176,0)
 ;
"RTN","SYNDHP47",177,0)
 I DHPPATS'?1.N1"R"1.N S RETSTA="-1^Invalid range format" QUIT
"RTN","SYNDHP47",178,0)
 S SOR=$P(DHPPATS,M),EOR=$P(DHPPATS,M,2)
"RTN","SYNDHP47",179,0)
 I EOR<SOR S RETSTA="-1^End before beginning" QUIT
"RTN","SYNDHP47",180,0)
 S NOPATS=EOR-SOR+1
"RTN","SYNDHP47",181,0)
 I ($G(RETJSON)="J"!($G(RETJSON)="F")),NOPATS>1000 S RETSTA="-1^please limit JSON request to 1000 patients" QUIT
"RTN","SYNDHP47",182,0)
 ; find first patient IEN
"RTN","SYNDHP47",183,0)
 S PATIEN=SOR-1
"RTN","SYNDHP47",184,0)
 F  S PATIEN=$O(^DPT(PATIEN)) QUIT:(PATIEN>EOR)!(+PATIEN=0)  D
"RTN","SYNDHP47",185,0)
 .;W !,PATIEN
"RTN","SYNDHP47",186,0)
 .;Q
"RTN","SYNDHP47",187,0)
 .S PATSTR=$$GETPATS(.PATARRAY,PATIEN)
"RTN","SYNDHP47",188,0)
 .S ^TMP("DHPPATRNG",$J)=^TMP("DHPPATRNG",$J)_PATSTR_"|"
"RTN","SYNDHP47",189,0)
 .S CT=CT+1
"RTN","SYNDHP47",190,0)
 .S ^SYNDHPTMP("DHPCOUNT",$J,CT)=PATSTR
"RTN","SYNDHP47",191,0)
 S RETSTA=^TMP("DHPPATRNG",$J)
"RTN","SYNDHP47",192,0)
 ;
"RTN","SYNDHP47",193,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP47",194,0)
 ;
"RTN","SYNDHP47",195,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP47",196,0)
 . S RETSTA=""
"RTN","SYNDHP47",197,0)
 . D TOJASON^SYNDHPUTL(.PATARRAY,.RETSTA)
"RTN","SYNDHP47",198,0)
 ;
"RTN","SYNDHP47",199,0)
 Q
"RTN","SYNDHP47",200,0)
 ;
"RTN","SYNDHP47",201,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP47",202,0)
T1 ;
"RTN","SYNDHP47",203,0)
 N ICN S ICN="1034989029V875306"
"RTN","SYNDHP47",204,0)
 N JSON S JSON=""
"RTN","SYNDHP47",205,0)
 N RETSTA
"RTN","SYNDHP47",206,0)
 D PATDEMI(.RETSTA,ICN,JSON)
"RTN","SYNDHP47",207,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP47",208,0)
 QUIT
"RTN","SYNDHP47",209,0)
 ;
"RTN","SYNDHP47",210,0)
T2 ;
"RTN","SYNDHP47",211,0)
 N ICN S ICN="1034989029V875306"
"RTN","SYNDHP47",212,0)
 N JSON S JSON="J"
"RTN","SYNDHP47",213,0)
 N RETSTA
"RTN","SYNDHP47",214,0)
 D PATDEMI(.RETSTA,ICN,JSON)
"RTN","SYNDHP47",215,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP47",216,0)
 QUIT
"RTN","SYNDHP47",217,0)
 ;
"RTN","SYNDHP47",218,0)
T3 ;
"RTN","SYNDHP47",219,0)
 N RANGE S RANGE="10R15"
"RTN","SYNDHP47",220,0)
 N JSON S JSON=""
"RTN","SYNDHP47",221,0)
 N RETSTA
"RTN","SYNDHP47",222,0)
 D PATDEMRNG(.RETSTA,RANGE,JSON)
"RTN","SYNDHP47",223,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP47",224,0)
 QUIT
"RTN","SYNDHP47",225,0)
 ;
"RTN","SYNDHP47",226,0)
T4 ;
"RTN","SYNDHP47",227,0)
 N RANGE S RANGE="10R15"
"RTN","SYNDHP47",228,0)
 N JSON S JSON="J"
"RTN","SYNDHP47",229,0)
 N RETSTA
"RTN","SYNDHP47",230,0)
 D PATDEMRNG(.RETSTA,RANGE,JSON)
"RTN","SYNDHP47",231,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP47",232,0)
 QUIT
"RTN","SYNDHP47",233,0)
 ;
"RTN","SYNDHP47",234,0)
T5 ;
"RTN","SYNDHP47",235,0)
 N ICN S ICN="ALL"
"RTN","SYNDHP47",236,0)
 N JSON S JSON=""
"RTN","SYNDHP47",237,0)
 N RETSTA
"RTN","SYNDHP47",238,0)
 D PATDEMAL(.RETSTA,ICN,JSON)
"RTN","SYNDHP47",239,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP47",240,0)
 QUIT
"RTN","SYNDHP47",241,0)
 ;
"RTN","SYNDHP47",242,0)
TESTS ;
"RTN","SYNDHP47",243,0)
DEMTEST0 ; pass
"RTN","SYNDHP47",244,0)
 D PATDEM(.RETSTA,"HYPERTENSION,PATIENT FEMALE",666111938,19280913,"F")
"RTN","SYNDHP47",245,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP47",246,0)
 Q
"RTN","SYNDHP48")
0^3^B113334144
"RTN","SYNDHP48",1,0)
SYNDHP48 ; HC/PWC/art - HealthConcourse - retrieve patient medication data ;05/07/2019
"RTN","SYNDHP48",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP48",3,0)
 ;;
"RTN","SYNDHP48",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP48",5,0)
 ;
"RTN","SYNDHP48",6,0)
 Q
"RTN","SYNDHP48",7,0)
 ;
"RTN","SYNDHP48",8,0)
 ; ---------------- Get patient medication statement ----------------------------
"RTN","SYNDHP48",9,0)
PATMEDS(RETSTA,DHPICN,FRDAT,TODAT) ; Patient medication statement for ICN
"RTN","SYNDHP48",10,0)
 ;
"RTN","SYNDHP48",11,0)
 ; Return patient medication statement for a given patient ICN
"RTN","SYNDHP48",12,0)
 ;
"RTN","SYNDHP48",13,0)
 ; Input:
"RTN","SYNDHP48",14,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP48",15,0)
 ;   FRDAT   - from date (inclusive), optional
"RTN","SYNDHP48",16,0)
 ;   TODAT   - to date (inclusive), optional
"RTN","SYNDHP48",17,0)
 ; Output:
"RTN","SYNDHP48",18,0)
 ;   RETSTA  - a delimited string that lists the following information
"RTN","SYNDHP48",19,0)
 ;      PatientICN ^ RESOURSE ID ^ STATUS ^ MEDICATION ^ DATE ASSERTED ^ CONDITION
"RTN","SYNDHP48",20,0)
 ;      ^ DOSAGE , SITE ; ROUTE ; DOSE ^ QUANTITY ^ DAYS ^ RXN |
"RTN","SYNDHP48",21,0)
 ;
"RTN","SYNDHP48",22,0)
 ;   Identifier will be "V"_SITE ID_"_"_FILEMAN #_"_"_FILE IEN   i.e. V_500_55_930
"RTN","SYNDHP48",23,0)
 ;
"RTN","SYNDHP48",24,0)
 ; validate ICN
"RTN","SYNDHP48",25,0)
STM ;
"RTN","SYNDHP48",26,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP48",27,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP48",28,0)
 ;
"RTN","SYNDHP48",29,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP48",30,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP48",31,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP48",32,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP48",33,0)
 ;
"RTN","SYNDHP48",34,0)
 N C,ACU,P,S,UL,D1,IDENT,ORDDAT,ORDNUM,ROUTE,STATUS,DOSORD,STDT,STDTFM,DRUG,SITE,SITEA
"RTN","SYNDHP48",35,0)
 N RETDESC,QTY,DAYS,RXN,IENS,IDATE,IDATEFM,RX,PATIEN,DRUGI
"RTN","SYNDHP48",36,0)
 S C=",",P="|",S=";",UL="_"
"RTN","SYNDHP48",37,0)
 ; get patient IEN from ICN
"RTN","SYNDHP48",38,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP48",39,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP48",40,0)
 ;
"RTN","SYNDHP48",41,0)
 S RETDESC=""
"RTN","SYNDHP48",42,0)
 S SITE=$P($$SITE^VASITE,U,3)
"RTN","SYNDHP48",43,0)
 S RETSTA=""
"RTN","SYNDHP48",44,0)
 ; loop through the PHARMACY PATIENT file #55 (^PS(55)) for patient (this will contain both IP and OP orders)
"RTN","SYNDHP48",45,0)
 ;
"RTN","SYNDHP48",46,0)
 ; this is start of Inpatient Orders
"RTN","SYNDHP48",47,0)
 S D1=0
"RTN","SYNDHP48",48,0)
 F  S D1=$O(^PS(55,PATIEN,5,D1)) Q:D1'?1N.N  D
"RTN","SYNDHP48",49,0)
 .S IENS=D1_C_PATIEN_C
"RTN","SYNDHP48",50,0)
 .S (ORDDAT,ORDNUM,ROUTE,STATUS,DOSORD,STDT,STDTFM,DRUG,SITEA,QTY,DAYS,RXN)=""
"RTN","SYNDHP48",51,0)
 .N MEDX,MEDERR
"RTN","SYNDHP48",52,0)
 .D GETS^DIQ(55.06,IENS,".01;3;10;28","IEN","MEDX","MEDERR")
"RTN","SYNDHP48",53,0)
 .QUIT:$D(MEDERR)
"RTN","SYNDHP48",54,0)
 .S ORDNUM=$G(MEDX(55.06,IENS,.01,"E"))   ; order number
"RTN","SYNDHP48",55,0)
 .; route is most likely not stored in vista as SCT code, but should check this
"RTN","SYNDHP48",56,0)
 .S ROUTE=$G(MEDX(55.06,IENS,3,"E"))      ; route
"RTN","SYNDHP48",57,0)
 .S STATUS=$G(MEDX(55.06,IENS,28,"E"))    ; status
"RTN","SYNDHP48",58,0)
 .S DOSORD=$P($G(^PS(55,PATIEN,5,D1,.2)),U,2)          ; dosage ordered
"RTN","SYNDHP48",59,0)
 .S STDTFM=$G(MEDX(55.06,IENS,10,"I"))      ; start date
"RTN","SYNDHP48",60,0)
 .QUIT:((STDTFM\1)<FRDAT)!((STDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP48",61,0)
 .S STDT=$$FMTHL7^XLFDT($G(MEDX(55.06,IENS,10,"I")))      ; start date
"RTN","SYNDHP48",62,0)
 .S DRUG=$$GET1^DIQ(55.07,1_C_IENS,.01,"E")  ; medication
"RTN","SYNDHP48",63,0)
 .S DRUGI=$$GET1^DIQ(55.07,1_C_IENS,.01,"I")
"RTN","SYNDHP48",64,0)
 .S RXN=$$GETRXN(DRUGI)
"RTN","SYNDHP48",65,0)
 .I RXN?1.N S RXN="RXN"_RXN
"RTN","SYNDHP48",66,0)
 .S IDENT=$$RESID^SYNDHP69("V",SITE)_UL_55_UL_PATIEN_UL_55.06_UL_D1
"RTN","SYNDHP48",67,0)
 .S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(STDT)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_$G(QTY)_U_$G(DAYS)_U_$G(RXN)_P
"RTN","SYNDHP48",68,0)
 ;
"RTN","SYNDHP48",69,0)
 ; start here for outpatient orders
"RTN","SYNDHP48",70,0)
 S D1=0
"RTN","SYNDHP48",71,0)
 F  S D1=$O(^PS(55,PATIEN,"P",D1)) Q:D1'?1N.N  D
"RTN","SYNDHP48",72,0)
 . S RX=$G(^PS(55,PATIEN,"P",D1,0))
"RTN","SYNDHP48",73,0)
 . S (IDENT,IDATE,DRUG,QTY,DAYS,STATUS,ROUTE,RXN)=""
"RTN","SYNDHP48",74,0)
 . N MEDX,MEDERR
"RTN","SYNDHP48",75,0)
 . D GETS^DIQ(52,RX_",",".01;1;2;6;7;8;100","IEN","MEDX","MEDERR")
"RTN","SYNDHP48",76,0)
 . QUIT:$D(MEDERR)
"RTN","SYNDHP48",77,0)
 . S IDENT=$$RESID^SYNDHP69("V",SITE)_UL_52_UL_RX
"RTN","SYNDHP48",78,0)
 . S IDATEFM=$G(MEDX(52,RX_",",1,"I"))     ;issue date
"RTN","SYNDHP48",79,0)
 . QUIT:((IDATEFM\1)<FRDAT)!((IDATEFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP48",80,0)
 . S IDATE=$$FMTHL7^XLFDT($G(MEDX(52,RX_",",1,"I")))     ;issue date HL7
"RTN","SYNDHP48",81,0)
 . S DRUG=$G(MEDX(52,RX_",",6,"E"))      ;medication
"RTN","SYNDHP48",82,0)
 . S DRUGI=$G(MEDX(52,RX_",",6,"I"))
"RTN","SYNDHP48",83,0)
 . S RXN=$$GETRXN(DRUGI)
"RTN","SYNDHP48",84,0)
 . I RXN?1.N S RXN="RXN"_RXN
"RTN","SYNDHP48",85,0)
 . S QTY=$G(MEDX(52,RX_",",7,"E"))       ;quantity
"RTN","SYNDHP48",86,0)
 . S DAYS=$G(MEDX(52,RX_",",8,"E"))      ;days supply
"RTN","SYNDHP48",87,0)
 . S STATUS=$G(MEDX(52,RX_",",100,"E"))  ;status
"RTN","SYNDHP48",88,0)
 . S ROUTE=$$GET1^DIQ(52.0113,"1,"_RX_",",6,"EN")  ;route
"RTN","SYNDHP48",89,0)
 . S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(IDATE)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_$G(QTY)_U_$G(DAYS)_U_$G(RXN)_P
"RTN","SYNDHP48",90,0)
 S RETSTA=DHPICN_U_RETDESC
"RTN","SYNDHP48",91,0)
 Q
"RTN","SYNDHP48",92,0)
 ;
"RTN","SYNDHP48",93,0)
GETRXN(X,IO) ; get RxNorm code for drug
"RTN","SYNDHP48",94,0)
 ;
"RTN","SYNDHP48",95,0)
 N NAME,F50P6IEN,VUID,NDFRT,RXNORM
"RTN","SYNDHP48",96,0)
 S NAME=$$GET1^DIQ(50,X_",",20,"E")
"RTN","SYNDHP48",97,0)
 I $G(DEBUG) W !,"name: ",NAME
"RTN","SYNDHP48",98,0)
 I NAME'="" D
"RTN","SYNDHP48",99,0)
 .S F50P6IEN=$O(^PSNDF(50.6,"B",NAME,""))
"RTN","SYNDHP48",100,0)
 .I $G(DEBUG) W !,"ien: ",F50P6IEN
"RTN","SYNDHP48",101,0)
 .S VUID=$$GET1^DIQ(50.6,F50P6IEN_",",99.99)
"RTN","SYNDHP48",102,0)
 .I $G(DEBUG) W !,"vuid: ",VUID
"RTN","SYNDHP48",103,0)
 .S NDFRT=$$graphmap^SYNGRAPH("ndfrt-map",VUID,"NDFRT")
"RTN","SYNDHP48",104,0)
 .I $G(DEBUG) W !,"ndfrt: ",NDFRT
"RTN","SYNDHP48",105,0)
 .N SCT S SCT=$$MAP^SYNDHPMP("rxn2ndf",NDFRT,"I")
"RTN","SYNDHP48",106,0)
 .I $G(DEBUG) W !,"sct: ",SCT
"RTN","SYNDHP48",107,0)
 .S RXNORM=$S(+SCT=-1:$P(SCT,U,2),1:$P(SCT,U,2))
"RTN","SYNDHP48",108,0)
 .I $G(DEBUG) W !,"rxnorm: ",RXNORM
"RTN","SYNDHP48",109,0)
 I NAME="" S RXNORM="^missing VistA data"
"RTN","SYNDHP48",110,0)
 I $G(DEBUG) W !,"rxnorm: ",RXNORM,!
"RTN","SYNDHP48",111,0)
 Q RXNORM
"RTN","SYNDHP48",112,0)
 ;I NAME="" S NAME=$$GET1^DIQ(50,X_",",26,"E")
"RTN","SYNDHP48",113,0)
 ;
"RTN","SYNDHP48",114,0)
 ; ---------------- Get patient medication administration ----------------------------
"RTN","SYNDHP48",115,0)
PATMEDA(RETSTA,DHPICN,FRDAT,TODAT) ; Patient medication administration for ICN
"RTN","SYNDHP48",116,0)
 ;
"RTN","SYNDHP48",117,0)
 ; Return patient medication administration for a given patient ICN
"RTN","SYNDHP48",118,0)
 ;
"RTN","SYNDHP48",119,0)
 ; Input:
"RTN","SYNDHP48",120,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP48",121,0)
 ;   FRDAT   - from date (inclusive), optional
"RTN","SYNDHP48",122,0)
 ;   TODAT   - to date (inclusive), optional
"RTN","SYNDHP48",123,0)
 ; Output:
"RTN","SYNDHP48",124,0)
 ;   RETSTA  - a delimited string that lists the following information
"RTN","SYNDHP48",125,0)
 ;      PatientICN ^ RESOURSE ID ^ STATUS ^ MEDICATION ^ DATE ASSERTED ^ CONDITION
"RTN","SYNDHP48",126,0)
 ;      ^ DOSAGE , SITE ; ROUTE ; DOSE ^ QUANTITY ^ DAYS ^ RXN |
"RTN","SYNDHP48",127,0)
 ;
"RTN","SYNDHP48",128,0)
 ;   Identifier will be "V"_SITE ID_"_"_FILEMAN #_"_"_FILE IEN   i.e. V_500_55_930
"RTN","SYNDHP48",129,0)
 ;
"RTN","SYNDHP48",130,0)
 ; validate ICN
"RTN","SYNDHP48",131,0)
STA ;
"RTN","SYNDHP48",132,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP48",133,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP48",134,0)
 ;
"RTN","SYNDHP48",135,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP48",136,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP48",137,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP48",138,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP48",139,0)
 ;
"RTN","SYNDHP48",140,0)
 N C,ACU,P,S,UL,D1,IDENT,ORDDAT,ORDNUM,ROUTE,STATUS,DOSORD,STDT,STDTFM,DRUG,SITE ;,IENS
"RTN","SYNDHP48",141,0)
 N RETDESC,SITEA,QTY,DAYS,RXN,IDATE,IDATEFM,PATIEN,DRUGI,RX
"RTN","SYNDHP48",142,0)
 S C=",",P="|",S=";",UL="_"
"RTN","SYNDHP48",143,0)
 ; get patient IEN from ICN
"RTN","SYNDHP48",144,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP48",145,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP48",146,0)
 ;
"RTN","SYNDHP48",147,0)
 S RETDESC=""
"RTN","SYNDHP48",148,0)
 S SITE=$P($$SITE^VASITE,U,3)
"RTN","SYNDHP48",149,0)
 S RETSTA=""
"RTN","SYNDHP48",150,0)
 ; loop through the PHARMACY PATIENT file #55 (^PS(55)) for patient (this will contain both IP and OP orders)
"RTN","SYNDHP48",151,0)
 ;
"RTN","SYNDHP48",152,0)
 ; this is start of Inpatient Orders
"RTN","SYNDHP48",153,0)
 S D1=0
"RTN","SYNDHP48",154,0)
 F  S D1=$O(^PS(55,PATIEN,5,D1)) Q:D1'?1N.N  D
"RTN","SYNDHP48",155,0)
 .S IENS=D1_C_PATIEN_C
"RTN","SYNDHP48",156,0)
 .S (ORDDAT,ORDNUM,ROUTE,STATUS,DOSORD,STDT,STDTFM,DRUG,SITEA,QTY,DAYS,RXN)=""
"RTN","SYNDHP48",157,0)
 .N MEDX,MEDERR
"RTN","SYNDHP48",158,0)
 .D GETS^DIQ(55.06,IENS,".01;3;10;28","IEN","MEDX","MEDERR")
"RTN","SYNDHP48",159,0)
 .QUIT:$D(MEDERR)
"RTN","SYNDHP48",160,0)
 .S ORDNUM=$G(MEDX(55.06,IENS,.01,"E"))   ; order number
"RTN","SYNDHP48",161,0)
 .; route is most likely not stored in vista as SCT code, but should check this
"RTN","SYNDHP48",162,0)
 .S ROUTE=$G(MEDX(55.06,IENS,3,"E"))      ; route
"RTN","SYNDHP48",163,0)
 .S STATUS=$G(MEDX(55.06,IENS,28,"E"))    ; status
"RTN","SYNDHP48",164,0)
 .S DOSORD=$P($G(^PS(55,PATIEN,5,D1,.2)),U,2)          ; dosage ordered
"RTN","SYNDHP48",165,0)
 .S STDTFM=$G(MEDX(55.06,IENS,10,"I"))      ; start date
"RTN","SYNDHP48",166,0)
 .QUIT:((STDTFM\1)<FRDAT)!((STDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP48",167,0)
 .S STDT=$$FMTHL7^XLFDT($G(MEDX(55.06,IENS,10,"I")))      ; start date
"RTN","SYNDHP48",168,0)
 .S DRUG=$$GET1^DIQ(55.07,1_C_IENS,.01,"E")  ; medication
"RTN","SYNDHP48",169,0)
 .S DRUGI=$$GET1^DIQ(55.07,1_C_IENS,.01,"I")
"RTN","SYNDHP48",170,0)
 .S RXN=$$GETRXN(DRUGI)
"RTN","SYNDHP48",171,0)
 .I RXN?1.N S RXN="RXN"_RXN
"RTN","SYNDHP48",172,0)
 .S IDENT=$$RESID^SYNDHP69("V",SITE)_UL_55_UL_PATIEN_UL_55.06_UL_D1
"RTN","SYNDHP48",173,0)
 .S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(STDT)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_$G(QTY)_U_$G(DAYS)_U_$G(RXN)_P
"RTN","SYNDHP48",174,0)
 ;
"RTN","SYNDHP48",175,0)
 ; start here for outpatient orders
"RTN","SYNDHP48",176,0)
 S D1=0
"RTN","SYNDHP48",177,0)
 F  S D1=$O(^PS(55,PATIEN,"P",D1)) Q:D1'?1N.N  D
"RTN","SYNDHP48",178,0)
 . S RX=$G(^PS(55,PATIEN,"P",D1,0))
"RTN","SYNDHP48",179,0)
 . S (IDENT,IDATE,DRUG,QTY,DAYS,STATUS,ROUTE)=""
"RTN","SYNDHP48",180,0)
 . N MEDX,MEDERR
"RTN","SYNDHP48",181,0)
 . D GETS^DIQ(52,RX_",",".01;1;2;6;7;8;100","IEN","MEDX","MEDERR")
"RTN","SYNDHP48",182,0)
 . QUIT:$D(MEDERR)
"RTN","SYNDHP48",183,0)
 . S IDENT=$$RESID^SYNDHP69("V",SITE)_UL_52_UL_RX
"RTN","SYNDHP48",184,0)
 . S IDATEFM=$G(MEDX(52,RX_",",1,"I"))     ;issue date
"RTN","SYNDHP48",185,0)
 . QUIT:((IDATEFM\1)<FRDAT)!((IDATEFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP48",186,0)
 . S IDATE=$$FMTHL7^XLFDT($G(MEDX(52,RX_",",1,"I")))     ;issue date
"RTN","SYNDHP48",187,0)
 . S DRUG=$G(MEDX(52,RX_",",6,"E"))      ;medication
"RTN","SYNDHP48",188,0)
 . S DRUGI=$G(MEDX(52,RX_",",6,"I"))
"RTN","SYNDHP48",189,0)
 . S RXN=$$GETRXN(DRUGI)
"RTN","SYNDHP48",190,0)
 . I RXN?1.N S RXN="RXN"_RXN
"RTN","SYNDHP48",191,0)
 . S QTY=$G(MEDX(52,RX_",",7,"E"))       ;quantity
"RTN","SYNDHP48",192,0)
 . S DAYS=$G(MEDX(52,RX_",",8,"E"))      ;days supply
"RTN","SYNDHP48",193,0)
 . S STATUS=$G(MEDX(52,RX_",",100,"E"))  ;status
"RTN","SYNDHP48",194,0)
 . S ROUTE=$$GET1^DIQ(52.0113,"1,"_RX_",",6,"EN")  ;route
"RTN","SYNDHP48",195,0)
 . S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(IDATE)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_$G(QTY)_U_$G(DAYS)_U_$G(RXN)_P
"RTN","SYNDHP48",196,0)
 S RETSTA=DHPICN_U_RETDESC
"RTN","SYNDHP48",197,0)
 Q
"RTN","SYNDHP48",198,0)
 ;
"RTN","SYNDHP48",199,0)
 ; ---------------- Get patient medication dispense ----------------------------
"RTN","SYNDHP48",200,0)
 ;
"RTN","SYNDHP48",201,0)
PATMEDD(RETSTA,DHPICN,FRDAT,TODAT) ; Patient medication dispense for ICN
"RTN","SYNDHP48",202,0)
 ;
"RTN","SYNDHP48",203,0)
 ; Return patient medication dispense for a given patient ICN
"RTN","SYNDHP48",204,0)
 ;
"RTN","SYNDHP48",205,0)
 ; Input:
"RTN","SYNDHP48",206,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP48",207,0)
 ;   FRDAT   - from date (inclusive), optional
"RTN","SYNDHP48",208,0)
 ;   TODAT   - to date (inclusive), optional
"RTN","SYNDHP48",209,0)
 ; Output:
"RTN","SYNDHP48",210,0)
 ;   RETSTA  - a delimited string that lists the following information
"RTN","SYNDHP48",211,0)
 ;      PatientICN ^ RESOURSE ID ^ STATUS ^ MEDICATION ^ DATE ASSERTED ^ CONDITION
"RTN","SYNDHP48",212,0)
 ;      ^ DOSAGE , SITE ; ROUTE ; DOSE ^ QUANTITY ^ DAYS ^ RXN |
"RTN","SYNDHP48",213,0)
 ;
"RTN","SYNDHP48",214,0)
 ;   Identifier will be "V"_SITE ID_"_"_FILEMAN #_"_"_FILE IEN   i.e. V_500_55_930
"RTN","SYNDHP48",215,0)
 ;
"RTN","SYNDHP48",216,0)
 ; validate ICN
"RTN","SYNDHP48",217,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP48",218,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP48",219,0)
 ;
"RTN","SYNDHP48",220,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP48",221,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP48",222,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP48",223,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP48",224,0)
 ;
"RTN","SYNDHP48",225,0)
 N C,ACU,P,S,UL,D1,IDENT,ORDDAT,ORDNUM,ROUTE,STATUS,DOSORD,STDT,STDTFM,DRUG,SITEA
"RTN","SYNDHP48",226,0)
 N RETDESC,SITE,QTY,DAYS,RXN,PATIEN,RX
"RTN","SYNDHP48",227,0)
 S C=",",P="|",S=";",UL="_"
"RTN","SYNDHP48",228,0)
 ; get patient IEN from ICN
"RTN","SYNDHP48",229,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP48",230,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP48",231,0)
 ;
"RTN","SYNDHP48",232,0)
 S RETDESC=""
"RTN","SYNDHP48",233,0)
 S SITE=$P($$SITE^VASITE,U,3)
"RTN","SYNDHP48",234,0)
 S RETSTA=""
"RTN","SYNDHP48",235,0)
 ; loop through the PHARMACY PATIENT file #55 (^PS(55)) for patient (this will contain both IP and OP orders).
"RTN","SYNDHP48",236,0)
 ; OP orders will need to get additional information from the PRESCRIPTION file #52 (^PSRX)
"RTN","SYNDHP48",237,0)
 S D1=0
"RTN","SYNDHP48",238,0)
 F  S D1=$O(^PS(55,PATIEN,5,D1)) Q:D1'?1N.N  D
"RTN","SYNDHP48",239,0)
 .S IENS=D1_C_PATIEN_C
"RTN","SYNDHP48",240,0)
 .S (ORDDAT,ORDNUM,ROUTE,STATUS,DOSORD,STDT,STDTFM,DRUG,SITEA,QTY,DAYS,RXN)=""
"RTN","SYNDHP48",241,0)
 .N MEDX,MEDERR
"RTN","SYNDHP48",242,0)
 .D GETS^DIQ(55.06,IENS,".01;3;10;28","IEN","MEDX","MEDERR")
"RTN","SYNDHP48",243,0)
 .QUIT:$D(MEDERR)
"RTN","SYNDHP48",244,0)
 .S ORDNUM=$G(MEDX(55.06,IENS,.01,"E"))   ; order number
"RTN","SYNDHP48",245,0)
 .; route is most likely not stored in vista as SCT code, but should check this
"RTN","SYNDHP48",246,0)
 .S ROUTE=$G(MEDX(55.06,IENS,3,"E"))      ; route
"RTN","SYNDHP48",247,0)
 .S STATUS=$G(MEDX(55.06,IENS,28,"E"))    ; status
"RTN","SYNDHP48",248,0)
 .S DOSORD=$P($G(^PS(55,PATIEN,5,D1,.2)),U,2)          ; dosage ordered
"RTN","SYNDHP48",249,0)
 .S STDTFM=$G(MEDX(55.06,IENS,10,"I"))      ; start date
"RTN","SYNDHP48",250,0)
 .QUIT:((STDTFM\1)<FRDAT)!((STDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP48",251,0)
 .S STDT=$$FMTHL7^XLFDT($G(MEDX(55.06,IENS,10,"I")))      ; start date
"RTN","SYNDHP48",252,0)
 .S DRUG=$$GET1^DIQ(55.07,1_C_IENS,.01,"E")  ; medication
"RTN","SYNDHP48",253,0)
 .S DRUGI=$$GET1^DIQ(55.07,1_C_IENS,.01,"I")
"RTN","SYNDHP48",254,0)
 .S RXN=$$GETRXN(DRUGI)
"RTN","SYNDHP48",255,0)
 .I RXN?1.N S RXN="RXN"_RXN
"RTN","SYNDHP48",256,0)
 .S IDENT=$$RESID^SYNDHP69("V",SITE)_UL_55_UL_PATIEN_UL_55.06_UL_D1
"RTN","SYNDHP48",257,0)
 .S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(STDT)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_$G(QTY)_U_$G(DAYS)_U_$G(RXN)_P
"RTN","SYNDHP48",258,0)
 ;
"RTN","SYNDHP48",259,0)
 S RETSTA=DHPICN_U_RETDESC
"RTN","SYNDHP48",260,0)
 Q
"RTN","SYNDHP48",261,0)
 ;
"RTN","SYNDHP48",262,0)
TESTS ;
"RTN","SYNDHP48",263,0)
 Q
"RTN","SYNDHP48",264,0)
 ;
"RTN","SYNDHP48",265,0)
T1 ;
"RTN","SYNDHP48",266,0)
 N ICN S ICN=""
"RTN","SYNDHP48",267,0)
 F  S ICN=$O(^DPT("AFICN",ICN)) Q:ICN=""  D
"RTN","SYNDHP48",268,0)
 .W !!!,ICN,!!!
"RTN","SYNDHP48",269,0)
 .D PATMEDS(.RETSTA,ICN)
"RTN","SYNDHP48",270,0)
 .W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP48",271,0)
 .W !!!
"RTN","SYNDHP48",272,0)
 Q
"RTN","SYNDHP48",273,0)
 ;
"RTN","SYNDHP48",274,0)
T2 ;
"RTN","SYNDHP48",275,0)
 N ICN S ICN=""
"RTN","SYNDHP48",276,0)
 F  S ICN=$O(^DPT("AFICN",ICN)) Q:ICN=""  D
"RTN","SYNDHP48",277,0)
 .W !,ICN,!
"RTN","SYNDHP48",278,0)
 .D PATMEDD(.RETSTA,ICN)
"RTN","SYNDHP48",279,0)
 .W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP48",280,0)
 Q
"RTN","SYNDHP48",281,0)
 ;
"RTN","SYNDHP48",282,0)
T3 ;
"RTN","SYNDHP48",283,0)
 N ICN,XPIEN
"RTN","SYNDHP48",284,0)
 S ICN=""
"RTN","SYNDHP48",285,0)
 F  S ICN=$O(^DPT("AFICN",ICN)) Q:ICN=""  D
"RTN","SYNDHP48",286,0)
 .S XPIEN=$O(^DPT("AFICN",ICN,""))
"RTN","SYNDHP48",287,0)
 .W !,ICN,!,XPIEN,!,^DPT(XPIEN,0),!
"RTN","SYNDHP48",288,0)
 .D PATMEDD(.RETSTA,ICN)
"RTN","SYNDHP48",289,0)
 .W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP48",290,0)
 Q
"RTN","SYNDHP48",291,0)
 ;
"RTN","SYNDHP48",292,0)
T4 ;
"RTN","SYNDHP48",293,0)
 N ICN S ICN="10111V183702"
"RTN","SYNDHP48",294,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP48",295,0)
 N TODAT S TODAT=""
"RTN","SYNDHP48",296,0)
 N RETSTA
"RTN","SYNDHP48",297,0)
 D PATMEDA(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP48",298,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP48",299,0)
 QUIT
"RTN","SYNDHP48",300,0)
 ;
"RTN","SYNDHP48",301,0)
T5 ;
"RTN","SYNDHP48",302,0)
 N ICN S ICN="10111V183702"
"RTN","SYNDHP48",303,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP48",304,0)
 N TODAT S TODAT=""
"RTN","SYNDHP48",305,0)
 N RETSTA
"RTN","SYNDHP48",306,0)
 D PATMEDD(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP48",307,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP48",308,0)
 QUIT
"RTN","SYNDHP48",309,0)
 ;
"RTN","SYNDHP48",310,0)
T6 ;
"RTN","SYNDHP48",311,0)
 N ICN S ICN="10111V183702"
"RTN","SYNDHP48",312,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP48",313,0)
 N TODAT S TODAT=""
"RTN","SYNDHP48",314,0)
 N RETSTA
"RTN","SYNDHP48",315,0)
 D PATMEDS(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP48",316,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP48",317,0)
 QUIT
"RTN","SYNDHP48",318,0)
 ;
"RTN","SYNDHP48",319,0)
 ;Statement
"RTN","SYNDHP48",320,0)
 ;IP S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(STDT)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_QTY_U_DAYS_U_RXN_P
"RTN","SYNDHP48",321,0)
 ;OP S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(IDATE)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_QTY_U_DAYS_U_RXN_P
"RTN","SYNDHP48",322,0)
 ;Administer
"RTN","SYNDHP48",323,0)
 ;IP S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(STDT)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_QTY_U_DAYS_U_RXN_P
"RTN","SYNDHP48",324,0)
 ;OP S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(IDATE)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_QTY_U_DAYS_U_RXN_P
"RTN","SYNDHP48",325,0)
 ;Dispense
"RTN","SYNDHP48",326,0)
 ;IP S RETDESC=RETDESC_$G(IDENT)_U_$G(STATUS)_U_$G(DRUG)_U_$G(STDT)_U_"REASON"_U_$G(SITEA)_S_$G(ROUTE)_S_$G(DOSORD)_U_QTY_U_DAYS_U_$G(RXN)_P
"RTN","SYNDHP53")
0^4^B22563892
"RTN","SYNDHP53",1,0)
SYNDHP53 ; HC/fjf/art - HealthConcourse - get patient labs ;05/04/2019
"RTN","SYNDHP53",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP53",3,0)
 ;;
"RTN","SYNDHP53",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP53",5,0)
 ;
"RTN","SYNDHP53",6,0)
 QUIT
"RTN","SYNDHP53",7,0)
 ;
"RTN","SYNDHP53",8,0)
 ;
"RTN","SYNDHP53",9,0)
 ; ---------------- Get patient labs ----------------------
"RTN","SYNDHP53",10,0)
 ;
"RTN","SYNDHP53",11,0)
PATLAB(RETSTA,NAME,SSN,DOB,GENDER,FRDAT,TODAT) ; get labs for a patient by traits
"RTN","SYNDHP53",12,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP53",13,0)
 QUIT
"RTN","SYNDHP53",14,0)
 ; Return patient labs for name, SSN, DOB, and gender
"RTN","SYNDHP53",15,0)
 ;
"RTN","SYNDHP53",16,0)
 ; Input:
"RTN","SYNDHP53",17,0)
 ;   NAME    - patient name
"RTN","SYNDHP53",18,0)
 ;   SSN     - social security number
"RTN","SYNDHP53",19,0)
 ;   DOB     - date of birth
"RTN","SYNDHP53",20,0)
 ;   GENDER  - gender
"RTN","SYNDHP53",21,0)
 ;   FRDAT   - from date (inclusive), optional, compared to 63.04:.01 DATE/TIME SPECIMEN TAKEN
"RTN","SYNDHP53",22,0)
 ;   TODAT   - to date (inclusive), optional, compared to 63.04:.01 DATE/TIME SPECIMEN TAKEN
"RTN","SYNDHP53",23,0)
 ; Output:
"RTN","SYNDHP53",24,0)
 ;   RETSTA  - a delimited string that lists LOINC codes for the patient labs
"RTN","SYNDHP53",25,0)
 ;           - ICN^LOINC code1|LOINC description|result|date|identifier
"RTN","SYNDHP53",26,0)
 ;
"RTN","SYNDHP53",27,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP53",28,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP53",29,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP53",30,0)
 ;
"RTN","SYNDHP53",31,0)
 N P,ICNST,PATIEN
"RTN","SYNDHP53",32,0)
 ;
"RTN","SYNDHP53",33,0)
 S P="|"
"RTN","SYNDHP53",34,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP53",35,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP53",36,0)
 ; if we are here we are dealing with a valid patient
"RTN","SYNDHP53",37,0)
 S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP53",38,0)
 ; get patient IEN from ICN
"RTN","SYNDHP53",39,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP53",40,0)
 I PATIEN="" S RETSTA="-1^Patient ICN not found" QUIT
"RTN","SYNDHP53",41,0)
 D LABS(.RETSTA,PATIEN,FRDAT,TODAT,DHPICN)
"RTN","SYNDHP53",42,0)
 ;
"RTN","SYNDHP53",43,0)
 QUIT
"RTN","SYNDHP53",44,0)
 ;
"RTN","SYNDHP53",45,0)
PATLABI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient labs for ICN
"RTN","SYNDHP53",46,0)
 ;
"RTN","SYNDHP53",47,0)
 ; Return patient labs for a given patient ICN
"RTN","SYNDHP53",48,0)
 ;
"RTN","SYNDHP53",49,0)
 ; Input:
"RTN","SYNDHP53",50,0)
 ;   DHPICN  - unique patient identifier across all VistA systems
"RTN","SYNDHP53",51,0)
 ;   FRDAT   - from date (inclusive), optional, compared to 63.04:.01 DATE/TIME SPECIMEN TAKEN
"RTN","SYNDHP53",52,0)
 ;   TODAT   - to date (inclusive), optional, compared to 63.04:.01 DATE/TIME SPECIMEN TAKEN
"RTN","SYNDHP53",53,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP53",54,0)
 ;             F = Return FHIR
"RTN","SYNDHP53",55,0)
 ;             0 or null = Return lab string (default)
"RTN","SYNDHP53",56,0)
 ; Output:
"RTN","SYNDHP53",57,0)
 ;   RETSTA  - a delimited string that lists LOINC codes for the patient labs
"RTN","SYNDHP53",58,0)
 ;           - ICN^LOINC code1|LOINC description|result|date|resource ID^...
"RTN","SYNDHP53",59,0)
 ;          or patient chem labs in JSON format
"RTN","SYNDHP53",60,0)
 ;
"RTN","SYNDHP53",61,0)
 ; validate ICN
"RTN","SYNDHP53",62,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP53",63,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP53",64,0)
 ;
"RTN","SYNDHP53",65,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP53",66,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP53",67,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP53",68,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP53",69,0)
 ;
"RTN","SYNDHP53",70,0)
 ; get patient IEN from ICN
"RTN","SYNDHP53",71,0)
 N LABARRAY
"RTN","SYNDHP53",72,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP53",73,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP53",74,0)
 ;
"RTN","SYNDHP53",75,0)
 D LABS(.RETSTA,PATIEN,FRDAT,TODAT,DHPICN,.LABARRAY)
"RTN","SYNDHP53",76,0)
 ;
"RTN","SYNDHP53",77,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP53",78,0)
 ;
"RTN","SYNDHP53",79,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP53",80,0)
 . S RETSTA=""
"RTN","SYNDHP53",81,0)
 . D TOJASON^SYNDHPUTL(.LABARRAY,.RETSTA)
"RTN","SYNDHP53",82,0)
 ;
"RTN","SYNDHP53",83,0)
 QUIT
"RTN","SYNDHP53",84,0)
 ;
"RTN","SYNDHP53",85,0)
LABS(LLIST,PATIEN,FRDAT,TODAT,DHPICN,LABARRAY) ; return chem labs for patient
"RTN","SYNDHP53",86,0)
 ;
"RTN","SYNDHP53",87,0)
 N LABREF S LABREF=$$GET1^DIQ(2,PATIEN_",",63) ;laboratory reference in Patient file
"RTN","SYNDHP53",88,0)
 I LABREF="" S LLIST=DHPICN QUIT
"RTN","SYNDHP53",89,0)
 ;
"RTN","SYNDHP53",90,0)
 N P S P="|"
"RTN","SYNDHP53",91,0)
 N RETSEQ S RETSEQ=0
"RTN","SYNDHP53",92,0)
 N LABS,TESTDT,TESTDTHL,LOINCCD,LOINCNM,RESULT,LABID,TESTIEN,TESTNAME,ARRAY
"RTN","SYNDHP53",93,0)
 D GETLABS^SYNDHP21(.LABS,LABREF,0)
"RTN","SYNDHP53",94,0)
 I $D(LABS("Lab","ERROR")) M LABARRAY("Labs",PATIEN)=LABS QUIT
"RTN","SYNDHP53",95,0)
 N SEQ S SEQ=""
"RTN","SYNDHP53",96,0)
 F  S SEQ=$O(LABS("Lab","chemHemToxRiaSerEtcs","chemHemToxRiaSerEtc",SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP53",97,0)
 . N TEST S TEST=$NA(LABS("Lab","chemHemToxRiaSerEtcs","chemHemToxRiaSerEtc",SEQ))
"RTN","SYNDHP53",98,0)
 . S TESTDT=@TEST@("dateTimeSpecimenTakenFM")
"RTN","SYNDHP53",99,0)
 . QUIT:((TESTDT\1)<FRDAT)!((TESTDT\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP53",100,0)
 . S TESTDTHL=@TEST@("dateTimeSpecimenTakenHL7")
"RTN","SYNDHP53",101,0)
 . S LOINCCD=@TEST@("loincCode")
"RTN","SYNDHP53",102,0)
 . S LOINCNM=@TEST@("loincName")
"RTN","SYNDHP53",103,0)
 . S RESULT=@TEST@("result")
"RTN","SYNDHP53",104,0)
 . S TESTIEN=@TEST@("labTestId")
"RTN","SYNDHP53",105,0)
 . S TESTNAME=@TEST@("labTestName")
"RTN","SYNDHP53",106,0)
 . S LABID=@TEST@("resourceId")
"RTN","SYNDHP53",107,0)
 . I $G(DEBUG) D
"RTN","SYNDHP53",108,0)
 . . ;W "  Workload Code: ",WKLDCODE,?30,WKLDNAME,!
"RTN","SYNDHP53",109,0)
 . . W "  Test Name:     ",TESTIEN,?30,TESTNAME,!
"RTN","SYNDHP53",110,0)
 . . W "  LOINC Code: ",LOINCCD,!
"RTN","SYNDHP53",111,0)
 . . W "  LOINC Name: ",LOINCNM,!
"RTN","SYNDHP53",112,0)
 . . W "  Result:     ",RESULT,!
"RTN","SYNDHP53",113,0)
 . S RETSEQ=RETSEQ+1
"RTN","SYNDHP53",114,0)
 . S ARRAY(RETSEQ)=LOINCCD_P_LOINCNM_P_RESULT_P_TESTDTHL_P_LABID
"RTN","SYNDHP53",115,0)
 . M LABARRAY("Labs",PATIEN)=LABS ;
"RTN","SYNDHP53",116,0)
 ;
"RTN","SYNDHP53",117,0)
 ;I $G(DEBUG) W ! ZWRITE ARRAY W !
"RTN","SYNDHP53",118,0)
 ;serialize data
"RTN","SYNDHP53",119,0)
 S LLIST=DHPICN
"RTN","SYNDHP53",120,0)
 S RETSEQ=""
"RTN","SYNDHP53",121,0)
 F  S RETSEQ=$O(ARRAY(RETSEQ)) QUIT:RETSEQ=""  D
"RTN","SYNDHP53",122,0)
 . S LLIST=LLIST_U_ARRAY(RETSEQ)
"RTN","SYNDHP53",123,0)
 ;
"RTN","SYNDHP53",124,0)
 QUIT
"RTN","SYNDHP53",125,0)
 ;
"RTN","SYNDHP53",126,0)
 ; --------------------------------------------------------------------
"RTN","SYNDHP53",127,0)
 ;
"RTN","SYNDHP53",128,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP53",129,0)
T1 ;
"RTN","SYNDHP53",130,0)
 N ICN S ICN="1034989029V875306"
"RTN","SYNDHP53",131,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP53",132,0)
 N TODAT S TODAT=""
"RTN","SYNDHP53",133,0)
 N JSON S JSON=""
"RTN","SYNDHP53",134,0)
 N RETSTA
"RTN","SYNDHP53",135,0)
 D PATLABI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP53",136,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP53",137,0)
 QUIT
"RTN","SYNDHP53",138,0)
 ;
"RTN","SYNDHP53",139,0)
T2 ;
"RTN","SYNDHP53",140,0)
 N ICN S ICN="1034989029V875306"
"RTN","SYNDHP53",141,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP53",142,0)
 N TODAT S TODAT=""
"RTN","SYNDHP53",143,0)
 N JSON S JSON="J"
"RTN","SYNDHP53",144,0)
 N RETSTA
"RTN","SYNDHP53",145,0)
 D PATLABI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP53",146,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP53",147,0)
 QUIT
"RTN","SYNDHP53",148,0)
 ;
"RTN","SYNDHP54")
0^5^B25313993
"RTN","SYNDHP54",1,0)
SYNDHP54 ; HC/rbd/art - HealthConcourse - retrieve patient provider data ;04/12/2019
"RTN","SYNDHP54",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP54",3,0)
 ;;
"RTN","SYNDHP54",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP54",5,0)
 ;
"RTN","SYNDHP54",6,0)
 QUIT
"RTN","SYNDHP54",7,0)
 ;
"RTN","SYNDHP54",8,0)
 ; ---------------- Get patient providers for encounters ------------------------------
"RTN","SYNDHP54",9,0)
 ;
"RTN","SYNDHP54",10,0)
PATPRVI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient encounter providers for ICN
"RTN","SYNDHP54",11,0)
 ;
"RTN","SYNDHP54",12,0)
 ; Return patient enc providers for a given patient ICN
"RTN","SYNDHP54",13,0)
 ;
"RTN","SYNDHP54",14,0)
 ; Input:
"RTN","SYNDHP54",15,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP54",16,0)
 ;   FRDAT   - from date (inclusive), optional, compares to Visit Date/Time
"RTN","SYNDHP54",17,0)
 ;   TODAT   - to date (inclusive), optional, compares to Visit Date/Time
"RTN","SYNDHP54",18,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP54",19,0)
 ;             F = Return FHIR
"RTN","SYNDHP54",20,0)
 ;             0 or null = Return patient providers string (default)
"RTN","SYNDHP54",21,0)
 ; Output:
"RTN","SYNDHP54",22,0)
 ;   RETSTA  - a delimited string that lists patient providers for encounters
"RTN","SYNDHP54",23,0)
 ;             ICN^visit date|visit ien|provider name|role|prim/sec|address1|address2|city|state|zip|off. phone|specialization|resourceId^...
"RTN","SYNDHP54",24,0)
 ;          or patient enc providers in JSON format
"RTN","SYNDHP54",25,0)
 ;
"RTN","SYNDHP54",26,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP54",27,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP54",28,0)
 I $G(DEBUG) W !,"DHPICN: ",DHPICN,"   FRDAT: ",FRDAT,"   TODAT: ",TODAT,"   RETJSON: ",RETJSON,!
"RTN","SYNDHP54",29,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP54",30,0)
 ;
"RTN","SYNDHP54",31,0)
 ; validate ICN
"RTN","SYNDHP54",32,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP54",33,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP54",34,0)
 ; 
"RTN","SYNDHP54",35,0)
 ; get patient IEN from ICN
"RTN","SYNDHP54",36,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP54",37,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP54",38,0)
 ;
"RTN","SYNDHP54",39,0)
 ; get encounter providers
"RTN","SYNDHP54",40,0)
 N ENCPROV
"RTN","SYNDHP54",41,0)
 S RETSTA=$$PRVS(.ENCPROV,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP54",42,0)
 ;
"RTN","SYNDHP54",43,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP54",44,0)
 ;
"RTN","SYNDHP54",45,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP54",46,0)
 . S RETSTA=""
"RTN","SYNDHP54",47,0)
 . D TOJASON^SYNDHPUTL(.ENCPROV,.RETSTA)
"RTN","SYNDHP54",48,0)
 ;
"RTN","SYNDHP54",49,0)
 Q
"RTN","SYNDHP54",50,0)
 ;
"RTN","SYNDHP54",51,0)
PRVS(ENCPROV,PATIEN,DHPICN,FRDAT,TODAT) ; get providers for encounters for a patient
"RTN","SYNDHP54",52,0)
 ;
"RTN","SYNDHP54",53,0)
 N ENCPROVS,ZARR
"RTN","SYNDHP54",54,0)
 N PRCITY,PRID,PRNAM,PROFFPH,PRPRMSEC,PRREC,PRROLE,PRSTAD1,PRSTAD2,PRSTATE,PRVID,PRVSTDT,PRVVIEN,PRZIP
"RTN","SYNDHP54",55,0)
 N USRCLIEN,USRSPEC,VSTDT
"RTN","SYNDHP54",56,0)
 N P S P="|"
"RTN","SYNDHP54",57,0)
 ; scan visit providers "C" index for IEN
"RTN","SYNDHP54",58,0)
 N PRIEN S PRIEN=""
"RTN","SYNDHP54",59,0)
 F  S PRIEN=$O(^AUPNVPRV("C",PATIEN,PRIEN)) QUIT:PRIEN=""  D
"RTN","SYNDHP54",60,0)
 . N VPROV
"RTN","SYNDHP54",61,0)
 . D GET1VPROV^SYNDHP23(.VPROV,PRIEN,0)
"RTN","SYNDHP54",62,0)
 . I $D(VPROV("Vprov","ERROR")) M ENCPROV("EncProv",PRIEN)=VPROV QUIT
"RTN","SYNDHP54",63,0)
 . ;I $G(DEBUG) W ! ZWRITE VPROV
"RTN","SYNDHP54",64,0)
 . S VSTDT=VPROV("Vprov","visitFM")
"RTN","SYNDHP54",65,0)
 . QUIT:((VSTDT\1)<FRDAT)!((VSTDT\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP54",66,0)
 . S PRID=VPROV("Vprov","resourceId")
"RTN","SYNDHP54",67,0)
 . S PRNAM=VPROV("Vprov","provider")
"RTN","SYNDHP54",68,0)
 . S PRVVIEN=VPROV("Vprov","visitId")
"RTN","SYNDHP54",69,0)
 . S PRVSTDT=VPROV("Vprov","visitHL7")
"RTN","SYNDHP54",70,0)
 . S PRVID=VPROV("Vprov","providerId")
"RTN","SYNDHP54",71,0)
 . S PRPRMSEC=VPROV("Vprov","primarySecondary")
"RTN","SYNDHP54",72,0)
 . N PROVARR,PROVERR
"RTN","SYNDHP54",73,0)
 . N IENS S IENS=PRVID_","
"RTN","SYNDHP54",74,0)
 . D GETS^DIQ(200,IENS,"8;.111;.112;.114;.115;.116;.132;41.99","EI","PROVARR","PROVERR")
"RTN","SYNDHP54",75,0)
 . ;I $G(DEBUG),$D(PROVERR) W !,">>ERROR<<" ZWRITE PROVERR
"RTN","SYNDHP54",76,0)
 . QUIT:$D(PROVERR)
"RTN","SYNDHP54",77,0)
 . S PRROLE=PROVARR(200,IENS,8,"E")
"RTN","SYNDHP54",78,0)
 . S VPROV("Vprov","provRole")=PRROLE
"RTN","SYNDHP54",79,0)
 . S PRSTAD1=PROVARR(200,IENS,.111,"E")
"RTN","SYNDHP54",80,0)
 . S VPROV("Vprov","provAddress1")=PRSTAD1
"RTN","SYNDHP54",81,0)
 . S PRSTAD2=PROVARR(200,IENS,.112,"E")
"RTN","SYNDHP54",82,0)
 . S VPROV("Vprov","provAddress2")=PRSTAD2
"RTN","SYNDHP54",83,0)
 . S PRCITY=PROVARR(200,IENS,.114,"E")
"RTN","SYNDHP54",84,0)
 . S VPROV("Vprov","provCity")=PRCITY
"RTN","SYNDHP54",85,0)
 . S PRSTATE=PROVARR(200,IENS,.115,"E")
"RTN","SYNDHP54",86,0)
 . S VPROV("Vprov","provState")=PRSTATE
"RTN","SYNDHP54",87,0)
 . S PRZIP=PROVARR(200,IENS,.116,"E")
"RTN","SYNDHP54",88,0)
 . S VPROV("Vprov","provZip")=PRZIP
"RTN","SYNDHP54",89,0)
 . S PROFFPH=PROVARR(200,IENS,.132,"E")
"RTN","SYNDHP54",90,0)
 . S VPROV("Vprov","provOffPhone")=PROFFPH
"RTN","SYNDHP54",91,0)
 . S VPROV("Vprov","provNpi")=PROVARR(200,IENS,41.99,"E")
"RTN","SYNDHP54",92,0)
 . S USRCLIEN=VPROV("Vprov","personClassId")
"RTN","SYNDHP54",93,0)
 . S USRSPEC=$$GET1^DIQ(8932.1,USRCLIEN_",",2)
"RTN","SYNDHP54",94,0)
 . S VPROV("Vprov","personClassSpecialty")=USRSPEC
"RTN","SYNDHP54",95,0)
 . I $G(DEBUG) W !,PRNAM_U_PRVSTDT_U_PRROLE_U_PRPRMSEC
"RTN","SYNDHP54",96,0)
 . S ZARR(DHPICN,PRVSTDT,PRVVIEN)=PRNAM_P_PRROLE_P_PRPRMSEC_P_PRSTAD1_P_PRSTAD2_P_PRCITY_P_PRSTATE_P_PRZIP_P_PROFFPH_P_USRSPEC_P_PRID
"RTN","SYNDHP54",97,0)
 . M ENCPROV("EncProv",PRIEN)=VPROV ;
"RTN","SYNDHP54",98,0)
 ;
"RTN","SYNDHP54",99,0)
 ; serialize data
"RTN","SYNDHP54",100,0)
 S (PRVSTDT,PRVVIEN)="",ENCPROVS=DHPICN
"RTN","SYNDHP54",101,0)
 F  S PRVSTDT=$O(ZARR(DHPICN,PRVSTDT)) QUIT:PRVSTDT=""  D
"RTN","SYNDHP54",102,0)
 .F  S PRVVIEN=$O(ZARR(DHPICN,PRVSTDT,PRVVIEN)) Q:PRVVIEN=""  D
"RTN","SYNDHP54",103,0)
 ..S PRREC=ZARR(DHPICN,PRVSTDT,PRVVIEN)
"RTN","SYNDHP54",104,0)
 ..S ENCPROVS=ENCPROVS_U_PRVSTDT_P_PRVVIEN_P_PRREC
"RTN","SYNDHP54",105,0)
 ..; visit date|visit ien|provider name|role|prim/sec|address1|address2|city|state|zip|off. phone|specialization|resourceId
"RTN","SYNDHP54",106,0)
 ;
"RTN","SYNDHP54",107,0)
 QUIT ENCPROVS
"RTN","SYNDHP54",108,0)
 ;
"RTN","SYNDHP54",109,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP54",110,0)
T1 ;
"RTN","SYNDHP54",111,0)
 N ICN S ICN="1095759922V858498"
"RTN","SYNDHP54",112,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP54",113,0)
 N TODAT S TODAT=""
"RTN","SYNDHP54",114,0)
 N JSON S JSON=""
"RTN","SYNDHP54",115,0)
 N RETSTA
"RTN","SYNDHP54",116,0)
 D PATPRVI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP54",117,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP54",118,0)
 QUIT
"RTN","SYNDHP54",119,0)
 ;
"RTN","SYNDHP54",120,0)
T2 ;
"RTN","SYNDHP54",121,0)
 N ICN S ICN="1095759922V858498"
"RTN","SYNDHP54",122,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP54",123,0)
 N TODAT S TODAT=""
"RTN","SYNDHP54",124,0)
 N JSON S JSON="J"
"RTN","SYNDHP54",125,0)
 N RETSTA
"RTN","SYNDHP54",126,0)
 D PATPRVI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP54",127,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP54",128,0)
 QUIT
"RTN","SYNDHP54",129,0)
 ;
"RTN","SYNDHP55")
0^6^B170944201
"RTN","SYNDHP55",1,0)
SYNDHP55 ; HC/art - HealthConcourse - retrieve patient procedures ;04/15/2019
"RTN","SYNDHP55",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP55",3,0)
 ;;
"RTN","SYNDHP55",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP55",5,0)
 ;
"RTN","SYNDHP55",6,0)
 ;Surgical Procedures
"RTN","SYNDHP55",7,0)
 ;Visit Procedures
"RTN","SYNDHP55",8,0)
 ;Radiology Procedures
"RTN","SYNDHP55",9,0)
 ;Radiology Reports
"RTN","SYNDHP55",10,0)
 ;
"RTN","SYNDHP55",11,0)
 QUIT
"RTN","SYNDHP55",12,0)
 ;
"RTN","SYNDHP55",13,0)
 ;Surgical Procedures
"RTN","SYNDHP55",14,0)
SRPRCS(PTIEN,FRDAT,TODAT) ; get surgical procedures for a patient
"RTN","SYNDHP55",15,0)
 ; build the array of SNOMED CT codes that correspond to procedures
"RTN","SYNDHP55",16,0)
 ;
"RTN","SYNDHP55",17,0)
 N PROCS,FNUM,FNBR2,PIEN,PIENS,PRCPTCD,PRCPTIEN,PID,SCT,SCTPT,SEQ,DATE,MAPPING
"RTN","SYNDHP55",18,0)
 N VISITID,VISITDT,VISITHL,SURG,PROV,PDATE,PDATEHL,PRDATE,PRDATEHL,SERPROCS,CLINIC,DIVISION
"RTN","SYNDHP55",19,0)
 N ORDER,ORDERIEN,PRINPROC,SCHDPROC
"RTN","SYNDHP55",20,0)
 ;
"RTN","SYNDHP55",21,0)
 N P S P="|"
"RTN","SYNDHP55",22,0)
 N S S S="_"
"RTN","SYNDHP55",23,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP55",24,0)
 S FNUM=130 ;surgery
"RTN","SYNDHP55",25,0)
 S FNBR2=9000010 ;visit
"RTN","SYNDHP55",26,0)
 N FLIST S FLIST=".015;.021;.09;.14;26;27;50;68;100;120;123"
"RTN","SYNDHP55",27,0)
 S SEQ=0
"RTN","SYNDHP55",28,0)
 ;
"RTN","SYNDHP55",29,0)
 I $G(DEBUG) W !,"Surgical Procedures",!
"RTN","SYNDHP55",30,0)
 ; scan surgery "B" index for IEN
"RTN","SYNDHP55",31,0)
 S PIEN=""
"RTN","SYNDHP55",32,0)
 F  S PIEN=$O(^SRF("B",PTIEN,PIEN)) QUIT:PIEN=""  D
"RTN","SYNDHP55",33,0)
 . N SURGARR,SURGERR
"RTN","SYNDHP55",34,0)
 . S PIENS=PIEN_","
"RTN","SYNDHP55",35,0)
 . D GETS^DIQ(FNUM,PIENS,FLIST,"EI","SURGARR","SURGERR")  ;specific fields
"RTN","SYNDHP55",36,0)
 . ;I $G(DEBUG),$D(SURGERR) W !,">>ERROR<<",! ZWRITE SURGERR
"RTN","SYNDHP55",37,0)
 . QUIT:$D(SURGERR)
"RTN","SYNDHP55",38,0)
 . S PID=$$RESID^SYNDHP69("V",SITE)_S_FNUM_S_PIEN
"RTN","SYNDHP55",39,0)
 . S PDATE=SURGARR(FNUM,PIENS,.09,"I") ;date of operation
"RTN","SYNDHP55",40,0)
 . QUIT:((PDATE\1)<FRDAT)!((PDATE\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP55",41,0)
 . S PDATEHL=$$FMTHL7^XLFDT(PDATE) ;date of operation, hl7 format
"RTN","SYNDHP55",42,0)
 . S CLINIC=SURGARR(FNUM,PIENS,.021,"E") ;associated clinic
"RTN","SYNDHP55",43,0)
 . S DIVISION=SURGARR(FNUM,PIENS,50,"E") ;division
"RTN","SYNDHP55",44,0)
 . S SURG=SURGARR(FNUM,PIENS,.14,"E") ;primary surgeon
"RTN","SYNDHP55",45,0)
 . S PRDATE=SURGARR(FNUM,PIENS,120,"I") ;date of procedure
"RTN","SYNDHP55",46,0)
 . S PRDATEHL=$$FMTHL7^XLFDT(PRDATE) ;date of operation, hl7 format
"RTN","SYNDHP55",47,0)
 . S PROV=SURGARR(FNUM,PIENS,123,"E") ;provider
"RTN","SYNDHP55",48,0)
 . S VISITID=SURGARR(FNUM,PIENS,.015,"I") ;visit, pointer to Visit file
"RTN","SYNDHP55",49,0)
 . S VISITDT=""
"RTN","SYNDHP55",50,0)
 . S:VISITID'="" VISITDT=$$GET1^DIQ(FNBR2,VISITID_",",.01,"I") ;visit/admit date&time
"RTN","SYNDHP55",51,0)
 . S VISITHL=$$FMTHL7^XLFDT(VISITDT) ;hl7 format visit/admit date&time
"RTN","SYNDHP55",52,0)
 . S ORDERIEN=SURGARR(FNUM,PIENS,100,"I") ;order number ien
"RTN","SYNDHP55",53,0)
 . S ORDER=SURGARR(FNUM,PIENS,100,"E") ;order number
"RTN","SYNDHP55",54,0)
 . S PRCPTIEN=SURGARR(FNUM,PIENS,27,"I") ;planned prin procedure code ien
"RTN","SYNDHP55",55,0)
 . S PRCPTCD=SURGARR(FNUM,PIENS,27,"E") ;planned prin procedure code
"RTN","SYNDHP55",56,0)
 . S PRINPROC=SURGARR(FNUM,PIENS,26,"E") ;principal procedure
"RTN","SYNDHP55",57,0)
 . S SCHDPROC=SURGARR(FNUM,PIENS,68,"E") ;scheduled procedure
"RTN","SYNDHP55",58,0)
 . ;LOOKUP SNOMED(sct) - cpt, os5
"RTN","SYNDHP55",59,0)
 . S SCT=""
"RTN","SYNDHP55",60,0)
 . S SCTPT=$S(PRINPROC'="":PRINPROC,1:"")
"RTN","SYNDHP55",61,0)
 . ;map cpt to snomed (currently uses very small map)
"RTN","SYNDHP55",62,0)
 . I PRCPTCD'="" D
"RTN","SYNDHP55",63,0)
 . . S SCT=$$MAP^SYNDHPMP("sct2cpt",PRCPTCD,"I")
"RTN","SYNDHP55",64,0)
 . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP55",65,0)
 . ;if no cpt hit, map os5 to snomed
"RTN","SYNDHP55",66,0)
 . I SCT="",PRCPTCD'="" D
"RTN","SYNDHP55",67,0)
 . . S SCT=$$MAP^SYNDHPMP("sct2os5",PRCPTCD,"I")
"RTN","SYNDHP55",68,0)
 . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP55",69,0)
 . I $G(DEBUG) D
"RTN","SYNDHP55",70,0)
 . . W !,"Record IEN: ",PIEN,!
"RTN","SYNDHP55",71,0)
 . . W "Planned Principal Procedure (CPT): ",PRCPTIEN,"     ",PRCPTCD,!
"RTN","SYNDHP55",72,0)
 . . W "Principal Procedure: ",?22,PRINPROC,!
"RTN","SYNDHP55",73,0)
 . . W "Scheduled Procedure: ",?22,SCHDPROC,!
"RTN","SYNDHP55",74,0)
 . . W "SCT: ",?22,SCT,!
"RTN","SYNDHP55",75,0)
 . . W "SCT Description: ",?22,SCTPT,!
"RTN","SYNDHP55",76,0)
 . . W "Date of Operation: ",?22,PDATE,"     ",PDATEHL,!
"RTN","SYNDHP55",77,0)
 . . W "Date of Procedure: ",?22,PRDATE,"     ",PRDATEHL,!
"RTN","SYNDHP55",78,0)
 . . W "Primary Surgeon: ",?22,SURG,!
"RTN","SYNDHP55",79,0)
 . . W "Provider: ",?22,PROV,!
"RTN","SYNDHP55",80,0)
 . . W "Clinic: ",?22,CLINIC,!
"RTN","SYNDHP55",81,0)
 . . W "Division: ",?22,DIVISION,!
"RTN","SYNDHP55",82,0)
 . . W "Order: ",?22,ORDERIEN,"     ",ORDER,!
"RTN","SYNDHP55",83,0)
 . . W "Visit IEN: ",?22,VISITID,!
"RTN","SYNDHP55",84,0)
 . . W "Visit Date: ",?22,VISITDT,"     ",VISITHL,!
"RTN","SYNDHP55",85,0)
 . . W "PID: ",?22,PID,!
"RTN","SYNDHP55",86,0)
 . S DATE=$S(PDATE'="":PDATEHL,PRDATE'="":PRDATEHL,VISITDT'="":VISITHL,1:"")
"RTN","SYNDHP55",87,0)
 . ;SCT code1|descrption|CPT code|date|identifier
"RTN","SYNDHP55",88,0)
 . S SEQ=SEQ+1
"RTN","SYNDHP55",89,0)
 . S PROCS(SEQ)=U_SCT_P_SCTPT_P_PRCPTCD_P_PDATEHL_P_PID
"RTN","SYNDHP55",90,0)
 ;
"RTN","SYNDHP55",91,0)
 ;I $G(DEBUG) W ! ZWRITE PROCS
"RTN","SYNDHP55",92,0)
 ;
"RTN","SYNDHP55",93,0)
 ;serialize data
"RTN","SYNDHP55",94,0)
 S SERPROCS=""
"RTN","SYNDHP55",95,0)
 S SEQ=""
"RTN","SYNDHP55",96,0)
 F  S SEQ=$O(PROCS(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP55",97,0)
 . S SERPROCS=SERPROCS_PROCS(SEQ)
"RTN","SYNDHP55",98,0)
 ;
"RTN","SYNDHP55",99,0)
 ;I $G(DEBUG) W ! ZWRITE SERPROCS
"RTN","SYNDHP55",100,0)
 ;
"RTN","SYNDHP55",101,0)
 QUIT SERPROCS
"RTN","SYNDHP55",102,0)
 ;
"RTN","SYNDHP55",103,0)
 ;Visit Procedures
"RTN","SYNDHP55",104,0)
VSTPRCS(PATIEN,FRDAT,TODAT) ;
"RTN","SYNDHP55",105,0)
 ;
"RTN","SYNDHP55",106,0)
 N PROCS,FNBR1,FNBR2,PIEN,VISITID,VISITDT,PRPROC
"RTN","SYNDHP55",107,0)
 N VISITHL,CPT,CPTNAME,PID,SEQ,SERPROCS,MAPPING,SCT
"RTN","SYNDHP55",108,0)
 ;
"RTN","SYNDHP55",109,0)
 S PROCS=""
"RTN","SYNDHP55",110,0)
 N P S P="|"
"RTN","SYNDHP55",111,0)
 S SEQ=0
"RTN","SYNDHP55",112,0)
 S FNBR1=9000010.18 ;v cpt
"RTN","SYNDHP55",113,0)
 S FNBR2=9000010 ;visit
"RTN","SYNDHP55",114,0)
 I $G(DEBUG) W !,"Visit Procedures",!
"RTN","SYNDHP55",115,0)
 ;
"RTN","SYNDHP55",116,0)
 S PIEN=""
"RTN","SYNDHP55",117,0)
 F  S PIEN=$O(^AUPNVCPT("C",PATIEN,PIEN)) QUIT:PIEN=""  D
"RTN","SYNDHP55",118,0)
 . N VCPT
"RTN","SYNDHP55",119,0)
 . D GET1VCPT^SYNDHP14(.VCPT,PIEN,0)
"RTN","SYNDHP55",120,0)
 . QUIT:$D(VCPT("Vcpt","ERROR"))
"RTN","SYNDHP55",121,0)
 . ;I $G(DEBUG) ZWRITE VCPT
"RTN","SYNDHP55",122,0)
 . S VISITDT=VCPT("Vcpt","visitFM") ;visit/admit date&time
"RTN","SYNDHP55",123,0)
 . QUIT:((VISITDT\1)<FRDAT)!((VISITDT\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP55",124,0)
 . S VISITHL=VCPT("Vcpt","visitHL7") ;hl7 format visit/admit date&time
"RTN","SYNDHP55",125,0)
 . S PID=VCPT("Vcpt","resourceId")
"RTN","SYNDHP55",126,0)
 . S CPT=VCPT("Vcpt","cpt") ;cpt code
"RTN","SYNDHP55",127,0)
 . S CPTNAME=VCPT("Vcpt","cptName") ;cpt name
"RTN","SYNDHP55",128,0)
 . S VISITDT=VCPT("Vcpt","visitFM") ;visit/admit date&time
"RTN","SYNDHP55",129,0)
 . QUIT:(VISITDT<FRDAT)!(VISITDT>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP55",130,0)
 . S VISITHL=VCPT("Vcpt","visitHL7") ;hl7 format visit/admit date&time
"RTN","SYNDHP55",131,0)
 . ;LOOKUP SNOMED(sct) - cpt, os5
"RTN","SYNDHP55",132,0)
 . S SCT=""
"RTN","SYNDHP55",133,0)
 . ;map cpt to snomed (currently uses very small map)
"RTN","SYNDHP55",134,0)
 . I CPT'="" D
"RTN","SYNDHP55",135,0)
 . . S SCT=$$MAP^SYNDHPMP("sct2cpt",CPT,"I")
"RTN","SYNDHP55",136,0)
 . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP55",137,0)
 . ;if no cpt hit, map os5 to snomed
"RTN","SYNDHP55",138,0)
 . I SCT="",CPT'="" D
"RTN","SYNDHP55",139,0)
 . . S SCT=$$MAP^SYNDHPMP("sct2os5",CPT,"I")
"RTN","SYNDHP55",140,0)
 . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP55",141,0)
 . S SEQ=SEQ+1
"RTN","SYNDHP55",142,0)
 . ;SCT code1|descrption|CPT code|date|identifier
"RTN","SYNDHP55",143,0)
 . S PROCS(SEQ)=U_SCT_P_CPTNAME_P_CPT_P_VISITHL_P_PID
"RTN","SYNDHP55",144,0)
 ;
"RTN","SYNDHP55",145,0)
 ;I $G(DEBUG) W ! ZWRITE PROCS
"RTN","SYNDHP55",146,0)
 ;
"RTN","SYNDHP55",147,0)
 ;serialize data
"RTN","SYNDHP55",148,0)
 S SERPROCS=""
"RTN","SYNDHP55",149,0)
 S SEQ=""
"RTN","SYNDHP55",150,0)
 F  S SEQ=$O(PROCS(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP55",151,0)
 . S SERPROCS=SERPROCS_PROCS(SEQ)
"RTN","SYNDHP55",152,0)
 ;
"RTN","SYNDHP55",153,0)
 ;I $G(DEBUG) W ! ZWRITE SERPROCS
"RTN","SYNDHP55",154,0)
 ;
"RTN","SYNDHP55",155,0)
 QUIT SERPROCS
"RTN","SYNDHP55",156,0)
 ;
"RTN","SYNDHP55",157,0)
 ;Radiology Procedures
"RTN","SYNDHP55",158,0)
RADPRCS(PATIEN,FRDAT,TODAT) ;
"RTN","SYNDHP55",159,0)
 ;
"RTN","SYNDHP55",160,0)
 N P S P="|"
"RTN","SYNDHP55",161,0)
 N SEQ S SEQ=0
"RTN","SYNDHP55",162,0)
 I $G(DEBUG) W !,"Radiology Procedures",!
"RTN","SYNDHP55",163,0)
 N RADEX
"RTN","SYNDHP55",164,0)
 D RADEXAM(.RADEX,PATIEN,0,FRDAT,TODAT)
"RTN","SYNDHP55",165,0)
 ;             1      2        3       4            5            6         7        8     9     10     11         12      13        14        15       16
"RTN","SYNDHP55",166,0)
 ; RADEX(SEQ)=PID_U_PatDfn_U_CatEx_U_ExamDate_U_ExamDateHl7_U_CASENBR_U_PROCIEN_U_PROC_U_CPT_U_SCT_U_PDIAGCD_U_REQPHYS_U_PIRES_U_PISTAFF_U_VISITDT_U_VISITHL
"RTN","SYNDHP55",167,0)
 ;
"RTN","SYNDHP55",168,0)
 N SCT,PROC,PROCS,CPT,EXDATE,EXDATEHL,PID
"RTN","SYNDHP55",169,0)
 N IDX S IDX=""
"RTN","SYNDHP55",170,0)
 F  S IDX=$O(RADEX(IDX)) QUIT:IDX=""  D
"RTN","SYNDHP55",171,0)
 . S EXDATE=$P(RADEX(IDX),U,4)
"RTN","SYNDHP55",172,0)
 . QUIT:((EXDATE\1)<FRDAT)!((EXDATE\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP55",173,0)
 . S SCT=$P(RADEX(IDX),U,10)
"RTN","SYNDHP55",174,0)
 . S PROC=$P(RADEX(IDX),U,8)
"RTN","SYNDHP55",175,0)
 . S CPT=$P(RADEX(IDX),U,9)
"RTN","SYNDHP55",176,0)
 . S EXDATEHL=$P(RADEX(IDX),U,5)
"RTN","SYNDHP55",177,0)
 . S PID=$P(RADEX(IDX),U,1)
"RTN","SYNDHP55",178,0)
 . ;SCT code|descrption|CPT code|date|identifier
"RTN","SYNDHP55",179,0)
 . S SEQ=SEQ+1
"RTN","SYNDHP55",180,0)
 . S PROCS(SEQ)=U_SCT_P_PROC_P_CPT_P_EXDATEHL_P_PID
"RTN","SYNDHP55",181,0)
 ;
"RTN","SYNDHP55",182,0)
 ;I $G(DEBUG) W ! ZWRITE PROCS
"RTN","SYNDHP55",183,0)
 ;
"RTN","SYNDHP55",184,0)
 ;serialize data
"RTN","SYNDHP55",185,0)
 N SERPROCS S SERPROCS=""
"RTN","SYNDHP55",186,0)
 N SEQ S SEQ=""
"RTN","SYNDHP55",187,0)
 F  S SEQ=$O(PROCS(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP55",188,0)
 . S SERPROCS=SERPROCS_PROCS(SEQ)
"RTN","SYNDHP55",189,0)
 ;
"RTN","SYNDHP55",190,0)
 ;I $G(DEBUG) W ! ZWRITE SERPROCS
"RTN","SYNDHP55",191,0)
 ;
"RTN","SYNDHP55",192,0)
 QUIT SERPROCS
"RTN","SYNDHP55",193,0)
 ;
"RTN","SYNDHP55",194,0)
 ;
"RTN","SYNDHP55",195,0)
 ;Radiology Procedures
"RTN","SYNDHP55",196,0)
RADEXAM(RADEX,PATIEN,RPT,FRDAT,TODAT) ;Radiology procedures, diagnosis, report for a patient
"RTN","SYNDHP55",197,0)
 ;Inputs: PATIEN - patient IEN
"RTN","SYNDHP55",198,0)
 ;        RPT - return report, 0=no, 1=yes
"RTN","SYNDHP55",199,0)
 ;Output: RADEX - array of radiology exams, by reference
"RTN","SYNDHP55",200,0)
 ;          PID^PatDfn^Category^ExamDate^ExamDateHl7^CASENBR^PROCIEN^PROC^CPT^SCT^PDIAGCD^REQPHYS^
"RTN","SYNDHP55",201,0)
 ;            PIRES^PISTAFF^VISITDT^VISITHL^EnteringUser
"RTN","SYNDHP55",202,0)
 ;
"RTN","SYNDHP55",203,0)
 S RADEX=""
"RTN","SYNDHP55",204,0)
 N S S S="_"
"RTN","SYNDHP55",205,0)
 N SEQ S SEQ=0
"RTN","SYNDHP55",206,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP55",207,0)
 N FNBR1 S FNBR1=70 ;RAD/NUC MED PATIENT FILE, this file DINUMed
"RTN","SYNDHP55",208,0)
 N FNBR2 S FNBR2=70.02 ;RAD/NUC MED PATIENT FILE:REGISTERED EXAMS
"RTN","SYNDHP55",209,0)
 N FNBR3 S FNBR3=70.03 ;RAD/NUC MED PATIENT FILE:REGISTERED EXAMS:EXAMINATIONS
"RTN","SYNDHP55",210,0)
 N FNBR4 S FNBR4=9000010 ;visit
"RTN","SYNDHP55",211,0)
 ;
"RTN","SYNDHP55",212,0)
 ;get patient record
"RTN","SYNDHP55",213,0)
 N IENS S IENS=PATIEN_","
"RTN","SYNDHP55",214,0)
 N RADRPT,PATARR,PATERR
"RTN","SYNDHP55",215,0)
 D GETS^DIQ(FNBR1,IENS,".01;.04;.06","EI","PATARR","PATERR")  ;specific fields
"RTN","SYNDHP55",216,0)
 ;I $G(DEBUG),$D(PATERR) W !,"FNBR1:",FNBR1,!,"IENS:",IENS,!,">>ERROR<<",! ZWRITE PATERR
"RTN","SYNDHP55",217,0)
 QUIT:$D(PATERR)
"RTN","SYNDHP55",218,0)
 N PatDfn S PatDfn=$G(PATARR(FNBR1,IENS,.01,"I")) ;patient dfn
"RTN","SYNDHP55",219,0)
 N CategoryCd S CategoryCd=$G(PATARR(FNBR1,IENS,.04,"I")) ;category code
"RTN","SYNDHP55",220,0)
 N Category S Category=$G(PATARR(FNBR1,IENS,.04,"E")) ;category
"RTN","SYNDHP55",221,0)
 N EnteringUserId S EnteringUserId=$G(PATARR(FNBR1,IENS,.06,"I")) ;user who entered patient
"RTN","SYNDHP55",222,0)
 N EnteringUser S EnteringUser=$G(PATARR(FNBR1,IENS,.06,"E")) ;user who entered patient
"RTN","SYNDHP55",223,0)
 ;get registered exams
"RTN","SYNDHP55",224,0)
 N REXIEN S REXIEN=0
"RTN","SYNDHP55",225,0)
 F  S REXIEN=$O(^RADPT(PATIEN,"DT",REXIEN)) QUIT:'+REXIEN  D
"RTN","SYNDHP55",226,0)
 . N IENS1 S IENS1=REXIEN_","_IENS
"RTN","SYNDHP55",227,0)
 . N REXARR,REXERR
"RTN","SYNDHP55",228,0)
 . D GETS^DIQ(FNBR2,IENS1,".01;2;3;4;5","EI","REXARR","REXERR")  ;specific fields
"RTN","SYNDHP55",229,0)
 . ;I $G(DEBUG),$D(REXERR) W !,">>ERROR<<",! ZWRITE REXERR
"RTN","SYNDHP55",230,0)
 . QUIT:$D(REXERR)
"RTN","SYNDHP55",231,0)
 . N ExamDate S ExamDate=$G(REXARR(FNBR2,IENS1,.01,"I")) ;exam date
"RTN","SYNDHP55",232,0)
 . QUIT:((ExamDate\1)<FRDAT)!((ExamDate\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP55",233,0)
 . N ExamDateHl7 S ExamDateHl7=$$FMTHL7^XLFDT(ExamDate) ;hl7 format exam date
"RTN","SYNDHP55",234,0)
 . ;get examinations
"RTN","SYNDHP55",235,0)
 . N EXIEN S EXIEN=0
"RTN","SYNDHP55",236,0)
 . F  S EXIEN=$O(^RADPT(PATIEN,"DT",REXIEN,"P",EXIEN)) QUIT:'+EXIEN  D
"RTN","SYNDHP55",237,0)
 . . N CASENBR,PROCIEN,PROC,CPT,PIRES,PDIAGCD,REQPHYS,PISTAFF,RPTTEXT,VISITID,VISITDT,VISITHL,SCT,PID
"RTN","SYNDHP55",238,0)
 . . N IENS2 S IENS2=EXIEN_","_IENS1
"RTN","SYNDHP55",239,0)
 . . N EXARR,EXERR
"RTN","SYNDHP55",240,0)
 . . D GETS^DIQ(FNBR3,IENS2,".01;2;12;13;14;15;17;27","EI","EXARR","EXERR")  ;specific fields
"RTN","SYNDHP55",241,0)
 . . ;I $G(DEBUG),$D(EXERR) W !,">>ERROR<<",! ZWRITE EXERR
"RTN","SYNDHP55",242,0)
 . . QUIT:$D(EXERR)
"RTN","SYNDHP55",243,0)
 . . S CASENBR=$G(EXARR(FNBR3,IENS2,.01,"I")) ;case number
"RTN","SYNDHP55",244,0)
 . . S PROCIEN=$G(EXARR(FNBR3,IENS2,2,"I")) ;procedure ien
"RTN","SYNDHP55",245,0)
 . . S PROC=$G(EXARR(FNBR3,IENS2,2,"E")) ;procedure name
"RTN","SYNDHP55",246,0)
 . . S CPT=""
"RTN","SYNDHP55",247,0)
 . . S:PROCIEN'="" CPT=$$GET1^DIQ(71,PROCIEN_",",9) ;cpt code
"RTN","SYNDHP55",248,0)
 . . S PIRES=$G(EXARR(FNBR3,IENS2,12,"E")) ;primary interpreting resident
"RTN","SYNDHP55",249,0)
 . . S PDIAGCD=$G(EXARR(FNBR3,IENS2,13,"E")) ;primary diagnostic code
"RTN","SYNDHP55",250,0)
 . . S REQPHYS=$G(EXARR(FNBR3,IENS2,14,"E")) ;requesting physician
"RTN","SYNDHP55",251,0)
 . . S PISTAFF=$G(EXARR(FNBR3,IENS2,15,"E")) ;primary interpreting staff
"RTN","SYNDHP55",252,0)
 . . S RPTTEXT=$G(EXARR(FNBR3,IENS2,17,"I")) ;report text (pointer to file 74)
"RTN","SYNDHP55",253,0)
 . . S VISITID=$G(EXARR(FNBR3,IENS2,27)) ;visit id
"RTN","SYNDHP55",254,0)
 . . S VISITDT=""
"RTN","SYNDHP55",255,0)
 . . S:VISITID'="" VISITDT=$$GET1^DIQ(FNBR4,VISITID_",",.01,"I") ;visit/admit date&time
"RTN","SYNDHP55",256,0)
 . . S VISITHL=$$FMTHL7^XLFDT(VISITDT) ;hl7 format visit/admit date&time
"RTN","SYNDHP55",257,0)
 . . S PID=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_PATIEN_S_FNBR2_S_REXIEN_S_FNBR3_S_EXIEN
"RTN","SYNDHP55",258,0)
 . . ;LOOKUP SNOMED(sct) - cpt, os5
"RTN","SYNDHP55",259,0)
 . . S SCT=""
"RTN","SYNDHP55",260,0)
 . . ;map cpt to snomed (currently uses very small map)
"RTN","SYNDHP55",261,0)
 . . I CPT'="" D
"RTN","SYNDHP55",262,0)
 . . . S SCT=$$MAP^SYNDHPMP("sct2cpt",CPT,"I")
"RTN","SYNDHP55",263,0)
 . . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP55",264,0)
 . . ;if no cpt hit, map os5 to snomed
"RTN","SYNDHP55",265,0)
 . . I SCT="",CPT'="" D
"RTN","SYNDHP55",266,0)
 . . . S SCT=$$MAP^SYNDHPMP("sct2os5",CPT,"I")
"RTN","SYNDHP55",267,0)
 . . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP55",268,0)
 . . ;
"RTN","SYNDHP55",269,0)
 . . I $G(DEBUG) D
"RTN","SYNDHP55",270,0)
 . . . W !,"Patient: ",?32,PatDfn,!
"RTN","SYNDHP55",271,0)
 . . . W "Category: ",?32,CategoryCd,"     ",Category,!
"RTN","SYNDHP55",272,0)
 . . . W "Exam Date: ",?32,ExamDate,"     ",ExamDateHl7,!
"RTN","SYNDHP55",273,0)
 . . . W "Case Number: ",?32,CASENBR,!
"RTN","SYNDHP55",274,0)
 . . . W "Procedure: ",?32,PROCIEN,"     ",PROC,!
"RTN","SYNDHP55",275,0)
 . . . W "CPT: ",?32,CPT,!
"RTN","SYNDHP55",276,0)
 . . . W "SCT: ",?32,SCT,!
"RTN","SYNDHP55",277,0)
 . . . W "Requesting physician: ",?32,REQPHYS,!
"RTN","SYNDHP55",278,0)
 . . . W "Primary diagnostic code: ",?32,PDIAGCD,!
"RTN","SYNDHP55",279,0)
 . . . W "Primary interpreting resident: ",?32,PIRES,!
"RTN","SYNDHP55",280,0)
 . . . W "Primary interpreting staff: ",?32,PISTAFF,!
"RTN","SYNDHP55",281,0)
 . . . W "Pointer to report text:",?32,RPTTEXT,!
"RTN","SYNDHP55",282,0)
 . . . W "Visit Date: ",?32,VISITDT,"     ",VISITHL,!
"RTN","SYNDHP55",283,0)
 . . . W "PID: ",?32,PID,!
"RTN","SYNDHP55",284,0)
 . . ;PID^PatDfn^Category^ExamDate^ExamDateHl7^CASENBR^PROCIEN^PROC^CPT^SCT^PDIAGCD^REQPHYS^PIRES^PISTAFF^VISITDT^VISITHL^EnteringUser
"RTN","SYNDHP55",285,0)
 . . S SEQ=SEQ+1
"RTN","SYNDHP55",286,0)
 . . S RADEX(SEQ)=PID_U_PatDfn_U_Category_U_ExamDate_U_ExamDateHl7_U_CASENBR_U_PROCIEN_U_PROC_U_CPT_U_SCT_U_PDIAGCD_U_REQPHYS_U_PIRES_U_PISTAFF_U_VISITDT_U_VISITHL_U_EnteringUser
"RTN","SYNDHP55",287,0)
 . . ;
"RTN","SYNDHP55",288,0)
 . . I $G(RPT),RPTTEXT'="" D
"RTN","SYNDHP55",289,0)
 . . . D GETRPT(.RADRPT,RPTTEXT,SITE,SEQ,FRDAT,TODAT)
"RTN","SYNDHP55",290,0)
 . . . M RADEX(SEQ)=RADRPT(SEQ)
"RTN","SYNDHP55",291,0)
 ;
"RTN","SYNDHP55",292,0)
 ;I $G(DEBUG) W ! ZWRITE RADEX
"RTN","SYNDHP55",293,0)
 ;
"RTN","SYNDHP55",294,0)
 QUIT
"RTN","SYNDHP55",295,0)
 ;
"RTN","SYNDHP55",296,0)
GETRPT(RADRPT,RPTTEXT,SITE,SEQ,FRDAT,TODAT) ; get radiology diagnostic report
"RTN","SYNDHP55",297,0)
 ; Inputs: RPTTEXT - radiology diagnostic report IEN from file #70
"RTN","SYNDHP55",298,0)
 ;         SITE - station number
"RTN","SYNDHP55",299,0)
 ;         SEQ - record sequence
"RTN","SYNDHP55",300,0)
 ; Output: RADRPT array
"RTN","SYNDHP55",301,0)
 ;         RADRPT(1) - PID^dayCase^dateTime^dateTimeHL7^status id^status^verifying physician id^verifying physician name
"RTN","SYNDHP55",302,0)
 ;         RADRPT("REPORT")=report
"RTN","SYNDHP55",303,0)
 ;         RADRPT("IMPRESSION")=impression
"RTN","SYNDHP55",304,0)
 ;
"RTN","SYNDHP55",305,0)
 N FNUM S FNUM=74
"RTN","SYNDHP55",306,0)
 I $G(DEBUG) W "<Radiology Report>"
"RTN","SYNDHP55",307,0)
 N DAYCASE,PRSTA,PRSTATUS,PPROV,PPROVNM,PDATE,PDATEHL
"RTN","SYNDHP55",308,0)
 N PID S PID=$$RESID^SYNDHP69("V",SITE)_"_"_FNUM_"_"_RPTTEXT
"RTN","SYNDHP55",309,0)
 N PIENS S PIENS=RPTTEXT_","
"RTN","SYNDHP55",310,0)
 N EXARR,EXERR
"RTN","SYNDHP55",311,0)
 D GETS^DIQ(FNUM,PIENS,".01;3;5;9;113","EI","EXARR","EXERR")  ;specific fields
"RTN","SYNDHP55",312,0)
 ;I $G(DEBUG),$D(EXERR) W !,">>ERROR<<",! ZWRITE EXERR
"RTN","SYNDHP55",313,0)
 QUIT:$D(EXERR)
"RTN","SYNDHP55",314,0)
 S PDATE=$G(EXARR(FNUM,PIENS,3,"I")) ;exam date/time
"RTN","SYNDHP55",315,0)
 QUIT:((PDATE\1)<FRDAT)!((PDATE\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP55",316,0)
 S PDATEHL=$$FMTHL7^XLFDT(PDATE) ;exam date/time HL7
"RTN","SYNDHP55",317,0)
 S DAYCASE=$G(EXARR(FNUM,PIENS,.01,"I")) ;day case#
"RTN","SYNDHP55",318,0)
 S PRSTA=$G(EXARR(FNUM,PIENS,5,"I")) ;report status
"RTN","SYNDHP55",319,0)
 S PRSTATUS=$G(EXARR(FNUM,PIENS,5,"E")) ;report status
"RTN","SYNDHP55",320,0)
 ;S PRSTA=$S(PRSTA="V":"final",PRSTA="D":"partial",1:"unknown") ; there are other possible values
"RTN","SYNDHP55",321,0)
 S PPROV=$G(EXARR(FNUM,PIENS,9,"I")) ;verifying physician ien
"RTN","SYNDHP55",322,0)
 S PPROVNM=$G(EXARR(FNUM,PIENS,9,"E")) ;verifying physician name
"RTN","SYNDHP55",323,0)
 ;
"RTN","SYNDHP55",324,0)
 N REPORT,IMPRESS,RPTTEXT,IMPTEXT,RPTLINE,IMPLINE
"RTN","SYNDHP55",325,0)
 S RPTTEXT=""
"RTN","SYNDHP55",326,0)
 S IMPTEXT=""
"RTN","SYNDHP55",327,0)
 D GETS^DIQ(FNUM,PIENS,200,,"REPORT","EXERR")
"RTN","SYNDHP55",328,0)
 ;I $G(DEBUG),$D(EXERR) W !,">>ERROR<<",! ZWRITE EXERR
"RTN","SYNDHP55",329,0)
 QUIT:$D(EXERR)
"RTN","SYNDHP55",330,0)
 N N S N=0
"RTN","SYNDHP55",331,0)
 F  S N=$O(REPORT(FNUM,PIENS,200,N)) Q:N=""  D
"RTN","SYNDHP55",332,0)
 . S RPTLINE=REPORT(FNUM,PIENS,200,N)
"RTN","SYNDHP55",333,0)
 . S RPTTEXT=RPTTEXT_RPTLINE
"RTN","SYNDHP55",334,0)
 N EXERR
"RTN","SYNDHP55",335,0)
 D GETS^DIQ(FNUM,PIENS,300,,"IMPRESS","EXERR")
"RTN","SYNDHP55",336,0)
 ;I $G(DEBUG),$D(EXERR) W !,">>ERROR<<",! ZWRITE EXERR
"RTN","SYNDHP55",337,0)
 QUIT:$D(EXERR)
"RTN","SYNDHP55",338,0)
 N N S N=0
"RTN","SYNDHP55",339,0)
 F  S N=$O(IMPRESS(FNUM,PIENS,300,N)) Q:N=""  D
"RTN","SYNDHP55",340,0)
 . S IMPLINE=IMPRESS(FNUM,PIENS,300,N)
"RTN","SYNDHP55",341,0)
 . S IMPTEXT=IMPTEXT_IMPLINE
"RTN","SYNDHP55",342,0)
 ;
"RTN","SYNDHP55",343,0)
 I $G(DEBUG) D
"RTN","SYNDHP55",344,0)
 . W !,"Exam Date/Time:",?25,PDATE,"     ",PDATEHL,!
"RTN","SYNDHP55",345,0)
 . W "Day-Case#:",?25,DAYCASE,!
"RTN","SYNDHP55",346,0)
 . W "Report Status:",?25,PRSTA,"     ",PRSTATUS,!
"RTN","SYNDHP55",347,0)
 . W "Verifying Physician:",?25,PPROV,"     ",PPROVNM,!
"RTN","SYNDHP55",348,0)
 . W "Report:",?25,RPTTEXT,!
"RTN","SYNDHP55",349,0)
 . W "Impression:",?25,IMPTEXT,!
"RTN","SYNDHP55",350,0)
 S RADRPT(SEQ,1)=PID_U_DAYCASE_U_PDATE_U_PDATEHL_U_PRSTA_U_PRSTATUS_U_PPROV_U_PPROVNM
"RTN","SYNDHP55",351,0)
 S RADRPT(SEQ,"REPORT")=RPTTEXT
"RTN","SYNDHP55",352,0)
 S RADRPT(SEQ,"IMPRESSION")=IMPTEXT
"RTN","SYNDHP55",353,0)
 ;
"RTN","SYNDHP55",354,0)
 QUIT
"RTN","SYNDHP55",355,0)
 ;
"RTN","SYNDHP56")
0^49^B92343991
"RTN","SYNDHP56",1,0)
SYNDHP56 ; HC/ART - HealthConcourse - retrieve patient mental health observations ;05/04/2019
"RTN","SYNDHP56",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP56",3,0)
 ;;
"RTN","SYNDHP56",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP56",5,0)
 ;
"RTN","SYNDHP56",6,0)
 QUIT
"RTN","SYNDHP56",7,0)
 ;
"RTN","SYNDHP56",8,0)
 ; ---------------- Get patient Observations ----------------------
"RTN","SYNDHP56",9,0)
 ;  MH Administrations
"RTN","SYNDHP56",10,0)
 ;  GAF
"RTN","SYNDHP56",11,0)
 ;
"RTN","SYNDHP56",12,0)
PATOBS(RETSTA,NAME,SSN,DOB,GENDER,FRDAT,TODAT) ; get Observations for a patient by traits
"RTN","SYNDHP56",13,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP56",14,0)
 QUIT
"RTN","SYNDHP56",15,0)
 ; Return patient Observations for name, SSN, DOB, and gender
"RTN","SYNDHP56",16,0)
 ;
"RTN","SYNDHP56",17,0)
 ; Input:
"RTN","SYNDHP56",18,0)
 ;   NAME    - patient name
"RTN","SYNDHP56",19,0)
 ;   SSN     - social security number
"RTN","SYNDHP56",20,0)
 ;   DOB     - date of birth
"RTN","SYNDHP56",21,0)
 ;   GENDER  - gender
"RTN","SYNDHP56",22,0)
 ;   FRDAT   - from date (inclusive), optional, compared to date given (MH) date/time of diagnosis (GAF)
"RTN","SYNDHP56",23,0)
 ;   TODAT   - to date (inclusive), optional, compared to date given (MH) date/time of diagnosis (GAF)
"RTN","SYNDHP56",24,0)
 ; Output:
"RTN","SYNDHP56",25,0)
 ;   RETSTA  - a delimited string that lists LOINC and SNOMED CT codes for the patient Observations
"RTN","SYNDHP56",26,0)
 ;           - ICN^SCT code|descrption|LOINC code|description|instrument name|date given|clinic name|ordered by|scale:score|identifier
"RTN","SYNDHP56",27,0)
 ;
"RTN","SYNDHP56",28,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP56",29,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP56",30,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP56",31,0)
 ;
"RTN","SYNDHP56",32,0)
 N C,P,S,ZARR,ICNST,DHPICN,PATIEN
"RTN","SYNDHP56",33,0)
 ;
"RTN","SYNDHP56",34,0)
 S C=",",P="|",S="_"
"RTN","SYNDHP56",35,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP56",36,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP56",37,0)
 ; if we are here we are dealing with a valid patient
"RTN","SYNDHP56",38,0)
 S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP56",39,0)
 ; get patient IEN from ICN
"RTN","SYNDHP56",40,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP56",41,0)
 ;
"RTN","SYNDHP56",42,0)
 S RETSTA=DHPICN
"RTN","SYNDHP56",43,0)
 D GET(.RETSTA,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP56",44,0)
 ;
"RTN","SYNDHP56",45,0)
 QUIT
"RTN","SYNDHP56",46,0)
 ;
"RTN","SYNDHP56",47,0)
PATOBSI(RETSTA,DHPICN,FRDAT,TODAT) ; Patient Observations for ICN
"RTN","SYNDHP56",48,0)
 ;
"RTN","SYNDHP56",49,0)
 ; Return patient Observations for a given patient ICN
"RTN","SYNDHP56",50,0)
 ;
"RTN","SYNDHP56",51,0)
 ; Input:
"RTN","SYNDHP56",52,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP56",53,0)
 ;   FRDAT   - from date (inclusive), optional, compared to date given (MH) date/time of diagnosis (GAF)
"RTN","SYNDHP56",54,0)
 ;   TODAT   - to date (inclusive), optional, compared to date given (MH) date/time of diagnosis (GAF)
"RTN","SYNDHP56",55,0)
 ; Output:
"RTN","SYNDHP56",56,0)
 ;   RETSTA  - a delimited string that lists LOINC and SNOMED CT codes for the patient Observations
"RTN","SYNDHP56",57,0)
 ;           - ICN^LOINC code|description|SCT code|description|Instrument Name|date given|clinic name|ordered by|scale:score|resource ID^...
"RTN","SYNDHP56",58,0)
 ;
"RTN","SYNDHP56",59,0)
 ; validate ICN
"RTN","SYNDHP56",60,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP56",61,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP56",62,0)
 ; 
"RTN","SYNDHP56",63,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP56",64,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP56",65,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP56",66,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP56",67,0)
 ;
"RTN","SYNDHP56",68,0)
 N C,P,S,ZARR,PATIEN
"RTN","SYNDHP56",69,0)
 S C=",",P="|",S="_"
"RTN","SYNDHP56",70,0)
 ; get patient IEN from ICN
"RTN","SYNDHP56",71,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP56",72,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP56",73,0)
 ;
"RTN","SYNDHP56",74,0)
 S RETSTA=DHPICN
"RTN","SYNDHP56",75,0)
 D GET(.RETSTA,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP56",76,0)
 ;
"RTN","SYNDHP56",77,0)
 QUIT
"RTN","SYNDHP56",78,0)
 ;
"RTN","SYNDHP56",79,0)
GET(RETSTA,PATIEN,FRDAT,TODAT) ;
"RTN","SYNDHP56",80,0)
 ;
"RTN","SYNDHP56",81,0)
 ;Mental Health Observations (Assessments/Administrations)
"RTN","SYNDHP56",82,0)
 S RETSTA=RETSTA_$$MHOBS(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP56",83,0)
 ;
"RTN","SYNDHP56",84,0)
 ;GAF (Global Assessment of Functioning)
"RTN","SYNDHP56",85,0)
 S RETSTA=RETSTA_$$GAFOBS(PATIEN,FRDAT,TODAT)
"RTN","SYNDHP56",86,0)
 ;
"RTN","SYNDHP56",87,0)
 QUIT
"RTN","SYNDHP56",88,0)
 ;
"RTN","SYNDHP56",89,0)
 ;
"RTN","SYNDHP56",90,0)
MHOBS(PATIEN,FRDAT,TODAT) ;Mental Health Observations
"RTN","SYNDHP56",91,0)
 ;patient's MH administration results - observation
"RTN","SYNDHP56",92,0)
 ;
"RTN","SYNDHP56",93,0)
 N PROCS,SERPROCS,SEQ,FNBR1,FNBR2
"RTN","SYNDHP56",94,0)
 N ADMINIEN,ADMINNBR,INSTID,INSTNAME,GIVDATE,GIVDATEHL,PROVO,PROVA,LOCID,LOCATION,SCALE,SCORE,PROVNAMO,PROVNAMA
"RTN","SYNDHP56",95,0)
 N SNOMED,SDESC,LOINC,LDESC,MH2LOINC,LOINC2MH,MH2SNOMED,SCT
"RTN","SYNDHP56",96,0)
 N RESIEN,RIENS
"RTN","SYNDHP56",97,0)
 N YS,YSRET,YSSEQ
"RTN","SYNDHP56",98,0)
 ;
"RTN","SYNDHP56",99,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP56",100,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP56",101,0)
 S PROCS=""
"RTN","SYNDHP56",102,0)
 S FNBR1=601.84 ;administrations
"RTN","SYNDHP56",103,0)
 S FNBR2=601.92 ;administration results
"RTN","SYNDHP56",104,0)
 ;D LOADREF(.MH2LOINC,.LOINC2MH,.MH2SNOMED)  ;load temporary code arrays
"RTN","SYNDHP56",105,0)
 S SEQ=0
"RTN","SYNDHP56",106,0)
 ;
"RTN","SYNDHP56",107,0)
 S YS("DFN")=PATIEN
"RTN","SYNDHP56",108,0)
 S YS("COMPLETE")="Y"
"RTN","SYNDHP56",109,0)
 D ADMINS^YTQAPI5(.YSRET,.YS)  ;call MH API
"RTN","SYNDHP56",110,0)
 I $G(DEBUG) D
"RTN","SYNDHP56",111,0)
 . W !,"Mental Health",!!
"RTN","SYNDHP56",112,0)
 . ;W ";                 1        2          3         4          5       6       7      8         9       10         11            12        13           14           15",!
"RTN","SYNDHP56",113,0)
 . ;W ";MH API output:Adm. ID^Inst. Name^Date Given^Date Saved^Orderer^Admin.By^Signed^# Answers^R_Privl^Is Legacy^INSTRUMENT id^Test IENS^copyright^location iens^DAY RESTART",!
"RTN","SYNDHP56",114,0)
 . ;ZWRITE YSRET
"RTN","SYNDHP56",115,0)
 . W "Adm. ID^Inst. Name^Date Given^Date Saved^Orderer^Admin.By^Signed^# Answers^R_Privl^Is Legacy^INSTRUMENT id^Test IENS^copyright^location iens^DAY RESTART",!
"RTN","SYNDHP56",116,0)
 QUIT:YSRET(1)["[ERROR]" SERPROCS
"RTN","SYNDHP56",117,0)
 S YSSEQ=2
"RTN","SYNDHP56",118,0)
 F  S YSSEQ=$O(YSRET(YSSEQ)) Q:YSSEQ=""  D
"RTN","SYNDHP56",119,0)
 . S ADMINNBR=$P(YSRET(YSSEQ),U,1) ;administration number
"RTN","SYNDHP56",120,0)
 . QUIT:ADMINNBR=""
"RTN","SYNDHP56",121,0)
 . S INSTNAME=$P(YSRET(YSSEQ),U,2) ;instrument name
"RTN","SYNDHP56",122,0)
 . S INSTID=$O(^YTT(601.71,"B",INSTNAME,"")) ;instrument id
"RTN","SYNDHP56",123,0)
 . S GIVDATE=$P(YSRET(YSSEQ),U,3) ;date given
"RTN","SYNDHP56",124,0)
 . QUIT:((GIVDATE\1)<FRDAT)!((GIVDATE\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP56",125,0)
 . S GIVDATEHL=$$FMTHL7^XLFDT(GIVDATE) ;hl7 format date given
"RTN","SYNDHP56",126,0)
 . S PROVO=$P(YSRET(YSSEQ),U,5) ;ordered by
"RTN","SYNDHP56",127,0)
 . S:+PROVO PROVNAMO=$$GET1^DIQ(200,PROVO_",",.01) ;ordered by
"RTN","SYNDHP56",128,0)
 . S PROVA=$P(YSRET(YSSEQ),U,6) ;administered by
"RTN","SYNDHP56",129,0)
 . S:+PROVA PROVNAMA=$$GET1^DIQ(200,PROVA_",",.01) ;administered by
"RTN","SYNDHP56",130,0)
 . S LOCID=$P(YSRET(YSSEQ),U,14) ;location ien
"RTN","SYNDHP56",131,0)
 . S LOCATION=$$GET1^DIQ(44,LOCID_",",.01) ;location
"RTN","SYNDHP56",132,0)
 . ;get administration results
"RTN","SYNDHP56",133,0)
 . S RESULT=""
"RTN","SYNDHP56",134,0)
 . S RESIEN=""
"RTN","SYNDHP56",135,0)
 . F  S RESIEN=$O(^YTT(601.92,"AC",ADMINNBR,RESIEN)) Q:RESIEN=""  D
"RTN","SYNDHP56",136,0)
 . . S RIENS=RESIEN_","
"RTN","SYNDHP56",137,0)
 . . S SCALE=$$GET1^DIQ(FNBR2,RIENS,2) ;scale
"RTN","SYNDHP56",138,0)
 . . S SCORE=$$GET1^DIQ(FNBR2,RIENS,3) ;raw score
"RTN","SYNDHP56",139,0)
 . . S RESULT=SCALE_":"_SCORE
"RTN","SYNDHP56",140,0)
 . . S PID=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_ADMINNBR_S_FNBR2_S_RESIEN
"RTN","SYNDHP56",141,0)
 . . ;
"RTN","SYNDHP56",142,0)
 . . ;Look-up LOINC CODE & SNOMED CT code
"RTN","SYNDHP56",143,0)
 . . S LDESC=INSTNAME_" Result"
"RTN","SYNDHP56",144,0)
 . . S SDESC=INSTNAME_" Result"
"RTN","SYNDHP56",145,0)
 . . S LOINC=""
"RTN","SYNDHP56",146,0)
 . . I INSTID'="" D
"RTN","SYNDHP56",147,0)
 . . . S LOINC=$$MAP^SYNDHPMP("mh2loinc",INSTID,"D")
"RTN","SYNDHP56",148,0)
 . . . S LOINC=$S(+LOINC=-1:"",1:$P(LOINC,U,2))
"RTN","SYNDHP56",149,0)
 . . I LOINC="",INSTNAME'="" D
"RTN","SYNDHP56",150,0)
 . . . S LOINC=$$MAP^SYNDHPMP("mh2loinc",INSTNAME,"D")
"RTN","SYNDHP56",151,0)
 . . . S LOINC=$S(+LOINC=-1:"",1:$P(LOINC,U,2))
"RTN","SYNDHP56",152,0)
 . . S SCT=""
"RTN","SYNDHP56",153,0)
 . . I INSTID'="" D
"RTN","SYNDHP56",154,0)
 . . . S SCT=$$MAP^SYNDHPMP("mh2sct",INSTID,"D")
"RTN","SYNDHP56",155,0)
 . . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP56",156,0)
 . . I SCT="",INSTNAME'="" D
"RTN","SYNDHP56",157,0)
 . . . S SCT=$$MAP^SYNDHPMP("mh2sct",INSTNAME,"D")
"RTN","SYNDHP56",158,0)
 . . . S SCT=$S(+SCT=-1:"",1:$P(SCT,U,2))
"RTN","SYNDHP56",159,0)
 . . ;
"RTN","SYNDHP56",160,0)
 . . I $G(DEBUG) D
"RTN","SYNDHP56",161,0)
 . . . W !,"Admin Number:    ",ADMINNBR,!
"RTN","SYNDHP56",162,0)
 . . . W "Instrument:      ",INSTID,"     ",INSTNAME,!
"RTN","SYNDHP56",163,0)
 . . . W "Date Given:      ",GIVDATE,"     ",GIVDATEHL,!
"RTN","SYNDHP56",164,0)
 . . . W "Ordered by:      ",PROVO,"     ",PROVNAMO,!
"RTN","SYNDHP56",165,0)
 . . . W "Administered by: ",PROVA,"     ",PROVNAMA,!
"RTN","SYNDHP56",166,0)
 . . . W "Location:        ",LOCID,"     ",LOCATION,!
"RTN","SYNDHP56",167,0)
 . . . W "Results:     ",RESULT,!
"RTN","SYNDHP56",168,0)
 . . . W "LOINC Code:  ",LOINC,!
"RTN","SYNDHP56",169,0)
 . . . W "SNOMED Code: ",SCT,!
"RTN","SYNDHP56",170,0)
 . . . W "Description: ",SDESC,!
"RTN","SYNDHP56",171,0)
 . . ;
"RTN","SYNDHP56",172,0)
 . . ;record is created for each result for an instrument administration
"RTN","SYNDHP56",173,0)
 . . ;LOINC code|description|SCT code|descrption|Instrument Name|date given|clinic name|ordered by|scale:score|resource id
"RTN","SYNDHP56",174,0)
 . . S SEQ=SEQ+1
"RTN","SYNDHP56",175,0)
 . . S PROCS(SEQ)=U_LOINC_P_LDESC_P_SCT_P_SDESC_P_INSTNAME_P_GIVDATEHL_P_LOCATION_P_PROVNAMO_P_RESULT_P_PID
"RTN","SYNDHP56",176,0)
 ;
"RTN","SYNDHP56",177,0)
 ;I $G(DEBUG) W ! ZWRITE PROCS
"RTN","SYNDHP56",178,0)
 ;serialize data
"RTN","SYNDHP56",179,0)
 S SERPROCS=""
"RTN","SYNDHP56",180,0)
 S SEQ=""
"RTN","SYNDHP56",181,0)
 F  S SEQ=$O(PROCS(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP56",182,0)
 . S SERPROCS=SERPROCS_PROCS(SEQ)
"RTN","SYNDHP56",183,0)
 ;
"RTN","SYNDHP56",184,0)
 ;I $G(DEBUG) W ! ZWRITE SERPROCS
"RTN","SYNDHP56",185,0)
 ;
"RTN","SYNDHP56",186,0)
 QUIT SERPROCS
"RTN","SYNDHP56",187,0)
 ;
"RTN","SYNDHP56",188,0)
GAFOBS(PATIEN,FRDAT,TODAT) ;get GAF score
"RTN","SYNDHP56",189,0)
 ;
"RTN","SYNDHP56",190,0)
 N PROCS,SERPROCS,SEQ,FNBR1,MHIEN,IENS
"RTN","SYNDHP56",191,0)
 N FILEDTFM,FILEDT,FILEDTHL,GAFDTFM,GAFDT,GAFDTHL,GAFBYID,GAFBY,TRANSCID,TRANSCR,GAF,RESULT,PID
"RTN","SYNDHP56",192,0)
 N SNOMED,SDESC,LOINC,LDESC,DESC,PATTYPE
"RTN","SYNDHP56",193,0)
 ;
"RTN","SYNDHP56",194,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP56",195,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP56",196,0)
 S (SNOMED,LOINC)=""
"RTN","SYNDHP56",197,0)
 S (SDESC,LDESC)="GAF"
"RTN","SYNDHP56",198,0)
 S DESC="Global Assessment of Functioning"
"RTN","SYNDHP56",199,0)
 ;
"RTN","SYNDHP56",200,0)
 I $G(DEBUG) W !,"GAF - Global Assessment of Functioning",!!
"RTN","SYNDHP56",201,0)
 S PROCS=""
"RTN","SYNDHP56",202,0)
 S FNBR1=627.8 ;Diagnostic Results-Mental Health
"RTN","SYNDHP56",203,0)
 S SEQ=0
"RTN","SYNDHP56",204,0)
 ;
"RTN","SYNDHP56",205,0)
 S MHIEN=""
"RTN","SYNDHP56",206,0)
 F  S MHIEN=$O(^YSD(627.8,"C",PATIEN,MHIEN)) QUIT:MHIEN=""  D
"RTN","SYNDHP56",207,0)
 . S IENS=MHIEN_","
"RTN","SYNDHP56",208,0)
 . S GAF=$$GET1^DIQ(FNBR1,IENS,65) ;axis 5 (GAF)
"RTN","SYNDHP56",209,0)
 . QUIT:GAF=""
"RTN","SYNDHP56",210,0)
 . S FILEDTFM=$$GET1^DIQ(FNBR1,IENS,.01,"I") ;file entry date fm format
"RTN","SYNDHP56",211,0)
 . S FILEDT=$$GET1^DIQ(FNBR1,IENS,.01) ;file entry date
"RTN","SYNDHP56",212,0)
 . S FILEDTHL=$$FMTHL7^XLFDT(FILEDTFM) ;hl7 format file entry date
"RTN","SYNDHP56",213,0)
 . S GAFDT=$$GET1^DIQ(FNBR1,IENS,.03) ;date/time of diagnosis
"RTN","SYNDHP56",214,0)
 . S GAFDTFM=$$GET1^DIQ(FNBR1,IENS,.03,"I") ;date/time of diagnosis fm format
"RTN","SYNDHP56",215,0)
 . QUIT:((GAFDTFM\1)<FRDAT)!((GAFDTFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP56",216,0)
 . S GAFDTHL=$$FMTHL7^XLFDT(GAFDTFM) ;hl7 format date/time of diagnosis
"RTN","SYNDHP56",217,0)
 . S GAFBYID=$$GET1^DIQ(FNBR1,IENS,.04,"I") ;diagnosed by ien
"RTN","SYNDHP56",218,0)
 . S GAFBY=$$GET1^DIQ(FNBR1,IENS,.04) ;diagnosed by
"RTN","SYNDHP56",219,0)
 . S TRANSCID=$$GET1^DIQ(FNBR1,IENS,.05,"I") ;transcriber ien
"RTN","SYNDHP56",220,0)
 . S TRANSCR=$$GET1^DIQ(FNBR1,IENS,.05) ;transcriber
"RTN","SYNDHP56",221,0)
 . S RESULT="GAF Scale:"_GAF
"RTN","SYNDHP56",222,0)
 . S PATTYPE=$$GET1^DIQ(FNBR1,IENS,66,"I") ;patient type
"RTN","SYNDHP56",223,0)
 . S PID=$$RESID^SYNDHP69("V",SITE)_S_FNBR1_S_MHIEN
"RTN","SYNDHP56",224,0)
 . I $G(DEBUG) D
"RTN","SYNDHP56",225,0)
 . . W "File Date Time: ",FILEDTFM,"     ",FILEDT,"     ",FILEDTHL,!
"RTN","SYNDHP56",226,0)
 . . W "GAF Date Time:  ",GAFDTFM,"     ",GAFDT,"     ",GAFDTHL,!
"RTN","SYNDHP56",227,0)
 . . W "Diagnosis by:   ",GAFBYID,"     ",GAFBY,!
"RTN","SYNDHP56",228,0)
 . . W "Transcriber:    ",TRANSCID,"     ",TRANSCR,!
"RTN","SYNDHP56",229,0)
 . . W "Patient Type:   ",PATTYPE,!
"RTN","SYNDHP56",230,0)
 . . W "Result:         ",RESULT,!
"RTN","SYNDHP56",231,0)
 . . W "LOINC Code:  ",LOINC,!
"RTN","SYNDHP56",232,0)
 . . W "SNOMED Code: ",SNOMED,!
"RTN","SYNDHP56",233,0)
 . . W "Description: ",SDESC,!
"RTN","SYNDHP56",234,0)
 . ;LOINC code|description|SCT code|descrption|Instrument Name|date given|clinic name|ordered by|scale:score|identifier
"RTN","SYNDHP56",235,0)
 . S SEQ=SEQ+1
"RTN","SYNDHP56",236,0)
 . S PROCS(SEQ)=U_LOINC_P_LDESC_P_SNOMED_P_SDESC_P_DESC_P_GAFDTHL_P_""_P_GAFBY_P_RESULT_P_PID
"RTN","SYNDHP56",237,0)
 ;
"RTN","SYNDHP56",238,0)
 ;I $G(DEBUG) W ! ZWRITE PROCS
"RTN","SYNDHP56",239,0)
 ;
"RTN","SYNDHP56",240,0)
 ;serialize data
"RTN","SYNDHP56",241,0)
 S SERPROCS=""
"RTN","SYNDHP56",242,0)
 S SEQ=""
"RTN","SYNDHP56",243,0)
 F  S SEQ=$O(PROCS(SEQ)) QUIT:SEQ=""  D
"RTN","SYNDHP56",244,0)
 . S SERPROCS=SERPROCS_PROCS(SEQ)
"RTN","SYNDHP56",245,0)
 ;
"RTN","SYNDHP56",246,0)
 ;I $G(DEBUG) W ! ZWRITE SERPROCS
"RTN","SYNDHP56",247,0)
 ;
"RTN","SYNDHP56",248,0)
 QUIT SERPROCS
"RTN","SYNDHP56",249,0)
 ;
"RTN","SYNDHP56",250,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP56",251,0)
T1 ;
"RTN","SYNDHP56",252,0)
 N ICN S ICN="5000000352V586511"
"RTN","SYNDHP56",253,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP56",254,0)
 N TODAT S TODAT=""
"RTN","SYNDHP56",255,0)
 N RETSTA
"RTN","SYNDHP56",256,0)
 D PATOBSI(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP56",257,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP56",258,0)
 QUIT
"RTN","SYNDHP56",259,0)
 ;
"RTN","SYNDHP57")
0^7^B81356532
"RTN","SYNDHP57",1,0)
SYNDHP57 ; HC/fjf/art - HealthConcourse - get patient allergies ;05/07/2019
"RTN","SYNDHP57",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP57",3,0)
 ;;
"RTN","SYNDHP57",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP57",5,0)
 ;
"RTN","SYNDHP57",6,0)
 QUIT
"RTN","SYNDHP57",7,0)
 ;
"RTN","SYNDHP57",8,0)
 ; ---------------- Get patient allergies ------------------------------
"RTN","SYNDHP57",9,0)
 ;
"RTN","SYNDHP57",10,0)
PATALLI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Patient allergies for ICN
"RTN","SYNDHP57",11,0)
 ;
"RTN","SYNDHP57",12,0)
 ; Return patient allergies for a given patient ICN
"RTN","SYNDHP57",13,0)
 ;
"RTN","SYNDHP57",14,0)
 ; Input:
"RTN","SYNDHP57",15,0)
 ;   DHPICN  - unique patient identifier across all VistA systems
"RTN","SYNDHP57",16,0)
 ;   FRDAT   - from date (inclusive), optional, compared to origination date/time
"RTN","SYNDHP57",17,0)
 ;   TODAT   - to date (inclusive), optional, compared to origination date/time
"RTN","SYNDHP57",18,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP57",19,0)
 ;             F = Return FHIR
"RTN","SYNDHP57",20,0)
 ;             0 or null = Return allergies string (default)
"RTN","SYNDHP57",21,0)
 ; Output:
"RTN","SYNDHP57",22,0)
 ;   RETSTA  - a delimited string that lists SNOMED CDT codes for the patient allergies
"RTN","SYNDHP57",23,0)
 ;           - ICN^allergen|SCT:code|origination dt/tm|type|verified flag|resource id~reaction:sct code:severity^...
"RTN","SYNDHP57",24,0)
 ;             or if no reaction: ICN^allergen|SCT:code|origination dt/tm|type|verified flag|resource id^...
"RTN","SYNDHP57",25,0)
 ;          or patient allergies in JSON format
"RTN","SYNDHP57",26,0)
 ;
"RTN","SYNDHP57",27,0)
 ; validate ICN
"RTN","SYNDHP57",28,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP57",29,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP57",30,0)
 ;
"RTN","SYNDHP57",31,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP57",32,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP57",33,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP57",34,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP57",35,0)
 ;
"RTN","SYNDHP57",36,0)
 ; get patient IEN from ICN
"RTN","SYNDHP57",37,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP57",38,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP57",39,0)
 ;
"RTN","SYNDHP57",40,0)
 N ALLARRAY
"RTN","SYNDHP57",41,0)
 S RETSTA=$$ALLERGIES(.ALLARRAY,PATIEN,DHPICN,FRDAT,TODAT)
"RTN","SYNDHP57",42,0)
 ;
"RTN","SYNDHP57",43,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP57",44,0)
 ;
"RTN","SYNDHP57",45,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP57",46,0)
 . S RETSTA=""
"RTN","SYNDHP57",47,0)
 . D TOJASON^SYNDHPUTL(.ALLARRAY,.RETSTA)
"RTN","SYNDHP57",48,0)
 ;
"RTN","SYNDHP57",49,0)
 QUIT
"RTN","SYNDHP57",50,0)
 ;
"RTN","SYNDHP57",51,0)
ALLERGIES(ALLARRAY,PATIEN,DHPICN,FRDAT,TODAT) ; get allergies for a patient
"RTN","SYNDHP57",52,0)
 ;
"RTN","SYNDHP57",53,0)
 N ZARR
"RTN","SYNDHP57",54,0)
 N V S V="_"
"RTN","SYNDHP57",55,0)
 N P S P="|"
"RTN","SYNDHP57",56,0)
 N S S S=";"
"RTN","SYNDHP57",57,0)
 N USER S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP57",58,0)
 N SITE S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP57",59,0)
 I $G(DEBUG) W !,"Allergies",!
"RTN","SYNDHP57",60,0)
 ;
"RTN","SYNDHP57",61,0)
 N x,AID,ADATEFM,ADATE,REACTANT,ALGE,ALLERGENI,ATYPE,ATYPET,AVERT,AEIER
"RTN","SYNDHP57",62,0)
 N RE85IEN,REACTION,ENTBY,ENTDATE,RSEV,IENS,ALLERGIES,FT,TX,O,CS
"RTN","SYNDHP57",63,0)
 N ALLRET S ALLRET=DHPICN
"RTN","SYNDHP57",64,0)
 N FNUM S FNUM=120.8 ;patient allergies
"RTN","SYNDHP57",65,0)
 ; scan Patient Allergies B index
"RTN","SYNDHP57",66,0)
 N ALLIEN S ALLIEN=""
"RTN","SYNDHP57",67,0)
 F x=1:1 S ALLIEN=$O(^GMR(FNUM,"B",PATIEN,ALLIEN)) QUIT:ALLIEN=""  D
"RTN","SYNDHP57",68,0)
 . N ALLERGY
"RTN","SYNDHP57",69,0)
 . D GET1ALLERGY^SYNDHP16(.ALLERGY,ALLIEN,0)
"RTN","SYNDHP57",70,0)
 . I $D(ALLERGY("Allergy","ERROR")) M ALLARRAY("Allergies",ALLIEN)=ALLERGY QUIT
"RTN","SYNDHP57",71,0)
 . S AID=ALLERGY("Allergy","resourceId")
"RTN","SYNDHP57",72,0)
 . S ADATEFM=ALLERGY("Allergy","originationDateTimeFM")
"RTN","SYNDHP57",73,0)
 . QUIT:((ADATEFM\1)<FRDAT)!((ADATEFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP57",74,0)
 . S ADATE=ALLERGY("Allergy","originationDateTimeHL7")
"RTN","SYNDHP57",75,0)
 . S REACTANT=ALLERGY("Allergy","reactant")
"RTN","SYNDHP57",76,0)
 . S FT=" ( FREE TEXT )"
"RTN","SYNDHP57",77,0)
 . I REACTANT[FT S REACTANT=$P(REACTANT,FT)
"RTN","SYNDHP57",78,0)
 . S ALGE=REACTANT
"RTN","SYNDHP57",79,0)
 . S ALLERGENI=ALLERGY("Allergy","gmrAllergyId")
"RTN","SYNDHP57",80,0)
 . I $P(ALLERGENI,S,2)["PS" S REACTANT=$P($$GVREF(ALLERGENI),U,2)
"RTN","SYNDHP57",81,0)
 . S ATYPE=ALLERGY("Allergy","allergyType")
"RTN","SYNDHP57",82,0)
 . S ATYPET=ALLERGY("Allergy","allergyTypeFHIR")
"RTN","SYNDHP57",83,0)
 . S AVERT=ALLERGY("Allergy","verified")
"RTN","SYNDHP57",84,0)
 . S AEIER=ALLERGY("Allergy","enteredInError")
"RTN","SYNDHP57",85,0)
 . S AVERT=$S(AVERT="YES":"confirmed",AEIER="YES":"entered-in-error",1:"unconfirmed")
"RTN","SYNDHP57",86,0)
 . ;get severity from file 120.85
"RTN","SYNDHP57",87,0)
 . S RE85IEN=$O(^GMR(120.85,"C",ALLIEN,""))
"RTN","SYNDHP57",88,0)
 . S RSEV=$$GET1^DIQ(120.85,RE85IEN_",",14.5)
"RTN","SYNDHP57",89,0)
 . S ALLERGY("Allergy","severity")=RSEV
"RTN","SYNDHP57",90,0)
 . S ALLERGY("Allergy","severityCd")=$$GET1^DIQ(120.85,RE85IEN_",",14.5,"I")
"RTN","SYNDHP57",91,0)
 . S ALLERGIES(x)=AID_U_ADATEFM_U_ADATE_U_REACTANT_U_ALLERGENI_U_ATYPE_U_ATYPET_U_AVERT_U_AEIER_U_RSEV
"RTN","SYNDHP57",92,0)
 . ;get reactions
"RTN","SYNDHP57",93,0)
 . N y
"RTN","SYNDHP57",94,0)
 . S IENS=""
"RTN","SYNDHP57",95,0)
 . F y=1:1 S IENS=$O(ALLERGY("Allergy","reactionss","reactions",IENS)) QUIT:IENS=""  D
"RTN","SYNDHP57",96,0)
 . . S REACTION=ALLERGY("Allergy","reactionss","reactions",IENS,"reaction")
"RTN","SYNDHP57",97,0)
 . . S ENTBY=ALLERGY("Allergy","reactionss","reactions",IENS,"enteredBy")
"RTN","SYNDHP57",98,0)
 . . S ENTDATE=ALLERGY("Allergy","reactionss","reactions",IENS,"dateEnteredHL7")
"RTN","SYNDHP57",99,0)
 . . S ALLERGIES(x,y)=AID_U_REACTION_U_ENTBY_U_ENTDATE_U_RSEV_U_ATYPET
"RTN","SYNDHP57",100,0)
 . M ALLARRAY("Allergies",ALLIEN)=ALLERGY ;
"RTN","SYNDHP57",101,0)
 . ;
"RTN","SYNDHP57",102,0)
 . I $G(DEBUG) D 
"RTN","SYNDHP57",103,0)
 . . W "ADATE:",ADATE,!
"RTN","SYNDHP57",104,0)
 . . W "REACTANT:",REACTANT,!
"RTN","SYNDHP57",105,0)
 . . W "ALGE:",ALGE,!
"RTN","SYNDHP57",106,0)
 . . W "ALLERGENI:",ALLERGENI,!
"RTN","SYNDHP57",107,0)
 . . W "ATYPE:",ATYPE,!
"RTN","SYNDHP57",108,0)
 . . W "ATYPET:",ATYPET,!
"RTN","SYNDHP57",109,0)
 . . W "AVERT:",AVERT,!
"RTN","SYNDHP57",110,0)
 . . W "AEIER:",AEIER,!
"RTN","SYNDHP57",111,0)
 . . W "RE85IEN:",RE85IEN,!
"RTN","SYNDHP57",112,0)
 . . W "RSEV:",RSEV,!
"RTN","SYNDHP57",113,0)
 ;
"RTN","SYNDHP57",114,0)
 ;I $G(DEBUG) W ! ZWRITE ALLERGIES W !
"RTN","SYNDHP57",115,0)
 ;
"RTN","SYNDHP57",116,0)
 ; serialize data
"RTN","SYNDHP57",117,0)
 N N,SCT,AIEN,ALGN,ALGE,ADATE,ATYPET,AVERT,RSEV,AID,ATYNODE,ATYPTX,ATYPET,GMRID
"RTN","SYNDHP57",118,0)
 S (SCT,AIEN)=""
"RTN","SYNDHP57",119,0)
 S ALGN=""
"RTN","SYNDHP57",120,0)
 F  S ALGN=$O(ALLERGIES(ALGN)) QUIT:ALGN=""  D
"RTN","SYNDHP57",121,0)
 . S ALGE=$P(ALLERGIES(ALGN),U,4)
"RTN","SYNDHP57",122,0)
 . S ADATE=$P(ALLERGIES(ALGN),U,3)
"RTN","SYNDHP57",123,0)
 . S GMRID=$P(ALLERGIES(ALGN),U,5)
"RTN","SYNDHP57",124,0)
 . S ATYPET=$P(ALLERGIES(ALGN),U,7)
"RTN","SYNDHP57",125,0)
 . S AVERT=$P(ALLERGIES(ALGN),U,8)
"RTN","SYNDHP57",126,0)
 . S RSEV=$P(ALLERGIES(ALGN),U,10)
"RTN","SYNDHP57",127,0)
 . S AID=$P(ALLERGIES(ALGN),U,1)
"RTN","SYNDHP57",128,0)
 . S ATYNODE=$O(ALLERGIES(ALGN,""))
"RTN","SYNDHP57",129,0)
 . S (ATYPTX,ATYPET)=""
"RTN","SYNDHP57",130,0)
 . I ATYNODE'="" D
"RTN","SYNDHP57",131,0)
 . . S ATYPTX=$G(ALLERGIES(ALGN,ATYNODE))
"RTN","SYNDHP57",132,0)
 . . S ATYPET=$P($G(ATYPTX),U,6)
"RTN","SYNDHP57",133,0)
 . N VMAP
"RTN","SYNDHP57",134,0)
 . I $P(GMRID,S,2)["PS" D
"RTN","SYNDHP57",135,0)
 . . S VUID=+$$GVREF(GMRID)
"RTN","SYNDHP57",136,0)
 . . S VMAP=$$MVUID(VUID,"VMAP")
"RTN","SYNDHP57",137,0)
 . I $P(GMRID,S,2)'["PS" D
"RTN","SYNDHP57",138,0)
 . . S CODE=$$MAPR^SYNDHPMP(ALGE,"T","A")
"RTN","SYNDHP57",139,0)
 . . S VMAP("SCT",CODE)=""
"RTN","SYNDHP57",140,0)
 . S (CS,N,O)=""
"RTN","SYNDHP57",141,0)
 . F  S N=$O(VMAP(N)) Q:N=""  F  S O=$O(VMAP(N,O)) Q:O=""  S CS=CS_N_":"_O_"~"
"RTN","SYNDHP57",142,0)
 . S CS=$RE($E($RE(CS),2,$L(CS)))
"RTN","SYNDHP57",143,0)
 . S ALLRET=ALLRET_U_ALGE_P_CS_P_ADATE_P_ATYPET_P_AVERT_P_AID
"RTN","SYNDHP57",144,0)
 . S N=""
"RTN","SYNDHP57",145,0)
 . F  S N=$O(ALLERGIES(ALGN,N)) Q:N=""  D
"RTN","SYNDHP57",146,0)
 . . S TX=ALLERGIES(ALGN,N)
"RTN","SYNDHP57",147,0)
 . . S REACTION=$P(TX,U,2)
"RTN","SYNDHP57",148,0)
 . . S ALLRET=ALLRET_"~"_REACTION_":"_$$MAPR^SYNDHPMP(REACTION,"T","R")_":"_$$LOW^XLFSTR(RSEV)
"RTN","SYNDHP57",149,0)
 . ;
"RTN","SYNDHP57",150,0)
 . I $G(DEBUG) D
"RTN","SYNDHP57",151,0)
 . . W "ALGE:",ALGE,!
"RTN","SYNDHP57",152,0)
 . . W "ADATE:",ADATE,!
"RTN","SYNDHP57",153,0)
 . . W "ATYPET:",ATYPET,!
"RTN","SYNDHP57",154,0)
 . . W "AVERT:",AVERT,!
"RTN","SYNDHP57",155,0)
 . . W "RSEV:",RSEV,!
"RTN","SYNDHP57",156,0)
 . . W "AID:",AID,!
"RTN","SYNDHP57",157,0)
 . . W "ATYNODE:",ATYNODE,!
"RTN","SYNDHP57",158,0)
 . . W "ATYPTX:",ATYPTX,!
"RTN","SYNDHP57",159,0)
 . . W "CS:",CS,!!
"RTN","SYNDHP57",160,0)
 ;
"RTN","SYNDHP57",161,0)
 QUIT ALLRET
"RTN","SYNDHP57",162,0)
 ;
"RTN","SYNDHP57",163,0)
 ;  -------------- Utility functions
"RTN","SYNDHP57",164,0)
 ;
"RTN","SYNDHP57",165,0)
VXMAPR(SURFORM,SFTYPE,MAOR) ; map reactions (SNOMED CT) - - redundant code - remove when sure
"RTN","SYNDHP57",166,0)
 ; map an allergic reaction surface form to an SCT code
"RTN","SYNDHP57",167,0)
 ; Input:
"RTN","SYNDHP57",168,0)
 ;   SURFORM - surface form
"RTN","SYNDHP57",169,0)
 ;   TYPE    - type of surface form
"RTN","SYNDHP57",170,0)
 ;             I - IEN
"RTN","SYNDHP57",171,0)
 ;             T - term
"RTN","SYNDHP57",172,0)
 ;   MAOR    - allergen or reaction
"RTN","SYNDHP57",173,0)
 ;             A - Allergen
"RTN","SYNDHP57",174,0)
 ;             R - Reaction
"RTN","SYNDHP57",175,0)
 ;
"RTN","SYNDHP57",176,0)
 I SFTYPE'="I",SFTYPE'="T" Q "-1^Type unrecognised - should be I or T"
"RTN","SYNDHP57",177,0)
 I MAOR'="A",MAOR'="R" Q "-1^Allergy/Reaction indicator unrecognised - should be A or R"
"RTN","SYNDHP57",178,0)
 N RSUB,INDX
"RTN","SYNDHP57",179,0)
 S RSUB=$S(MAOR="A":"ALLERGENS",1:"REACTIONS")
"RTN","SYNDHP57",180,0)
 S INDX=$S(SFTYPE="I":"ICT",1:"TCI")
"RTN","SYNDHP57",181,0)
 I '$D(^SYN("2002.010",RSUB,INDX,SURFORM)) Q ""  ; <<<<<< this global is missing
"RTN","SYNDHP57",182,0)
 QUIT $O(^SYN("2002.010",RSUB,INDX,SURFORM,""))
"RTN","SYNDHP57",183,0)
 ;
"RTN","SYNDHP57",184,0)
GVREF(ALLERGEN) ; map allergens (SNOMED CT, NDFRT, RxNorm, VANDF, etc)
"RTN","SYNDHP57",185,0)
 ; GMRD - SNOMED CT
"RTN","SYNDHP57",186,0)
 N S S S=";"
"RTN","SYNDHP57",187,0)
 ;I $P(ALLERGEN,S,2)["GMRD" D MAPGMRD QUIT MAPS
"RTN","SYNDHP57",188,0)
 I $P(ALLERGEN,S,2)["PSDRUG" QUIT $$VDRUG()
"RTN","SYNDHP57",189,0)
 I $P(ALLERGEN,S,2)["PSNDF" QUIT $$VPSNDF()
"RTN","SYNDHP57",190,0)
 I $P(ALLERGEN,S,2)["PS(50.416" QUIT $$VP50416()
"RTN","SYNDHP57",191,0)
 I $P(ALLERGEN,S,2)["PS(50.605" QUIT $$VP50605()
"RTN","SYNDHP57",192,0)
 QUIT
"RTN","SYNDHP57",193,0)
 ;
"RTN","SYNDHP57",194,0)
VDRUG() ;
"RTN","SYNDHP57",195,0)
 N PSDIEN,GENNAM,FPFOS,VUID,VMAP
"RTN","SYNDHP57",196,0)
 ;W !,N,"  -  ",INT,"  -  ",EXT
"RTN","SYNDHP57",197,0)
 S PSDIEN=+$P(ALLERGEN,";")
"RTN","SYNDHP57",198,0)
 ;W !,$$GET1^DIQ(50,PSDIEN_",",64,"E")
"RTN","SYNDHP57",199,0)
 S GENNAM=$$GET1^DIQ(50,PSDIEN_",",64,"E")
"RTN","SYNDHP57",200,0)
 ;W !,$O(^PS(50.416,"B",GENNAM,""))
"RTN","SYNDHP57",201,0)
 I '$D(^PS(50.416,"B",GENNAM)) QUIT "not found"
"RTN","SYNDHP57",202,0)
 S FPFOS=$O(^PS(50.416,"B",GENNAM,""))
"RTN","SYNDHP57",203,0)
 S VUID=$$GET1^DIQ(50.416,FPFOS_",","VUID")
"RTN","SYNDHP57",204,0)
 S VMAP=$$MVUID(VUID,"VMAP")
"RTN","SYNDHP57",205,0)
 QUIT VUID_U_GENNAM
"RTN","SYNDHP57",206,0)
 ;
"RTN","SYNDHP57",207,0)
 ;
"RTN","SYNDHP57",208,0)
VPSNDF() ;
"RTN","SYNDHP57",209,0)
 N PSDIEN,GENNAM,VUID
"RTN","SYNDHP57",210,0)
 S PSDIEN=+$P(ALLERGEN,";")
"RTN","SYNDHP57",211,0)
 S GENNAM=$$GET1^DIQ(50.6,PSDIEN_",",.01,"E")
"RTN","SYNDHP57",212,0)
 S VUID=$$GET1^DIQ(50.6,PSDIEN_",","VUID")
"RTN","SYNDHP57",213,0)
 QUIT VUID_U_GENNAM
"RTN","SYNDHP57",214,0)
 ;
"RTN","SYNDHP57",215,0)
VP50416() ;
"RTN","SYNDHP57",216,0)
 N PSDIEN,GENNAM,VUID
"RTN","SYNDHP57",217,0)
 S PSDIEN=+$P(ALLERGEN,";")
"RTN","SYNDHP57",218,0)
 S GENNAM=$$GET1^DIQ(50.416,PSDIEN_",",.01,"E")
"RTN","SYNDHP57",219,0)
 S VUID=$$GET1^DIQ(50.416,PSDIEN_",","VUID")
"RTN","SYNDHP57",220,0)
 QUIT VUID_U_GENNAM
"RTN","SYNDHP57",221,0)
 ;
"RTN","SYNDHP57",222,0)
VP50605() ;
"RTN","SYNDHP57",223,0)
 N PSDIEN,GENNAM,VUID
"RTN","SYNDHP57",224,0)
 S PSDIEN=+$P(ALLERGEN,";")
"RTN","SYNDHP57",225,0)
 S GENNAM=$$GET1^DIQ(50.605,PSDIEN_",",1,"E")
"RTN","SYNDHP57",226,0)
 S VUID=$$GET1^DIQ(50.605,PSDIEN_",","VUID")
"RTN","SYNDHP57",227,0)
 QUIT VUID_U_GENNAM
"RTN","SYNDHP57",228,0)
 ;
"RTN","SYNDHP57",229,0)
LYNX ;
"RTN","SYNDHP57",230,0)
 N EXT,INT
"RTN","SYNDHP57",231,0)
 N N S N=0
"RTN","SYNDHP57",232,0)
 N F S F=120.8
"RTN","SYNDHP57",233,0)
 F  S N=$O(^GMR(F,N)) Q:+N=0  D
"RTN","SYNDHP57",234,0)
 .S INT=$$GET1^DIQ(F,N_",",1,"I")
"RTN","SYNDHP57",235,0)
 .S EXT=$$GET1^DIQ(F,N_",",1,"E")
"RTN","SYNDHP57",236,0)
 .I $P(INT,";",2)["GMRD" Q
"RTN","SYNDHP57",237,0)
 .;I $P(INT,";",2)["PSDRUG" D LPSDRUG Q
"RTN","SYNDHP57",238,0)
 .I $P(INT,";",2)["PSNDF" D LPSNDF Q
"RTN","SYNDHP57",239,0)
 .W !,N,"  -  ",INT,"  -  ",EXT
"RTN","SYNDHP57",240,0)
 Q
"RTN","SYNDHP57",241,0)
 ;
"RTN","SYNDHP57",242,0)
LPSNDF ;
"RTN","SYNDHP57",243,0)
 Q
"RTN","SYNDHP57",244,0)
 W !,N,"  -  ",INT,"  -  ",EXT
"RTN","SYNDHP57",245,0)
 N PSDIEN,VUID
"RTN","SYNDHP57",246,0)
 S PSDIEN=+$P(INT,";")
"RTN","SYNDHP57",247,0)
 S VUID=$$GET1^DIQ(50.6,PSDIEN_",","VUID")
"RTN","SYNDHP57",248,0)
 W !,VUID
"RTN","SYNDHP57",249,0)
 Q
"RTN","SYNDHP57",250,0)
 ;
"RTN","SYNDHP57",251,0)
MVUID(VUID,MAP) ;  ******   needs work  ******
"RTN","SYNDHP57",252,0)
 ; map VUID to RXNORM sources ; Should be RxNorm
"RTN","SYNDHP57",253,0)
 N VMAP,RXCUI,SRC,CODE
"RTN","SYNDHP57",254,0)
 S VMAP("VANDF",VUID)=""
"RTN","SYNDHP57",255,0)
 S RXCUI=""
"RTN","SYNDHP57",256,0)
 F  S RXCUI=$O(^SYN("2002.020","IXVANDF",VUID,RXCUI)) Q:RXCUI=""  D
"RTN","SYNDHP57",257,0)
 .F SRC="RXNORM","NDFRT" D
"RTN","SYNDHP57",258,0)
 ..S CODE=""
"RTN","SYNDHP57",259,0)
 ..F  S CODE=$O(^SYN("2002.020",RXCUI,SRC,CODE)) Q:CODE=""  D
"RTN","SYNDHP57",260,0)
 ...S VMAP(SRC,CODE)=""
"RTN","SYNDHP57",261,0)
 M @MAP=VMAP
"RTN","SYNDHP57",262,0)
 Q MAP
"RTN","SYNDHP57",263,0)
 ;
"RTN","SYNDHP57",264,0)
KILL ;
"RTN","SYNDHP57",265,0)
 ;K AEIER,AID,ALLERGENI,CS,CODE,V,VMAP,SRC,RXCUI,ATYPET,GENNAM,REACT,REACTS,VUID
"RTN","SYNDHP57",266,0)
 ;K ALLERGY,AVERT,ATYPE,S,ALGN,PSDRUG
"RTN","SYNDHP57",267,0)
 Q
"RTN","SYNDHP57",268,0)
 ;
"RTN","SYNDHP57",269,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP57",270,0)
T1 ;
"RTN","SYNDHP57",271,0)
 N ICN S ICN="10111V183702"
"RTN","SYNDHP57",272,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP57",273,0)
 N TODAT S TODAT=""
"RTN","SYNDHP57",274,0)
 N JSON S JSON=""
"RTN","SYNDHP57",275,0)
 N RETSTA
"RTN","SYNDHP57",276,0)
 D PATALLI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP57",277,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP57",278,0)
 QUIT
"RTN","SYNDHP57",279,0)
 ;
"RTN","SYNDHP57",280,0)
T2 ;
"RTN","SYNDHP57",281,0)
 N ICN S ICN="10111V183702"
"RTN","SYNDHP57",282,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP57",283,0)
 N TODAT S TODAT=""
"RTN","SYNDHP57",284,0)
 N JSON S JSON="J"
"RTN","SYNDHP57",285,0)
 N RETSTA
"RTN","SYNDHP57",286,0)
 D PATALLI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP57",287,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP57",288,0)
 QUIT
"RTN","SYNDHP57",289,0)
 ;
"RTN","SYNDHP57",290,0)
TESTS ;
"RTN","SYNDHP57",291,0)
ALLTEST0 ; pass
"RTN","SYNDHP57",292,0)
 D PATALLI(.RETSTA,"10111V183702")
"RTN","SYNDHP57",293,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP57",294,0)
 Q
"RTN","SYNDHP57",295,0)
PROTEST ; in keeping with the spirit of the times
"RTN","SYNDHP57",296,0)
 n icn,pien
"RTN","SYNDHP57",297,0)
 s icn=""
"RTN","SYNDHP57",298,0)
 f  s icn=$o(^DPT("AFICN",icn)) q:icn=""  d
"RTN","SYNDHP57",299,0)
 .s pien=""
"RTN","SYNDHP57",300,0)
 .f  s pien=$o(^DPT("AFICN",icn,pien)) q:pien=""  d
"RTN","SYNDHP57",301,0)
 ..q:'$d(^GMR(120.8,"B",pien))
"RTN","SYNDHP57",302,0)
 ..k output
"RTN","SYNDHP57",303,0)
 ..k (icn,pien)
"RTN","SYNDHP57",304,0)
 ..d PATALLI(.output,icn)
"RTN","SYNDHP57",305,0)
 ..;i output["RXNORM" q
"RTN","SYNDHP57",306,0)
 ..;i output["NDFRT" q
"RTN","SYNDHP57",307,0)
 ..;i output'["VANDF" q
"RTN","SYNDHP57",308,0)
 ..W !!!!!!!! W $$ZW^SYNDHPUTL("output")
"RTN","SYNDHP57",309,0)
 q
"RTN","SYNDHP58")
0^67^B22472959
"RTN","SYNDHP58",1,0)
SYNDHP58 ; HC/art - HealthConcourse - get care team data ;05/04/2019
"RTN","SYNDHP58",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP58",3,0)
 ;;
"RTN","SYNDHP58",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP58",5,0)
 ;
"RTN","SYNDHP58",6,0)
 ;The authoratative source for VHA care team data is PCMM Web. (currently no connection is available.)
"RTN","SYNDHP58",7,0)
 ; PCMM Web updates VistA files on a regular basis.
"RTN","SYNDHP58",8,0)
 ;
"RTN","SYNDHP58",9,0)
 QUIT
"RTN","SYNDHP58",10,0)
 ;
"RTN","SYNDHP58",11,0)
GETTEAMS(RETSTA,FRDAT,TODAT,RETJSON) ;get all care teams
"RTN","SYNDHP58",12,0)
 ;input: FRDAT   - from date (inclusive), optional, compared to Current Activation Date
"RTN","SYNDHP58",13,0)
 ;       TODAT   - to date (inclusive), optional, compared to Current Activation Date
"RTN","SYNDHP58",14,0)
 ;       RETJSON - J = Return JSON
"RTN","SYNDHP58",15,0)
 ;                 F = Return FHIR
"RTN","SYNDHP58",16,0)
 ;                 0 or null = Return TEAMS string (default)
"RTN","SYNDHP58",17,0)
 ;returns: RETSTA - delimited string or JSON or FHIR string
"RTN","SYNDHP58",18,0)
 ;                  field delimiter |
"RTN","SYNDHP58",19,0)
 ;                  team delimiter ^
"RTN","SYNDHP58",20,0)
 ;                  resourceId | teamName | teamPurpose | institution | serviceDept | currentStatus | fhirTeamType | currentActivationDate | currentInactivationDate | current#Patients | resourceType ^ ...
"RTN","SYNDHP58",21,0)
 ;                or care team data in JSON format
"RTN","SYNDHP58",22,0)
 ;
"RTN","SYNDHP58",23,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP58",24,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP58",25,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP58",26,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP58",27,0)
 ;
"RTN","SYNDHP58",28,0)
 S RETSTA=""
"RTN","SYNDHP58",29,0)
 N P S P="|"
"RTN","SYNDHP58",30,0)
 N TEAMS
"RTN","SYNDHP58",31,0)
 N TEAMIEN S TEAMIEN=0
"RTN","SYNDHP58",32,0)
 F  S TEAMIEN=$O(^SCTM(404.51,TEAMIEN)) QUIT:+TEAMIEN=0  D
"RTN","SYNDHP58",33,0)
 . I $G(DEBUG) W !,"-------------------------------------------------------------",!
"RTN","SYNDHP58",34,0)
 . N TEAM,TEAMJ
"RTN","SYNDHP58",35,0)
 . D GET1TEAM^SYNDHP18(.TEAM,TEAMIEN,0)
"RTN","SYNDHP58",36,0)
 . I $D(TEAM("Team","ERROR")) M TEAMS("Teams",TEAMIEN)=TEAM QUIT
"RTN","SYNDHP58",37,0)
 . QUIT:((TEAM("Team","currentActivationDateCFM")\1)<FRDAT)!((TEAM("Team","currentActivationDateCFM")\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP58",38,0)
 . M TEAMS("Teams",TEAMIEN)=TEAM
"RTN","SYNDHP58",39,0)
 . I $G(RETJSON)'="J",$G(RETJSON)'="F" D
"RTN","SYNDHP58",40,0)
 . . S RETSTA=RETSTA_TEAM("Team","resourceId")_P_TEAM("Team","teamName")_P_TEAM("Team","teamPurpose")_P_TEAM("Team","institution")_P_TEAM("Team","serviceDept")_P
"RTN","SYNDHP58",41,0)
 . . S RETSTA=RETSTA_TEAM("Team","currentStatusC")_P_"longitudinal"_P_TEAM("Team","currentActivationDateCHL7")_P_TEAM("Team","currentInactivationDateCHL7")_P
"RTN","SYNDHP58",42,0)
 . . S RETSTA=RETSTA_TEAM("Team","current#PatientsC")_P_TEAM("Team","resourceType")_U
"RTN","SYNDHP58",43,0)
 . . ;I $G(DEBUG) W ! ZWRITE TEAM
"RTN","SYNDHP58",44,0)
 ;
"RTN","SYNDHP58",45,0)
 ;I $G(DEBUG) W ! ZWRITE TEAMS
"RTN","SYNDHP58",46,0)
 ;
"RTN","SYNDHP58",47,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP58",48,0)
 ;
"RTN","SYNDHP58",49,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP58",50,0)
 . S RETSTA=""
"RTN","SYNDHP58",51,0)
 . D TOJASON^SYNDHPUTL(.TEAMS,.RETSTA)
"RTN","SYNDHP58",52,0)
 ;
"RTN","SYNDHP58",53,0)
 ;I $G(DEBUG) W ! ZWRITE RETSTA
"RTN","SYNDHP58",54,0)
 ;
"RTN","SYNDHP58",55,0)
 QUIT
"RTN","SYNDHP58",56,0)
 ;
"RTN","SYNDHP58",57,0)
GETTEAM(RETSTA,TEAMID,RETJSON) ;get one care team
"RTN","SYNDHP58",58,0)
 ;input: TEAMID - Team Name or IEN
"RTN","SYNDHP58",59,0)
 ;       RETJSON - J = Return JSON
"RTN","SYNDHP58",60,0)
 ;                 F = Return FHIR
"RTN","SYNDHP58",61,0)
 ;                 0 or null = Return TEAMS string (default)
"RTN","SYNDHP58",62,0)
 ;returns: RETSTA - delimited string or JSON or FHIR string
"RTN","SYNDHP58",63,0)
 ;                  resourceId | teamName | teamPurpose | institution | serviceDept | currentStatus | fhirTeamType | currentActivationDate | currentInactivationDate | current#Patients | resourceType
"RTN","SYNDHP58",64,0)
 ;                or care team data in JSON format
"RTN","SYNDHP58",65,0)
 ;         -1^What team?
"RTN","SYNDHP58",66,0)
 ;         -1^Team not found
"RTN","SYNDHP58",67,0)
 ;
"RTN","SYNDHP58",68,0)
 I $G(TEAMID)="" S RETSTA="-1^What team?" QUIT
"RTN","SYNDHP58",69,0)
 N TEAMIEN,ERR
"RTN","SYNDHP58",70,0)
 S TEAMIEN=$$FIND1^DIC(404.51,"","B",TEAMID,"","","ERR")
"RTN","SYNDHP58",71,0)
 ;I $G(DEBUG),$D(ERR) W ! ZWRITE ERR
"RTN","SYNDHP58",72,0)
 I TEAMIEN=0,+TEAMID,'$D(^SCTM(404.51,+TEAMID)) S RETSTA="-1^Team not found" QUIT
"RTN","SYNDHP58",73,0)
 I $D(^SCTM(404.51,+TEAMID,0)) S TEAMIEN=TEAMID
"RTN","SYNDHP58",74,0)
 I TEAMIEN=0 S RETSTA="-1^Team not found" QUIT
"RTN","SYNDHP58",75,0)
 ;
"RTN","SYNDHP58",76,0)
 I $G(DEBUG) W !,"---------------------------- care team ---------------------------------",!
"RTN","SYNDHP58",77,0)
 N P S P="|"
"RTN","SYNDHP58",78,0)
 S RETSTA=""
"RTN","SYNDHP58",79,0)
 N TEAM,TEAMJ,TEAMS
"RTN","SYNDHP58",80,0)
 DO
"RTN","SYNDHP58",81,0)
 . D GET1TEAM^SYNDHP18(.TEAM,TEAMIEN,0)
"RTN","SYNDHP58",82,0)
 . M TEAMS("Teams",TEAMIEN)=TEAM
"RTN","SYNDHP58",83,0)
 . QUIT:$D(TEAM("Team","ERROR"))
"RTN","SYNDHP58",84,0)
 . I $G(RETJSON)'="J",$G(RETJSON)'="F" D
"RTN","SYNDHP58",85,0)
 . . S RETSTA=RETSTA_TEAM("Team","resourceId")_P_TEAM("Team","teamName")_P_TEAM("Team","teamPurpose")_P_TEAM("Team","institution")_P_TEAM("Team","serviceDept")_P
"RTN","SYNDHP58",86,0)
 . . S RETSTA=RETSTA_TEAM("Team","currentStatusC")_P_"longitudinal"_P_TEAM("Team","currentActivationDateCHL7")_P_TEAM("Team","currentInactivationDateCHL7")_P
"RTN","SYNDHP58",87,0)
 . . S RETSTA=RETSTA_TEAM("Team","current#PatientsC")_P_TEAM("Team","resourceType")
"RTN","SYNDHP58",88,0)
 ;I $G(DEBUG) W ! ZWRITE TEAM
"RTN","SYNDHP58",89,0)
 ;I $G(DEBUG) W ! ZWRITE TEAMS W !
"RTN","SYNDHP58",90,0)
 ;
"RTN","SYNDHP58",91,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP58",92,0)
 ;
"RTN","SYNDHP58",93,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP58",94,0)
 . S RETSTA=""
"RTN","SYNDHP58",95,0)
 . D TOJASON^SYNDHPUTL(.TEAMS,.RETSTA)
"RTN","SYNDHP58",96,0)
 ;
"RTN","SYNDHP58",97,0)
 ;I $G(DEBUG) W ! ZWRITE RETSTA W !
"RTN","SYNDHP58",98,0)
 ;
"RTN","SYNDHP58",99,0)
 QUIT
"RTN","SYNDHP58",100,0)
 ;
"RTN","SYNDHP58",101,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP58",102,0)
T1 ;
"RTN","SYNDHP58",103,0)
 N TEAMID S TEAMID="BLUE"
"RTN","SYNDHP58",104,0)
 N JSON S JSON=""
"RTN","SYNDHP58",105,0)
 N RETSTA
"RTN","SYNDHP58",106,0)
 D GETTEAM(.RETSTA,TEAMID,JSON)
"RTN","SYNDHP58",107,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP58",108,0)
 QUIT
"RTN","SYNDHP58",109,0)
 ;
"RTN","SYNDHP58",110,0)
T2 ;
"RTN","SYNDHP58",111,0)
 N TEAMID S TEAMID=5
"RTN","SYNDHP58",112,0)
 N JSON S JSON="J"
"RTN","SYNDHP58",113,0)
 N RETSTA
"RTN","SYNDHP58",114,0)
 D GETTEAM(.RETSTA,TEAMID,JSON)
"RTN","SYNDHP58",115,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP58",116,0)
 QUIT
"RTN","SYNDHP58",117,0)
 ;
"RTN","SYNDHP58",118,0)
T3 ;
"RTN","SYNDHP58",119,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP58",120,0)
 N TODAT S TODAT=""
"RTN","SYNDHP58",121,0)
 N JSON S JSON=""
"RTN","SYNDHP58",122,0)
 N RETSTA
"RTN","SYNDHP58",123,0)
 D GETTEAMS(.RETSTA,FRDAT,TODAT,JSON)
"RTN","SYNDHP58",124,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP58",125,0)
 QUIT
"RTN","SYNDHP58",126,0)
 ;
"RTN","SYNDHP58",127,0)
T4 ;
"RTN","SYNDHP58",128,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP58",129,0)
 N TODAT S TODAT=""
"RTN","SYNDHP58",130,0)
 N JSON S JSON="J"
"RTN","SYNDHP58",131,0)
 N RETSTA
"RTN","SYNDHP58",132,0)
 D GETTEAMS(.RETSTA,FRDAT,TODAT,JSON)
"RTN","SYNDHP58",133,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP58",134,0)
 QUIT
"RTN","SYNDHP58",135,0)
 ;
"RTN","SYNDHP59")
0^68^B60059790
"RTN","SYNDHP59",1,0)
SYNDHP59 ; HC/art - HealthConcourse - get care plan data for a patient ;05/07/2019
"RTN","SYNDHP59",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP59",3,0)
 ;;
"RTN","SYNDHP59",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP59",5,0)
 ;
"RTN","SYNDHP59",6,0)
 QUIT
"RTN","SYNDHP59",7,0)
 ; -------------------- Patient Care Plans --------------------
"RTN","SYNDHP59",8,0)
 ;
"RTN","SYNDHP59",9,0)
PATCPALL(RETSTA,NAME,SSN,DOB,GENDER,FRDAT,TODAT,RETJSON) ; get Care Plans for a patient by traits
"RTN","SYNDHP59",10,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP59",11,0)
 QUIT
"RTN","SYNDHP59",12,0)
 ; Return patient Care Plans for name, SSN, DOB, and gender
"RTN","SYNDHP59",13,0)
 ; This API will only return data for Synthea care plan patients
"RTN","SYNDHP59",14,0)
 ;
"RTN","SYNDHP59",15,0)
 ; Input:
"RTN","SYNDHP59",16,0)
 ;   NAME    - patient name
"RTN","SYNDHP59",17,0)
 ;   SSN     - social security number
"RTN","SYNDHP59",18,0)
 ;   DOB     - date of birth
"RTN","SYNDHP59",19,0)
 ;   GENDER  - gender
"RTN","SYNDHP59",20,0)
 ;   FRDATE  - from date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP59",21,0)
 ;   TODATE  - to date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP59",22,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP59",23,0)
 ;             F = Return FHIR
"RTN","SYNDHP59",24,0)
 ;             0 = Return Care Plan string (default)
"RTN","SYNDHP59",25,0)
 ; Output:
"RTN","SYNDHP59",26,0)
 ;   RETSTA  - a delimited string ...
"RTN","SYNDHP59",27,0)
 ;           - ICN^resourceId|HF SCT|HF Name|levelSeverity|encounterProvider|eventDateTime|visitDateTime|comments^...
"RTN","SYNDHP59",28,0)
 ;
"RTN","SYNDHP59",29,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP59",30,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP59",31,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP59",32,0)
 ;
"RTN","SYNDHP59",33,0)
 N ICNST,DHPICN,PATIEN
"RTN","SYNDHP59",34,0)
 ;
"RTN","SYNDHP59",35,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP59",36,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP59",37,0)
 S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP59",38,0)
 ;
"RTN","SYNDHP59",39,0)
 ; get patient IEN from ICN
"RTN","SYNDHP59",40,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP59",41,0)
 ;
"RTN","SYNDHP59",42,0)
 S RETSTA=DHPICN
"RTN","SYNDHP59",43,0)
 ;
"RTN","SYNDHP59",44,0)
 D GETALL(.RETSTA,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP59",45,0)
 ;
"RTN","SYNDHP59",46,0)
 QUIT
"RTN","SYNDHP59",47,0)
 ;
"RTN","SYNDHP59",48,0)
 ; -------------------- Patient Care Plans --------------------
"RTN","SYNDHP59",49,0)
 ;
"RTN","SYNDHP59",50,0)
PATCPALLI(RETSTA,DHPICN,FRDAT,TODAT,RETJSON) ; Get Patient Care Plans for ICN
"RTN","SYNDHP59",51,0)
 ;
"RTN","SYNDHP59",52,0)
 ; Return patient Care Plans for a given patient ICN
"RTN","SYNDHP59",53,0)
 ; This API will only return care plan(s) for ingested Synthea patients
"RTN","SYNDHP59",54,0)
 ;
"RTN","SYNDHP59",55,0)
 ; Input:
"RTN","SYNDHP59",56,0)
 ;   DHPICN  - patient ICN (unique patient identifier across all VistA systems)
"RTN","SYNDHP59",57,0)
 ;   FRDAT   - from date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP59",58,0)
 ;   TODAT   - to date (inclusive), optional, compared to Visit Date/Time
"RTN","SYNDHP59",59,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP59",60,0)
 ;             F = Return FHIR
"RTN","SYNDHP59",61,0)
 ;             0 = Return Care Plan string (default)
"RTN","SYNDHP59",62,0)
 ; Output:
"RTN","SYNDHP59",63,0)
 ;   RETSTA  - a delimited string ...
"RTN","SYNDHP59",64,0)
 ;           - ICN^resourceId|HF SCT|HF Name|levelSeverity|encounterProvider|eventDateTime|visitDateTime|comments^...
"RTN","SYNDHP59",65,0)
 ;         or care plan data in JSON format
"RTN","SYNDHP59",66,0)
 ;
"RTN","SYNDHP59",67,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP59",68,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP59",69,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP59",70,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP59",71,0)
 ;
"RTN","SYNDHP59",72,0)
 ; validate ICN
"RTN","SYNDHP59",73,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP59",74,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP59",75,0)
 ; 
"RTN","SYNDHP59",76,0)
 ; get patient IEN from ICN
"RTN","SYNDHP59",77,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP59",78,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP59",79,0)
 ;
"RTN","SYNDHP59",80,0)
 S RETSTA=DHPICN
"RTN","SYNDHP59",81,0)
 ;
"RTN","SYNDHP59",82,0)
 D GETALL(.RETSTA,PATIEN,FRDAT,TODAT)
"RTN","SYNDHP59",83,0)
 ;
"RTN","SYNDHP59",84,0)
 QUIT
"RTN","SYNDHP59",85,0)
 ;
"RTN","SYNDHP59",86,0)
GETALL(RETSTA,PATIEN,FRDAT,TODAT) ;get all care plans for a patient
"RTN","SYNDHP59",87,0)
 ;
"RTN","SYNDHP59",88,0)
 N P S P="|"
"RTN","SYNDHP59",89,0)
 ;
"RTN","SYNDHP59",90,0)
 N visitId,HLFACTS
"RTN","SYNDHP59",91,0)
 N HFIEN S HFIEN=""
"RTN","SYNDHP59",92,0)
 F  S HFIEN=$O(^AUPNVHF("C",PATIEN,HFIEN)) QUIT:HFIEN=""  D
"RTN","SYNDHP59",93,0)
 . N HLFACT
"RTN","SYNDHP59",94,0)
 . D GET1HLF^SYNDHP15(.HLFACT,HFIEN,1,0)
"RTN","SYNDHP59",95,0)
 . I $D(HLFACT("HealthFactor","ERROR")) M HLFACTS("CarePlan",HFIEN)=HLFACT QUIT
"RTN","SYNDHP59",96,0)
 . ;I $D(HLFACT("HealthFactor","ERROR")) M HLFACTS("CarePlan",visitId,"Visit",HFIEN)=HLFACT QUIT
"RTN","SYNDHP59",97,0)
 . QUIT:$E(HLFACT("HealthFactor","hlfName"),1,4)'="SYN "
"RTN","SYNDHP59",98,0)
 . I $G(DEBUG) W HLFACT("HealthFactor","visitFM"),!
"RTN","SYNDHP59",99,0)
 . QUIT:((HLFACT("HealthFactor","visitFM")\1)<FRDAT)!((HLFACT("HealthFactor","visitFM")\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP59",100,0)
 . S visitId=HLFACT("HealthFactor","visitId")
"RTN","SYNDHP59",101,0)
 . M HLFACTS("CarePlan",visitId,"Visit",HFIEN)=HLFACT
"RTN","SYNDHP59",102,0)
 . I $G(RETJSON)'="J",$G(RETJSON)'="F" D
"RTN","SYNDHP59",103,0)
 . . S RETSTA=RETSTA_U_HLFACT("HealthFactor","resourceId")_P_HLFACT("HealthFactor","hlfNameSCT")_P_HLFACT("HealthFactor","hlfName")_P
"RTN","SYNDHP59",104,0)
 . . S RETSTA=RETSTA_HLFACT("HealthFactor","levelSeverity")_P_HLFACT("HealthFactor","encounterProvider")_P_HLFACT("HealthFactor","eventDateTimeHL7")_P
"RTN","SYNDHP59",105,0)
 . . S RETSTA=RETSTA_HLFACT("HealthFactor","visitHL7")_P_HLFACT("HealthFactor","comments")
"RTN","SYNDHP59",106,0)
 ;
"RTN","SYNDHP59",107,0)
 ;I $G(DEBUG) W ! ZWRITE HLFACTS
"RTN","SYNDHP59",108,0)
 ;
"RTN","SYNDHP59",109,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP59",110,0)
 ;
"RTN","SYNDHP59",111,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP59",112,0)
 . S RETSTA=""
"RTN","SYNDHP59",113,0)
 . D TOJASON^SYNDHPUTL(.HLFACTS,.RETSTA)
"RTN","SYNDHP59",114,0)
 ;
"RTN","SYNDHP59",115,0)
 ;I $G(DEBUG) W ! ZWRITE RETSTA
"RTN","SYNDHP59",116,0)
 ;
"RTN","SYNDHP59",117,0)
 QUIT
"RTN","SYNDHP59",118,0)
 ;
"RTN","SYNDHP59",119,0)
PATCP(RETSTA,NAME,SSN,DOB,GENDER,VRESID,RETJSON) ; get Care Plan for a patient by traits and Visit ID
"RTN","SYNDHP59",120,0)
 S RETSTA="-1^This service has been retired"
"RTN","SYNDHP59",121,0)
 QUIT
"RTN","SYNDHP59",122,0)
 ; Return patient Care Plans for name, SSN, DOB, and gender and Visit ID
"RTN","SYNDHP59",123,0)
 ; This API will only return data for Synthea care plan patients
"RTN","SYNDHP59",124,0)
 ;
"RTN","SYNDHP59",125,0)
 ; Input:
"RTN","SYNDHP59",126,0)
 ;   NAME    - patient name
"RTN","SYNDHP59",127,0)
 ;   SSN     - social security number
"RTN","SYNDHP59",128,0)
 ;   DOB     - date of birth
"RTN","SYNDHP59",129,0)
 ;   GENDER  - gender
"RTN","SYNDHP59",130,0)
 ;   VRESID  - Visit resource ID
"RTN","SYNDHP59",131,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP59",132,0)
 ;             0 = Return Care Plan string (default)
"RTN","SYNDHP59",133,0)
 ; Output:
"RTN","SYNDHP59",134,0)
 ;   RETSTA  - a delimited string ...
"RTN","SYNDHP59",135,0)
 ;           - ICN^resourceId|HF SCT|HF Name|levelSeverity|encounterProvider|eventDateTime|visitDateTime|comments^...
"RTN","SYNDHP59",136,0)
 ;         or care plan data in JSON format
"RTN","SYNDHP59",137,0)
 ;
"RTN","SYNDHP59",138,0)
 I $G(VRESID)="" S RETSTA="-1^No visit identifier" QUIT
"RTN","SYNDHP59",139,0)
 ;
"RTN","SYNDHP59",140,0)
 N ICNST
"RTN","SYNDHP59",141,0)
 D PATVAL^SYNDHP43(.ICNST,NAME,SSN,DOB,GENDER)
"RTN","SYNDHP59",142,0)
 I +ICNST'=1 S RETSTA=ICNST QUIT
"RTN","SYNDHP59",143,0)
 N DHPICN S DHPICN=$P(ICNST,U,3)
"RTN","SYNDHP59",144,0)
 ;
"RTN","SYNDHP59",145,0)
 ; get patient IEN from ICN
"RTN","SYNDHP59",146,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP59",147,0)
 ;
"RTN","SYNDHP59",148,0)
 S RETSTA=DHPICN
"RTN","SYNDHP59",149,0)
 ;
"RTN","SYNDHP59",150,0)
 D GETONE(.RETSTA,PATIEN,VRESID)
"RTN","SYNDHP59",151,0)
 ;
"RTN","SYNDHP59",152,0)
 QUIT
"RTN","SYNDHP59",153,0)
 ;
"RTN","SYNDHP59",154,0)
PATCPI(RETSTA,DHPICN,VRESID,RETJSON) ; Patient Care Plan(s) for ICN and Visit ID
"RTN","SYNDHP59",155,0)
 ;
"RTN","SYNDHP59",156,0)
 ; Return patient Care Plan for a given patient ICN and Visit ID
"RTN","SYNDHP59",157,0)
 ; This API will only return data for Synthea care plan patients
"RTN","SYNDHP59",158,0)
 ;
"RTN","SYNDHP59",159,0)
 ; Input:
"RTN","SYNDHP59",160,0)
 ;   DHPICN  - patient ICN (unique patient identifier across all VistA systems)
"RTN","SYNDHP59",161,0)
 ;   VRESID  - Visit resource ID, "_" piece 4 is the visit ien 
"RTN","SYNDHP59",162,0)
 ;   RETJSON - J = Return JSON
"RTN","SYNDHP59",163,0)
 ;             F = Return FHIR
"RTN","SYNDHP59",164,0)
 ;             0 = Return Care Plan string (default)
"RTN","SYNDHP59",165,0)
 ; Output:
"RTN","SYNDHP59",166,0)
 ;   RETSTA  - a delimited string ...
"RTN","SYNDHP59",167,0)
 ;           - ICN^resourceId|HF SCT|HF Name|levelSeverity|encounterProvider|eventDateTime|visitDateTime|comments^...
"RTN","SYNDHP59",168,0)
 ;         or care plan data in JSON format
"RTN","SYNDHP59",169,0)
 ;
"RTN","SYNDHP59",170,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP59",171,0)
 I $G(VRESID)="" S RETSTA="-1^What visit?" QUIT
"RTN","SYNDHP59",172,0)
 ;
"RTN","SYNDHP59",173,0)
 ; validate ICN
"RTN","SYNDHP59",174,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP59",175,0)
 ; 
"RTN","SYNDHP59",176,0)
 ; get patient IEN from ICN
"RTN","SYNDHP59",177,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP59",178,0)
 ;
"RTN","SYNDHP59",179,0)
 S RETSTA=DHPICN
"RTN","SYNDHP59",180,0)
 ;
"RTN","SYNDHP59",181,0)
 D GETONE(.RETSTA,PATIEN,VRESID)
"RTN","SYNDHP59",182,0)
 ;
"RTN","SYNDHP59",183,0)
 QUIT
"RTN","SYNDHP59",184,0)
 ;
"RTN","SYNDHP59",185,0)
GETONE(RETSTA,PATIEN,VRESID) ;get care plan(s) for a visit
"RTN","SYNDHP59",186,0)
 ;
"RTN","SYNDHP59",187,0)
 N P S P="|"
"RTN","SYNDHP59",188,0)
 N S S S="_"
"RTN","SYNDHP59",189,0)
 ;
"RTN","SYNDHP59",190,0)
 N HLFACTS
"RTN","SYNDHP59",191,0)
 N VISIT S VISIT=$P(VRESID,S,4)
"RTN","SYNDHP59",192,0)
 N HFIEN S HFIEN=""
"RTN","SYNDHP59",193,0)
 F  S HFIEN=$O(^AUPNVHF("C",PATIEN,HFIEN)) QUIT:HFIEN=""  D
"RTN","SYNDHP59",194,0)
 . N HLFACT
"RTN","SYNDHP59",195,0)
 . D GET1HLF^SYNDHP15(.HLFACT,HFIEN,1,0)
"RTN","SYNDHP59",196,0)
 . I $D(HLFACT("HealthFactor","ERROR")) M HLFACTS("CarePlan",HFIEN)=HLFACT QUIT
"RTN","SYNDHP59",197,0)
 . ;I $D(HLFACT("HealthFactor","ERROR")) M HLFACTS("CarePlan",visitId,"Visit",HFIEN)=HLFACT QUIT
"RTN","SYNDHP59",198,0)
 . QUIT:$E(HLFACT("HealthFactor","hlfName"),1,4)'="SYN "  ;skip if not synthea ingested
"RTN","SYNDHP59",199,0)
 . QUIT:VISIT'=HLFACT("HealthFactor","visitId")  ;skip if not for requested visit
"RTN","SYNDHP59",200,0)
 . S visitId=HLFACT("HealthFactor","visitId")
"RTN","SYNDHP59",201,0)
 . M HLFACTS("CarePlan",visitId,"Visit",HFIEN)=HLFACT
"RTN","SYNDHP59",202,0)
 . I $G(RETJSON)'="J",$G(RETJSON)'="F" D
"RTN","SYNDHP59",203,0)
 . . S RETSTA=RETSTA_U_HLFACT("HealthFactor","resourceId")_P_HLFACT("HealthFactor","hlfNameSCT")_P_HLFACT("HealthFactor","hlfName")_P
"RTN","SYNDHP59",204,0)
 . . S RETSTA=RETSTA_HLFACT("HealthFactor","levelSeverity")_P_HLFACT("HealthFactor","encounterProvider")_P_HLFACT("HealthFactor","eventDateTimeHL7")_P
"RTN","SYNDHP59",205,0)
 . . S RETSTA=RETSTA_HLFACT("HealthFactor","visitHL7")_P_HLFACT("HealthFactor","comments")
"RTN","SYNDHP59",206,0)
 ;
"RTN","SYNDHP59",207,0)
 ;I $G(DEBUG) W ! ZWRITE HLFACTS
"RTN","SYNDHP59",208,0)
 ;
"RTN","SYNDHP59",209,0)
 ;I $G(RETJSON)="F" D xxx  ;create array for FHIR
"RTN","SYNDHP59",210,0)
 ;
"RTN","SYNDHP59",211,0)
 I $G(RETJSON)="J"!($G(RETJSON)="F") D
"RTN","SYNDHP59",212,0)
 . S RETSTA=""
"RTN","SYNDHP59",213,0)
 . D TOJASON^SYNDHPUTL(.HLFACTS,.RETSTA)
"RTN","SYNDHP59",214,0)
 ;
"RTN","SYNDHP59",215,0)
 ;I $G(DEBUG) W ! ZWRITE RETSTA
"RTN","SYNDHP59",216,0)
 ;
"RTN","SYNDHP59",217,0)
 QUIT
"RTN","SYNDHP59",218,0)
 ;
"RTN","SYNDHP59",219,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP59",220,0)
T1 ;
"RTN","SYNDHP59",221,0)
 N ICN S ICN="2434609669V691690"
"RTN","SYNDHP59",222,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP59",223,0)
 N TODAT S TODAT=""
"RTN","SYNDHP59",224,0)
 N JSON S JSON=""
"RTN","SYNDHP59",225,0)
 N RETSTA
"RTN","SYNDHP59",226,0)
 D PATCPALLI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP59",227,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP59",228,0)
 QUIT
"RTN","SYNDHP59",229,0)
 ;
"RTN","SYNDHP59",230,0)
T2 ;
"RTN","SYNDHP59",231,0)
 N ICN S ICN="2434609669V691690"
"RTN","SYNDHP59",232,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP59",233,0)
 N TODAT S TODAT=""
"RTN","SYNDHP59",234,0)
 N JSON S JSON="J"
"RTN","SYNDHP59",235,0)
 N RETSTA
"RTN","SYNDHP59",236,0)
 D PATCPALLI(.RETSTA,ICN,FRDAT,TODAT,JSON)
"RTN","SYNDHP59",237,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP59",238,0)
 QUIT
"RTN","SYNDHP59",239,0)
 ;
"RTN","SYNDHP59",240,0)
T3 ;
"RTN","SYNDHP59",241,0)
 N ICN S ICN="2434609669V691690"
"RTN","SYNDHP59",242,0)
 N VRESID S VRESID="V_500_1000010_34494"
"RTN","SYNDHP59",243,0)
 N JSON S JSON=""
"RTN","SYNDHP59",244,0)
 N RETSTA
"RTN","SYNDHP59",245,0)
 D PATCPI(.RETSTA,ICN,VRESID,JSON)
"RTN","SYNDHP59",246,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP59",247,0)
 QUIT
"RTN","SYNDHP59",248,0)
 ;
"RTN","SYNDHP59",249,0)
T4 ;
"RTN","SYNDHP59",250,0)
 N ICN S ICN="2434609669V691690"
"RTN","SYNDHP59",251,0)
 N VRESID S VRESID="V_500_1000010_34494"
"RTN","SYNDHP59",252,0)
 N JSON S JSON="J"
"RTN","SYNDHP59",253,0)
 N RETSTA
"RTN","SYNDHP59",254,0)
 D PATCPI(.RETSTA,ICN,VRESID,JSON)
"RTN","SYNDHP59",255,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP59",256,0)
 QUIT
"RTN","SYNDHP59",257,0)
 ;
"RTN","SYNDHP61")
0^8^B175435602
"RTN","SYNDHP61",1,0)
SYNDHP61 ;DHP/FJF/ART - HealthConcourse - Write To VistA ;12/07/2018
"RTN","SYNDHP61",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP61",3,0)
 ;;
"RTN","SYNDHP61",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP61",5,0)
 ;
"RTN","SYNDHP61",6,0)
 QUIT
"RTN","SYNDHP61",7,0)
 ;
"RTN","SYNDHP61",8,0)
 ; vitals update
"RTN","SYNDHP61",9,0)
VITUPD(RETSTA,DHPPAT,DHPSCT,DHPOBS,DHPUNT,DHPDTM,DHPROV,DHPLOC) ; vitals update
"RTN","SYNDHP61",10,0)
 ;
"RTN","SYNDHP61",11,0)
 ; Input:
"RTN","SYNDHP61",12,0)
 ;  DHPPAT  - patient ICN           (mandatory)
"RTN","SYNDHP61",13,0)
 ;  DHPSCT  - SNOMED CT code        (mandatory)
"RTN","SYNDHP61",14,0)
 ;  DHPOBS  - Observation Value     (mandatory)
"RTN","SYNDHP61",15,0)
 ;  DHPUNT  - Observation units     (mandatory)
"RTN","SYNDHP61",16,0)
 ;  DHPDTM  - Observation Date/Time (mandatory) HL7 format
"RTN","SYNDHP61",17,0)
 ;  DHPROV  - provider              (mandatory) NPI#
"RTN","SYNDHP61",18,0)
 ;  DHPLOC  - location              (mandatory) name
"RTN","SYNDHP61",19,0)
 ; Output:   
"RTN","SYNDHP61",20,0)
 ;  1 - success
"RTN","SYNDHP61",21,0)
 ; -1 - failure
"RTN","SYNDHP61",22,0)
 ;
"RTN","SYNDHP61",23,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" Q
"RTN","SYNDHP61",24,0)
 ; set up array of allowed SCT codes
"RTN","SYNDHP61",25,0)
 ;
"RTN","SYNDHP61",26,0)
 D VITSCT
"RTN","SYNDHP61",27,0)
 ;
"RTN","SYNDHP61",28,0)
 I '$D(SCTA(DHPSCT)) S RETSTA="-1^SNOMED CT code not recognised as vitals" Q
"RTN","SYNDHP61",29,0)
 ; build FDA and update vitals file (FN)
"RTN","SYNDHP61",30,0)
 D VITFDA
"RTN","SYNDHP61",31,0)
 D UPDATE^DIE(,"FDA",,"ZZERR")
"RTN","SYNDHP61",32,0)
 S RETSTA=$S($D(ZZERR):-1,1:1)
"RTN","SYNDHP61",33,0)
 Q
"RTN","SYNDHP61",34,0)
 ;
"RTN","SYNDHP61",35,0)
VITSCT ; set up recognised SCT codes for VITALS
"RTN","SYNDHP61",36,0)
 ; map incoming SNOMED CT code to VistA Vital Type (file FN1)
"RTN","SYNDHP61",37,0)
 S SCTA(27113001)="9^Body weight"
"RTN","SYNDHP61",38,0)
 S SCTA(50373000)="8^Body height"
"RTN","SYNDHP61",39,0)
 S SCTA(75367002)="1^Blood pressure"
"RTN","SYNDHP61",40,0)
 S SCTA(78564009)="5^Pulse rate"
"RTN","SYNDHP61",41,0)
 S SCTA(386725007)="2^Body Temperature"
"RTN","SYNDHP61",42,0)
 S SCTA(86290005)="3^Respiration"
"RTN","SYNDHP61",43,0)
 S SCTA(48094003)="10^Abdominal girth measurement"
"RTN","SYNDHP61",44,0)
 S SCTA(21727005)="11^Audiometry"
"RTN","SYNDHP61",45,0)
 S SCTA(252465000)="21^Pulse oximetry"
"RTN","SYNDHP61",46,0)
 S SCTA(22253000)="22^Pain"
"RTN","SYNDHP61",47,0)
 ; map incoming SNOMED CT code to VistA Vital Type (file FN1)
"RTN","SYNDHP61",48,0)
 S SCTX(9)="27113001^Body weight"
"RTN","SYNDHP61",49,0)
 S SCTX(8)="50373000^Body height"
"RTN","SYNDHP61",50,0)
 S SCTX(1)="75367002^Blood pressure"
"RTN","SYNDHP61",51,0)
 S SCTX(5)="78564009^Pulse rate"
"RTN","SYNDHP61",52,0)
 S SCTX(2)="386725007^Body Temperature"
"RTN","SYNDHP61",53,0)
 S SCTX(3)="86290005^Respiration"
"RTN","SYNDHP61",54,0)
 S SCTX(10)="48094003^Abdominal girth measurement"
"RTN","SYNDHP61",55,0)
 S SCTX(11)="21727005^Audiometry"
"RTN","SYNDHP61",56,0)
 S SCTX(21)="252465000^Pulse oximetry"
"RTN","SYNDHP61",57,0)
 S SCTX(22)="22253000^Pain"
"RTN","SYNDHP61",58,0)
 Q
"RTN","SYNDHP61",59,0)
 ;
"RTN","SYNDHP61",60,0)
VITFDA ; build FDA array for Vitals
"RTN","SYNDHP61",61,0)
 K FDA,ZZERR,ORIEN
"RTN","SYNDHP61",62,0)
 N PATIEN,PRVIEN,LOCIEN
"RTN","SYNDHP61",63,0)
 S FN=120.5
"RTN","SYNDHP61",64,0)
 ;S DHPLOC=$G(DHPLOC,10000000286)
"RTN","SYNDHP61",65,0)
 ;S DHPROV=$G(DHPROV,101)
"RTN","SYNDHP61",66,0)
 S DHPOBS=$$SI2IMP(DHPSCT,DHPOBS)
"RTN","SYNDHP61",67,0)
 S ORIEN(1)=$$NEXTIEN()
"RTN","SYNDHP61",68,0)
 S PATIEN=$O(^DPT("AFICN",DHPPAT,""))
"RTN","SYNDHP61",69,0)
 S PRVIEN=0
"RTN","SYNDHP61",70,0)
 I $G(DHPROV)'="" S PRVIEN=$O(^VA(200,"ANPI",DHPROV,""))
"RTN","SYNDHP61",71,0)
 I 'PRVIEN S PRVIEN=$O(^XUSEC("PROVIDER",0))
"RTN","SYNDHP61",72,0)
 I 'PRVIEN S $EC=",U-SET-UP-A-BLOODY-PROVIDER,"
"RTN","SYNDHP61",73,0)
 S LOCIEN=$O(^SC("B",DHPLOC,""))
"RTN","SYNDHP61",74,0)
 ;
"RTN","SYNDHP61",75,0)
 S FDA(FN,"+1,",.01)=$$HL7TFM^XLFDT(DHPDTM) ;date/time vitals taken
"RTN","SYNDHP61",76,0)
 S FDA(FN,"+1,",.02)=PATIEN ;patient
"RTN","SYNDHP61",77,0)
 S FDA(FN,"+1,",.03)=+SCTA(DHPSCT) ;vital type
"RTN","SYNDHP61",78,0)
 S FDA(FN,"+1,",.04)=$$HL7TFM^XLFDT(DHPDTM) ;date/time vitals entered
"RTN","SYNDHP61",79,0)
 S FDA(FN,"+1,",.05)=DHPLOC ;hospital location
"RTN","SYNDHP61",80,0)
 S FDA(FN,"+1,",.06)=PRVIEN ;entered by
"RTN","SYNDHP61",81,0)
 S FDA(FN,"+1,",1.2)=DHPOBS ;rate
"RTN","SYNDHP61",82,0)
 Q
"RTN","SYNDHP61",83,0)
 ;
"RTN","SYNDHP61",84,0)
NEXTIEN() ; 
"RTN","SYNDHP61",85,0)
 ; Get new code IEN
"RTN","SYNDHP61",86,0)
 Q $O(^GMR(FN,9E29),-1)+1
"RTN","SYNDHP61",87,0)
 ;
"RTN","SYNDHP61",88,0)
SI2IMP(SCT,OBS) ; convert metric units to imperial
"RTN","SYNDHP61",89,0)
 ;
"RTN","SYNDHP61",90,0)
 N UNITS
"RTN","SYNDHP61",91,0)
 S UNITS=$$UP^XLFSTR(DHPUNT)
"RTN","SYNDHP61",92,0)
 I SCT=27113001,UNITS="KG" Q $J(OBS*2.20462,0,1)  ; weight kg to lbs
"RTN","SYNDHP61",93,0)
 I SCT=50373000,UNITS="CM" Q $J(OBS*0.393701,0,0) ; height cm to inches
"RTN","SYNDHP61",94,0)
 I SCT=386725007,UNITS="CEL" Q $J(OBS/5*9+32,0,1) ; celsius to fahrenheit
"RTN","SYNDHP61",95,0)
 Q OBS
"RTN","SYNDHP61",96,0)
 ;
"RTN","SYNDHP61",97,0)
 ;
"RTN","SYNDHP61",98,0)
 ; -------- problem/condition update
"RTN","SYNDHP61",99,0)
 ;
"RTN","SYNDHP61",100,0)
PROBUPD(RETSTA,DHPPAT,DHPSCT,DHPSDES,DHPROV,DHPDTM,DHPRID) ; problems update
"RTN","SYNDHP61",101,0)
 ;
"RTN","SYNDHP61",102,0)
 ; Alternate entry for creating problem/condition if snomed code does not map to icd code, so can't use DATA2PCE
"RTN","SYNDHP61",103,0)
 ;
"RTN","SYNDHP61",104,0)
 ; Input:
"RTN","SYNDHP61",105,0)
 ;  DHPPAT -   patient ICN                (mandatory)
"RTN","SYNDHP61",106,0)
 ;  DHPSCT -   SNOMED CT code             (mandatory)
"RTN","SYNDHP61",107,0)
 ;  DHPSDES -  SNOMED CT designation code (optional)      >>>not used in code below, code (DHPSCDES) is looked up in Lexicon <<<
"RTN","SYNDHP61",108,0)
 ;  DHPROV -   Provider     (NPI)              (optional)
"RTN","SYNDHP61",109,0)
 ;  DHPDTM -   Observation Date/Time  (HL7)    (mandatory)
"RTN","SYNDHP61",110,0)
 ;  DHPRID -   DHP unique resource ID     (optional)
"RTN","SYNDHP61",111,0)
 ;               agency_facility          
"RTN","SYNDHP61",112,0)
 ;
"RTN","SYNDHP61",113,0)
 ; Output:   
"RTN","SYNDHP61",114,0)
 ;  1 - success
"RTN","SYNDHP61",115,0)
 ; -1 - failure
"RTN","SYNDHP61",116,0)
 ;
"RTN","SYNDHP61",117,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" Q
"RTN","SYNDHP61",118,0)
 ;
"RTN","SYNDHP61",119,0)
 ;I '$D(SCTA(DHPSCT)) S RETSTA="-1^SNOMED CT code not recognised as vitals" Q
"RTN","SYNDHP61",120,0)
 ; build FDA and update vitals file (FN)
"RTN","SYNDHP61",121,0)
 K LEX
"RTN","SYNDHP61",122,0)
 S LEX=$$CODE^LEXTRAN(DHPSCT,"SCT")
"RTN","SYNDHP61",123,0)
 I +LEX=-2 S RETSTA=LEX Q
"RTN","SYNDHP61",124,0)
 D PROBFDA
"RTN","SYNDHP61",125,0)
 D UPDATE^DIE(,"FDA",,"ZZERR")
"RTN","SYNDHP61",126,0)
 ;W ! ZW ZZERR
"RTN","SYNDHP61",127,0)
 S RETSTA=$S($D(ZZERR):-1,1:1)
"RTN","SYNDHP61",128,0)
 Q
"RTN","SYNDHP61",129,0)
 ;
"RTN","SYNDHP61",130,0)
 ;
"RTN","SYNDHP61",131,0)
PROBFDA ; build FDA array for Problems
"RTN","SYNDHP61",132,0)
 ;
"RTN","SYNDHP61",133,0)
 K FDA,ZZERR,ORIEN
"RTN","SYNDHP61",134,0)
 S P="|"
"RTN","SYNDHP61",135,0)
 S FN=9000011
"RTN","SYNDHP61",136,0)
 ;S DHPOBS=$$UNCNVT(DHPSCT,DHPOBS)
"RTN","SYNDHP61",137,0)
 S ORIEN(1)=$$NEXTIEN()
"RTN","SYNDHP61",138,0)
 S PATIEN=$O(^DPT("AFICN",DHPPAT,""))
"RTN","SYNDHP61",139,0)
 S MAPVUID=5217693 ; VUID for SNOMED CT to ICD-10-CM mapping 
"RTN","SYNDHP61",140,0)
 K LEX
"RTN","SYNDHP61",141,0)
 S DHPICD=$$GETASSN^LEXTRAN1(DHPSCT,MAPVUID)
"RTN","SYNDHP61",142,0)
 S DHPICD=$O(LEX(1,""))
"RTN","SYNDHP61",143,0)
 I DHPICD="" S DHPICD="R69."
"RTN","SYNDHP61",144,0)
 S DHPICD=+$$ICDDX^ICDEX(DHPICD,30)
"RTN","SYNDHP61",145,0)
 S FDA(FN,"+1,",.01)=DHPICD ;diagnosis
"RTN","SYNDHP61",146,0)
 S FDA(FN,"+1,",.02)=PATIEN ;patient name
"RTN","SYNDHP61",147,0)
 S FDA(FN,"+1,",.03)=$$NOW^XLFDT() ;date last modified
"RTN","SYNDHP61",148,0)
 S FDA(FN,"+1,",.04)="P" ; or "F" personal history/family history
"RTN","SYNDHP61",149,0)
 ;
"RTN","SYNDHP61",150,0)
 S DHPLOC=+DHPRID
"RTN","SYNDHP61",151,0)
 S FDA(FN,"+1,",.06)=DHPLOC ; location
"RTN","SYNDHP61",152,0)
 S FDA(FN,"+1,",1.07)=$$HL7TFM^XLFDT(DHPDTM) ;date resolved <<<<<<<<<<<<< not if still active
"RTN","SYNDHP61",153,0)
 S FDA(FN,"+1,",.08)=$$NOW^XLFDT() ;date entered
"RTN","SYNDHP61",154,0)
 S FDA(FN,"+1,",.13)=$$HL7TFM^XLFDT(DHPDTM) ;date of onset
"RTN","SYNDHP61",155,0)
 S STATII=P_"A"_P_"I"_P
"RTN","SYNDHP61",156,0)
 S FDA(FN,"+1,",.12)=$S(STATII[(P_$G(DHPSTA)_P):DHPSTA,1:"A") ;status
"RTN","SYNDHP61",157,0)
 S FDA(FN,"+1,",80001)=DHPSCT ; snomed ct concept code
"RTN","SYNDHP61",158,0)
 ;
"RTN","SYNDHP61",159,0)
 N LEX
"RTN","SYNDHP61",160,0)
 S LEX=$$CODE^LEXTRAN(DHPSCT,"SCT",,,,1,1)
"RTN","SYNDHP61",161,0)
 S DHPSCDES=$P($G(LEX("P")),U,3)
"RTN","SYNDHP61",162,0)
 S LEXIEN=$P(LEX("P"),U,2)
"RTN","SYNDHP61",163,0)
 S EXPRSN=$P(LEX("P"),U)
"RTN","SYNDHP61",164,0)
 S PROVNAR=$$PROVNARTL(EXPRSN)
"RTN","SYNDHP61",165,0)
 S FDA(FN,"+1,",.05)=PROVNAR ;provider narrative
"RTN","SYNDHP61",166,0)
 S FDA(FN,"+1,",1.01)=LEXIEN ;problem
"RTN","SYNDHP61",167,0)
 S FDA(FN,"+1,",80002)=DHPSCDES ;snomed ct designation code
"RTN","SYNDHP61",168,0)
 S FDA(FN,"+1,",80201)=$$HL7TFM^XLFDT(DHPDTM) ;date of interest
"RTN","SYNDHP61",169,0)
 S FDA(FN,"+1,",80202)="10D" ;coding system
"RTN","SYNDHP61",170,0)
 S NUM=$O(^AUPNPROB("AA",PATIEN,DHPLOC,""),-1) ;get last NMBR used
"RTN","SYNDHP61",171,0)
 S NUM=+$RE(+$RE(NUM))
"RTN","SYNDHP61",172,0)
 S NUM=NUM+1
"RTN","SYNDHP61",173,0)
 S FDA(FN,"+1,",.07)=NUM ;nmbr
"RTN","SYNDHP61",174,0)
 S PRVIEN="" I DHPROV'="" S PRVIEN=$O(^VA(200,"ANPI",DHPROV,""))
"RTN","SYNDHP61",175,0)
 S FDA(FN,"+1,",1.03)=PRVIEN ;entered by
"RTN","SYNDHP61",176,0)
 S FDA(FN,"+1,",1.04)=PRVIEN ;recording provider
"RTN","SYNDHP61",177,0)
 S FDA(FN,"+1,",1.05)=PRVIEN ;responsible provider
"RTN","SYNDHP61",178,0)
 ;W ! ZW FDA
"RTN","SYNDHP61",179,0)
 Q
"RTN","SYNDHP61",180,0)
PROVNARTL(EXPRSN) ; deal with provider narrative
"RTN","SYNDHP61",181,0)
 ;
"RTN","SYNDHP61",182,0)
 N PROVNAR
"RTN","SYNDHP61",183,0)
 I '$D(^AUTNPOV("B",EXPRSN)) D PROVNADD(EXPRSN)
"RTN","SYNDHP61",184,0)
 S PROVNAR=$O(^AUTNPOV("B",EXPRSN,""))
"RTN","SYNDHP61",185,0)
 Q PROVNAR
"RTN","SYNDHP61",186,0)
 ;
"RTN","SYNDHP61",187,0)
PROVNADD(EXPRSN) ;
"RTN","SYNDHP61",188,0)
 N PNIEN
"RTN","SYNDHP61",189,0)
 S PNIEN=$O(^AUTNPOV(99999999999),-1)+1
"RTN","SYNDHP61",190,0)
 S ^AUTNPOV(PNIEN,0)=EXPRSN
"RTN","SYNDHP61",191,0)
 S ^AUTNPOV("B",EXPRSN,PNIEN)=""
"RTN","SYNDHP61",192,0)
 Q
"RTN","SYNDHP61",193,0)
 ;
"RTN","SYNDHP61",194,0)
 ; -------- Immunization update
"RTN","SYNDHP61",195,0)
 ;
"RTN","SYNDHP61",196,0)
IMMUNUPD(RETSTA,DHPPAT,VISIT,IMMUNIZ,ANATLOC,ADMINRT,DOSE,EVENTDT,IMMPROV) ;Immunization update
"RTN","SYNDHP61",197,0)
 ;
"RTN","SYNDHP61",198,0)
 ; Input:
"RTN","SYNDHP61",199,0)
 ;  DHPPAT  - patient ICN  (mandatory)
"RTN","SYNDHP61",200,0)
 ;  VISIT   - visit ien    (mandatory)
"RTN","SYNDHP61",201,0)
 ;  IMMUNIZ - cvx code     (mandatory)
"RTN","SYNDHP61",202,0)
 ;  ANATLOC - anatomical location
"RTN","SYNDHP61",203,0)
 ;  ADMINRT - route of administration
"RTN","SYNDHP61",204,0)
 ;  DOSE    - dose
"RTN","SYNDHP61",205,0)
 ;  EVENTDT - event date/time (HL7 format)
"RTN","SYNDHP61",206,0)
 ;  IMMPROV - immunization provider (NPI)
"RTN","SYNDHP61",207,0)
 ;
"RTN","SYNDHP61",208,0)
 ; Output:   RETSTA
"RTN","SYNDHP61",209,0)
 ;  1 - success
"RTN","SYNDHP61",210,0)
 ; -1 - failure -1^message
"RTN","SYNDHP61",211,0)
 ;
"RTN","SYNDHP61",212,0)
 N IMMIEN
"RTN","SYNDHP61",213,0)
 ;
"RTN","SYNDHP61",214,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" QUIT
"RTN","SYNDHP61",215,0)
 ;
"RTN","SYNDHP61",216,0)
 I $G(IMMUNIZ)="" S RETSTA="-1^Immunization (CVX code) is required" QUIT
"RTN","SYNDHP61",217,0)
 S IMMIEN=$O(^AUTTIMM("C",IMMUNIZ,""))
"RTN","SYNDHP61",218,0)
 I IMMIEN="" S RETSTA="-1^Immunization (CVX code) not found" QUIT
"RTN","SYNDHP61",219,0)
 I +$$GET1^DIQ(9999999.14,IMMIEN_",",.07,"I") S RETSTA="-1^Immunization is inactive" QUIT
"RTN","SYNDHP61",220,0)
 ;
"RTN","SYNDHP61",221,0)
 I $G(VISIT)="" S RETSTA="-1^Visit IEN is required" QUIT
"RTN","SYNDHP61",222,0)
 I '$D(^AUPNVSIT(VISIT)) S RETSTA="-1^Visit not found" QUIT
"RTN","SYNDHP61",223,0)
 ;
"RTN","SYNDHP61",224,0)
 N PACKAGE,SOURCE,USER,ERRDISP,ZZERR,PPEDIT,ZZERDESC,ACCOUNT
"RTN","SYNDHP61",225,0)
 N IMMDATA,IMMPRVIEN,PPEDIT
"RTN","SYNDHP61",226,0)
 ;
"RTN","SYNDHP61",227,0)
 S RETSTA=1
"RTN","SYNDHP61",228,0)
 D SETUP
"RTN","SYNDHP61",229,0)
 QUIT:RETSTA=-1
"RTN","SYNDHP61",230,0)
 ;
"RTN","SYNDHP61",231,0)
 S RETSTA=$$DATA2PCE^PXAI("IMMDATA",PACKAGE,SOURCE,.VISIT,USER,$G(ERRDISP),.ZZERR,$G(PPEDIT),.ZZERDESC,.ACCOUNT)
"RTN","SYNDHP61",232,0)
 ;I $D(ZZERR) ZW ZZERR
"RTN","SYNDHP61",233,0)
 I $D(ZZERDESC) M RETSTA("ZZERDESC")=ZZERDESC
"RTN","SYNDHP61",234,0)
 I $D(ZZERR) M RETSTA("ZZERR")=ZZERR
"RTN","SYNDHP61",235,0)
 M RESTSTA("IMMDATA")=IMMDATA
"RTN","SYNDHP61",236,0)
 QUIT
"RTN","SYNDHP61",237,0)
 ;
"RTN","SYNDHP61",238,0)
 ; $$DATA2PCE Output:   
"RTN","SYNDHP61",239,0)
 ;+   1  if no errors and processed completely
"RTN","SYNDHP61",240,0)
 ;+  -1  if errors occurred but processed completely as possible
"RTN","SYNDHP61",241,0)
 ;+  -2  if could not get a visit
"RTN","SYNDHP61",242,0)
 ;+  -3  if called incorrectly
"RTN","SYNDHP61",243,0)
 ;
"RTN","SYNDHP61",244,0)
SETUP ; set data for $$DATA2PCE call
"RTN","SYNDHP61",245,0)
 ;
"RTN","SYNDHP61",246,0)
 S PACKAGE=507 ;PCE PATIENT CARE ENCOUNTER
"RTN","SYNDHP61",247,0)
 S SOURCE="DHP DATA INGEST"
"RTN","SYNDHP61",248,0)
 S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP61",249,0)
 N EVDATFM
"RTN","SYNDHP61",250,0)
 S EVDATFM=$$HL7TFM^XLFDT(EVENTDT)
"RTN","SYNDHP61",251,0)
 S ERRDISP=1 ;for testing only, set to null otherwise  <<<<<<<<<<<<<<<<<<<<<<<
"RTN","SYNDHP61",252,0)
 S PPEDIT=""
"RTN","SYNDHP61",253,0)
 S ACCOUNT=""
"RTN","SYNDHP61",254,0)
 ;
"RTN","SYNDHP61",255,0)
 S IMMDATA("IMMUNIZATION",1,"IMMUN")=IMMIEN
"RTN","SYNDHP61",256,0)
 ;don't send null data values to create records
"RTN","SYNDHP61",257,0)
 ; There are extra data elements here for possible future use
"RTN","SYNDHP61",258,0)
 I $G(IMMPROV)'="" D
"RTN","SYNDHP61",259,0)
 . S IMMPRVIEN=$O(^VA(200,"ANPI",IMMPROV,""))
"RTN","SYNDHP61",260,0)
 . QUIT:IMMPRVIEN=""
"RTN","SYNDHP61",261,0)
 . S IMMDATA("IMMUNIZATION",1,"ENC PROVIDER")=IMMPRVIEN
"RTN","SYNDHP61",262,0)
 S:$G(EVENTDT)'="" IMMDATA("IMMUNIZATION",1,"EVENT D/T")=EVDATFM
"RTN","SYNDHP61",263,0)
 S:$G(SERIES)'="" IMMDATA("IMMUNIZATION",1,"SERIES")=SERIES
"RTN","SYNDHP61",264,0)
 S:$G(REACTION)'="" IMMDATA("IMMUNIZATION",1,"REACTION")=REACTION
"RTN","SYNDHP61",265,0)
 S:$G(CONTRA)'="" IMMDATA("IMMUNIZATION",1,"CONTRAINDICATED")=CONTRA
"RTN","SYNDHP61",266,0)
 S:$G(DXCODE)'="" IMMDATA("IMMUNIZATION",1,"DIAGNOSIS")=DXCODE
"RTN","SYNDHP61",267,0)
 S:$G(COMMENT)'="" IMMDATA("IMMUNIZATION",1,"COMMENT")=COMMENT
"RTN","SYNDHP61",268,0)
 S:$G(LOTNUM)'="" IMMDATA("IMMUNIZATION",1,"LOT NUM")=LOTNUM
"RTN","SYNDHP61",269,0)
 S:$G(INFOSRC)'="" IMMDATA("IMMUNIZATION",1,"INFO SOURCE")=INFOSRC
"RTN","SYNDHP61",270,0)
 S:$G(ADMINRT)'="" IMMDATA("IMMUNIZATION",1,"ADMIN ROUTE")=ADMINRT
"RTN","SYNDHP61",271,0)
 S:$G(ANATLOC)'="" IMMDATA("IMMUNIZATION",1,"ANATOMIC LOC")=ANATLOC
"RTN","SYNDHP61",272,0)
 S:$G(DOSE)'="" IMMDATA("IMMUNIZATION",1,"DOSE")=DOSE
"RTN","SYNDHP61",273,0)
 S:$G(DOSEUNIT)'="" IMMDATA("IMMUNIZATION",1,"DOSE UNITS")=DOSEUNIT
"RTN","SYNDHP61",274,0)
 N SERCAT
"RTN","SYNDHP61",275,0)
 S SERCAT=$S(EVDATFM\1<$$DT^XLFDT:"E",1:"A")
"RTN","SYNDHP61",276,0)
 S IMMDATA("IMMUNIZATION",1,"SERVICE CATEGORY")=SERCAT ; A for current E for historical
"RTN","SYNDHP61",277,0)
 QUIT
"RTN","SYNDHP61",278,0)
 ;
"RTN","SYNDHP61",279,0)
 ; -------- Encounter update
"RTN","SYNDHP61",280,0)
 ;
"RTN","SYNDHP61",281,0)
ENCTUPD(RETSTA,DHPPAT,STARTDT,ENDDT,ENCPROV,CLINIC,SCTDX,SCTCPT) ;Encounter update
"RTN","SYNDHP61",282,0)
 ;return visit id/ien
"RTN","SYNDHP61",283,0)
 ;
"RTN","SYNDHP61",284,0)
 S U="^"
"RTN","SYNDHP61",285,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" QUIT
"RTN","SYNDHP61",286,0)
 ;
"RTN","SYNDHP61",287,0)
 I $G(ENCPROV)'="" D
"RTN","SYNDHP61",288,0)
 .S ENCPRVIEN=$O(^VA(200,"ANPI",ENCPROV,""))
"RTN","SYNDHP61",289,0)
 .I 'ENCPRVIEN S ENCPRVIEN=$O(^XUSEC("PROVIDER",0))
"RTN","SYNDHP61",290,0)
 .I 'ENCPRVIEN S $EC=",U-SET-UP-A-BLOODY-PROVIDER,"
"RTN","SYNDHP61",291,0)
 S PATIEN=$O(^DPT("AFICN",DHPPAT,""),-1)
"RTN","SYNDHP61",292,0)
 S SOURCE="DHP DATA INGEST"
"RTN","SYNDHP61",293,0)
 S PACKAGE=$$FIND1^DIC(9.4,,"","PCE")
"RTN","SYNDHP61",294,0)
 S LOCATION=$O(^SC("B",CLINIC,""))
"RTN","SYNDHP61",295,0)
 S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP61",296,0)
 ;
"RTN","SYNDHP61",297,0)
 ;chop off seconds
"RTN","SYNDHP61",298,0)
 N APPTDATE
"RTN","SYNDHP61",299,0)
 S APPTDATE=$$HL7TFM^XLFDT(STARTDT)
"RTN","SYNDHP61",300,0)
 S APPTTM=$E($P(APPTDATE,".",2),1,4)
"RTN","SYNDHP61",301,0)
 S $P(APPTDATE,".",2)=APPTTM
"RTN","SYNDHP61",302,0)
 ;
"RTN","SYNDHP61",303,0)
 ; map SNOMED CT code in SCTDX to ICD-10
"RTN","SYNDHP61",304,0)
 S MAPVUID=5217693 ; VUID for SNOMED CT to ICD-10-CM mapping 
"RTN","SYNDHP61",305,0)
 ;K LEX
"RTN","SYNDHP61",306,0)
 ;S DHPICD=$$GETASSN^LEXTRAN1(SCTDX,MAPVUID)
"RTN","SYNDHP61",307,0)
 ;S DHPICD=$O(LEX(1,""))
"RTN","SYNDHP61",308,0)
 ;I DHPICD="" S DHPICD="R69."
"RTN","SYNDHP61",309,0)
 ;S DHPICD=+$$ICDDX^ICDEX(DHPICD,30)
"RTN","SYNDHP61",310,0)
 I $G(SCTDX)'="" D  ;
"RTN","SYNDHP61",311,0)
 .S MAPPING=$S(APPTDATE>3150930:"sct2icd",1:"sct2icdnine") ; APPTDATE IS IN FM FORMAT
"RTN","SYNDHP61",312,0)
 .S DHPICD=$$MAP^SYNDHPMP(MAPPING,SCTDX)
"RTN","SYNDHP61",313,0)
 .I +DHPICD=-1 S RETSTA="-1^SNOMED CT CODE "_SCTDX_" not mapped" Q
"RTN","SYNDHP61",314,0)
 .;S DHPICD=+$$ICDDX^ICDEX($P(DHPICD,U,2),30)
"RTN","SYNDHP61",315,0)
 .I +DHPICD'=-1 S DHPICD=+$$ICDDX^ICDEX($P(DHPICD,U,2),30)
"RTN","SYNDHP61",316,0)
 ;
"RTN","SYNDHP61",317,0)
 ; map SNOMED CT code in SCTCPT to CPT
"RTN","SYNDHP61",318,0)
 ;S DHPCPT=$S($$MAP^SYNQLDM(SCTCPT)'="":$$MAP^SYNQLDM(SCTCPT),1:92002)
"RTN","SYNDHP61",319,0)
 S DHPCPT=$$MAP^SYNQLDM(SCTCPT)
"RTN","SYNDHP61",320,0)
 I DHPCPT'="" D
"RTN","SYNDHP61",321,0)
 .I '$D(^ICPT("B",DHPCPT)) S DHPCPT=""
"RTN","SYNDHP61",322,0)
 I DHPCPT="" D
"RTN","SYNDHP61",323,0)
 .S DHPCPT=$$MAP^SYNDHPMP("sct2os5",SCTCPT)
"RTN","SYNDHP61",324,0)
 .I +DHPCPT=-1 S DHPCPT="" Q
"RTN","SYNDHP61",325,0)
 .S DHPCPT=$P(DHPCPT,U,2)
"RTN","SYNDHP61",326,0)
 ;
"RTN","SYNDHP61",327,0)
 I DHPCPT="" S RETSTA="-1^SNOMED CT CODE "_SCTCPT_" not mapped" Q
"RTN","SYNDHP61",328,0)
 ; create root array
"RTN","SYNDHP61",329,0)
 K ENCDATA
"RTN","SYNDHP61",330,0)
 S ENCDATA("ENCOUNTER",1,"PATIENT")=PATIEN
"RTN","SYNDHP61",331,0)
 S ENCDATA("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","SYNDHP61",332,0)
 S ENCDATA("ENCOUNTER",1,"ENC D/T")=APPTDATE
"RTN","SYNDHP61",333,0)
 S ENCDATA("ENCOUNTER",1,"HOS LOC")=LOCATION
"RTN","SYNDHP61",334,0)
 N SERCAT
"RTN","SYNDHP61",335,0)
 S SERCAT=$S(APPTDATE\1<$$DT^XLFDT:"E",1:"A")
"RTN","SYNDHP61",336,0)
 S SERCAT="A"
"RTN","SYNDHP61",337,0)
 S ENCDATA("ENCOUNTER",1,"SERVICE CATEGORY")=SERCAT ; A for current E for historical
"RTN","SYNDHP61",338,0)
 S ENCDATA("PROVIDER",1,"NAME")=ENCPRVIEN
"RTN","SYNDHP61",339,0)
 S ENCDATA("PROVIDER",1,"PRIMARY")=1
"RTN","SYNDHP61",340,0)
 ; gpl 100%
"RTN","SYNDHP61",341,0)
 I +$G(DHPICD)=-1 D  ; no mapping was found
"RTN","SYNDHP61",342,0)
 . I $G(SCTDX)="" Q  ; no code passed in
"RTN","SYNDHP61",343,0)
 . S ENCDATA("STD CODES",1,"CODE")=SCTDX
"RTN","SYNDHP61",344,0)
 . S ENCDATA("STD CODES",1,"CODING SYSTEM")="SCT"
"RTN","SYNDHP61",345,0)
 . S ENCDATA("STD CODES",1,"EVENT D/T")=APPTDATE
"RTN","SYNDHP61",346,0)
 . S ENCDATA("STD CODES",1,"COMMENT")="Purpose of Visit - POV."
"RTN","SYNDHP61",347,0)
 . S ENCDATA("STD CODES",1,"ENC PROVIDER")=ENCPRVIEN
"RTN","SYNDHP61",348,0)
 . ; health factor for CPRS display (v 30,31)
"RTN","SYNDHP61",349,0)
 . N HFIEN
"RTN","SYNDHP61",350,0)
 . S HFIEN=$O(^AUTTHF("B","SYN SNOMED PURPOSE OF VISIT",""))
"RTN","SYNDHP61",351,0)
 . I HFIEN'="" D  ; Health factor exists
"RTN","SYNDHP61",352,0)
 . . S ENCDATA("HEALTH FACTOR",1,"HEALTH FACTOR")=HFIEN
"RTN","SYNDHP61",353,0)
 . . S ENCDATA("HEALTH FACTOR",1,"EVENT D/T")=APPTDATE
"RTN","SYNDHP61",354,0)
 . . S ENCDATA("HEALTH FACTOR",1,"COMMENT")=SCTDX
"RTN","SYNDHP61",355,0)
 E  D  ; mapping was found
"RTN","SYNDHP61",356,0)
 . I $G(SCTDX)'="" S ENCDATA("DX/PL",1,"DIAGNOSIS")=DHPICD
"RTN","SYNDHP61",357,0)
 . I $G(SCTDX)'="" S ENCDATA("DX/PL",1,"ENC PROVIDER")=ENCPRVIEN
"RTN","SYNDHP61",358,0)
 . I $G(SCTDX)'="" S ENCDATA("DX/PL",1,"PRIMARY")=1
"RTN","SYNDHP61",359,0)
 S ENCDATA("PROCEDURE",1,"PROCEDURE")=DHPCPT
"RTN","SYNDHP61",360,0)
 S ENCDATA("PROCEDURE",1,"QTY")=1
"RTN","SYNDHP61",361,0)
 I $G(SCTDX)'="" I +DHPICD'=-1 S ENCDATA("PROCEDURE",1,"DIAGNOSIS")=DHPICD
"RTN","SYNDHP61",362,0)
 ;
"RTN","SYNDHP61",363,0)
 K ZZERR,ZZERDESC,VISIT
"RTN","SYNDHP61",364,0)
 S RETSTA=$$DATA2PCE^PXAI("ENCDATA",PACKAGE,SOURCE,.VISIT,USER,$G(ERRDISP),.ZZERR,$G(PPEDIT),.ZZERDESC,.ACCOUNT)
"RTN","SYNDHP61",365,0)
 S RETSTA=RETSTA_"^"_$G(VISIT)
"RTN","SYNDHP61",366,0)
 I $D(ZZERDESC) M RETSTA("ZZERDESC")=ZZERDESC
"RTN","SYNDHP61",367,0)
 I $D(ZZERR) M RETSTA("ZZERR")=ZZERR
"RTN","SYNDHP61",368,0)
 M RETSTA("ENCDATA")=ENCDATA
"RTN","SYNDHP61",369,0)
 ;
"RTN","SYNDHP61",370,0)
 ;change APPTDATE back to HL7 format for these next calls
"RTN","SYNDHP61",371,0)
 S APPTDATE=$$FMTHL7^XLFDT(APPTDATE)
"RTN","SYNDHP61",372,0)
 ;create appointment
"RTN","SYNDHP61",373,0)
 N DHPLEN
"RTN","SYNDHP61",374,0)
 S DHPLEN=""
"RTN","SYNDHP61",375,0)
 D APPTADD^SYNDHP62(.RETSTA,DHPPAT,CLINIC,APPTDATE,DHPLEN)
"RTN","SYNDHP61",376,0)
 QUIT:$G(RETSTA("APPT"))'=1
"RTN","SYNDHP61",377,0)
 ;
"RTN","SYNDHP61",378,0)
 ;check-in appointment
"RTN","SYNDHP61",379,0)
 N DHPCIDT
"RTN","SYNDHP61",380,0)
 S DHPCIDT=""
"RTN","SYNDHP61",381,0)
 D APPTCKIN^SYNDHP62(.RETSTA,DHPPAT,CLINIC,APPTDATE,DHPCIDT)
"RTN","SYNDHP61",382,0)
 QUIT:$G(RETSTA("CKIN"))'=1
"RTN","SYNDHP61",383,0)
 ;
"RTN","SYNDHP61",384,0)
 ;check-out appointment
"RTN","SYNDHP61",385,0)
 N DHPCODT
"RTN","SYNDHP61",386,0)
 S DHPCODT=""
"RTN","SYNDHP61",387,0)
 D APTCKOUT^SYNDHP62(.RETSTA,DHPPAT,CLINIC,APPTDATE,DHPCODT)
"RTN","SYNDHP61",388,0)
 ;
"RTN","SYNDHP61",389,0)
 QUIT
"RTN","SYNDHP61",390,0)
 ;
"RTN","SYNDHP61",391,0)
 ; -------------------------------------------------------------------------
"RTN","SYNDHP61",392,0)
 ;;
"RTN","SYNDHP61",393,0)
TEST ;
"RTN","SYNDHP61",394,0)
T1 D PROBUPD(.ZXC,"5482156687V807096",267036007,158482014,9990006675,20180118,"5OO_EXT")
"RTN","SYNDHP61",395,0)
 Q
"RTN","SYNDHP61",396,0)
T2 D ENCTUPD(.ZXC,"5482156687V807096",20161227154556,20161227161234,"9990000348","GENERAL MEDICINE",73211009,10492003)
"RTN","SYNDHP61",397,0)
 Q
"RTN","SYNDHP61",398,0)
T3 S IDT=20170115154546
"RTN","SYNDHP61",399,0)
 F SDT=IDT:1E8:(IDT+9E8) S EDT=SDT+2E8 D
"RTN","SYNDHP61",400,0)
 .;K VISIT
"RTN","SYNDHP61",401,0)
 .K ZXC
"RTN","SYNDHP61",402,0)
 .D ENCTUPD(.ZXC,"9004935583V839304",SDT,EDT,"9990000348","GENERAL MEDICINE",73211009,10492003)
"RTN","SYNDHP61",403,0)
 .W !!,"___________________________________________________",!!
"RTN","SYNDHP61",404,0)
 .ZWRITE ZXC
"RTN","SYNDHP61",405,0)
 .W !!
"RTN","SYNDHP61",406,0)
 .ZWRITE ENCDATA
"RTN","SYNDHP61",407,0)
 .W !!,"___________________________________________________",!!
"RTN","SYNDHP61",408,0)
 .ZWRITE ZZERDESC
"RTN","SYNDHP61",409,0)
 .W !!,"___________________________________________________",!!
"RTN","SYNDHP61",410,0)
 .ZWRITE ZZERR
"RTN","SYNDHP61",411,0)
 Q
"RTN","SYNDHP62")
0^9^B308344743
"RTN","SYNDHP62",1,0)
SYNDHP62 ;DHP/ART - HealthConcourse - Write Problems, Appointments To VistA ;05/29/2018
"RTN","SYNDHP62",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP62",3,0)
 ;;
"RTN","SYNDHP62",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP62",5,0)
 ;
"RTN","SYNDHP62",6,0)
 QUIT
"RTN","SYNDHP62",7,0)
 ;
"RTN","SYNDHP62",8,0)
 ; -------- Problem/Condition update
"RTN","SYNDHP62",9,0)
 ;
"RTN","SYNDHP62",10,0)
PRBUPDT(RETSTA,DHPPAT,DHPVST,DHPROV,DHPONS,DHPABT,DHPCLNST,DHPSCT) ;Problem/Condition update
"RTN","SYNDHP62",11,0)
 ;
"RTN","SYNDHP62",12,0)
 ; Input:
"RTN","SYNDHP62",13,0)
 ;   DHPPAT   - Patient ICN
"RTN","SYNDHP62",14,0)
 ;   DHPVST   - Visit ID
"RTN","SYNDHP62",15,0)
 ;   DHPROV   - Provider ID (NPI)
"RTN","SYNDHP62",16,0)
 ;   DHPONS   - Onset Date (HL7 format)
"RTN","SYNDHP62",17,0)
 ;   DHPABT   - Abatement Date (HL7 format)
"RTN","SYNDHP62",18,0)
 ;   DHPCLNST - Clinical Status ?   (A or I)
"RTN","SYNDHP62",19,0)
 ;   DHPSCT   - SNOMED CT code
"RTN","SYNDHP62",20,0)
 ;
"RTN","SYNDHP62",21,0)
 ; Output:   RETSTA
"RTN","SYNDHP62",22,0)
 ;  1 - success
"RTN","SYNDHP62",23,0)
 ; -1 - failure -1^message
"RTN","SYNDHP62",24,0)
 ;
"RTN","SYNDHP62",25,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" Q
"RTN","SYNDHP62",26,0)
 ;
"RTN","SYNDHP62",27,0)
 I $G(DHPSCT)="" S RETSTA="-1^SNOMED CT code is required" Q
"RTN","SYNDHP62",28,0)
 I $G(DHPVST)="" S RETSTA="-1^Visit IEN is required" Q
"RTN","SYNDHP62",29,0)
 I $G(DHPONS)="" S RETSTA="-1^onset date is required" Q
"RTN","SYNDHP62",30,0)
 I '$D(^AUPNVSIT(DHPVST)) S RETSTA="-1^Visit not found" Q
"RTN","SYNDHP62",31,0)
 ;
"RTN","SYNDHP62",32,0)
 N PACKAGE,SOURCE,USER,ERRDISP,ZZERR,PPEDIT,ZZERDESC,ACCOUNT
"RTN","SYNDHP62",33,0)
 N PROBDATA,PRBPRIEN,STATII,MAPVUID,P,DHPICD,DHPCS,MAPPING
"RTN","SYNDHP62",34,0)
 ;
"RTN","SYNDHP62",35,0)
 S PACKAGE=$$FIND1^DIC(9.4,,"","PCE")
"RTN","SYNDHP62",36,0)
 S SOURCE="DHP DATA INGEST"
"RTN","SYNDHP62",37,0)
 S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP62",38,0)
 S ERRDISP=""
"RTN","SYNDHP62",39,0)
 I $G(DEBUG)=1 S ERRDISP=1
"RTN","SYNDHP62",40,0)
 S PPEDIT=""
"RTN","SYNDHP62",41,0)
 S ACCOUNT=""
"RTN","SYNDHP62",42,0)
 S P="|"
"RTN","SYNDHP62",43,0)
 ;
"RTN","SYNDHP62",44,0)
 S RETSTA=1
"RTN","SYNDHP62",45,0)
 ;
"RTN","SYNDHP62",46,0)
 S PROBDATA("DX/PL",1,"PL ADD")=1
"RTN","SYNDHP62",47,0)
 S DHPONS=$P($$HL7TFM^XLFDT(DHPONS),".",1)
"RTN","SYNDHP62",48,0)
 ;20130526110511-0400 
"RTN","SYNDHP62",49,0)
 ;date portion only, active problems can not have a date resolved
"RTN","SYNDHP62",50,0)
 S PROBDATA("DX/PL",1,"PL ONSET DATE")=DHPONS
"RTN","SYNDHP62",51,0)
 S:$G(DHPABT)'="" PROBDATA("DX/PL",1,"PL RESOLVED DATE")=$P($$HL7TFM^XLFDT(DHPABT),".",1)
"RTN","SYNDHP62",52,0)
 ;
"RTN","SYNDHP62",53,0)
 ;S MAPVUID=5217693 ; VUID for SNOMED CT to ICD-10-CM mapping 
"RTN","SYNDHP62",54,0)
 ;K LEX
"RTN","SYNDHP62",55,0)
 ;S DHPICD=$$GETASSN^LEXTRAN1(DHPSCT,MAPVUID)
"RTN","SYNDHP62",56,0)
 ;S DHPICD=$O(LEX(1,""))
"RTN","SYNDHP62",57,0)
 ;I DHPICD="" S DHPICD="R69."
"RTN","SYNDHP62",58,0)
 ;S DHPICD=+$$ICDDX^ICDEX(DHPICD,30) ;30=ICD-10
"RTN","SYNDHP62",59,0)
 ;S PROBDATA("DX/PL",1,"DIAGNOSIS")=DHPICD
"RTN","SYNDHP62",60,0)
 ;S PROBDATA("DX/PL",1,"DIAGNOSIS")=DHPSCT
"RTN","SYNDHP62",61,0)
 ;
"RTN","SYNDHP62",62,0)
 ; next line determines whether to use ICD10 or ICD9 map
"RTN","SYNDHP62",63,0)
 S MAPPING=$S(DHPONS>3150930:"sct2icd",1:"sct2icdnine")
"RTN","SYNDHP62",64,0)
 ;
"RTN","SYNDHP62",65,0)
 ;W !!,">>>> DHPONS ",DHPONS
"RTN","SYNDHP62",66,0)
 ;W !,">>>> MAPPING ",MAPPING,!!
"RTN","SYNDHP62",67,0)
 ;
"RTN","SYNDHP62",68,0)
 ;
"RTN","SYNDHP62",69,0)
 S DHPICD=$$MAP^SYNDHPMP(MAPPING,DHPSCT)
"RTN","SYNDHP62",70,0)
 I +DHPICD=-1 S RETSTA="-1^SNOMED CT CODE "_DHPSCT_" not mapped" Q
"RTN","SYNDHP62",71,0)
 S DHPCS=$S(DHPONS>3150930:30,1:1)
"RTN","SYNDHP62",72,0)
 S DHPICD=$P(DHPICD,U,2) ; DHPICD now contains ICD code from mapping return
"RTN","SYNDHP62",73,0)
 N ICDTX
"RTN","SYNDHP62",74,0)
 S ICDTX=$$ICDDX^ICDEX(DHPICD,DHPCS)
"RTN","SYNDHP62",75,0)
 ;
"RTN","SYNDHP62",76,0)
 S DHPICD=+ICDTX ; DHPICD now contains ICD code IEN
"RTN","SYNDHP62",77,0)
 I +DHPICD=-1 S RETSTA="-1^ICD Code "_DHPICD_" not on file" Q
"RTN","SYNDHP62",78,0)
 S DHPDXNR=$P(ICDTX,U,4)
"RTN","SYNDHP62",79,0)
 S PROBDATA("DX/PL",1,"DIAGNOSIS")=DHPICD
"RTN","SYNDHP62",80,0)
 S PROBDATA("DX/PL",1,"NARRATIVE")=DHPDXNR
"RTN","SYNDHP62",81,0)
 N SERCAT
"RTN","SYNDHP62",82,0)
 S SERCAT="A" ; $S(DHPONS\1<$$DT^XLFDT:"E",1:"A")
"RTN","SYNDHP62",83,0)
 S PROBDATA("DX/PL",1,"SERVICE CATEGORY")=SERCAT ; A for current E for historical
"RTN","SYNDHP62",84,0)
 S DHPDXF=$$PRMDX(DHPVST,DHPICD)
"RTN","SYNDHP62",85,0)
 I DHPDXF=-1 S RETSTA="-1^Problem with DX code "_DHPICD_" already exists for visit "_DHPVST Q
"RTN","SYNDHP62",86,0)
 S PROBDATA("DX/PL",1,"PRIMARY")=DHPDXF
"RTN","SYNDHP62",87,0)
 ;
"RTN","SYNDHP62",88,0)
 I $G(DHPROV)'="" D
"RTN","SYNDHP62",89,0)
 . S PRBPRIEN=$O(^VA(200,"ANPI",DHPROV,""))
"RTN","SYNDHP62",90,0)
 . QUIT:PRBPRIEN=""
"RTN","SYNDHP62",91,0)
 . S PROBDATA("DX/PL",1,"ENC PROVIDER")=PRBPRIEN
"RTN","SYNDHP62",92,0)
 ;
"RTN","SYNDHP62",93,0)
 S STATII=P_"A"_P_"I"_P
"RTN","SYNDHP62",94,0)
 S:$G(DHPCLNST)'="" PROBDATA("DX/PL",1,"PL ACTIVE")=$S(STATII[(P_$G(DHPCLNST)_P):DHPCLNST,1:"A")
"RTN","SYNDHP62",95,0)
 ;
"RTN","SYNDHP62",96,0)
 S RETSTA=$$DATA2PCE^PXAI("PROBDATA",PACKAGE,SOURCE,.DHPVST,USER,$G(ERRDISP),.ZZERR,$G(PPEDIT),.ZZERDESC,.ACCOUNT)
"RTN","SYNDHP62",97,0)
 ;I $D(ZZERR) ZWRITE ZZERR
"RTN","SYNDHP62",98,0)
 S RETSTA=RETSTA_"^"_$G(DHPVST)
"RTN","SYNDHP62",99,0)
 I $D(ZZERDESC) M RETSTA("ZZERDESC")=ZZERDESC
"RTN","SYNDHP62",100,0)
 I $D(ZZERR) M RETSTA("ZZERR")=ZZERR
"RTN","SYNDHP62",101,0)
 M RETSTA("PROBDATA")=PROBDATA
"RTN","SYNDHP62",102,0)
 ;
"RTN","SYNDHP62",103,0)
 ; $$DATA2PCE Output:   
"RTN","SYNDHP62",104,0)
 ;+   1  if no errors and processed completely
"RTN","SYNDHP62",105,0)
 ;+  -1  if errors occurred but processed completely as possible
"RTN","SYNDHP62",106,0)
 ;+  -2  if could not get a visit
"RTN","SYNDHP62",107,0)
 ;+  -3  if called incorrectly
"RTN","SYNDHP62",108,0)
 QUIT
"RTN","SYNDHP62",109,0)
 ;
"RTN","SYNDHP62",110,0)
PRMDX(X,D) ; Check if primary diagnosis
"RTN","SYNDHP62",111,0)
 ; Input:
"RTN","SYNDHP62",112,0)
 ;   X - visit IEN
"RTN","SYNDHP62",113,0)
 ;   D - DX code IEN
"RTN","SYNDHP62",114,0)
 ; Output
"RTN","SYNDHP62",115,0)
 ;   1 if code D can be filed as primary DX
"RTN","SYNDHP62",116,0)
 ;   0 if code D can be filed as secondary DX
"RTN","SYNDHP62",117,0)
 ;  -1 if there is already a problem with DX code D files for the visit
"RTN","SYNDHP62",118,0)
 ;
"RTN","SYNDHP62",119,0)
 N IND,PRMDX,DIAG
"RTN","SYNDHP62",120,0)
 S IND=0
"RTN","SYNDHP62",121,0)
 F  S IND=$O(^AUPNVPOV("AD",X,IND)) Q:IND=""  D
"RTN","SYNDHP62",122,0)
 .I $P(^AUPNVPOV(IND,0),U,12)="P" D
"RTN","SYNDHP62",123,0)
 ..S DIAG=$P(^AUPNVPOV(IND,0),U,1)
"RTN","SYNDHP62",124,0)
 ..S PRMDX(DIAG)=""
"RTN","SYNDHP62",125,0)
 I '$D(PRMDX) Q 1  ; D is the primary DX
"RTN","SYNDHP62",126,0)
 I '$D(PRMDX(D)) Q 0  ; D is a secondary DX
"RTN","SYNDHP62",127,0)
 Q -1  ; problem with DX D already exists for visit
"RTN","SYNDHP62",128,0)
 ;
"RTN","SYNDHP62",129,0)
 ; -------- Appointment create
"RTN","SYNDHP62",130,0)
 ;
"RTN","SYNDHP62",131,0)
APPTADD(RETSTA,DHPPAT,DHPCLIN,DHPAPTDT,DHPLEN) ;Create appointment
"RTN","SYNDHP62",132,0)
 ;
"RTN","SYNDHP62",133,0)
 ;     - past appointments are created as Walk-in, NSC, Regular appointments
"RTN","SYNDHP62",134,0)
 ;     - future appointments are created as NSC, Regular appointments
"RTN","SYNDHP62",135,0)
 ;
"RTN","SYNDHP62",136,0)
 ; Input:
"RTN","SYNDHP62",137,0)
 ;   DHPPAT   - Patient ICN (required)
"RTN","SYNDHP62",138,0)
 ;   DHPCLIN  - Clinic Name (required)
"RTN","SYNDHP62",139,0)
 ;   DHPAPTDT - Appointment Date & Time (required) all dates received in HL7 format
"RTN","SYNDHP62",140,0)
 ;   DHPLEN   - Appointment length as minutes (optional, defaults to 15 mins.)
"RTN","SYNDHP62",141,0)
 ;
"RTN","SYNDHP62",142,0)
 ; Output:   RETSTA("APPT")
"RTN","SYNDHP62",143,0)
 ;  1 - success
"RTN","SYNDHP62",144,0)
 ; -1 - failure -1^message
"RTN","SYNDHP62",145,0)
 ;
"RTN","SYNDHP62",146,0)
 N PATDFN,APPTDT,APPTLEN,CHKINDT,CHKOUTDT,COFLG,CLINIEN,INACTDT,REACTDT
"RTN","SYNDHP62",147,0)
 N Y,EXDATE,BADDATE,RESULT,MSG
"RTN","SYNDHP62",148,0)
 ;
"RTN","SYNDHP62",149,0)
 I $G(DHPPAT)="" S RETSTA("APPT")="-1^Missing patient identifier (#2)." QUIT
"RTN","SYNDHP62",150,0)
 I $G(DHPCLIN)="" S RETSTA("APPT")="-1^Missing appt. location (#44)." QUIT
"RTN","SYNDHP62",151,0)
 I $G(DHPAPTDT)="" S RETSTA("APPT")="-1^Missing date/time for appt." QUIT
"RTN","SYNDHP62",152,0)
 ;
"RTN","SYNDHP62",153,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA("APPT")="-1^Patient not recognised" QUIT
"RTN","SYNDHP62",154,0)
 S PATDFN=$O(^DPT("AFICN",DHPPAT,""))
"RTN","SYNDHP62",155,0)
 ;
"RTN","SYNDHP62",156,0)
 ; -- Check appointment date/time --
"RTN","SYNDHP62",157,0)
 S APPTDT=$$HL7TFM^XLFDT(DHPAPTDT)
"RTN","SYNDHP62",158,0)
 I $P(APPTDT,".",2)="" S RETSTA("APPT")="-1^Missing time for appt." QUIT
"RTN","SYNDHP62",159,0)
 ;convert to external and check date/time against Fileman date/time field
"RTN","SYNDHP62",160,0)
 S Y=APPTDT
"RTN","SYNDHP62",161,0)
 D DD^%DT
"RTN","SYNDHP62",162,0)
 S EXDATE=Y ;Convert to external
"RTN","SYNDHP62",163,0)
 D CHK^DIE(2.98,.001,"",EXDATE,.RESULT,.MSG)
"RTN","SYNDHP62",164,0)
 I RESULT="^" S RETSTA("APPT")="-1^Invalid appt date/time." QUIT
"RTN","SYNDHP62",165,0)
 ;
"RTN","SYNDHP62",166,0)
 S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP62",167,0)
 ;
"RTN","SYNDHP62",168,0)
 S:$G(DHPLEN)="" APPTLEN=15 ;default appointment length
"RTN","SYNDHP62",169,0)
 ;
"RTN","SYNDHP62",170,0)
 ; -- Check Clinic --
"RTN","SYNDHP62",171,0)
 S CLINIEN=$O(^SC("B",DHPCLIN,""))
"RTN","SYNDHP62",172,0)
 I CLINIEN="" S RETSTA("APPT")="-1^Invalid clinic name (#44)." QUIT
"RTN","SYNDHP62",173,0)
 S INACTDT=$$GET1^DIQ(44,CLINIEN_",",2505,"I") ;inactivate date
"RTN","SYNDHP62",174,0)
 S REACTDT=$$GET1^DIQ(44,CLINIEN_",",2506,"I") ;reactivate date
"RTN","SYNDHP62",175,0)
 I INACTDT'="",REACTDT="",INACTDT<APPTDT S RETSTA("APPT")="-1^Clinic inactive on appt. date (#44)." QUIT
"RTN","SYNDHP62",176,0)
 I REACTDT'="",REACTDT>INACTDT,REACTDT>APPTDT S RETSTA("APPT")="-1^Clinic inactive on appt. date (#44)." QUIT
"RTN","SYNDHP62",177,0)
 I REACTDT'="",REACTDT<INACTDT,INACTDT<APPTDT S RETSTA("APPT")="-1^Clinic inactive on appt. date (#44)." QUIT
"RTN","SYNDHP62",178,0)
 ;
"RTN","SYNDHP62",179,0)
 ; -- Check for Clinic stop code --
"RTN","SYNDHP62",180,0)
 I $$GET1^DIQ(44,CLINIEN_",",8)="" D  QUIT
"RTN","SYNDHP62",181,0)
 . S RETSTA("APPT")="-1^Clinic missing STOP CODE NUMBER (#44,8)."
"RTN","SYNDHP62",182,0)
 ;
"RTN","SYNDHP62",183,0)
 I $G(DEBUG)=1 D
"RTN","SYNDHP62",184,0)
 . W "Create Appointment  APPTADD^SYNDHP62",!
"RTN","SYNDHP62",185,0)
 . W "ICN: ",DHPPAT,"   DFN: ",PATDFN,!
"RTN","SYNDHP62",186,0)
 . W "CLINIC: ",DHPCLIN,"   IEN: ",CLINIEN,!
"RTN","SYNDHP62",187,0)
 . W "APPT D/T: ",DHPAPTDT,"   ",APPTDT,!
"RTN","SYNDHP62",188,0)
 ;
"RTN","SYNDHP62",189,0)
 I $D(^DPT(PATDFN,"S",APPTDT,0)),$P($G(^DPT(PATDFN,"S",APPTDT,0)),U,2)'="C" D  QUIT
"RTN","SYNDHP62",190,0)
 . S RETSTA("APPT")="-1^Duplicate Appointment"
"RTN","SYNDHP62",191,0)
 ;
"RTN","SYNDHP62",192,0)
 ; -- create patient appointment --
"RTN","SYNDHP62",193,0)
 N FDA,ERRMSG,IENS,IENROOT
"RTN","SYNDHP62",194,0)
 S IENS="+1,"_PATDFN_","
"RTN","SYNDHP62",195,0)
 S FDA(2.98,IENS,.001)=APPTDT ;appointment date/time
"RTN","SYNDHP62",196,0)
 S FDA(2.98,IENS,.01)=CLINIEN ;clinic
"RTN","SYNDHP62",197,0)
 S FDA(2.98,IENS,3)="" ;status
"RTN","SYNDHP62",198,0)
 S FDA(2.98,IENS,9.5)=9 ;appointment type (9=regular)
"RTN","SYNDHP62",199,0)
 S FDA(2.98,IENS,19)=DUZ ;data entry clerk
"RTN","SYNDHP62",200,0)
 S FDA(2.98,IENS,20)=DT ;date appointment made
"RTN","SYNDHP62",201,0)
 S FDA(2.98,IENS,21)="" ;pointer to Encounter record (409.68)
"RTN","SYNDHP62",202,0)
 I APPTDT<$$NOW^XLFDT() D
"RTN","SYNDHP62",203,0)
 . S FDA(2.98,IENS,9)=4 ;purpose of visit (4=unscheduled visit)
"RTN","SYNDHP62",204,0)
 . S FDA(2.98,IENS,25)="W" ;sched request type (W=walk-in)
"RTN","SYNDHP62",205,0)
 . S FDA(2.98,IENS,26)=0 ;next available appt indicator
"RTN","SYNDHP62",206,0)
 E  D
"RTN","SYNDHP62",207,0)
 . S FDA(2.98,IENS,9)=3 ;purpose of visit (3=scheduled visit)
"RTN","SYNDHP62",208,0)
 . S FDA(2.98,IENS,25)="N" ;sched request type (N=next available)
"RTN","SYNDHP62",209,0)
 . S FDA(2.98,IENS,26)=1 ;next available appt indicator
"RTN","SYNDHP62",210,0)
 . S FDA(2.98,IENS,27)=$P(APPTDT,".",1) ;desired date of appointment
"RTN","SYNDHP62",211,0)
 . S FDA(2.98,IENS,28)=0 ;follow-up visit (0=no)
"RTN","SYNDHP62",212,0)
 D UPDATE^DIE("","FDA","IENROOT","ERRMSG")
"RTN","SYNDHP62",213,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",214,0)
 . S RETSTA("APPT")="-1^Problem saving patient appointment info (#2.98) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",215,0)
 ;
"RTN","SYNDHP62",216,0)
 ; -- create clinic appointment --
"RTN","SYNDHP62",217,0)
 N FDA,IENS,ERRMSG,ERROR
"RTN","SYNDHP62",218,0)
 S IENS="+2,"_CLINIEN_","
"RTN","SYNDHP62",219,0)
 S IENS(2)=+APPTDT
"RTN","SYNDHP62",220,0)
 S ERROR=0
"RTN","SYNDHP62",221,0)
 I '$D(^SC(CLINIEN,"S",APPTDT,0)) D
"RTN","SYNDHP62",222,0)
 . S FDA(44.001,IENS,.01)=+APPTDT ;appointment date/time
"RTN","SYNDHP62",223,0)
 . D UPDATE^DIE("","FDA","IENS","ERRMSG")
"RTN","SYNDHP62",224,0)
 . I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",225,0)
 . . S RETSTA("APPT")="-1^Problem saving clinic appointment date (#44.001) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",226,0)
 . . S ERROR=1
"RTN","SYNDHP62",227,0)
 ;ZWRITE IENS
"RTN","SYNDHP62",228,0)
 QUIT:ERROR
"RTN","SYNDHP62",229,0)
 S APPTDT=$G(IENS(2))
"RTN","SYNDHP62",230,0)
 N FDA,IENS,ERRMSG
"RTN","SYNDHP62",231,0)
 S IENS="?+1,"_+APPTDT_","_CLINIEN_","
"RTN","SYNDHP62",232,0)
 S FDA(44.003,IENS,.01)=PATDFN ;patient dfn
"RTN","SYNDHP62",233,0)
 S FDA(44.003,IENS,1)=APPTLEN ;appointment length
"RTN","SYNDHP62",234,0)
 S FDA(44.003,IENS,7)=DUZ ;data entry clerk
"RTN","SYNDHP62",235,0)
 S FDA(44.003,IENS,8)=$P($$NOW^XLFDT,".",1) ;date appointment made
"RTN","SYNDHP62",236,0)
 D UPDATE^DIE("","FDA","IENS","ERRMSG")
"RTN","SYNDHP62",237,0)
 ;ZWRITE IENS
"RTN","SYNDHP62",238,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",239,0)
 . S RETSTA("APPT")="-1^Problem saving clinic appointment (#44.003) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",240,0)
 ;
"RTN","SYNDHP62",241,0)
 S RETSTA("APPT")=1
"RTN","SYNDHP62",242,0)
 ;
"RTN","SYNDHP62",243,0)
 QUIT
"RTN","SYNDHP62",244,0)
 ;
"RTN","SYNDHP62",245,0)
 ; -------- Appointment check-in
"RTN","SYNDHP62",246,0)
 ;
"RTN","SYNDHP62",247,0)
APPTCKIN(RETSTA,DHPPAT,DHPCLIN,DHPAPTDT,DHPCIDT) ;Check-in appointment
"RTN","SYNDHP62",248,0)
 ;
"RTN","SYNDHP62",249,0)
 ; Input:
"RTN","SYNDHP62",250,0)
 ;   DHPPAT   - Patient ICN (required)
"RTN","SYNDHP62",251,0)
 ;   DHPCLIN  - Clinic Name (required)
"RTN","SYNDHP62",252,0)
 ;   DHPAPTDT - Appointment Date & Time (required) all dates received in HL7 format
"RTN","SYNDHP62",253,0)
 ;   DHPCIDT  - Check-in Date & Time (optional, will default to appointment date/time)
"RTN","SYNDHP62",254,0)
 ;
"RTN","SYNDHP62",255,0)
 ; Output:   RETSTA("CKIN")
"RTN","SYNDHP62",256,0)
 ;  1 - success
"RTN","SYNDHP62",257,0)
 ; -1 - failure -1^message
"RTN","SYNDHP62",258,0)
 ;
"RTN","SYNDHP62",259,0)
 N Y,PATDFN,APPTDT,CHKINDT,CLINIEN,EXDATE,BADDATE,RESULT,MSG,HIT,CLAPTIEN,ELIGCODE
"RTN","SYNDHP62",260,0)
 ;
"RTN","SYNDHP62",261,0)
 I $G(DHPPAT)="" S RETSTA("CKIN")="-1^Missing patient identifier (#2)." QUIT
"RTN","SYNDHP62",262,0)
 I $G(DHPCLIN)="" S RETSTA("CKIN")="-1^Missing appt. location (#44)." QUIT
"RTN","SYNDHP62",263,0)
 I $G(DHPAPTDT)="" S RETSTA("CKIN")="-1^Missing date/time for appt." QUIT
"RTN","SYNDHP62",264,0)
 ;
"RTN","SYNDHP62",265,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA("CKIN")="-1^Patient not recognised" QUIT
"RTN","SYNDHP62",266,0)
 S PATDFN=$O(^DPT("AFICN",DHPPAT,""))
"RTN","SYNDHP62",267,0)
 ;
"RTN","SYNDHP62",268,0)
 ; -- Check Clinic --
"RTN","SYNDHP62",269,0)
 S CLINIEN=$O(^SC("B",DHPCLIN,""))
"RTN","SYNDHP62",270,0)
 I CLINIEN="" S RETSTA("CKIN")="-1^Invalid clinic name (#44)." QUIT
"RTN","SYNDHP62",271,0)
 ;
"RTN","SYNDHP62",272,0)
 ; -- Check appointment date/time --
"RTN","SYNDHP62",273,0)
 S APPTDT=$$HL7TFM^XLFDT(DHPAPTDT)
"RTN","SYNDHP62",274,0)
 I $P(APPTDT,".",2)="" S RETSTA("CKIN")="-1^Missing time for appt." QUIT
"RTN","SYNDHP62",275,0)
 ;convert to external and check date/time against Fileman date/time field
"RTN","SYNDHP62",276,0)
 S Y=APPTDT
"RTN","SYNDHP62",277,0)
 D DD^%DT
"RTN","SYNDHP62",278,0)
 S EXDATE=Y ;Convert to external
"RTN","SYNDHP62",279,0)
 D CHK^DIE(2.98,.001,"",EXDATE,.RESULT,.MSG)
"RTN","SYNDHP62",280,0)
 I RESULT="^" S RETSTA("CKIN")="-1^Invalid appt date/time." QUIT
"RTN","SYNDHP62",281,0)
 ;
"RTN","SYNDHP62",282,0)
 ; -- Check check-in date/time --
"RTN","SYNDHP62",283,0)
 N RESULT,MSG
"RTN","SYNDHP62",284,0)
 S BADDATE=0
"RTN","SYNDHP62",285,0)
 I $G(DHPCIDT)="" D
"RTN","SYNDHP62",286,0)
 . S CHKINDT=APPTDT
"RTN","SYNDHP62",287,0)
 E  D
"RTN","SYNDHP62",288,0)
 . S CHKINDT=$$HL7TFM^XLFDT(DHPCIDT)
"RTN","SYNDHP62",289,0)
 . I $P(CHKINDT,".",2)="" S RETSTA("CKIN")="-1^Missing time for check-in.",BADDATE=1 QUIT
"RTN","SYNDHP62",290,0)
 . ;convert to external and check date/time against Fileman date/time field
"RTN","SYNDHP62",291,0)
 . S Y=CHKINDT
"RTN","SYNDHP62",292,0)
 . D DD^%DT
"RTN","SYNDHP62",293,0)
 . S EXDATE=Y
"RTN","SYNDHP62",294,0)
 . D CHK^DIE(2.98,.001,"",EXDATE,.RESULT,.MSG)
"RTN","SYNDHP62",295,0)
 . I RESULT="^" S RETSTA("CKIN")="-1^Invalid check-in date/time.",BADDATE=1 QUIT
"RTN","SYNDHP62",296,0)
 QUIT:BADDATE
"RTN","SYNDHP62",297,0)
 ;
"RTN","SYNDHP62",298,0)
 ;check that there are both patient and clinic appointment records
"RTN","SYNDHP62",299,0)
 I '$D(^DPT(PATDFN,"S",APPTDT,0)) D  QUIT
"RTN","SYNDHP62",300,0)
 . S RETSTA("CKIN")="-1^Patient Appointment record was not found"
"RTN","SYNDHP62",301,0)
 ;
"RTN","SYNDHP62",302,0)
 S HIT=0
"RTN","SYNDHP62",303,0)
 S CLAPTIEN=0
"RTN","SYNDHP62",304,0)
 F  S CLAPTIEN=$O(^SC(CLINIEN,"S",APPTDT,1,CLAPTIEN)) QUIT:CLAPTIEN=""  D  QUIT:HIT
"RTN","SYNDHP62",305,0)
 . S:$P(^SC(CLINIEN,"S",APPTDT,1,CLAPTIEN,0),U,1)=PATDFN HIT=1
"RTN","SYNDHP62",306,0)
 I 'HIT D  QUIT
"RTN","SYNDHP62",307,0)
 . S RETSTA("CKIN")="-1^Clinic Appointment record was not found"
"RTN","SYNDHP62",308,0)
 ;
"RTN","SYNDHP62",309,0)
 I $G(DEBUG)=1 D
"RTN","SYNDHP62",310,0)
 . W "Appointment Check-in  APPTCKIN^SYNDHP62",!
"RTN","SYNDHP62",311,0)
 . W "ICN:             ",DHPPAT,"   DFN: ",PATDFN,!
"RTN","SYNDHP62",312,0)
 . W "CLINIC:          ",DHPCLIN,"   IEN: ",CLINIEN,!
"RTN","SYNDHP62",313,0)
 . W "CLINIC,APPT,IEN: ",CLAPTIEN,!
"RTN","SYNDHP62",314,0)
 . W "APPT D/T:        ",DHPAPTDT,"   ",APPTDT,!
"RTN","SYNDHP62",315,0)
 . W "CHK-IN D/T:      ",DHPCIDT,"   ",CHKINDT,!
"RTN","SYNDHP62",316,0)
 ;
"RTN","SYNDHP62",317,0)
 ; -- appointment check-in updates --
"RTN","SYNDHP62",318,0)
 ;
"RTN","SYNDHP62",319,0)
 ; clinic appointment record
"RTN","SYNDHP62",320,0)
 ;  30 - eligibility of visit 0;10
"RTN","SYNDHP62",321,0)
 ;      10 = NSC
"RTN","SYNDHP62",322,0)
 ;      11 = NSC, VA PENSION
"RTN","SYNDHP62",323,0)
 ;      15 = SC LESS THAN 50%
"RTN","SYNDHP62",324,0)
 ;      16 = SERVICE CONNECTED 50% to 100%
"RTN","SYNDHP62",325,0)
 ;  309 - checked-in (date) C;1
"RTN","SYNDHP62",326,0)
 ;  302 - check in user C;2 P200
"RTN","SYNDHP62",327,0)
 ;  305 - check in entered (date) C;5
"RTN","SYNDHP62",328,0)
 ;
"RTN","SYNDHP62",329,0)
 S ELIGCODE=$$GET1^DIQ(2,DHPPAT_",",.361,"I")
"RTN","SYNDHP62",330,0)
 S:ELIGCODE="" ELIGCODE=10
"RTN","SYNDHP62",331,0)
 N IENS,FDA,ERRMSG
"RTN","SYNDHP62",332,0)
 S IENS=CLAPTIEN_","_APPTDT_","_CLINIEN_","
"RTN","SYNDHP62",333,0)
 S FDA(44.003,IENS,30)=ELIGCODE ;eligibility of visit
"RTN","SYNDHP62",334,0)
 S FDA(44.003,IENS,309)=CHKINDT ;checked-in (date)
"RTN","SYNDHP62",335,0)
 S FDA(44.003,IENS,302)=DUZ ;check in user
"RTN","SYNDHP62",336,0)
 S FDA(44.003,IENS,305)=CHKINDT ;check in entered (date)
"RTN","SYNDHP62",337,0)
 D FILE^DIE("K","FDA","ERRMSG")
"RTN","SYNDHP62",338,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",339,0)
 . S RETSTA("CKIN")="-1^Problem updating clinic appointment check-in info (#44.003) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",340,0)
 ;
"RTN","SYNDHP62",341,0)
 S RETSTA("CKIN")=1
"RTN","SYNDHP62",342,0)
 ;
"RTN","SYNDHP62",343,0)
 QUIT
"RTN","SYNDHP62",344,0)
 ;
"RTN","SYNDHP62",345,0)
 ; -------- Appointment check-out
"RTN","SYNDHP62",346,0)
 ;
"RTN","SYNDHP62",347,0)
APTCKOUT(RETSTA,DHPPAT,DHPCLIN,DHPAPTDT,DHPCODT) ;Check-out appointment
"RTN","SYNDHP62",348,0)
 ;>>>>>> This API currently will ONLY work for synthetic data ingest <<<<<<<
"RTN","SYNDHP62",349,0)
 ;>>>>>>  where Outpatient Encounters and Visits are created first   <<<<<<<
"RTN","SYNDHP62",350,0)
 ; Input:
"RTN","SYNDHP62",351,0)
 ;   DHPPAT   - Patient ICN (required)
"RTN","SYNDHP62",352,0)
 ;   DHPCLIN  - Clinic Name (required)
"RTN","SYNDHP62",353,0)
 ;   DHPAPTDT - Appointment Date & Time (required) all dates received in HL7 format
"RTN","SYNDHP62",354,0)
 ;   DHPCODT  - Check-out Date & Time (optional, will default to check-in date/time + 30 minutes)
"RTN","SYNDHP62",355,0)
 ;
"RTN","SYNDHP62",356,0)
 ; Output:   RETSTA("CKOUT")
"RTN","SYNDHP62",357,0)
 ;  1 - success
"RTN","SYNDHP62",358,0)
 ; -1 - failure -1^message
"RTN","SYNDHP62",359,0)
 ;
"RTN","SYNDHP62",360,0)
 N Y,PATDFN,APPTDT,CHKINDT,CHKOUTDT,CLINIEN,EXDATE,BADDATE,RESULT,MSG,HIT,CLAPTIEN,IENS
"RTN","SYNDHP62",361,0)
 ;
"RTN","SYNDHP62",362,0)
 I $G(DHPPAT)="" S RETSTA("CKOUT")="-1^Missing patient identifier (#2)." QUIT
"RTN","SYNDHP62",363,0)
 I $G(DHPCLIN)="" S RETSTA("CKOUT")="-1^Missing appt. location (#44)." QUIT
"RTN","SYNDHP62",364,0)
 I $G(DHPAPTDT)="" S RETSTA("CKOUT")="-1^Missing date/time for appt." QUIT
"RTN","SYNDHP62",365,0)
 ;
"RTN","SYNDHP62",366,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA("CKOUT")="-1^Patient not recognised" QUIT
"RTN","SYNDHP62",367,0)
 S PATDFN=$O(^DPT("AFICN",DHPPAT,""))
"RTN","SYNDHP62",368,0)
 ;
"RTN","SYNDHP62",369,0)
 ; -- Check Clinic --
"RTN","SYNDHP62",370,0)
 S CLINIEN=$O(^SC("B",DHPCLIN,""))
"RTN","SYNDHP62",371,0)
 I CLINIEN="" S RETSTA("CKOUT")="-1^Invalid clinic name (#44)." QUIT
"RTN","SYNDHP62",372,0)
 ;
"RTN","SYNDHP62",373,0)
 ; -- Check appointment date/time --
"RTN","SYNDHP62",374,0)
 S APPTDT=$$HL7TFM^XLFDT(DHPAPTDT)
"RTN","SYNDHP62",375,0)
 I $P(APPTDT,".",2)="" S RETSTA("CKOUT")="-1^Missing time for appt." QUIT
"RTN","SYNDHP62",376,0)
 ;convert to external and check date/time against Fileman date/time field
"RTN","SYNDHP62",377,0)
 S Y=APPTDT
"RTN","SYNDHP62",378,0)
 D DD^%DT
"RTN","SYNDHP62",379,0)
 S EXDATE=Y ;Convert to external
"RTN","SYNDHP62",380,0)
 D CHK^DIE(2.98,.001,"",EXDATE,.RESULT,.MSG)
"RTN","SYNDHP62",381,0)
 I RESULT="^" S RETSTA("CKOUT")="-1^Invalid appt date/time." QUIT
"RTN","SYNDHP62",382,0)
 ;
"RTN","SYNDHP62",383,0)
 ;check that there are both patient and clinic appointment records
"RTN","SYNDHP62",384,0)
 I '$D(^DPT(PATDFN,"S",APPTDT,0)) D  QUIT
"RTN","SYNDHP62",385,0)
 . S RETSTA("CKOUT")="-1^Patient Appointment record was not found"
"RTN","SYNDHP62",386,0)
 ;
"RTN","SYNDHP62",387,0)
 S HIT=0
"RTN","SYNDHP62",388,0)
 S CLAPTIEN=0
"RTN","SYNDHP62",389,0)
 F  S CLAPTIEN=$O(^SC(CLINIEN,"S",APPTDT,1,CLAPTIEN)) QUIT:CLAPTIEN=""  D  QUIT:HIT
"RTN","SYNDHP62",390,0)
 . S:$P(^SC(CLINIEN,"S",APPTDT,1,CLAPTIEN,0),U,1)=PATDFN HIT=1
"RTN","SYNDHP62",391,0)
 I 'HIT D  QUIT
"RTN","SYNDHP62",392,0)
 . S RETSTA("CKOUT")="-1^Clinic Appointment record was not found"
"RTN","SYNDHP62",393,0)
 ;
"RTN","SYNDHP62",394,0)
 ; -- Get check-in date/time --
"RTN","SYNDHP62",395,0)
 S IENS=CLAPTIEN_","_APPTDT_","_CLINIEN_","
"RTN","SYNDHP62",396,0)
 S CHKINDT=$$GET1^DIQ(44.003,IENS,309,"I")
"RTN","SYNDHP62",397,0)
 I CHKINDT="" D  QUIT
"RTN","SYNDHP62",398,0)
 . S RETSTA("CKOUT")="-1^Appointment has not been checked-in"
"RTN","SYNDHP62",399,0)
 ;
"RTN","SYNDHP62",400,0)
 ; -- Check check-out date/time --
"RTN","SYNDHP62",401,0)
 N RESULT,MSG
"RTN","SYNDHP62",402,0)
 S BADDATE=0
"RTN","SYNDHP62",403,0)
 I $G(DHPCODT)="" D
"RTN","SYNDHP62",404,0)
 . S CHKOUTDT=$$FMADD^XLFDT(CHKINDT,0,0,30)
"RTN","SYNDHP62",405,0)
 E  D
"RTN","SYNDHP62",406,0)
 . S CHKOUTDT=$$HL7TFM^XLFDT(DHPCODT)
"RTN","SYNDHP62",407,0)
 . I $P(CHKOUTDT,".",2)="" S RETSTA("CKOUT")="-1^Missing time for check-out.",BADDATE=1 QUIT
"RTN","SYNDHP62",408,0)
 . ;convert to external and check date/time against Fileman date/time field
"RTN","SYNDHP62",409,0)
 . S Y=CHKOUTDT
"RTN","SYNDHP62",410,0)
 . D DD^%DT
"RTN","SYNDHP62",411,0)
 . S EXDATE=Y
"RTN","SYNDHP62",412,0)
 . D CHK^DIE(2.98,.001,"",EXDATE,.RESULT,.MSG)
"RTN","SYNDHP62",413,0)
 . I RESULT="^" S RETSTA("CKOUT")="-1^Invalid check-out date/time.",BADDATE=1 QUIT
"RTN","SYNDHP62",414,0)
 QUIT:BADDATE
"RTN","SYNDHP62",415,0)
 I CHKOUTDT'>CHKINDT S RETSTA("CKOUT")="-1^Check-out date/time must greater than check-in date." QUIT
"RTN","SYNDHP62",416,0)
 ;
"RTN","SYNDHP62",417,0)
 ;check requirements for completing check-out of appointment
"RTN","SYNDHP62",418,0)
 N COERRMSG,IDX
"RTN","SYNDHP62",419,0)
 S COERRMSG=1
"RTN","SYNDHP62",420,0)
 D CHECKCO(.COERRMSG,PATDFN,APPTDT)
"RTN","SYNDHP62",421,0)
 I COERRMSG=-1 D  QUIT
"RTN","SYNDHP62",422,0)
 . S RETSTA("CKOUT")=-1
"RTN","SYNDHP62",423,0)
 . S IDX=""
"RTN","SYNDHP62",424,0)
 . F  S IDX=$O(COERRMSG(IDX)) QUIT:IDX=""  D
"RTN","SYNDHP62",425,0)
 . . S RETSTA("CKOUT")=RETSTA("CKOUT")_"^"_COERRMSG(IDX)
"RTN","SYNDHP62",426,0)
 ;
"RTN","SYNDHP62",427,0)
 I $G(DEBUG)=1 D
"RTN","SYNDHP62",428,0)
 . W "Appointment Check-in  APTCKOUT^SYNDHP62",!
"RTN","SYNDHP62",429,0)
 . W "ICN:             ",DHPPAT,"   DFN: ",PATDFN,!
"RTN","SYNDHP62",430,0)
 . W "CLINIC:          ",DHPCLIN,"   IEN: ",CLINIEN,!
"RTN","SYNDHP62",431,0)
 . W "CLINIC,APPT,IEN: ",CLAPTIEN,!
"RTN","SYNDHP62",432,0)
 . W "APPT D/T:        ",DHPAPTDT,"   ",APPTDT,!
"RTN","SYNDHP62",433,0)
 . W "CHK-IN D/T:      ",CHKINDT,!
"RTN","SYNDHP62",434,0)
 . W "CHK-OUT D/T:     ",DHPCODT,"   ",CHKOUTDT,!
"RTN","SYNDHP62",435,0)
 ;
"RTN","SYNDHP62",436,0)
 ; -- appointment check-out updates --
"RTN","SYNDHP62",437,0)
 ;
"RTN","SYNDHP62",438,0)
 ; patient appointment record
"RTN","SYNDHP62",439,0)
 ;  update appt record with outpatient encounter ien
"RTN","SYNDHP62",440,0)
 ;    21 - outpatient encounter 0;20 P409.68
"RTN","SYNDHP62",441,0)
 ;
"RTN","SYNDHP62",442,0)
 ;get the outpatient encounter IEN for the appt. encounter record, not the stop code record
"RTN","SYNDHP62",443,0)
 N SCEIEN
"RTN","SYNDHP62",444,0)
 S SCEIEN=$O(^SCE("ADFN",PATDFN,APPTDT,""))
"RTN","SYNDHP62",445,0)
 I SCEIEN="" D  QUIT
"RTN","SYNDHP62",446,0)
 . S RETSTA("CKOUT")="-1^Could not find the outpatient encounter record."
"RTN","SYNDHP62",447,0)
 ;
"RTN","SYNDHP62",448,0)
 ; patient appointment record
"RTN","SYNDHP62",449,0)
 ;  update appt record with outpatient encounter ien
"RTN","SYNDHP62",450,0)
 ;    21 - outpatient encounter 0;20 P409.68
"RTN","SYNDHP62",451,0)
 ;
"RTN","SYNDHP62",452,0)
 N IENS,FDA,ERRMSG
"RTN","SYNDHP62",453,0)
 S IENS=APPTDT_","_PATDFN_","
"RTN","SYNDHP62",454,0)
 S FDA(2.98,IENS,21)=SCEIEN ;outpatient encounter
"RTN","SYNDHP62",455,0)
 D FILE^DIE("K","FDA","ERRMSG")
"RTN","SYNDHP62",456,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",457,0)
 . S RETSTA("CKOUT")="-1^Problem updating patient appointment Outpat Enc pointer (#2.98) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",458,0)
 ;
"RTN","SYNDHP62",459,0)
 ; clinic appointment record
"RTN","SYNDHP62",460,0)
 ;  303 - checked out (date) C;3
"RTN","SYNDHP62",461,0)
 ;  304 - check out user C;4 P200
"RTN","SYNDHP62",462,0)
 ;  306 - check out entered (date) C;6
"RTN","SYNDHP62",463,0)
 ;
"RTN","SYNDHP62",464,0)
 N IENS,FDA,ERRMSG
"RTN","SYNDHP62",465,0)
 S IENS=CLAPTIEN_","_APPTDT_","_CLINIEN_","
"RTN","SYNDHP62",466,0)
 S FDA(44.003,IENS,303)=CHKOUTDT ;checked out (date)
"RTN","SYNDHP62",467,0)
 S FDA(44.003,IENS,304)=DUZ ;check out user
"RTN","SYNDHP62",468,0)
 S FDA(44.003,IENS,306)=CHKOUTDT ;check out entered (date)
"RTN","SYNDHP62",469,0)
 D FILE^DIE("K","FDA","ERRMSG")
"RTN","SYNDHP62",470,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",471,0)
 . S RETSTA("CKOUT")="-1^Problem updating clinic appointment check-out info (#44.003) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",472,0)
 ;
"RTN","SYNDHP62",473,0)
 ; outpatient encounter records
"RTN","SYNDHP62",474,0)
 ;
"RTN","SYNDHP62",475,0)
 N IENS,FDA,ERRMSG
"RTN","SYNDHP62",476,0)
 S IENS=SCEIEN_","
"RTN","SYNDHP62",477,0)
 S FDA(409.68,IENS,.07)=CHKOUTDT ;check out process completion
"RTN","SYNDHP62",478,0)
 S FDA(409.68,IENS,.1)=11 ;appointment type
"RTN","SYNDHP62",479,0)
 S FDA(409.68,IENS,.12)=2 ;status
"RTN","SYNDHP62",480,0)
 D FILE^DIE("K","FDA","ERRMSG")
"RTN","SYNDHP62",481,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",482,0)
 . S RETSTA("CKOUT")="-1^Problem updating outpatient encounter (#409.68) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",483,0)
 ;
"RTN","SYNDHP62",484,0)
 N IENS,FDA,ERRMSG
"RTN","SYNDHP62",485,0)
 S IENS=$O(^SCE("APAR",SCEIEN,""))_","
"RTN","SYNDHP62",486,0)
 S FDA(409.68,IENS,.1)=11 ;appointment type
"RTN","SYNDHP62",487,0)
 D FILE^DIE("K","FDA","ERRMSG")
"RTN","SYNDHP62",488,0)
 I $D(ERRMSG) D  QUIT
"RTN","SYNDHP62",489,0)
 . S RETSTA("CKOUT")="-1^Problem updating outpatient encounter (#409.68) - "_$G(ERRMSG("DIERR",1,"TEXT",1))
"RTN","SYNDHP62",490,0)
 ;
"RTN","SYNDHP62",491,0)
 ; visit records - no update required
"RTN","SYNDHP62",492,0)
 ;
"RTN","SYNDHP62",493,0)
 S RETSTA("CKOUT")=1
"RTN","SYNDHP62",494,0)
 ;
"RTN","SYNDHP62",495,0)
 QUIT
"RTN","SYNDHP62",496,0)
 ;
"RTN","SYNDHP62",497,0)
CHECKCO(COERRMSG,PATDFN,APPTDT) ;
"RTN","SYNDHP62",498,0)
 ;
"RTN","SYNDHP62",499,0)
 N ECNT,SCEIENP,SCEIENS,INVDATE,VIENP,VIENS,VPROV,VPOV,VCPT
"RTN","SYNDHP62",500,0)
 S ECNT=0
"RTN","SYNDHP62",501,0)
 ;
"RTN","SYNDHP62",502,0)
 S SCEIENP=$O(^SCE("ADFN",PATDFN,APPTDT,""))
"RTN","SYNDHP62",503,0)
 I SCEIENP="" D
"RTN","SYNDHP62",504,0)
 . S ECNT=ECNT+1
"RTN","SYNDHP62",505,0)
 . S COERRMSG=-1
"RTN","SYNDHP62",506,0)
 . S COERRMSG(ECNT)="No Outpatient Encounter record"
"RTN","SYNDHP62",507,0)
 ;
"RTN","SYNDHP62",508,0)
 I SCEIENP'="" D
"RTN","SYNDHP62",509,0)
 . S SCEIENS=$O(^SCE("APAR",SCEIENP,""))
"RTN","SYNDHP62",510,0)
 . I SCEIENS="" D
"RTN","SYNDHP62",511,0)
 . . S ECNT=ECNT+1
"RTN","SYNDHP62",512,0)
 . . S COERRMSG=-1
"RTN","SYNDHP62",513,0)
 . . S COERRMSG(ECNT)="No Outpatient Encounter stop code record"
"RTN","SYNDHP62",514,0)
 ;
"RTN","SYNDHP62",515,0)
 S INVDATE=9999999-$P(+APPTDT,".",1)_$S($P(+APPTDT,".",2)'="":"."_$P(+APPTDT,".",2),1:"")
"RTN","SYNDHP62",516,0)
 S VIENP=$O(^AUPNVSIT("AA",PATDFN,INVDATE,""))
"RTN","SYNDHP62",517,0)
 I VIENP="" D
"RTN","SYNDHP62",518,0)
 . S ECNT=ECNT+1
"RTN","SYNDHP62",519,0)
 . S COERRMSG=-1
"RTN","SYNDHP62",520,0)
 . S COERRMSG(ECNT)="No Visit record"
"RTN","SYNDHP62",521,0)
 ;
"RTN","SYNDHP62",522,0)
 I VIENP'="" D
"RTN","SYNDHP62",523,0)
 . S VIENS=$O(^AUPNVSIT("AD",VIENP,""))
"RTN","SYNDHP62",524,0)
 . I VIENS="" D
"RTN","SYNDHP62",525,0)
 . . S ECNT=ECNT+1
"RTN","SYNDHP62",526,0)
 . . S COERRMSG=-1
"RTN","SYNDHP62",527,0)
 . . S COERRMSG(ECNT)="No Visit stop code record"
"RTN","SYNDHP62",528,0)
 . ;
"RTN","SYNDHP62",529,0)
 . S VPROV=$O(^AUPNVPRV("AD",VIENP,""))
"RTN","SYNDHP62",530,0)
 . I VPROV="" D
"RTN","SYNDHP62",531,0)
 . . S ECNT=ECNT+1
"RTN","SYNDHP62",532,0)
 . . S COERRMSG=-1
"RTN","SYNDHP62",533,0)
 . . S COERRMSG(ECNT)="No V Provider record for Visit"
"RTN","SYNDHP62",534,0)
 . ;
"RTN","SYNDHP62",535,0)
 . S VPOV=$O(^AUPNVPOV("AD",VIENP,""))
"RTN","SYNDHP62",536,0)
 . I VPOV="" D
"RTN","SYNDHP62",537,0)
 . . S ECNT=ECNT+1
"RTN","SYNDHP62",538,0)
 . . S COERRMSG=-1
"RTN","SYNDHP62",539,0)
 . . S COERRMSG(ECNT)="No V POV record for Visit"
"RTN","SYNDHP62",540,0)
 . ;
"RTN","SYNDHP62",541,0)
 . S VCPT=$O(^AUPNVCPT("AD",VIENP,""))
"RTN","SYNDHP62",542,0)
 . I VCPT="" D
"RTN","SYNDHP62",543,0)
 . . S ECNT=ECNT+1
"RTN","SYNDHP62",544,0)
 . . S COERRMSG=-1
"RTN","SYNDHP62",545,0)
 . . S COERRMSG(ECNT)="No V CPT record for Visit"
"RTN","SYNDHP62",546,0)
 . ;
"RTN","SYNDHP62",547,0)
 QUIT
"RTN","SYNDHP62",548,0)
 ;
"RTN","SYNDHP62",549,0)
TEST ;
"RTN","SYNDHP62",550,0)
T1 S ERRDISP=1
"RTN","SYNDHP62",551,0)
 D PRBUPDT(.ZXC,"5482156687V807096",2,9990006675,,"A","5OO_EXT",267036007)
"RTN","SYNDHP62",552,0)
 Q
"RTN","SYNDHP62",553,0)
 ;"PAT":"5482156687V807096","VST":"17004","ROV":"9990006675","ONS":"20130117","ABT":"20131021","CLNST":"I","SCT":"267036007"
"RTN","SYNDHP62",554,0)
T2 S ERRDISP=1
"RTN","SYNDHP62",555,0)
 D PRBUPDT(.ZXC,"11004V412157",17003,9990006675,20160117,20161021,"I",1657008)
"RTN","SYNDHP62",556,0)
 Q
"RTN","SYNDHP62",557,0)
T3 ;
"RTN","SYNDHP62",558,0)
 S ERRDISP=1
"RTN","SYNDHP62",559,0)
 D PRBUPDT(.ZXC,"11004V412157",,9990006675,20160117,20161021,"I",1657008)
"RTN","SYNDHP62",560,0)
 Q
"RTN","SYNDHP62",561,0)
T4 ; ICD9 code that was valid at 20130117
"RTN","SYNDHP62",562,0)
 S ERRDISP=1
"RTN","SYNDHP62",563,0)
 D PRBUPDT(.ZXC,"11004V412157",17003,9990006675,20130117,20161021,"I",2251002)
"RTN","SYNDHP63")
0^10^B12371395
"RTN","SYNDHP63",1,0)
SYNDHP63 ; HC/art - HealthConcourse - Write Lab Tests to VistA ;05/29/2018
"RTN","SYNDHP63",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP63",3,0)
 ;;
"RTN","SYNDHP63",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP63",5,0)
 ;
"RTN","SYNDHP63",6,0)
 QUIT
"RTN","SYNDHP63",7,0)
 ;
"RTN","SYNDHP63",8,0)
 ; -------- Create lab test for a patient
"RTN","SYNDHP63",9,0)
 ;
"RTN","SYNDHP63",10,0)
LABADD(RETSTA,DHPPAT,DHPLOC,DHPTEST,DHPRSLT,DHPRSDT,DHPLOINC) ;Create lab test
"RTN","SYNDHP63",11,0)
 ; This is a wrapper to setup a call to the ISI Lab Import processing
"RTN","SYNDHP63",12,0)
 ;
"RTN","SYNDHP63",13,0)
 ; Input:
"RTN","SYNDHP63",14,0)
 ;   DHPPAT  - Patient ICN (required)
"RTN","SYNDHP63",15,0)
 ;   DHPLOC  - Location Name (required)
"RTN","SYNDHP63",16,0)
 ;   DHPTEST - Test name (required if no valid LOINC code passed)
"RTN","SYNDHP63",17,0)
 ;   DHPRSLT - Test result value (required)
"RTN","SYNDHP63",18,0)
 ;   DHPRSDT - Test result date (required, HL7 format)
"RTN","SYNDHP63",19,0)
 ;   DHPLOINC - LOINC code
"RTN","SYNDHP63",20,0)
 ;
"RTN","SYNDHP63",21,0)
 ; Output:   RETSTA
"RTN","SYNDHP63",22,0)
 ;  1 - success
"RTN","SYNDHP63",23,0)
 ; -1 - failure -1^message
"RTN","SYNDHP63",24,0)
 ;
"RTN","SYNDHP63",25,0)
 N PATDFN,PATSSN,LABARRAY,RC,DHPRC,LOINCIEN,TESTIEN,LABTEST,SAVEIO
"RTN","SYNDHP63",26,0)
 ;send input values back to caller
"RTN","SYNDHP63",27,0)
 S RETSTA("LABINPUT","DHPPAT")=DHPPAT
"RTN","SYNDHP63",28,0)
 S RETSTA("LABINPUT","DHPLOC")=DHPLOC
"RTN","SYNDHP63",29,0)
 S RETSTA("LABINPUT","DHPTEST")=DHPTEST
"RTN","SYNDHP63",30,0)
 S RETSTA("LABINPUT","DHPRSLT")=DHPRSLT
"RTN","SYNDHP63",31,0)
 S RETSTA("LABINPUT","DHPRSDT")=DHPRSDT
"RTN","SYNDHP63",32,0)
 S RETSTA("LABINPUT","DHPLOINC")=DHPLOINC
"RTN","SYNDHP63",33,0)
 ;
"RTN","SYNDHP63",34,0)
 I $G(DHPPAT)="" S RETSTA="-1^Missing patient identifier." QUIT
"RTN","SYNDHP63",35,0)
 I $G(DHPLOC)="" S RETSTA="-1^Missing location." QUIT
"RTN","SYNDHP63",36,0)
 I $G(DHPLOINC)="",$G(DHPTEST)="" S RETSTA="-1^Missing lab test name." QUIT
"RTN","SYNDHP63",37,0)
 I $G(DHPRSLT)="" S RETSTA="-1^Missing lab test result value." QUIT
"RTN","SYNDHP63",38,0)
 I $G(DHPRSDT)="" S RETSTA="-1^Missing lab test result date/time." QUIT
"RTN","SYNDHP63",39,0)
 ;
"RTN","SYNDHP63",40,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised." QUIT
"RTN","SYNDHP63",41,0)
 S PATDFN=$O(^DPT("AFICN",DHPPAT,""))
"RTN","SYNDHP63",42,0)
 S PATSSN=$$GET1^DIQ(2,PATDFN_",",.09,"I") ;patient SSN
"RTN","SYNDHP63",43,0)
 I PATSSN="" S RETSTA="-1^Patient does not have an SSN." QUIT
"RTN","SYNDHP63",44,0)
 ;
"RTN","SYNDHP63",45,0)
 ; -- Check lab test date/time --
"RTN","SYNDHP63",46,0)
 S LABDTTM=$$HL7TFM^XLFDT(DHPRSDT)
"RTN","SYNDHP63",47,0)
 I $P(LABDTTM,".",2)="" S RETSTA="-1^Missing time for result date/time." QUIT
"RTN","SYNDHP63",48,0)
 ;chop off seconds
"RTN","SYNDHP63",49,0)
 S LABTM=$E($P(LABDTTM,".",2),1,4)
"RTN","SYNDHP63",50,0)
 S $P(LABDTTM,".",2)=LABTM
"RTN","SYNDHP63",51,0)
 S LABDTTM=$$HL7TFM^XLFDT($$FMTHL7^XLFDT(LABDTTM)) ;drop any trailing 0's in time
"RTN","SYNDHP63",52,0)
 ;
"RTN","SYNDHP63",53,0)
 ;Get lab test name for LOINC code
"RTN","SYNDHP63",54,0)
 I $G(DHPLOINC)'="" D
"RTN","SYNDHP63",55,0)
 . S LOINCIEN=$O(^LAB(95.3,"B",$P(DHPLOINC,"-",1),""))
"RTN","SYNDHP63",56,0)
 . QUIT:LOINCIEN=""
"RTN","SYNDHP63",57,0)
 . S TESTIEN=$O(^LAB(60,"AF",LOINCIEN,""))
"RTN","SYNDHP63",58,0)
 . QUIT:TESTIEN=""
"RTN","SYNDHP63",59,0)
 . S LABTEST=$$GET1^DIQ(60,TESTIEN_",",.01)
"RTN","SYNDHP63",60,0)
 I $G(LABTEST)="" S LABTEST=$$UP^XLFSTR(DHPTEST)
"RTN","SYNDHP63",61,0)
 I $G(LABTEST)="" S RETSTA="-1^Cannot determine lab test name." QUIT
"RTN","SYNDHP63",62,0)
 ;
"RTN","SYNDHP63",63,0)
 S LABARRAY("PAT_SSN")=PATSSN
"RTN","SYNDHP63",64,0)
 S LABARRAY("LAB_TEST")=LABTEST
"RTN","SYNDHP63",65,0)
 S LABARRAY("RESULT_DT")=LABDTTM
"RTN","SYNDHP63",66,0)
 S LABARRAY("RESULT_VAL")=DHPRSLT
"RTN","SYNDHP63",67,0)
 S LABARRAY("LOCATION")=DHPLOC
"RTN","SYNDHP63",68,0)
 S LABARRAY("LOINC")=DHPLOINC
"RTN","SYNDHP63",69,0)
 M RETSTA("LABDATA")=LABARRAY
"RTN","SYNDHP63",70,0)
 ;
"RTN","SYNDHP63",71,0)
 I $G(DEBUG)=1 D
"RTN","SYNDHP63",72,0)
 . W "ICN:      ",DHPPAT,!
"RTN","SYNDHP63",73,0)
 . W "SSN:      ",LABARRAY("PAT_SSN"),!
"RTN","SYNDHP63",74,0)
 . W "LOCATION: ",LABARRAY("LOCATION"),!
"RTN","SYNDHP63",75,0)
 . W "LOINC:    ",DHPLOINC,!
"RTN","SYNDHP63",76,0)
 . W "TEST:     ",LABARRAY("LAB_TEST"),!
"RTN","SYNDHP63",77,0)
 . W "RESULT:   ",LABARRAY("RESULT_VAL"),!
"RTN","SYNDHP63",78,0)
 . W "DATE:     ",LABARRAY("RESULT_DT"),!
"RTN","SYNDHP63",79,0)
 ;
"RTN","SYNDHP63",80,0)
 ;call ISI Labs Ingest
"RTN","SYNDHP63",81,0)
 S DUZ=$$DUZ^SYNDHP69
"RTN","SYNDHP63",82,0)
 ;
"RTN","SYNDHP63",83,0)
 S DHPRC=$$LAB^ISIIMP12(.RC,.LABARRAY)
"RTN","SYNDHP63",84,0)
 I +DHPRC=-1 S RETSTA=DHPRC QUIT
"RTN","SYNDHP63",85,0)
 ;
"RTN","SYNDHP63",86,0)
 S RETSTA=1
"RTN","SYNDHP63",87,0)
 ;
"RTN","SYNDHP63",88,0)
 QUIT
"RTN","SYNDHP63",89,0)
 ;
"RTN","SYNDHP63",90,0)
 ;
"RTN","SYNDHP63",91,0)
T1 ; test one
"RTN","SYNDHP63",92,0)
 ;
"RTN","SYNDHP63",93,0)
 M PARMS=^%wd(17.040801,1,1267,"load","labs",13,"parms")
"RTN","SYNDHP63",94,0)
 S N=""
"RTN","SYNDHP63",95,0)
 F  S N=$O(PARMS(N)) Q:N=""  S @N=PARMS(N)
"RTN","SYNDHP63",96,0)
 D LABADD(.ZXC,DHPPAT,DHPLOC,DHPLAB,DHPOBS,DHPDTM,DHPLOINC)
"RTN","SYNDHP63",97,0)
 Q
"RTN","SYNDHP64")
0^11^B1748603
"RTN","SYNDHP64",1,0)
SYNDHP64 ;DHP/AFHIL -fjf/art - HealthConcourse - Write Health Factors to VistA ; 31st July 2018
"RTN","SYNDHP64",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP64",3,0)
 ;;
"RTN","SYNDHP64",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP64",5,0)
 ;
"RTN","SYNDHP64",6,0)
 QUIT
"RTN","SYNDHP64",7,0)
 ;
"RTN","SYNDHP64",8,0)
 ; -------- Create health factor for a patient
"RTN","SYNDHP64",9,0)
 ;
"RTN","SYNDHP64",10,0)
HLFADD(RETSTA,DHPPAT,DHPLOC,DHPHLF,DHPCAT,DHPCODE,DHPCOD,DHPSYS,DHPDAT,DHPPRV,DHPVST,DHPCOM,DHPUCUM,DHPMAG) ;
"RTN","SYNDHP64",11,0)
 ; Create health factor
"RTN","SYNDHP64",12,0)
 ; 
"RTN","SYNDHP64",13,0)
 ;
"RTN","SYNDHP64",14,0)
 ; Input:
"RTN","SYNDHP64",15,0)
 ;   DHPPAT  - Patient ICN (required)
"RTN","SYNDHP64",16,0)
 ;   DHPLOC  - Location Name (required)
"RTN","SYNDHP64",17,0)
 ;   DHPHLF  - Health Factor Name (include SNOMED CT or LOINC code)
"RTN","SYNDHP64",18,0)
 ;   DHPCAT  - Health Factor Category
"RTN","SYNDHP64",19,0)
 ;   DHPCOD  - Code
"RTN","SYNDHP64",20,0)
 ;   DHPSYS  - Coding system (SNOMED CT or LOINC)
"RTN","SYNDHP64",21,0)
 ;   DHPDAT  - Date
"RTN","SYNDHP64",22,0)
 ;   DHPPRV  - Provider
"RTN","SYNDHP64",23,0)
 ;   DHPVST  - Visit number
"RTN","SYNDHP64",24,0)
 ;   DHPCOM  - Comment
"RTN","SYNDHP64",25,0)
 ;   DHPUCUM - UCUM code
"RTN","SYNDHP64",26,0)
 ;   DHPMAG  - Magnitude
"RTN","SYNDHP64",27,0)
 ;
"RTN","SYNDHP64",28,0)
 ; Output:   RETSTA
"RTN","SYNDHP64",29,0)
 ;  1 - success
"RTN","SYNDHP64",30,0)
 ; -1 - failure -1^message
"RTN","SYNDHP64",31,0)
 ;
"RTN","SYNDHP64",32,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" Q
"RTN","SYNDHP64",33,0)
 ;
"RTN","SYNDHP64",34,0)
 I $G(DHPSCT)="" S RETSTA="-1^SNOMED CT code is required" Q
"RTN","SYNDHP64",35,0)
 I $G(DHPVST)="" S RETSTA="-1^Visit IEN is required" Q
"RTN","SYNDHP64",36,0)
 ;
"RTN","SYNDHP64",37,0)
 ;
"RTN","SYNDHP64",38,0)
 ;S HDATA("LEVEL/SEVERITY")
"RTN","SYNDHP64",39,0)
 ; HDATA("EVENT D/T"))
"RTN","SYNDHP64",40,0)
 ; HDATA("ORD PROVIDER"))
"RTN","SYNDHP64",41,0)
 ; HDATA("ENC PROVIDER"))
"RTN","SYNDHP64",42,0)
 ;
"RTN","SYNDHP64",43,0)
 ;Magnitude and UCUM code
"RTN","SYNDHP64",44,0)
 ; HDATA("MAGNITUDE"))
"RTN","SYNDHP64",45,0)
 ; HDATA("COMMENT"))
"RTN","SYNDHP64",46,0)
 ;
"RTN","SYNDHP65")
0^51^B5073143
"RTN","SYNDHP65",1,0)
SYNDHP65 ;DHP/AFHIL -fjf - HealthConcourse - Write Procedures to VistA ; 12th Sept 2018
"RTN","SYNDHP65",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP65",3,0)
 ;;
"RTN","SYNDHP65",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP65",5,0)
 ;
"RTN","SYNDHP65",6,0)
PRCADD(RETSTA,DHPPAT,DHPVST,DHPCNT,DHPSCT,DHPDTM) ;Ingest Procedures
"RTN","SYNDHP65",7,0)
 ;
"RTN","SYNDHP65",8,0)
 ; Ingest Procedures into VistA
"RTN","SYNDHP65",9,0)
 ;
"RTN","SYNDHP65",10,0)
 ; Input:
"RTN","SYNDHP65",11,0)
 ;   DHPPAT   - patient ICN              (mandatory)
"RTN","SYNDHP65",12,0)
 ;   DHPVST   - Visit Identifier         (mandatory)
"RTN","SYNDHP65",13,0)
 ;   DHPCNT   - No of times performed    (mandatory)
"RTN","SYNDHP65",14,0)
 ;   DHPSCT   - SCT Procedure code       (mandatory)   
"RTN","SYNDHP65",15,0)
 ;   DHPDTM   - Procedure Date/Time      (mandatory) HL7 format
"RTN","SYNDHP65",16,0)
 ; Output:   
"RTN","SYNDHP65",17,0)
 ;   1 - success
"RTN","SYNDHP65",18,0)
 ;  -1 - failure
"RTN","SYNDHP65",19,0)
 ;
"RTN","SYNDHP65",20,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" Q
"RTN","SYNDHP65",21,0)
 ;
"RTN","SYNDHP65",22,0)
 I $G(DHPSCT)="" S RETSTA="-1^SNOMED CT code is required" Q
"RTN","SYNDHP65",23,0)
 I $G(DHPVST)="" S RETSTA="-1^Visit IEN is required" Q
"RTN","SYNDHP65",24,0)
 I '$D(^AUPNVSIT(DHPVST)) S RETSTA="-1^Visit not found" Q
"RTN","SYNDHP65",25,0)
 ;
"RTN","SYNDHP65",26,0)
 D INIT
"RTN","SYNDHP65",27,0)
 ;
"RTN","SYNDHP65",28,0)
 ; use SNOMED CT to OS5 mapping
"RTN","SYNDHP65",29,0)
 S MAPPING="sct2os5"
"RTN","SYNDHP65",30,0)
 ;
"RTN","SYNDHP65",31,0)
 S DHPOS5=$$MAP^SYNDHPMP(MAPPING,DHPSCT)
"RTN","SYNDHP65",32,0)
 I +DHPOS5'=1 S RETSTA="-1^Code "_DHPSCT_" not mapped" Q
"RTN","SYNDHP65",33,0)
 S DHPOS5=$P(DHPOS5,U,2)
"RTN","SYNDHP65",34,0)
 ;
"RTN","SYNDHP65",35,0)
 S PROCDATA("PROCEDURE",1,"PROCEDURE")=DHPOS5
"RTN","SYNDHP65",36,0)
 S PROCDATA("PROCEDURE",1,"QTY")=DHPCNT
"RTN","SYNDHP65",37,0)
 ;
"RTN","SYNDHP65",38,0)
 S DATFM=$$HL7TFM^XLFDT(DHPDTM)
"RTN","SYNDHP65",39,0)
 S PROCDATA("PROCEDURE",1,"EVENT D/T")=DATFM
"RTN","SYNDHP65",40,0)
 ;
"RTN","SYNDHP65",41,0)
 ;
"RTN","SYNDHP65",42,0)
 S RETSTA=1
"RTN","SYNDHP65",43,0)
 S RETSTA=$$DATA2PCE^PXAI("PROCDATA",PACKAGE,SOURCE,.DHPVST,USER,$G(ERRDISP),.ZZERR,$G(PPEDIT),.ZZERDESC,.ACCOUNT)
"RTN","SYNDHP65",44,0)
 ;I $D(ZZERR) ZWRITE ZZERR
"RTN","SYNDHP65",45,0)
 ;
"RTN","SYNDHP65",46,0)
 Q
"RTN","SYNDHP65",47,0)
 ;
"RTN","SYNDHP65",48,0)
INIT ; Initiate variables
"RTN","SYNDHP65",49,0)
 ;
"RTN","SYNDHP65",50,0)
 S PACKAGE=$$FIND1^DIC(9.4,,"","PCE")
"RTN","SYNDHP65",51,0)
 S SOURCE="DHP DATA INGEST"
"RTN","SYNDHP65",52,0)
 S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP65",53,0)
 S ERRDISP=""
"RTN","SYNDHP65",54,0)
 I $G(DEBUG)=1 S ERRDISP=1
"RTN","SYNDHP65",55,0)
 S PPEDIT=""
"RTN","SYNDHP65",56,0)
 S ACCOUNT=""
"RTN","SYNDHP65",57,0)
 S P="|"
"RTN","SYNDHP65",58,0)
 ;
"RTN","SYNDHP65",59,0)
 S ERRDISP=1 ;for testing only, set to null otherwise  <<<<<<<<<<<<<<<<<<<<<<<
"RTN","SYNDHP65",60,0)
 S PPEDIT=""
"RTN","SYNDHP65",61,0)
 S ACCOUNT=""
"RTN","SYNDHP65",62,0)
 ;
"RTN","SYNDHP65",63,0)
 Q
"RTN","SYNDHP65",64,0)
 ;
"RTN","SYNDHP65",65,0)
T1 ;
"RTN","SYNDHP65",66,0)
 D PRCADD(.ZXC,"5000000352V586511",20559,1,56876005,20151002)
"RTN","SYNDHP65",67,0)
 Q
"RTN","SYNDHP67")
0^12^B17235437
"RTN","SYNDHP67",1,0)
SYNDHP67 ; AFHIL/fjf/art - HealthConcourse - retrieve patient TIU notes ;05/07/2019
"RTN","SYNDHP67",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP67",3,0)
 ;;
"RTN","SYNDHP67",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP67",5,0)
 ;
"RTN","SYNDHP67",6,0)
PATTIUI(RETSTA,DHPICN,FRDAT,TODAT) ; Patient TIU Notes for ICN
"RTN","SYNDHP67",7,0)
 ;
"RTN","SYNDHP67",8,0)
 ; Return patient Text Integration Utility Notes for a given patient ICN
"RTN","SYNDHP67",9,0)
 ;
"RTN","SYNDHP67",10,0)
 ; Input:
"RTN","SYNDHP67",11,0)
 ;   ICN     - unique patient identifier across all VistA systems
"RTN","SYNDHP67",12,0)
 ;   FRDAT   - from date (inclusive), optional, compared to 1201 ENTRY DATE/TIME
"RTN","SYNDHP67",13,0)
 ;   TODAT   - to date (inclusive), optional, compared to 1201 ENTRY DATE/TIME
"RTN","SYNDHP67",14,0)
 ; Output:
"RTN","SYNDHP67",15,0)
 ;   RETSTA  - a delimited string that lists the following information
"RTN","SYNDHP67",16,0)
 ;      PatientICN~ResourceID|DateTime|NoteStatus|NoteConfidentiality
"RTN","SYNDHP67",17,0)
 ;        |NoteAuthor|NoteLine(1)^NoteLine(2)^NoteLine(3)...
"RTN","SYNDHP67",18,0)
 ;        ^NoteLine(n)^|LOINC Code_LOINC Name~...
"RTN","SYNDHP67",19,0)
 ;
"RTN","SYNDHP67",20,0)
 ;  Identifier will be "V"_SITE ID_FILE #_FILE IEN   i.e. V_500_8925_930
"RTN","SYNDHP67",21,0)
 ;
"RTN","SYNDHP67",22,0)
 S FRDAT=$S($G(FRDAT):$$HL7TFM^XLFDT(FRDAT),1:1000101)
"RTN","SYNDHP67",23,0)
 S TODAT=$S($G(TODAT):$$HL7TFM^XLFDT(TODAT),1:9991231)
"RTN","SYNDHP67",24,0)
 I $G(DEBUG) W !,"FRDAT: ",FRDAT,"   TODAT: ",TODAT,!
"RTN","SYNDHP67",25,0)
 I FRDAT>TODAT S RETSTA="-1^From date is greater than to date" QUIT
"RTN","SYNDHP67",26,0)
 ;
"RTN","SYNDHP67",27,0)
 ; validate ICN
"RTN","SYNDHP67",28,0)
 I $G(DHPICN)="" S RETSTA="-1^What patient?" QUIT
"RTN","SYNDHP67",29,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTA="-1^Patient identifier not recognised" Q
"RTN","SYNDHP67",30,0)
 ;
"RTN","SYNDHP67",31,0)
 N P,S,T,SITE,USER,PATIEN,NTS,NT,NTX,NTIEN,VID,NTSTA,NTDTMFM,NTDTM,NTAUTH,NCONF,NTLS,NTL
"RTN","SYNDHP67",32,0)
 S P="|",S="_",T="~"
"RTN","SYNDHP67",33,0)
 S U=$G(U,"^")
"RTN","SYNDHP67",34,0)
 I '$D(DT) S DT=$$DT^XLFDT
"RTN","SYNDHP67",35,0)
 S DUZ=$G(DUZ,1)
"RTN","SYNDHP67",36,0)
 S USER=$G(DUZ,1),DUZ("AG")="V"
"RTN","SYNDHP67",37,0)
 S SITE=$P($$SITE^VASITE,"^",3)
"RTN","SYNDHP67",38,0)
 ;
"RTN","SYNDHP67",39,0)
 ; get list of notes for patient
"RTN","SYNDHP67",40,0)
 S RETSTA=DHPICN
"RTN","SYNDHP67",41,0)
 S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP67",42,0)
 I PATIEN="" S RETSTA="-1^Internal data structure error" QUIT
"RTN","SYNDHP67",43,0)
 ;
"RTN","SYNDHP67",44,0)
 N ZXC
"RTN","SYNDHP67",45,0)
 D NOTES^TIUSRVLO(.ZXC,PATIEN,,,USER)
"RTN","SYNDHP67",46,0)
 ; now scan list for individual notes
"RTN","SYNDHP67",47,0)
 S NTS=$NA(@ZXC)
"RTN","SYNDHP67",48,0)
 S NT=0
"RTN","SYNDHP67",49,0)
 ; set generic LOINC code required by Azure implementation of FHIR
"RTN","SYNDHP67",50,0)
 N NTLOINC S NTLOINC="11506-3_Provider-unspecified Progress note"
"RTN","SYNDHP67",51,0)
 F  S NT=$O(@NTS@(NT)) Q:NT=""  D
"RTN","SYNDHP67",52,0)
 .I $E(RETSTA,$L(RETSTA))=U S RETSTA=$E(RETSTA,1,$L(RETSTA)-1)
"RTN","SYNDHP67",53,0)
 .S NTX=@NTS@(NT)
"RTN","SYNDHP67",54,0)
 .S NTIEN=$P(NTX,U)
"RTN","SYNDHP67",55,0)
 .S NTDTMFM=$$GET1^DIQ(8925,NTIEN_",",1201,"I")
"RTN","SYNDHP67",56,0)
 .QUIT:((NTDTMFM\1)<FRDAT)!((NTDTMFM\1)>TODAT)  ;quit if outside of requested date range
"RTN","SYNDHP67",57,0)
 .S RETSTA=RETSTA_T
"RTN","SYNDHP67",58,0)
 .S VID=$$RESID^SYNDHP69("V",SITE)_S_8925_S_NTIEN
"RTN","SYNDHP67",59,0)
 .S NTSTA=$P(NTX,U,7)
"RTN","SYNDHP67",60,0)
 .S NTSTA=$$NOTSTAT(NTSTA)
"RTN","SYNDHP67",61,0)
 .S NTDTM=$$FMTHL7^XLFDT(NTDTMFM)
"RTN","SYNDHP67",62,0)
 .S NTAUTH=$$GET1^DIQ(8925,NTIEN_",",1202,"I")
"RTN","SYNDHP67",63,0)
 .S NTAUTH=$$GET1^DIQ(200,NTAUTH_",",41.99)
"RTN","SYNDHP67",64,0)
 .; note confidentiality
"RTN","SYNDHP67",65,0)
 .S NCONF="N"
"RTN","SYNDHP67",66,0)
 .;W !,NT,"  -  ",NTSTA,!
"RTN","SYNDHP67",67,0)
 .S RETSTA=RETSTA_VID_P_NTDTM_P_NTSTA_P_NCONF_P_NTAUTH_P ;_NTLOINC_P
"RTN","SYNDHP67",68,0)
 .; now get note text
"RTN","SYNDHP67",69,0)
 .N ZXCV,NTLTX
"RTN","SYNDHP67",70,0)
 .D TGET^TIUSRVR1(.ZXCV,NTIEN)
"RTN","SYNDHP67",71,0)
 .;ZW @ZXCV
"RTN","SYNDHP67",72,0)
 .S NTLS=$NA(@ZXCV)
"RTN","SYNDHP67",73,0)
 .S NTL=0
"RTN","SYNDHP67",74,0)
 .F  S NTL=$O(@NTLS@(NTL)) Q:NTL=""  D
"RTN","SYNDHP67",75,0)
 ..S NTLTX=@NTLS@(NTL)
"RTN","SYNDHP67",76,0)
 ..S RETSTA=RETSTA_NTLTX_U
"RTN","SYNDHP67",77,0)
 .S RETSTA=RETSTA_P_NTLOINC_P
"RTN","SYNDHP67",78,0)
 Q
"RTN","SYNDHP67",79,0)
 ;
"RTN","SYNDHP67",80,0)
NOTSTAT(X) ; Note status mapping
"RTN","SYNDHP67",81,0)
 ; the VistA status must map to one of the following FHIR statii
"RTN","SYNDHP67",82,0)
 ;   preliminary | final | amended | entered-in-error
"RTN","SYNDHP67",83,0)
 ;
"RTN","SYNDHP67",84,0)
 ; X is External Status value (8925, .05) converted to lower case
"RTN","SYNDHP67",85,0)
 ;
"RTN","SYNDHP67",86,0)
 ;  statii from TIU(8925.6
"RTN","SYNDHP67",87,0)
 ;    1)="UNDICTATED^preliminary"
"RTN","SYNDHP67",88,0)
 ;    2)="UNTRANSCRIBED^preliminary"
"RTN","SYNDHP67",89,0)
 ;    3)="UNRELEASED^preliminary"
"RTN","SYNDHP67",90,0)
 ;    4)="UNVERIFIED^preliminary"
"RTN","SYNDHP67",91,0)
 ;    5)="UNSIGNED^preliminary"
"RTN","SYNDHP67",92,0)
 ;    6)="UNCOSIGNED^preliminary"
"RTN","SYNDHP67",93,0)
 ;    7)="COMPLETED^final"
"RTN","SYNDHP67",94,0)
 ;    8)="AMENDED^amended"
"RTN","SYNDHP67",95,0)
 ;    9)="PURGED^entered-in-error"
"RTN","SYNDHP67",96,0)
 ;    10)="TEST^entered-in-error"
"RTN","SYNDHP67",97,0)
 ;    11)="ACTIVE^preliminary"
"RTN","SYNDHP67",98,0)
 ;    13)="INACTIVE^preliminary"
"RTN","SYNDHP67",99,0)
 ;    14)="DELETED^enered-in-error"
"RTN","SYNDHP67",100,0)
 ;    15)="RETRACTED^entered-in-error"
"RTN","SYNDHP67",101,0)
 ;
"RTN","SYNDHP67",102,0)
 ;
"RTN","SYNDHP67",103,0)
 ; converted to values returned by TIU RPC
"RTN","SYNDHP67",104,0)
 ;
"RTN","SYNDHP67",105,0)
 N XNS
"RTN","SYNDHP67",106,0)
 S XNS("active")="preliminary"
"RTN","SYNDHP67",107,0)
 S XNS("amended")="amended"
"RTN","SYNDHP67",108,0)
 S XNS("completed")="final"
"RTN","SYNDHP67",109,0)
 S XNS("deleted")="enered-in-error"
"RTN","SYNDHP67",110,0)
 S XNS("inactive")="preliminary"
"RTN","SYNDHP67",111,0)
 S XNS("purged")="entered-in-error"
"RTN","SYNDHP67",112,0)
 S XNS("retracted")="entered-in-error"
"RTN","SYNDHP67",113,0)
 S XNS("test")="entered-in-error"
"RTN","SYNDHP67",114,0)
 S XNS("uncosigned")="preliminary"
"RTN","SYNDHP67",115,0)
 S XNS("undictated")="preliminary"
"RTN","SYNDHP67",116,0)
 S XNS("unreleased")="preliminary"
"RTN","SYNDHP67",117,0)
 S XNS("unsigned")="preliminary"
"RTN","SYNDHP67",118,0)
 S XNS("untranscribed")="preliminary"
"RTN","SYNDHP67",119,0)
 S XNS("unverified")="preliminary"
"RTN","SYNDHP67",120,0)
 ; 
"RTN","SYNDHP67",121,0)
 Q:$D(XNS(X)) $P(XNS(X),U)
"RTN","SYNDHP67",122,0)
 Q "error - composition status not recognised"
"RTN","SYNDHP67",123,0)
 ;
"RTN","SYNDHP67",124,0)
 ; ----------- Unit Test -----------
"RTN","SYNDHP67",125,0)
T1 ;
"RTN","SYNDHP67",126,0)
 N ZXC
"RTN","SYNDHP67",127,0)
 D PATTIUI(.ZXC,"5000000001V324625")
"RTN","SYNDHP67",128,0)
 Q
"RTN","SYNDHP67",129,0)
T2 ;
"RTN","SYNDHP67",130,0)
 N ZXS
"RTN","SYNDHP67",131,0)
 D PATTIUI(.ZXS,"11004V412157")
"RTN","SYNDHP67",132,0)
 Q
"RTN","SYNDHP67",133,0)
 ;
"RTN","SYNDHP67",134,0)
T3 ;
"RTN","SYNDHP67",135,0)
 N ICN S ICN="9009373208V847154"
"RTN","SYNDHP67",136,0)
 N FRDAT S FRDAT=""
"RTN","SYNDHP67",137,0)
 N TODAT S TODAT=""
"RTN","SYNDHP67",138,0)
 N RETSTA
"RTN","SYNDHP67",139,0)
 D PATTIUI(.RETSTA,ICN,FRDAT,TODAT)
"RTN","SYNDHP67",140,0)
 W $$ZW^SYNDHPUTL("RETSTA")
"RTN","SYNDHP67",141,0)
 QUIT
"RTN","SYNDHP67",142,0)
 ;
"RTN","SYNDHP69")
0^13^B4950282
"RTN","SYNDHP69",1,0)
SYNDHP69 ;AFHIL-DHP/fjf - HealthConcourse - Common Utility Functions
"RTN","SYNDHP69",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP69",3,0)
 ;;
"RTN","SYNDHP69",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP69",5,0)
 Q
"RTN","SYNDHP69",6,0)
 ;
"RTN","SYNDHP69",7,0)
DUZ() ; issues/set DUZ
"RTN","SYNDHP69",8,0)
 I '$D(DT) S DT=$$DT^XLFDT
"RTN","SYNDHP69",9,0)
 N VASITE S VASITE=$$SITE^VASITE
"RTN","SYNDHP69",10,0)
 N SITE S SITE=$P(VASITE,"^",3)
"RTN","SYNDHP69",11,0)
 S DUZ=$S(+$G(DUZ)=0:1,1:DUZ)
"RTN","SYNDHP69",12,0)
 S DUZ("AG")="V",DUZ(2)=+SITE ;'temporary' fix for lab accession
"RTN","SYNDHP69",13,0)
 Q DUZ
"RTN","SYNDHP69",14,0)
 ;
"RTN","SYNDHP69",15,0)
 ;
"RTN","SYNDHP69",16,0)
RESID(ENT,SITE) ; resource ID
"RTN","SYNDHP69",17,0)
 ; some rudimenatary validatation inputs
"RTN","SYNDHP69",18,0)
 ;
"RTN","SYNDHP69",19,0)
 N S
"RTN","SYNDHP69",20,0)
 S S="_"
"RTN","SYNDHP69",21,0)
 Q ENT_S_SITE_$$FACID
"RTN","SYNDHP69",22,0)
 ;
"RTN","SYNDHP69",23,0)
 ;
"RTN","SYNDHP69",24,0)
FACID() ; Get facility parameter to append to site
"RTN","SYNDHP69",25,0)
 ;
"RTN","SYNDHP69",26,0)
 N XPARSYS
"RTN","SYNDHP69",27,0)
 Q $$GET^XPAR("SYS","SYNDHPFAC",1)
"RTN","SYNDHP69",28,0)
 ;
"RTN","SYNDHP69",29,0)
 ;
"RTN","SYNDHP69",30,0)
GETFACID(RETSTA,X) ; Get facility parameter
"RTN","SYNDHP69",31,0)
 ;
"RTN","SYNDHP69",32,0)
 S RETSTA=$$FACID
"RTN","SYNDHP69",33,0)
 Q
"RTN","SYNDHP69",34,0)
 ;
"RTN","SYNDHP69",35,0)
FACPAR(RETSTA,DHPFAC) ; Setup/delete faciltity identification parameter
"RTN","SYNDHP69",36,0)
 ;
"RTN","SYNDHP69",37,0)
 ; Input:
"RTN","SYNDHP69",38,0)
 ;   DHPFAC - facility identifier
"RTN","SYNDHP69",39,0)
 ;     ER     - Emergency Room
"RTN","SYNDHP69",40,0)
 ;     HOSP   - Hospital
"RTN","SYNDHP69",41,0)
 ;     SCLIN  - Specialist Clinic
"RTN","SYNDHP69",42,0)
 ;     HS     - HealthShare
"RTN","SYNDHP69",43,0)
 ;     @      - delete
"RTN","SYNDHP69",44,0)
 ;   
"RTN","SYNDHP69",45,0)
 S RETSTA=0
"RTN","SYNDHP69",46,0)
 I "^ER^SCLIN^HOSP^HS^@"'[DHPFAC S RETSTA=0_"^error" Q
"RTN","SYNDHP69",47,0)
 I $$CKPRDF=0 S RETSTA=0_"^parameter definition error" Q
"RTN","SYNDHP69",48,0)
 ;
"RTN","SYNDHP69",49,0)
 ; add the parameter if it doesn't exist, or delete for FAC="@"
"RTN","SYNDHP69",50,0)
 K ZZERR
"RTN","SYNDHP69",51,0)
 D EN^XPAR("SYS","SYNDHPFAC",,DHPFAC,.ZZERR)
"RTN","SYNDHP69",52,0)
 S RETSTA='ZZERR
"RTN","SYNDHP69",53,0)
 Q
"RTN","SYNDHP69",54,0)
 ;
"RTN","SYNDHP69",55,0)
CKPRDF() ; Check that parameter definition exists for SYNDHPFAC
"RTN","SYNDHP69",56,0)
 ;       and it it doesn't exist, create it
"RTN","SYNDHP69",57,0)
 N FN,FDA,ZZERR
"RTN","SYNDHP69",58,0)
 S FN=8989.51
"RTN","SYNDHP69",59,0)
 I +$$FIND1^DIC(FN,,"MX","SYNDHPFAC")'=0 Q 1
"RTN","SYNDHP69",60,0)
 S FDA(FN,"+1,",.01)="SYNDHPFAC"
"RTN","SYNDHP69",61,0)
 S FDA(FN,"+1,",.02)="SYNDHP Facility Parameter"
"RTN","SYNDHP69",62,0)
 S FDA(FN,"+1,",1.1)="F"
"RTN","SYNDHP69",63,0)
 K ZZERR
"RTN","SYNDHP69",64,0)
 D UPDATE^DIE(,"FDA",,"ZZERR")
"RTN","SYNDHP69",65,0)
 Q '$D(ZZERR)
"RTN","SYNDHP69",66,0)
 ;
"RTN","SYNDHP69",67,0)
 ;
"RTN","SYNDHP69",68,0)
LOGRST(RETSTA) ; expunge ^VPRHTTP("log")
"RTN","SYNDHP69",69,0)
 ;
"RTN","SYNDHP69",70,0)
 N QT
"RTN","SYNDHP69",71,0)
 S QT=""""
"RTN","SYNDHP69",72,0)
 K ^VPRHTTP("log")
"RTN","SYNDHP69",73,0)
 S RETSTA="Mission accomplished - ^VPRHTTP("_QT_"log"_QT_")"_" annihilated"
"RTN","SYNDHP69",74,0)
 Q
"RTN","SYNDHP69",75,0)
 ;
"RTN","SYNDHP69",76,0)
 ;
"RTN","SYNDHP69",77,0)
TEST D EN^%ut($T(+0),1) QUIT
"RTN","SYNDHP69",78,0)
T1 ; @TEST HASHINFO^ORDEA previously crashed due to bad DUZ(2)
"RTN","SYNDHP69",79,0)
 S DUZ=$$DUZ()
"RTN","SYNDHP69",80,0)
 N ORY
"RTN","SYNDHP69",81,0)
 D HASHINFO^ORDEA(.ORY,1,$$PROV^SYNINIT)
"RTN","SYNDHP69",82,0)
 D SUCCEED^%ut
"RTN","SYNDHP69",83,0)
 QUIT
"RTN","SYNDHP69",84,0)
 ;
"RTN","SYNDHP73")
0^14^B176773227
"RTN","SYNDHP73",1,0)
SYNDHP73 ;AFHIL DHP/fjf/art - HealthConcourse - DHP REST handlers ;03/27/2019
"RTN","SYNDHP73",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP73",3,0)
 ;;
"RTN","SYNDHP73",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP73",5,0)
 ;  -------------------------------
"RTN","SYNDHP73",6,0)
 ;  Patient validate bridge routine
"RTN","SYNDHP73",7,0)
 ;  -------------------------------
"RTN","SYNDHP73",8,0)
 ;
"RTN","SYNDHP73",9,0)
PATVAL ; Verify patient on basis of name, SSN, DoB, Gender and Mother's Maiden name 
"RTN","SYNDHP73",10,0)
 ;parse out RPC call parameters from REST request
"RTN","SYNDHP73",11,0)
 ;  
"RTN","SYNDHP73",12,0)
 ;   DHPPATVAL
"RTN","SYNDHP73",13,0)
 ;
"RTN","SYNDHP73",14,0)
 ;S $ZT="^ZTER"
"RTN","SYNDHP73",15,0)
 D PARSEVAL
"RTN","SYNDHP73",16,0)
 ;
"RTN","SYNDHP73",17,0)
 D PATVAL^SYNDHP43(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPMMDNM)
"RTN","SYNDHP73",18,0)
 ; RETSTA is string returned by 
"RTN","SYNDHP73",19,0)
 ;S RETSTA="NOTHING SUCCEEDS LIKE A BUDGIE"
"RTN","SYNDHP73",20,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",21,0)
 ;
"RTN","SYNDHP73",22,0)
 Q
"RTN","SYNDHP73",23,0)
 ;
"RTN","SYNDHP73",24,0)
PARSEVAL ; 
"RTN","SYNDHP73",25,0)
 ;
"RTN","SYNDHP73",26,0)
 F I="SSN","DOB","GENDER","MMDNM" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",27,0)
 S DHPNAME=$$GETPARAM^RGNETWWW("NAME",1,1)
"RTN","SYNDHP73",28,0)
 S DHPNAME=DHPNAME_","_$$GETPARAM^RGNETWWW("NAME",1,2)_" "
"RTN","SYNDHP73",29,0)
 Q
"RTN","SYNDHP73",30,0)
 ;
"RTN","SYNDHP73",31,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",32,0)
 ;  Patient demographics by traits bridge routine
"RTN","SYNDHP73",33,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",34,0)
 ;
"RTN","SYNDHP73",35,0)
PATDEM ; get patient demographics for one patient
"RTN","SYNDHP73",36,0)
 ;
"RTN","SYNDHP73",37,0)
 ;   DHPPATDEM
"RTN","SYNDHP73",38,0)
 ;
"RTN","SYNDHP73",39,0)
 D PARSEDEM
"RTN","SYNDHP73",40,0)
 D PATDEM^SYNDHP47(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPJSON)
"RTN","SYNDHP73",41,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",42,0)
 Q
"RTN","SYNDHP73",43,0)
 ;
"RTN","SYNDHP73",44,0)
PARSEDEM ;
"RTN","SYNDHP73",45,0)
 ;
"RTN","SYNDHP73",46,0)
 F I="SSN","DOB","GENDER","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",47,0)
 S DHPNAME=$$GETPARAM^RGNETWWW("NAME",1,1)
"RTN","SYNDHP73",48,0)
 S DHPNAME=DHPNAME_","_$$GETPARAM^RGNETWWW("NAME",1,2)_" "
"RTN","SYNDHP73",49,0)
 Q
"RTN","SYNDHP73",50,0)
 ;
"RTN","SYNDHP73",51,0)
 ;  ------------------------------------------
"RTN","SYNDHP73",52,0)
 ;  Patient demographics by ICN bridge routine
"RTN","SYNDHP73",53,0)
 ;  ------------------------------------------
"RTN","SYNDHP73",54,0)
 ;
"RTN","SYNDHP73",55,0)
PATDEMI ; get patient demographics for one patient
"RTN","SYNDHP73",56,0)
 ;
"RTN","SYNDHP73",57,0)
 ;   DHPPATDEMICN
"RTN","SYNDHP73",58,0)
 ;
"RTN","SYNDHP73",59,0)
 D PARSEICN
"RTN","SYNDHP73",60,0)
 F I="JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",61,0)
 D PATDEMI^SYNDHP47(.RETSTA,DHPICN,DHPJSON)
"RTN","SYNDHP73",62,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",63,0)
 Q
"RTN","SYNDHP73",64,0)
 ;
"RTN","SYNDHP73",65,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",66,0)
 ;  All patient demographics by ICN="ALL" bridge routine
"RTN","SYNDHP73",67,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",68,0)
 ;
"RTN","SYNDHP73",69,0)
PATDEMAL ; get patient demographics for all patients
"RTN","SYNDHP73",70,0)
 ;
"RTN","SYNDHP73",71,0)
 ;   DHPPATDEMALL
"RTN","SYNDHP73",72,0)
 ;
"RTN","SYNDHP73",73,0)
 D PARSEICN
"RTN","SYNDHP73",74,0)
 F I="JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",75,0)
 D PATDEMAL^SYNDHP47(.RETSTA,DHPICN,DHPJSON)
"RTN","SYNDHP73",76,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",77,0)
 Q
"RTN","SYNDHP73",78,0)
 ;
"RTN","SYNDHP73",79,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",80,0)
 ;  All patient ICN's bridge routine
"RTN","SYNDHP73",81,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",82,0)
 ;
"RTN","SYNDHP73",83,0)
PATICNS ; get patient ICN for all patients
"RTN","SYNDHP73",84,0)
 ;
"RTN","SYNDHP73",85,0)
 ;   DHPPATICNALL
"RTN","SYNDHP73",86,0)
 ;
"RTN","SYNDHP73",87,0)
 F I="CNT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",88,0)
 D ICNS^SYNDHPIC(.RETSTA,DHPCNT,DHPJSON)
"RTN","SYNDHP73",89,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",90,0)
 Q
"RTN","SYNDHP73",91,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",92,0)
 ;  All patient demographics by ICN=range bridge routine
"RTN","SYNDHP73",93,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",94,0)
 ;
"RTN","SYNDHP73",95,0)
PATDEMRG ; get patient demographics for a range of patients
"RTN","SYNDHP73",96,0)
 ;
"RTN","SYNDHP73",97,0)
 ;   DHPPATDEMRNG
"RTN","SYNDHP73",98,0)
 ;
"RTN","SYNDHP73",99,0)
 D PARSEICN
"RTN","SYNDHP73",100,0)
 F I="JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",101,0)
 D PATDEMRNG^SYNDHP47(.RETSTA,DHPICN,DHPJSON)
"RTN","SYNDHP73",102,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",103,0)
 Q
"RTN","SYNDHP73",104,0)
 ;
"RTN","SYNDHP73",105,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",106,0)
 ;  Patient condition SCT codes by traits bridge routine
"RTN","SYNDHP73",107,0)
 ;  ----------------------------------------------------
"RTN","SYNDHP73",108,0)
 ;
"RTN","SYNDHP73",109,0)
PATCON ; get patient condition SCT codes for one patient by traits
"RTN","SYNDHP73",110,0)
 ;
"RTN","SYNDHP73",111,0)
 ;   DHPPATCON
"RTN","SYNDHP73",112,0)
 ;
"RTN","SYNDHP73",113,0)
 D PARSECON
"RTN","SYNDHP73",114,0)
 D PATCONDS^SYNDHP03(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER)
"RTN","SYNDHP73",115,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",116,0)
 Q
"RTN","SYNDHP73",117,0)
 ;
"RTN","SYNDHP73",118,0)
PARSECON ;
"RTN","SYNDHP73",119,0)
 ; 
"RTN","SYNDHP73",120,0)
 F I="SSN","DOB","GENDER" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",121,0)
 S DHPNAME=$$GETPARAM^RGNETWWW("NAME",1,1)
"RTN","SYNDHP73",122,0)
 S DHPNAME=DHPNAME_","_$$GETPARAM^RGNETWWW("NAME",1,2)_" "
"RTN","SYNDHP73",123,0)
 Q
"RTN","SYNDHP73",124,0)
 ;
"RTN","SYNDHP73",125,0)
 ;  ----------------------------------------
"RTN","SYNDHP73",126,0)
 ;  Patient conditions by ICN bridge routine
"RTN","SYNDHP73",127,0)
 ;  ----------------------------------------
"RTN","SYNDHP73",128,0)
 ;
"RTN","SYNDHP73",129,0)
PATCONI ; get patient conditions for one patient by ICN
"RTN","SYNDHP73",130,0)
 ;
"RTN","SYNDHP73",131,0)
 ;   DHPPATCONICN
"RTN","SYNDHP73",132,0)
 ;
"RTN","SYNDHP73",133,0)
 D PARSEICN
"RTN","SYNDHP73",134,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",135,0)
 D PATCONI^SYNDHP03(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",136,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",137,0)
 Q
"RTN","SYNDHP73",138,0)
 ;
"RTN","SYNDHP73",139,0)
 ;  --------------------------------------------------------
"RTN","SYNDHP73",140,0)
 ;  Patient encounters for one patient by ICN bridge routine
"RTN","SYNDHP73",141,0)
 ;  --------------------------------------------------------
"RTN","SYNDHP73",142,0)
 ;
"RTN","SYNDHP73",143,0)
PATENCI ; get patient encounters for one patient by ICN
"RTN","SYNDHP73",144,0)
 ;
"RTN","SYNDHP73",145,0)
 ;   DHPPATENCICN
"RTN","SYNDHP73",146,0)
 ;
"RTN","SYNDHP73",147,0)
 D PARSEICN
"RTN","SYNDHP73",148,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",149,0)
 D PATENCI^SYNDHP40(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",150,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",151,0)
 Q
"RTN","SYNDHP73",152,0)
 ;  
"RTN","SYNDHP73",153,0)
 ;  ---------------------------------------
"RTN","SYNDHP73",154,0)
 ;  Patients for a condition bridge routine
"RTN","SYNDHP73",155,0)
 ;  ---------------------------------------
"RTN","SYNDHP73",156,0)
 ;
"RTN","SYNDHP73",157,0)
PATCONAL ; get patients for a condition
"RTN","SYNDHP73",158,0)
 ;
"RTN","SYNDHP73",159,0)
 ;   DHPPATS4CON
"RTN","SYNDHP73",160,0)
 ;
"RTN","SYNDHP73",161,0)
 D PARSECONAL
"RTN","SYNDHP73",162,0)
 D PATCONAL^SYNDHP03(.RETSTA,DHPSCT)
"RTN","SYNDHP73",163,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",164,0)
 Q
"RTN","SYNDHP73",165,0)
 ;
"RTN","SYNDHP73",166,0)
PARSECONAL ; generalise
"RTN","SYNDHP73",167,0)
 ; 
"RTN","SYNDHP73",168,0)
 F I="SCT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",169,0)
 Q
"RTN","SYNDHP73",170,0)
 ;
"RTN","SYNDHP73",171,0)
 ;  --------------------------------------------------
"RTN","SYNDHP73",172,0)
 ;  Patient medication statement by ICN bridge routine
"RTN","SYNDHP73",173,0)
 ;  --------------------------------------------------
"RTN","SYNDHP73",174,0)
 ;
"RTN","SYNDHP73",175,0)
PATMEDS ; get patient medication statement for one patient by ICN
"RTN","SYNDHP73",176,0)
 ;
"RTN","SYNDHP73",177,0)
 ;   DHPPATMEDSICN
"RTN","SYNDHP73",178,0)
 ;
"RTN","SYNDHP73",179,0)
 D PARSEICN
"RTN","SYNDHP73",180,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",181,0)
 D PATMEDS^SYNDHP48(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",182,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",183,0)
 Q
"RTN","SYNDHP73",184,0)
 ;
"RTN","SYNDHP73",185,0)
 ;  -------------------------------------------------------
"RTN","SYNDHP73",186,0)
 ;  Patient medication administration by ICN bridge routine
"RTN","SYNDHP73",187,0)
 ;  -------------------------------------------------------
"RTN","SYNDHP73",188,0)
 ;
"RTN","SYNDHP73",189,0)
PATMEDA ; get patient medication administration for one patient by ICN
"RTN","SYNDHP73",190,0)
 ;
"RTN","SYNDHP73",191,0)
 ;   DHPPATMEDAICN
"RTN","SYNDHP73",192,0)
 ;
"RTN","SYNDHP73",193,0)
 D PARSEICN
"RTN","SYNDHP73",194,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",195,0)
 D PATMEDA^SYNDHP48(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",196,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",197,0)
 Q
"RTN","SYNDHP73",198,0)
 ;
"RTN","SYNDHP73",199,0)
 ;  -------------------------------------------------
"RTN","SYNDHP73",200,0)
 ;  Patient medication dispense by ICN bridge routine
"RTN","SYNDHP73",201,0)
 ;  -------------------------------------------------
"RTN","SYNDHP73",202,0)
 ;
"RTN","SYNDHP73",203,0)
PATMEDD ; get patient medication dispense for one patient by ICN
"RTN","SYNDHP73",204,0)
 ;
"RTN","SYNDHP73",205,0)
 ;   DHPPATMEDDICN
"RTN","SYNDHP73",206,0)
 ;
"RTN","SYNDHP73",207,0)
 D PARSEICN
"RTN","SYNDHP73",208,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",209,0)
 D PATMEDD^SYNDHP48(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",210,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",211,0)
 Q
"RTN","SYNDHP73",212,0)
 ;
"RTN","SYNDHP73",213,0)
 ;  ---------------------------------------
"RTN","SYNDHP73",214,0)
 ;  Patient vitals by traits bridge routine
"RTN","SYNDHP73",215,0)
 ;  ---------------------------------------
"RTN","SYNDHP73",216,0)
 ;
"RTN","SYNDHP73",217,0)
PATVIT ; get patient vitals for one patient by traits
"RTN","SYNDHP73",218,0)
 ;
"RTN","SYNDHP73",219,0)
 ;   DHPPATVIT
"RTN","SYNDHP73",220,0)
 ;
"RTN","SYNDHP73",221,0)
 D PARSEVIT
"RTN","SYNDHP73",222,0)
 D PATVIT^SYNDHP01(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",223,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",224,0)
 Q
"RTN","SYNDHP73",225,0)
 ;
"RTN","SYNDHP73",226,0)
 ;
"RTN","SYNDHP73",227,0)
PARSEVIT ;
"RTN","SYNDHP73",228,0)
 ;
"RTN","SYNDHP73",229,0)
 F I="SSN","DOB","GENDER","FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",230,0)
 S DHPNAME=$$GETPARAM^RGNETWWW("NAME",1,1)
"RTN","SYNDHP73",231,0)
 S DHPNAME=DHPNAME_","_$$GETPARAM^RGNETWWW("NAME",1,2)_" "
"RTN","SYNDHP73",232,0)
 Q
"RTN","SYNDHP73",233,0)
 ;
"RTN","SYNDHP73",234,0)
 ;  ------------------------------------
"RTN","SYNDHP73",235,0)
 ;  Patient vitals by ICN bridge routine
"RTN","SYNDHP73",236,0)
 ;  ------------------------------------
"RTN","SYNDHP73",237,0)
 ;
"RTN","SYNDHP73",238,0)
PATVITI ; get patient vitals for one patient by ICN
"RTN","SYNDHP73",239,0)
 ;
"RTN","SYNDHP73",240,0)
 ;   DHPPATVITICN
"RTN","SYNDHP73",241,0)
 ;
"RTN","SYNDHP73",242,0)
 D PARSEICN
"RTN","SYNDHP73",243,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",244,0)
 D PATVITI^SYNDHP01(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",245,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",246,0)
 Q
"RTN","SYNDHP73",247,0)
 ;
"RTN","SYNDHP73",248,0)
 ;  -----------------------------------------------
"RTN","SYNDHP73",249,0)
 ;  Patient health factors by traits bridge routine
"RTN","SYNDHP73",250,0)
 ;  -----------------------------------------------
"RTN","SYNDHP73",251,0)
 ;
"RTN","SYNDHP73",252,0)
PATHLF ; get patient health factors for one patient
"RTN","SYNDHP73",253,0)
 ;
"RTN","SYNDHP73",254,0)
 ;   DHPPATHLF
"RTN","SYNDHP73",255,0)
 ;
"RTN","SYNDHP73",256,0)
 D PARSETRAITS
"RTN","SYNDHP73",257,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",258,0)
 D PATHLF^SYNDHP09(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",259,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",260,0)
 Q
"RTN","SYNDHP73",261,0)
 ;
"RTN","SYNDHP73",262,0)
 ;  --------------------------------------------
"RTN","SYNDHP73",263,0)
 ;  Patient health factors by ICN bridge routine
"RTN","SYNDHP73",264,0)
 ;  --------------------------------------------
"RTN","SYNDHP73",265,0)
 ;
"RTN","SYNDHP73",266,0)
PATHLFI ; get patient health factors for one patient
"RTN","SYNDHP73",267,0)
 ;
"RTN","SYNDHP73",268,0)
 ;   DHPPATHLFICN
"RTN","SYNDHP73",269,0)
 ;
"RTN","SYNDHP73",270,0)
 D PARSEICN
"RTN","SYNDHP73",271,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",272,0)
 D PATHLFI^SYNDHP09(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",273,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",274,0)
 Q
"RTN","SYNDHP73",275,0)
 ;
"RTN","SYNDHP73",276,0)
 ;  -------------------------------------------
"RTN","SYNDHP73",277,0)
 ;  Patient procedures by traits bridge routine
"RTN","SYNDHP73",278,0)
 ;  -------------------------------------------
"RTN","SYNDHP73",279,0)
 ;
"RTN","SYNDHP73",280,0)
PATPRC ; get patient procedures for one patient
"RTN","SYNDHP73",281,0)
 ;
"RTN","SYNDHP73",282,0)
 ;   DHPPATPRC
"RTN","SYNDHP73",283,0)
 ;
"RTN","SYNDHP73",284,0)
 D PARSETRAITS
"RTN","SYNDHP73",285,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",286,0)
 D PATPRC^SYNDHP04(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",287,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",288,0)
 Q
"RTN","SYNDHP73",289,0)
 ;
"RTN","SYNDHP73",290,0)
 ;  ----------------------------------------
"RTN","SYNDHP73",291,0)
 ;  Patient procedures by ICN bridge routine
"RTN","SYNDHP73",292,0)
 ;  ----------------------------------------
"RTN","SYNDHP73",293,0)
 ;
"RTN","SYNDHP73",294,0)
PATPRCI ; get patient procedures for one patient
"RTN","SYNDHP73",295,0)
 ;
"RTN","SYNDHP73",296,0)
 ;   DHPPATPRCICN
"RTN","SYNDHP73",297,0)
 ;
"RTN","SYNDHP73",298,0)
 D PARSEICN
"RTN","SYNDHP73",299,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",300,0)
 D PATPRCI^SYNDHP04(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",301,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",302,0)
 Q
"RTN","SYNDHP73",303,0)
 ;
"RTN","SYNDHP73",304,0)
 ;  ---------------------------------------
"RTN","SYNDHP73",305,0)
 ;  Patient allergies by ICN bridge routine
"RTN","SYNDHP73",306,0)
 ;  ---------------------------------------
"RTN","SYNDHP73",307,0)
 ;
"RTN","SYNDHP73",308,0)
PATALLI ; get patient allergies for one patient by ICN
"RTN","SYNDHP73",309,0)
 ;
"RTN","SYNDHP73",310,0)
 ;   DHPPATALLICN
"RTN","SYNDHP73",311,0)
 ;
"RTN","SYNDHP73",312,0)
 D PARSEICN
"RTN","SYNDHP73",313,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",314,0)
 D PATALLI^SYNDHP57(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",315,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",316,0)
 Q
"RTN","SYNDHP73",317,0)
 ;
"RTN","SYNDHP73",318,0)
 ;  -----------------------------------------------
"RTN","SYNDHP73",319,0)
 ;  Patient diagnostic report by ICN bridge routine
"RTN","SYNDHP73",320,0)
 ;  -----------------------------------------------
"RTN","SYNDHP73",321,0)
 ;
"RTN","SYNDHP73",322,0)
PATDXREP ; get patient diagnostic report for one patient by ICN
"RTN","SYNDHP73",323,0)
 ;
"RTN","SYNDHP73",324,0)
 ;   DHPPATDXRICN
"RTN","SYNDHP73",325,0)
 ;
"RTN","SYNDHP73",326,0)
 D PARSEICN
"RTN","SYNDHP73",327,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",328,0)
 D PATDXRI^SYNDHP05(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",329,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",330,0)
 Q
"RTN","SYNDHP73",331,0)
 ;
"RTN","SYNDHP73",332,0)
 ;  -------------------------------------
"RTN","SYNDHP73",333,0)
 ;  Patient labs by traits bridge routine
"RTN","SYNDHP73",334,0)
 ;  -------------------------------------
"RTN","SYNDHP73",335,0)
 ;
"RTN","SYNDHP73",336,0)
PATLAB ; get patient labs for one patient
"RTN","SYNDHP73",337,0)
 ;
"RTN","SYNDHP73",338,0)
 ;   DHPPATLAB
"RTN","SYNDHP73",339,0)
 ;
"RTN","SYNDHP73",340,0)
 D PARSETRAITS
"RTN","SYNDHP73",341,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",342,0)
 D PATLAB^SYNDHP53(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",343,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",344,0)
 Q
"RTN","SYNDHP73",345,0)
 ;
"RTN","SYNDHP73",346,0)
 ;  ----------------------------------
"RTN","SYNDHP73",347,0)
 ;  Patient labs by ICN bridge routine
"RTN","SYNDHP73",348,0)
 ;  ----------------------------------
"RTN","SYNDHP73",349,0)
 ;
"RTN","SYNDHP73",350,0)
PATLABI ; get patient labs for one patient
"RTN","SYNDHP73",351,0)
 ;
"RTN","SYNDHP73",352,0)
 ;   DHPPATLABICN
"RTN","SYNDHP73",353,0)
 ;
"RTN","SYNDHP73",354,0)
 D PARSEICN
"RTN","SYNDHP73",355,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",356,0)
 D PATLABI^SYNDHP53(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",357,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",358,0)
 Q
"RTN","SYNDHP73",359,0)
 ;
"RTN","SYNDHP73",360,0)
 ;  -------------------------------------------
"RTN","SYNDHP73",361,0)
 ;  Patient Enc Providers by ICN bridge routine
"RTN","SYNDHP73",362,0)
 ;  -------------------------------------------
"RTN","SYNDHP73",363,0)
 ;
"RTN","SYNDHP73",364,0)
PATPRVI ; get patient encounter providers for one patient
"RTN","SYNDHP73",365,0)
 ;
"RTN","SYNDHP73",366,0)
 ;   DHPPATPRVICN
"RTN","SYNDHP73",367,0)
 ;
"RTN","SYNDHP73",368,0)
 D PARSEICN
"RTN","SYNDHP73",369,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",370,0)
 D PATPRVI^SYNDHP54(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",371,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",372,0)
 Q
"RTN","SYNDHP73",373,0)
 ;  ------------------------------------------
"RTN","SYNDHP73",374,0)
 ;  Patient Appointments by ICN bridge routine
"RTN","SYNDHP73",375,0)
 ;  ------------------------------------------
"RTN","SYNDHP73",376,0)
 ;
"RTN","SYNDHP73",377,0)
PATAPTI ; get patient appointments for one patient
"RTN","SYNDHP73",378,0)
 ;
"RTN","SYNDHP73",379,0)
 ;   DHPPATAPTICN
"RTN","SYNDHP73",380,0)
 ;
"RTN","SYNDHP73",381,0)
 D PARSEICN
"RTN","SYNDHP73",382,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",383,0)
 D PATAPTI^SYNDHP41(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",384,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",385,0)
 Q
"RTN","SYNDHP73",386,0)
 ;
"RTN","SYNDHP73",387,0)
 ;  -----------------------------------
"RTN","SYNDHP73",388,0)
 ;  Patient Flags by ICN bridge routine
"RTN","SYNDHP73",389,0)
 ;  -----------------------------------
"RTN","SYNDHP73",390,0)
 ;
"RTN","SYNDHP73",391,0)
PATFLGI ; get patient flags for one patient
"RTN","SYNDHP73",392,0)
 ;
"RTN","SYNDHP73",393,0)
 ;   DHPPATFLGICN
"RTN","SYNDHP73",394,0)
 ;
"RTN","SYNDHP73",395,0)
 D PARSEICN
"RTN","SYNDHP73",396,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",397,0)
 D PATFLGI^SYNDHP08(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",398,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",399,0)
 Q
"RTN","SYNDHP73",400,0)
 ;
"RTN","SYNDHP73",401,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",402,0)
 ;  Patient Immunizations by ICN bridge routine
"RTN","SYNDHP73",403,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",404,0)
 ;
"RTN","SYNDHP73",405,0)
PATIMMI ; get patient immunizations for one patient
"RTN","SYNDHP73",406,0)
 ;
"RTN","SYNDHP73",407,0)
 ;   DHPPATIMMICN
"RTN","SYNDHP73",408,0)
 ;
"RTN","SYNDHP73",409,0)
 D PARSEICN
"RTN","SYNDHP73",410,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",411,0)
 D PATIMMI^SYNDHP02(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",412,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",413,0)
 Q
"RTN","SYNDHP73",414,0)
 ;
"RTN","SYNDHP73",415,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",416,0)
 ;  Patient Goals by ICN bridge routine
"RTN","SYNDHP73",417,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",418,0)
 ;
"RTN","SYNDHP73",419,0)
PATGOLI ; get patient goals for one patient
"RTN","SYNDHP73",420,0)
 ;
"RTN","SYNDHP73",421,0)
 ;   DHPPATGOLICN
"RTN","SYNDHP73",422,0)
 ;
"RTN","SYNDHP73",423,0)
 D PARSEICN
"RTN","SYNDHP73",424,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",425,0)
 D PATGOLI^SYNDHP07(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",426,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",427,0)
 Q
"RTN","SYNDHP73",428,0)
 ;
"RTN","SYNDHP73",429,0)
 ;
"RTN","SYNDHP73",430,0)
 ;  -----------------------------------------------
"RTN","SYNDHP73",431,0)
 ;  Patient observations by traits bridge routine
"RTN","SYNDHP73",432,0)
 ;  -----------------------------------------------
"RTN","SYNDHP73",433,0)
 ;
"RTN","SYNDHP73",434,0)
PATOBS ; get patient observations for one patient
"RTN","SYNDHP73",435,0)
 ;
"RTN","SYNDHP73",436,0)
 ;   DHPPATOBS
"RTN","SYNDHP73",437,0)
 ;
"RTN","SYNDHP73",438,0)
 D PARSETRAITS
"RTN","SYNDHP73",439,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",440,0)
 D PATOBS^SYNDHP56(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",441,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",442,0)
 Q
"RTN","SYNDHP73",443,0)
 ;
"RTN","SYNDHP73",444,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",445,0)
 ;  Patient observations by ICN bridge routine
"RTN","SYNDHP73",446,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",447,0)
 ;
"RTN","SYNDHP73",448,0)
PATOBSI ; get patient observations for one patient
"RTN","SYNDHP73",449,0)
 ;
"RTN","SYNDHP73",450,0)
 ;   DHPPATOBSICN
"RTN","SYNDHP73",451,0)
 ;
"RTN","SYNDHP73",452,0)
 D PARSEICN
"RTN","SYNDHP73",453,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",454,0)
 D PATOBSI^SYNDHP56(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",455,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",456,0)
 Q
"RTN","SYNDHP73",457,0)
 ;
"RTN","SYNDHP73",458,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",459,0)
 ;  Get one care team bridge routine
"RTN","SYNDHP73",460,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",461,0)
 ;
"RTN","SYNDHP73",462,0)
CARETEAM ; get one care team
"RTN","SYNDHP73",463,0)
 ;
"RTN","SYNDHP73",464,0)
 ;   DHPCARETEAM
"RTN","SYNDHP73",465,0)
 ;
"RTN","SYNDHP73",466,0)
 F I="TEAM","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",467,0)
 D GETTEAM^SYNDHP58(.RETSTA,DHPTEAM,DHPJSON)
"RTN","SYNDHP73",468,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",469,0)
 Q
"RTN","SYNDHP73",470,0)
 ;
"RTN","SYNDHP73",471,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",472,0)
 ;  Get all care teams bridge routine
"RTN","SYNDHP73",473,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",474,0)
 ;
"RTN","SYNDHP73",475,0)
CARETEAMS ; get all care teams
"RTN","SYNDHP73",476,0)
 ;
"RTN","SYNDHP73",477,0)
 ;   DHPCARETEAMS
"RTN","SYNDHP73",478,0)
 ;
"RTN","SYNDHP73",479,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",480,0)
 D GETTEAMS^SYNDHP58(.RETSTA,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",481,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",482,0)
 Q
"RTN","SYNDHP73",483,0)
 ;
"RTN","SYNDHP73",484,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",485,0)
 ;  get Care Plans for a patient by traits bridge routine
"RTN","SYNDHP73",486,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",487,0)
 ;
"RTN","SYNDHP73",488,0)
PATCPALL ; get all care plans
"RTN","SYNDHP73",489,0)
 ;
"RTN","SYNDHP73",490,0)
 ;   DHPPATCPALL
"RTN","SYNDHP73",491,0)
 ;
"RTN","SYNDHP73",492,0)
 D PARSETRAITS
"RTN","SYNDHP73",493,0)
 F I="FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",494,0)
 D PATCPALL^SYNDHP59(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",495,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",496,0)
 Q
"RTN","SYNDHP73",497,0)
 ;
"RTN","SYNDHP73",498,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",499,0)
 ;  get Care Plans for a patient by ICN bridge routine
"RTN","SYNDHP73",500,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",501,0)
 ;
"RTN","SYNDHP73",502,0)
PATCPALLI ; get all care plans for a patient
"RTN","SYNDHP73",503,0)
 ;
"RTN","SYNDHP73",504,0)
 ;   DHPPATCPALLI
"RTN","SYNDHP73",505,0)
 ;
"RTN","SYNDHP73",506,0)
 F I="ICN","FRDAT","TODAT","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",507,0)
 D PATCPALLI^SYNDHP59(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHP73",508,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",509,0)
 Q
"RTN","SYNDHP73",510,0)
 ;
"RTN","SYNDHP73",511,0)
 ;  --------------------------------------------------------
"RTN","SYNDHP73",512,0)
 ;  get one Care Plan for a patient by traits bridge routine
"RTN","SYNDHP73",513,0)
 ;  --------------------------------------------------------
"RTN","SYNDHP73",514,0)
 ;
"RTN","SYNDHP73",515,0)
PATCP ; get one care plan for a patient
"RTN","SYNDHP73",516,0)
 ;
"RTN","SYNDHP73",517,0)
 ;   DHPPATCP
"RTN","SYNDHP73",518,0)
 ;
"RTN","SYNDHP73",519,0)
 D PARSETRAITS
"RTN","SYNDHP73",520,0)
 F I="VRESID","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",521,0)
 D PATCP^SYNDHP59(.RETSTA,DHPNAME,DHPSSN,DHPDOB,DHPGENDER,DHPVRESID,DHPJSON)
"RTN","SYNDHP73",522,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",523,0)
 Q
"RTN","SYNDHP73",524,0)
 ;
"RTN","SYNDHP73",525,0)
 ;  --------------------------------------------------------
"RTN","SYNDHP73",526,0)
 ;  get one Care Plan for a patient by ICN bridge routine
"RTN","SYNDHP73",527,0)
 ;  --------------------------------------------------------
"RTN","SYNDHP73",528,0)
 ;
"RTN","SYNDHP73",529,0)
PATCPI ; get one care plan for a patient
"RTN","SYNDHP73",530,0)
 ;
"RTN","SYNDHP73",531,0)
 ;   DHPPATCPI
"RTN","SYNDHP73",532,0)
 ;
"RTN","SYNDHP73",533,0)
 F I="ICN","VRESID","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",534,0)
 D PATCPI^SYNDHP59(.RETSTA,DHPICN,DHPVRESID,DHPJSON)
"RTN","SYNDHP73",535,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",536,0)
 Q
"RTN","SYNDHP73",537,0)
 ;
"RTN","SYNDHP73",538,0)
 ;  ----------------------------------------------
"RTN","SYNDHP73",539,0)
 ;  Institution Information by HLOC bridge routine
"RTN","SYNDHP73",540,0)
 ;  ----------------------------------------------
"RTN","SYNDHP73",541,0)
 ; 
"RTN","SYNDHP73",542,0)
HLOCINST ; get institution information for hospital location name
"RTN","SYNDHP73",543,0)
 ;
"RTN","SYNDHP73",544,0)
 ;    DHPHLOCINSTHLOCNAM
"RTN","SYNDHP73",545,0)
 ;
"RTN","SYNDHP73",546,0)
 D PARSEHLC
"RTN","SYNDHP73",547,0)
 D HOSINSTI^SYNDHP06(.RETSTA,DHPHLOC,DHPJSON)
"RTN","SYNDHP73",548,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",549,0)
 Q
"RTN","SYNDHP73",550,0)
 ;
"RTN","SYNDHP73",551,0)
PARSEHLC ; Hospital Location Name PARSER
"RTN","SYNDHP73",552,0)
 ;
"RTN","SYNDHP73",553,0)
 F I="HLOC","JSON" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",554,0)
 Q
"RTN","SYNDHP73",555,0)
 ;
"RTN","SYNDHP73",556,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",557,0)
 ;  Text Integration Utility (TIU) bridge routine
"RTN","SYNDHP73",558,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",559,0)
 ;
"RTN","SYNDHP73",560,0)
PATTIUI ; get patient notes for one patient by ICN
"RTN","SYNDHP73",561,0)
 ;
"RTN","SYNDHP73",562,0)
 ;   DHPPATTIUICN
"RTN","SYNDHP73",563,0)
 ;
"RTN","SYNDHP73",564,0)
 D PARSEICN
"RTN","SYNDHP73",565,0)
 F I="FRDAT","TODAT" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",566,0)
 D PATTIUI^SYNDHP67(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHP73",567,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",568,0)
 Q
"RTN","SYNDHP73",569,0)
 ;
"RTN","SYNDHP73",570,0)
 ;  --------------------------------------------------
"RTN","SYNDHP73",571,0)
 ;  get record specified by resource ID bridge routine
"RTN","SYNDHP73",572,0)
 ;  --------------------------------------------------
"RTN","SYNDHP73",573,0)
 ;
"RTN","SYNDHP73",574,0)
GETRESID ; get record specified by resource ID
"RTN","SYNDHP73",575,0)
 ;
"RTN","SYNDHP73",576,0)
 ;   DHPGETRESID
"RTN","SYNDHP73",577,0)
 ;
"RTN","SYNDHP73",578,0)
 F I="RESID" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",579,0)
 D GETREC^SYNDHP99(.RETSTA,DHPRESID)
"RTN","SYNDHP73",580,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",581,0)
 Q
"RTN","SYNDHP73",582,0)
 ;
"RTN","SYNDHP73",583,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",584,0)
 ;  Mappings bridge routine
"RTN","SYNDHP73",585,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",586,0)
 ;
"RTN","SYNDHP73",587,0)
MAPSVC ; get mapped code for a given source and code
"RTN","SYNDHP73",588,0)
 ;
"RTN","SYNDHP73",589,0)
 ;   DHPMAPSVC
"RTN","SYNDHP73",590,0)
 ;
"RTN","SYNDHP73",591,0)
 D PARSEMAP
"RTN","SYNDHP73",592,0)
 D MAPSVC^SYNDHP83(.RETSTA,DHPMAP,DHPCODE,DHPDIR,DHPIOE)
"RTN","SYNDHP73",593,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",594,0)
 Q
"RTN","SYNDHP73",595,0)
 ;
"RTN","SYNDHP73",596,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",597,0)
 ;  Facility Suffix Parameter bridge routine
"RTN","SYNDHP73",598,0)
 ;  ---------------------------------------------
"RTN","SYNDHP73",599,0)
 ;
"RTN","SYNDHP73",600,0)
SYSFAC ; get system facility  suffix parameter
"RTN","SYNDHP73",601,0)
 ;
"RTN","SYNDHP73",602,0)
 ;   DHPSYSFACUPD
"RTN","SYNDHP73",603,0)
 ;
"RTN","SYNDHP73",604,0)
 S DHPFAC="DHP"_$$GETPARAM^RGNETWWW(1)
"RTN","SYNDHP73",605,0)
 D GETFACID^SYNDHP69(.RETSTA,DHPFAC)
"RTN","SYNDHP73",606,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",607,0)
 Q 
"RTN","SYNDHP73",608,0)
 ;
"RTN","SYNDHP73",609,0)
LOGRST ; expunge VPRHTTP("log"
"RTN","SYNDHP73",610,0)
 ;
"RTN","SYNDHP73",611,0)
 ;   DHPVPRLOGRST
"RTN","SYNDHP73",612,0)
 ;
"RTN","SYNDHP73",613,0)
 D LOGRST^SYNDHP69(.RETSTA)
"RTN","SYNDHP73",614,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP73",615,0)
 Q 
"RTN","SYNDHP73",616,0)
 ;
"RTN","SYNDHP73",617,0)
 ;  -------------------------------------
"RTN","SYNDHP73",618,0)
 ;
"RTN","SYNDHP73",619,0)
PARSEICN ; ICN PARSER
"RTN","SYNDHP73",620,0)
 ; 
"RTN","SYNDHP73",621,0)
 F I="ICN" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",622,0)
 Q
"RTN","SYNDHP73",623,0)
 ;
"RTN","SYNDHP73",624,0)
PARSETRAITS ; Traits parser
"RTN","SYNDHP73",625,0)
 ;
"RTN","SYNDHP73",626,0)
 F I="SSN","DOB","GENDER" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",627,0)
 S DHPNAME=$$GETPARAM^RGNETWWW("NAME",1,1)
"RTN","SYNDHP73",628,0)
 S DHPNAME=DHPNAME_","_$$GETPARAM^RGNETWWW("NAME",1,2)_" "
"RTN","SYNDHP73",629,0)
 Q
"RTN","SYNDHP73",630,0)
 ;
"RTN","SYNDHP73",631,0)
PARSEMAP ; Map parser
"RTN","SYNDHP73",632,0)
 ;
"RTN","SYNDHP73",633,0)
 F I="MAP","CODE","DIR","IOE" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP73",634,0)
 Q
"RTN","SYNDHP79")
0^15^B29692023
"RTN","SYNDHP79",1,0)
SYNDHP79 ; HC/fjf/art - HealthConcourse - DHP REST handlers ;03/27/2019
"RTN","SYNDHP79",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP79",3,0)
 ;;
"RTN","SYNDHP79",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP79",5,0)
 ; 
"RTN","SYNDHP79",6,0)
 ;  -------------------------------------------
"RTN","SYNDHP79",7,0)
 ;  Save patient vitals to VistA bridge routine
"RTN","SYNDHP79",8,0)
 ;  -------------------------------------------
"RTN","SYNDHP79",9,0)
 ;
"RTN","SYNDHP79",10,0)
PATVITSV ; save patient vitals for one patient to VistA
"RTN","SYNDHP79",11,0)
 ;
"RTN","SYNDHP79",12,0)
 ;   DHPPATVITPST
"RTN","SYNDHP79",13,0)
 ;
"RTN","SYNDHP79",14,0)
 ;CRASH
"RTN","SYNDHP79",15,0)
 D PARSEVITU
"RTN","SYNDHP79",16,0)
 D VITUPD^SYNDHP61(.RETSTA,DHPICN,DHPSCT,DHPOBS,DHPUNT,DHPDTM)
"RTN","SYNDHP79",17,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",18,0)
 Q
"RTN","SYNDHP79",19,0)
 ;
"RTN","SYNDHP79",20,0)
 ;
"RTN","SYNDHP79",21,0)
PARSEVITU ;
"RTN","SYNDHP79",22,0)
 ;
"RTN","SYNDHP79",23,0)
 S C=",",L=":"
"RTN","SYNDHP79",24,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",25,0)
 ;CRASH
"RTN","SYNDHP79",26,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",27,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",28,0)
 F I="ICN","SCT","OBS","UNT","DTM" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",29,0)
 ;S ^ZZFJF(99)=DHPICN_"^"_DHPSCT_"^"_DHPOBS_"^"_DHPUNT_"^"_DHPDTM
"RTN","SYNDHP79",30,0)
 Q
"RTN","SYNDHP79",31,0)
 ;
"RTN","SYNDHP79",32,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",33,0)
 ;
"RTN","SYNDHP79",34,0)
PATPRBSVX ; - old save patient problems for one patient to VistA
"RTN","SYNDHP79",35,0)
 ; >>>>>> THIS IS OLD CODE <<<<<<<
"RTN","SYNDHP79",36,0)
 ; >>>>>> SEE PATPRBSV BELOW <<<<<<<
"RTN","SYNDHP79",37,0)
 ;
"RTN","SYNDHP79",38,0)
 ;   DHPPATPRBUPD
"RTN","SYNDHP79",39,0)
 ;
"RTN","SYNDHP79",40,0)
 ;CRASH
"RTN","SYNDHP79",41,0)
 D PARSEPUPD
"RTN","SYNDHP79",42,0)
 D PROBUPD^SYNDHP61(.RETSTA,DHPICN,DHPSCT,DHPDES,DHPROV,DHPDTM,DHPRID)
"RTN","SYNDHP79",43,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",44,0)
 Q
"RTN","SYNDHP79",45,0)
 ;
"RTN","SYNDHP79",46,0)
 ;
"RTN","SYNDHP79",47,0)
PARSEPUPDX ;
"RTN","SYNDHP79",48,0)
 ;
"RTN","SYNDHP79",49,0)
 S C=",",L=":"
"RTN","SYNDHP79",50,0)
 D SYNDHPLOG($H)
"RTN","SYNDHP79",51,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",52,0)
 I $L(PARAMS,L)=1 S C="&",L="="
"RTN","SYNDHP79",53,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",54,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",55,0)
 F I="ICN","SCT","DES","ROV","DTM","RID" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",56,0)
 ;S ^ZZFJF(99)=DHPICN_"^"_DHPSCT_"^"_DHPOBS_"^"_DHPUNT_"^"_DHPDTM
"RTN","SYNDHP79",57,0)
 Q
"RTN","SYNDHP79",58,0)
 ;
"RTN","SYNDHP79",59,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",60,0)
 ;
"RTN","SYNDHP79",61,0)
 ;
"RTN","SYNDHP79",62,0)
PATPRBSV ; save patient problems for one patient to VistA
"RTN","SYNDHP79",63,0)
 ;
"RTN","SYNDHP79",64,0)
 ;   DHPPATPRBUPD
"RTN","SYNDHP79",65,0)
 ;
"RTN","SYNDHP79",66,0)
 ;CRASH
"RTN","SYNDHP79",67,0)
 D PARSEPUPD
"RTN","SYNDHP79",68,0)
 D PRBUPDT^SYNDHP62(.RETSTA,DHPPAT,DHPVST,DHPROV,DHPONS,DHPABT,DHPCLNST,DHPSCT)
"RTN","SYNDHP79",69,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",70,0)
 Q
"RTN","SYNDHP79",71,0)
 ;
"RTN","SYNDHP79",72,0)
 ;
"RTN","SYNDHP79",73,0)
PARSEPUPD ;
"RTN","SYNDHP79",74,0)
 ;
"RTN","SYNDHP79",75,0)
 S C=",",L=":"
"RTN","SYNDHP79",76,0)
 D SYNDHPLOG($H)
"RTN","SYNDHP79",77,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",78,0)
 I $L(PARAMS,L)=1 S C="&",L="="
"RTN","SYNDHP79",79,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",80,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",81,0)
 F I="PAT","VST","ROV","ONS","ABT","CLNST","SCT" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",82,0)
 Q
"RTN","SYNDHP79",83,0)
 ;
"RTN","SYNDHP79",84,0)
 ;
"RTN","SYNDHP79",85,0)
PATDEMSV ; save demographics for one patient
"RTN","SYNDHP79",86,0)
 ;
"RTN","SYNDHP79",87,0)
 ; *** may have been overtaken by events
"RTN","SYNDHP79",88,0)
 ; *** may be removed at some suitable juncture or use ISI?
"RTN","SYNDHP79",89,0)
 ;
"RTN","SYNDHP79",90,0)
 ;   DHPPATDEMUPD
"RTN","SYNDHP79",91,0)
 ;
"RTN","SYNDHP79",92,0)
 ;D PARSEDEM
"RTN","SYNDHP79",93,0)
 ;D DEMUPD^SYNDHP61(.RETSTA,DHPICN,DHPSCT,DHPDES,DHPICD,DHPROV,DHPDTM,DHPRID)
"RTN","SYNDHP79",94,0)
 ;D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",95,0)
 Q
"RTN","SYNDHP79",96,0)
PARSEDEM ;
"RTN","SYNDHP79",97,0)
 ;
"RTN","SYNDHP79",98,0)
 S C=",",L=":"
"RTN","SYNDHP79",99,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",100,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",101,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",102,0)
 ;CRASH
"RTN","SYNDHP79",103,0)
 F I="ICN","SCT","DES","ICD","ROV","DTM","RID" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",104,0)
 ;S ^ZZFJF(99)=DHPICN_"^"_DHPSCT_"^"_DHPOBS_"^"_DHPUNT_"^"_DHPDTM
"RTN","SYNDHP79",105,0)
 Q
"RTN","SYNDHP79",106,0)
 ;
"RTN","SYNDHP79",107,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",108,0)
 ;
"RTN","SYNDHP79",109,0)
PATIMUSV ; save Immunizations for one patient
"RTN","SYNDHP79",110,0)
 ;
"RTN","SYNDHP79",111,0)
 ;   DHPPATIMMUPD
"RTN","SYNDHP79",112,0)
 ;
"RTN","SYNDHP79",113,0)
 D PARSEIMU
"RTN","SYNDHP79",114,0)
 ; Immunizations update
"RTN","SYNDHP79",115,0)
 D IMMUNUPD^SYNDHP61(.RETSTA,DHPICN,DHPVIS,DHPCVX,DHPLOC,DHPROU,DHPDOS,DHPDTM,DHPPROV)
"RTN","SYNDHP79",116,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",117,0)
 Q
"RTN","SYNDHP79",118,0)
PARSEIMU ;
"RTN","SYNDHP79",119,0)
 ;
"RTN","SYNDHP79",120,0)
 N C,I,L,PARAMS
"RTN","SYNDHP79",121,0)
 ;
"RTN","SYNDHP79",122,0)
 S C=",",L=":"
"RTN","SYNDHP79",123,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",124,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",125,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",126,0)
 ;CRASH
"RTN","SYNDHP79",127,0)
 F I="ICN","VIS","CVX","LOC","ROU","DOS","DTM","PROV" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",128,0)
 ;S ^ZZART(99)=DHPICN_U_DHPVIS_U_DHPCVX_U_DHPLOC_U_DHPROU_U_DHPDOS_U_DHPDTM_U_DHPPROV
"RTN","SYNDHP79",129,0)
 Q
"RTN","SYNDHP79",130,0)
 ;
"RTN","SYNDHP79",131,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",132,0)
 ;
"RTN","SYNDHP79",133,0)
PATAPTCR ; create Appointment for one patient
"RTN","SYNDHP79",134,0)
 ;
"RTN","SYNDHP79",135,0)
 ;   DHPPATAPTCRE
"RTN","SYNDHP79",136,0)
 ;
"RTN","SYNDHP79",137,0)
 D PARSEAPT
"RTN","SYNDHP79",138,0)
 ; Appointment create
"RTN","SYNDHP79",139,0)
 D APPTADD^SYNDHP62(.RETSTA,DHPPAT,DHPCLIN,DHPAPTDT,DHPLEN)
"RTN","SYNDHP79",140,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",141,0)
 Q
"RTN","SYNDHP79",142,0)
PARSEAPT ;
"RTN","SYNDHP79",143,0)
 ;
"RTN","SYNDHP79",144,0)
 N C,I,L,PARAMS
"RTN","SYNDHP79",145,0)
 ;
"RTN","SYNDHP79",146,0)
 S C=",",L=":"
"RTN","SYNDHP79",147,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",148,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",149,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",150,0)
 ;CRASH
"RTN","SYNDHP79",151,0)
 F I="PAT","CLIN","APTDT","LEN" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",152,0)
 ;S ^ZZART(99)=DHPPAT_U_DHPCLIN_U_DHPAPTDT_U_DHPLEN
"RTN","SYNDHP79",153,0)
 Q
"RTN","SYNDHP79",154,0)
 ;
"RTN","SYNDHP79",155,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",156,0)
 ;
"RTN","SYNDHP79",157,0)
PATAPTCI ; check-in one Appointment for one patient
"RTN","SYNDHP79",158,0)
 ;
"RTN","SYNDHP79",159,0)
 ;   DHPPATAPTCI
"RTN","SYNDHP79",160,0)
 ;
"RTN","SYNDHP79",161,0)
 D PARSECI
"RTN","SYNDHP79",162,0)
 ; Appointment create
"RTN","SYNDHP79",163,0)
 D APPTCKIN^SYNDHP62(.RETSTA,DHPPAT,DHPCLIN,DHPAPTDT,DHPCIDT)
"RTN","SYNDHP79",164,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",165,0)
 Q
"RTN","SYNDHP79",166,0)
PARSECI ;
"RTN","SYNDHP79",167,0)
 ;
"RTN","SYNDHP79",168,0)
 N C,I,L,PARAMS
"RTN","SYNDHP79",169,0)
 ;
"RTN","SYNDHP79",170,0)
 S C=",",L=":"
"RTN","SYNDHP79",171,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",172,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",173,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",174,0)
 ;CRASH
"RTN","SYNDHP79",175,0)
 F I="PAT","CLIN","APTDT","CIDT" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",176,0)
 ;S ^ZZART(99)=DHPPAT_U_DHPCLIN_U_DHPAPTDT_U_DHPCIDT
"RTN","SYNDHP79",177,0)
 Q
"RTN","SYNDHP79",178,0)
 ;
"RTN","SYNDHP79",179,0)
 ;
"RTN","SYNDHP79",180,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",181,0)
 ;
"RTN","SYNDHP79",182,0)
PATLABSV ; create one lab result for one patient
"RTN","SYNDHP79",183,0)
 ;
"RTN","SYNDHP79",184,0)
 ;   DHPPATLABUPD
"RTN","SYNDHP79",185,0)
 ;
"RTN","SYNDHP79",186,0)
 D PARSELAB
"RTN","SYNDHP79",187,0)
 ; Lab Result create
"RTN","SYNDHP79",188,0)
 D LABADD^SYNDHP63(.RETSTA,DHPPAT,DHPLOC,DHPTEST,DHPRSLT,DHPRSDT,DHPLOINC)
"RTN","SYNDHP79",189,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",190,0)
 Q
"RTN","SYNDHP79",191,0)
PARSELAB ;
"RTN","SYNDHP79",192,0)
 ;
"RTN","SYNDHP79",193,0)
 N C,I,L,PARAMS
"RTN","SYNDHP79",194,0)
 ;
"RTN","SYNDHP79",195,0)
 S C=",",L=":"
"RTN","SYNDHP79",196,0)
 S PARAMS=RGNETREQ("BODY",1)
"RTN","SYNDHP79",197,0)
 F I=1:1:$L(PARAMS,C) D
"RTN","SYNDHP79",198,0)
 .S PARAMS($P($P(PARAMS,C,I),L))=$P($P(PARAMS,C,I),L,2)
"RTN","SYNDHP79",199,0)
 ;CRASH
"RTN","SYNDHP79",200,0)
 F I="PAT","LOC","TEST","RSLT","RSDT","LOINC" S @("DHP"_I)=PARAMS(I)
"RTN","SYNDHP79",201,0)
 ;S ^ZZART(99)=DHPPAT_U_DHPLOC_U_DHPTEST_U_DHPRSLT_U_DHPRSDT_U_DHPLOINC
"RTN","SYNDHP79",202,0)
 Q
"RTN","SYNDHP79",203,0)
 ;
"RTN","SYNDHP79",204,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",205,0)
 ;
"RTN","SYNDHP79",206,0)
SYSFAC ; create/delete system facility parameter
"RTN","SYNDHP79",207,0)
 ;
"RTN","SYNDHP79",208,0)
 ;   DHPSYSFACUPD
"RTN","SYNDHP79",209,0)
 ;
"RTN","SYNDHP79",210,0)
 F I="FAC" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP79",211,0)
 S ^zzfjf("FAC")=DHPFAC
"RTN","SYNDHP79",212,0)
 D FACPAR^SYNDHP69(.RETSTA,DHPFAC)
"RTN","SYNDHP79",213,0)
 D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP79",214,0)
 Q 
"RTN","SYNDHP79",215,0)
 ;
"RTN","SYNDHP79",216,0)
 ;  ---------------------------------------------
"RTN","SYNDHP79",217,0)
 ;
"RTN","SYNDHP79",218,0)
PARSEICN ; ICN PARSER
"RTN","SYNDHP79",219,0)
 ; 
"RTN","SYNDHP79",220,0)
 ;CRASH
"RTN","SYNDHP79",221,0)
 F I="ICN" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP79",222,0)
 Q
"RTN","SYNDHP79",223,0)
PARSETRAITS ; Traits parser
"RTN","SYNDHP79",224,0)
 ;
"RTN","SYNDHP79",225,0)
 F I="SSN","DOB","GENDER" S @("DHP"_I)=$$GETPARAM^RGNETWWW(I)
"RTN","SYNDHP79",226,0)
 S DHPNAME=$$GETPARAM^RGNETWWW("NAME",1,1)
"RTN","SYNDHP79",227,0)
 S DHPNAME=DHPNAME_","_$$GETPARAM^RGNETWWW("NAME",1,2)_" "
"RTN","SYNDHP79",228,0)
 Q
"RTN","SYNDHP79",229,0)
SYNDHPLOG(TS) ; log arrays
"RTN","SYNDHP79",230,0)
 I $D(RGNETREQ) M ^SYNDHPLOG(TS,"RGNETREQ")=RGNETREQ
"RTN","SYNDHP79",231,0)
 I $D(RGCFG) M ^SYNDHPLOG(TS,"RGCFG")=RGCFG
"RTN","SYNDHP79",232,0)
 q
"RTN","SYNDHP83")
0^16^B347144
"RTN","SYNDHP83",1,0)
SYNDHP83 ; AFHIL/fjf - HealthConcourse - retrieve mapped code ;03/21/2019
"RTN","SYNDHP83",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP83",3,0)
 ;
"RTN","SYNDHP83",4,0)
 ;
"RTN","SYNDHP83",5,0)
 Q
"RTN","SYNDHP83",6,0)
 ;
"RTN","SYNDHP83",7,0)
 ; ----------------  Get Mapped Code  ----------------------  
"RTN","SYNDHP83",8,0)
 ;
"RTN","SYNDHP83",9,0)
MAPSVC(RETSTA,DHPMAP,DHPCODE,DHPDIR,DHPIOE) ; get mapped code
"RTN","SYNDHP83",10,0)
 ;
"RTN","SYNDHP83",11,0)
 ; Return mapped code for given mapping and source code
"RTN","SYNDHP83",12,0)
 ;
"RTN","SYNDHP83",13,0)
 ; Input:
"RTN","SYNDHP83",14,0)
 ;   DHPMAP   - map identifier e.g. sct2icd, or rxn2ndf
"RTN","SYNDHP83",15,0)
 ;   DHPCODE  - source code to be mapped
"RTN","SYNDHP83",16,0)
 ;   DHPDIR  - direction of mapping
"RTN","SYNDHP83",17,0)
 ;             D for direct (default)
"RTN","SYNDHP83",18,0)
 ;             I for inverse
"RTN","SYNDHP83",19,0)
 ;   DHPIOE  - use internal or exernal mappings
"RTN","SYNDHP83",20,0)
 ;             I for internal SYN VistA (default)
"RTN","SYNDHP83",21,0)
 ;             H for external HealthConcourse
"RTN","SYNDHP83",22,0)
 ; Output:
"RTN","SYNDHP83",23,0)
 ;   RETSTA   - a delimited string that has the following
"RTN","SYNDHP83",24,0)
 ;              n^target_code
"RTN","SYNDHP83",25,0)
 ;              
"RTN","SYNDHP83",26,0)
 ;             -where n is a flag indicating success/failure of request
"RTN","SYNDHP83",27,0)
 ;                 1 - success
"RTN","SYNDHP83",28,0)
 ;                -1 - exception
"RTN","SYNDHP83",29,0)
 ;                target_code is the code that is the result of the mapping              
"RTN","SYNDHP83",30,0)
 ;             
"RTN","SYNDHP83",31,0)
 N C
"RTN","SYNDHP83",32,0)
 S C=","
"RTN","SYNDHP83",33,0)
 S RETSTA=$$MAP^SYNDHPMP(DHPMAP,DHPCODE,DHPDIR,DHPIOE)
"RTN","SYNDHP83",34,0)
 Q
"RTN","SYNDHP89")
0^17^B401561
"RTN","SYNDHP89",1,0)
SYNDHP89 ; HC/art/fjf - HealthConcourse - DHP REST handlers
"RTN","SYNDHP89",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP89",3,0)
 ;;
"RTN","SYNDHP89",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP89",5,0)
 ;
"RTN","SYNDHP89",6,0)
 Q
"RTN","SYNDHP89",7,0)
 ;  ------------------------------------------------------------
"RTN","SYNDHP89",8,0)
 ;  Patient Text Integration Utility Notes by ICN bridge routine
"RTN","SYNDHP89",9,0)
 ;  ------------------------------------------------------------
"RTN","SYNDHP89",10,0)
 ;
"RTN","SYNDHP89",11,0)
PATTIUI ; get patient conditions for one patient by ICN
"RTN","SYNDHP89",12,0)
 ; ** to be retired
"RTN","SYNDHP89",13,0)
 ;
"RTN","SYNDHP89",14,0)
 ;   DHPPATTIUICN
"RTN","SYNDHP89",15,0)
 ;
"RTN","SYNDHP89",16,0)
 ;D PARSEICN
"RTN","SYNDHP89",17,0)
 ;D PATTIUI^SYNDHP67(.RETSTA,DHPICN)
"RTN","SYNDHP89",18,0)
 ;D ADD^RGNETWWW(RETSTA_$C(13,10))
"RTN","SYNDHP89",19,0)
 Q
"RTN","SYNDHP91")
0^72^B40944851
"RTN","SYNDHP91",1,0)
SYNDHP91 ;DHP/fjf - HealthConcourse - Write care plans to VistA ;11/07/2018
"RTN","SYNDHP91",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHP91",3,0)
 ;;
"RTN","SYNDHP91",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP91",5,0)
 ;
"RTN","SYNDHP91",6,0)
 QUIT
"RTN","SYNDHP91",7,0)
 ;
"RTN","SYNDHP91",8,0)
 ;*//Input:
"RTN","SYNDHP91",9,0)
 ; a. Classification
"RTN","SYNDHP91",10,0)
 ; b. Activities SNOMED CT
"RTN","SYNDHP91",11,0)
 ; c. Goals - text and ptr to PL
"RTN","SYNDHP91",12,0)
 ; Status - fhir CODE
"RTN","SYNDHP91",13,0)
 ; Date
"RTN","SYNDHP91",14,0)
 ;
"RTN","SYNDHP91",15,0)
 ;
"RTN","SYNDHP91",16,0)
 ; 1.   Use data2pce to ingest careplans, activities & goals
"RTN","SYNDHP91",17,0)
 ; a.   Encounter
"RTN","SYNDHP91",18,0)
 ; b.   CarePlan points to encounter and the goals
"RTN","SYNDHP91",19,0)
 ; i.   V standard codes (SNOMED CT) - classification 
"RTN","SYNDHP91",20,0)
 ; c.   Goals - has text goal - points to condition/problems (reason for goal)
"RTN","SYNDHP91",21,0)
 ; i.   Use Healthfactors 
"RTN","SYNDHP91",22,0)
 ; ii.  Create goals HF category - config - add to configuration utility this will be for problem
"RTN","SYNDHP91",23,0)
 ; iii. For each goal create a health factor if doesn't already exist (laygo) (text from c above)
"RTN","SYNDHP91",24,0)
 ; iv.  Code which references the problem list
"RTN","SYNDHP91",25,0)
 ; v.   Entire text of goal goes in comment and say that goal addresses this problem  -> add SCT + desc code in there too
"RTN","SYNDHP91",26,0)
 ;
"RTN","SYNDHP91",27,0)
 ; d.
"RTN","SYNDHP91",28,0)
 ;
"RTN","SYNDHP91",29,0)
 ; Signature:
"RTN","SYNDHP91",30,0)
 ;Visit IEN
"RTN","SYNDHP91",31,0)
 ;Goals (array) text & code <- problem list code (SNOMED CT & or ICD)
"RTN","SYNDHP91",32,0)
 ;Activities (array) SNOMED code^status
"RTN","SYNDHP91",33,0)
 ;Classification SNOMED CT code
"RTN","SYNDHP91",34,0)
 ;CarePlan Status from FHIR set
"RTN","SYNDHP91",35,0)
 ;
"RTN","SYNDHP91",36,0)
 ;
"RTN","SYNDHP91",37,0)
 ;Generate TIU note for careplan and associate with encounter.
"RTN","SYNDHP91",38,0)
 ;//*
"RTN","SYNDHP91",39,0)
 ;
"RTN","SYNDHP91",40,0)
 ; HF for cat for careplan
"RTN","SYNDHP91",41,0)
 ; HF for careplan (use healthfactor manager
"RTN","SYNDHP91",42,0)
 ; HF for activity 
"RTN","SYNDHP91",43,0)
 ; pass to DATA2PCE
"RTN","SYNDHP91",44,0)
 ; 
"RTN","SYNDHP91",45,0)
 ;
"RTN","SYNDHP91",46,0)
 ; -------- Create Care Plan for Patient
"RTN","SYNDHP91",47,0)
 ;
"RTN","SYNDHP91",48,0)
CPLUPDT(RETSTA,DHPPAT,DHPVST,DHPCAT,DHPACT,DHPGOL,DHPSCT,DHPSDT,DHPEDT) ;  update
"RTN","SYNDHP91",49,0)
 ;
"RTN","SYNDHP91",50,0)
 ; Input:
"RTN","SYNDHP91",51,0)
 ;   DHPPAT   - Patient ICN
"RTN","SYNDHP91",52,0)
 ;   DHPVST   - Visit ID
"RTN","SYNDHP91",53,0)
 ;   DHPCAT   - Category ID (SCT code. text, and FHIR status - active, completed, etc)
"RTN","SYNDHP91",54,0)
 ;   DHPACT   - List of Activities (SCT code, text, and FHIR status - in-progress, etc)
"RTN","SYNDHP91",55,0)
 ;   DHPGOL   - List of Goals
"RTN","SYNDHP91",56,0)
 ;   DHPSCT   - Reason for CarePlan (SCT code) - Care Plan Addresses
"RTN","SYNDHP91",57,0)
 ;   DHPSDT   - CarePlan Period start
"RTN","SYNDHP91",58,0)
 ;   DHPEDT   - CarePlan period end
"RTN","SYNDHP91",59,0)
 ;
"RTN","SYNDHP91",60,0)
 ;
"RTN","SYNDHP91",61,0)
 ; Output:   RETSTA
"RTN","SYNDHP91",62,0)
 ;  1 - success
"RTN","SYNDHP91",63,0)
 ; -1 - failure -1^message
"RTN","SYNDHP91",64,0)
 ;
"RTN","SYNDHP91",65,0)
 I '$D(^DPT("AFICN",DHPPAT)) S RETSTA="-1^Patient not recognised" Q
"RTN","SYNDHP91",66,0)
 ;
"RTN","SYNDHP91",67,0)
 ;I $G(DHPSCT)="" S RETSTA="-1^SNOMED CT code is required" Q
"RTN","SYNDHP91",68,0)
 I $G(DHPVST)="" S RETSTA="-1^Visit IEN is required" Q
"RTN","SYNDHP91",69,0)
 I '$D(^AUPNVSIT(DHPVST)) S RETSTA="-1^Visit not found" Q
"RTN","SYNDHP91",70,0)
 ;
"RTN","SYNDHP91",71,0)
 ;
"RTN","SYNDHP91",72,0)
 ;
"RTN","SYNDHP91",73,0)
 S U="^",T="~"
"RTN","SYNDHP91",74,0)
 ;
"RTN","SYNDHP91",75,0)
 S DHPGOL=$G(DHPGOL)
"RTN","SYNDHP91",76,0)
 S DHPSCT=$G(DHPSCT)
"RTN","SYNDHP91",77,0)
 S DHPSDT=$P($$HL7TFM^XLFDT(DHPSDT),".",1)
"RTN","SYNDHP91",78,0)
 S DHPEDT=$P($$HL7TFM^XLFDT(DHPEDT),".",1)
"RTN","SYNDHP91",79,0)
 ;
"RTN","SYNDHP91",80,0)
 S VISIT=DHPVST
"RTN","SYNDHP91",81,0)
 S PATIEN=$O(^DPT("AFICN",DHPPAT,""),-1)
"RTN","SYNDHP91",82,0)
 S PACKAGE=$$FIND1^DIC(9.4,,"","?")
"RTN","SYNDHP91",83,0)
 S SOURCE="DHP DATA INGEST"
"RTN","SYNDHP91",84,0)
 S USER=$$DUZ^SYNDHP69
"RTN","SYNDHP91",85,0)
 S ERRDISP=""
"RTN","SYNDHP91",86,0)
 I $G(DEBUG)=1 S ERRDISP=1
"RTN","SYNDHP91",87,0)
 S CATCD=$P(DHPCAT,T)
"RTN","SYNDHP91",88,0)
 S CATTX=$P(DHPCAT,T,2)
"RTN","SYNDHP91",89,0)
 S CATST=$P(DHPCAT,T,3)
"RTN","SYNDHP91",90,0)
 ;S CONC=$$CODE^LEXTRAN(DHPSCT,"SCT",,,,,1)
"RTN","SYNDHP91",91,0)
 S ADDCD=$P(DHPSCT,U)
"RTN","SYNDHP91",92,0)
 S ADDTX=$P(DHPSCT,U,2)
"RTN","SYNDHP91",93,0)
 S ADDST=$P(DHPSCT,U,3)
"RTN","SYNDHP91",94,0)
 ;
"RTN","SYNDHP91",95,0)
 ; Call HF manager and retrieve HF for careplan category data or
"RTN","SYNDHP91",96,0)
 ;   add category HF and return data if it doesn't already exist 
"RTN","SYNDHP91",97,0)
 S CATDAT=$$HFCPCAT^SYNFHF(CATCD,CATTX)
"RTN","SYNDHP91",98,0)
 ;
"RTN","SYNDHP91",99,0)
 ; Call HF manager and retrieve HF for careplan
"RTN","SYNDHP91",100,0)
 ;   add careplan HF if it doesn't already exist
"RTN","SYNDHP91",101,0)
 S HFCAP=$$HFCP^SYNFHF(CATCD,CATTX,CATDAT)
"RTN","SYNDHP91",102,0)
 ;
"RTN","SYNDHP91",103,0)
 ; Call HF manager and retrieve HF for careplan addresses data or
"RTN","SYNDHP91",104,0)
 ;   add addresses HF and return data if it doesn't already exist 
"RTN","SYNDHP91",105,0)
 S ADDDAT=$$HFADDR^SYNFHF(ADDCD,ADDTX,CATDAT)
"RTN","SYNDHP91",106,0)
 ;
"RTN","SYNDHP91",107,0)
 ; create encounter array
"RTN","SYNDHP91",108,0)
 ;
"RTN","SYNDHP91",109,0)
 K ENCDATA
"RTN","SYNDHP91",110,0)
 ; 
"RTN","SYNDHP91",111,0)
 ;
"RTN","SYNDHP91",112,0)
 ; Careplan health factor
"RTN","SYNDHP91",113,0)
 ;
"RTN","SYNDHP91",114,0)
 S ENCDATA("HEALTH FACTOR",1,"HEALTH FACTOR")=+HFCAP
"RTN","SYNDHP91",115,0)
 S ENCDATA("HEALTH FACTOR",1,"EVENT D/T")=DHPSDT
"RTN","SYNDHP91",116,0)
 S ENCDATA("HEALTH FACTOR",1,"COMMENT")="Start: "_DHPSDT_" End: "_DHPEDT_" Status: "_CATST
"RTN","SYNDHP91",117,0)
 ;
"RTN","SYNDHP91",118,0)
 ; what health factor addresses
"RTN","SYNDHP91",119,0)
 ;
"RTN","SYNDHP91",120,0)
 S ENCDATA("HEALTH FACTOR",2,"HEALTH FACTOR")=+ADDDAT
"RTN","SYNDHP91",121,0)
 S ENCDATA("HEALTH FACTOR",2,"EVENT D/T")=DHPSDT
"RTN","SYNDHP91",122,0)
 S ENCDATA("HEALTH FACTOR",2,"COMMENT")="Start: "_DHPSDT_" End: "_DHPEDT ; _" Status: "_ADDST
"RTN","SYNDHP91",123,0)
 ;
"RTN","SYNDHP91",124,0)
 ; careplan activities
"RTN","SYNDHP91",125,0)
 ;
"RTN","SYNDHP91",126,0)
 I +CATDAT'=0 D
"RTN","SYNDHP91",127,0)
 .F I=1:1:$L(DHPACT,U) D
"RTN","SYNDHP91",128,0)
 ..S ACTS=$P(DHPACT,U,I)
"RTN","SYNDHP91",129,0)
 ..S ACTSCT=$P(ACTS,T)
"RTN","SYNDHP91",130,0)
 ..S ACTTXT=$P(ACTS,T,2)
"RTN","SYNDHP91",131,0)
 ..S ACTSTA=$P(ACTS,T,3)
"RTN","SYNDHP91",132,0)
 ..S HFACT=$$HFACT^SYNFHF(ACTSCT,ACTTXT,+CATDAT)
"RTN","SYNDHP91",133,0)
 ..S ENCDATA("HEALTH FACTOR",I+2,"HEALTH FACTOR")=+HFACT
"RTN","SYNDHP91",134,0)
 ..S ENCDATA("HEALTH FACTOR",I+2,"EVENT D/T")=DHPSDT
"RTN","SYNDHP91",135,0)
 ..S ENCDATA("HEALTH FACTOR",I+2,"COMMENT")="Start: "_DHPSDT_" End: "_DHPEDT_" Status: "_ACTSTA
"RTN","SYNDHP91",136,0)
 ; 
"RTN","SYNDHP91",137,0)
GOLS ; careplan goals
"RTN","SYNDHP91",138,0)
 ;
"RTN","SYNDHP91",139,0)
 F J=1:1:$L(DHPGOL,U) D
"RTN","SYNDHP91",140,0)
 .S GOLS=$P(DHPGOL,U,J)
"RTN","SYNDHP91",141,0)
 .S GOLSCT=$P(GOLS,T)
"RTN","SYNDHP91",142,0)
 .S GOLTXT=$P(GOLS,T,2)
"RTN","SYNDHP91",143,0)
 .S GOLSTA=$P(GOLS,T,3)
"RTN","SYNDHP91",144,0)
 .S HFACT=$$HFGOAL^SYNFHF(GOLSCT,+CATDAT,GOLTXT)
"RTN","SYNDHP91",145,0)
 .S ENCDATA("HEALTH FACTOR",J+I+2,"HEALTH FACTOR")=+HFACT
"RTN","SYNDHP91",146,0)
 .S ENCDATA("HEALTH FACTOR",J+I+2,"EVENT D/T")=DHPSDT
"RTN","SYNDHP91",147,0)
 .S ENCDATA("HEALTH FACTOR",J+I+2,"COMMENT")="Start: "_DHPSDT_" End: "_DHPEDT_" Status: "_GOLSTA
"RTN","SYNDHP91",148,0)
 ;
"RTN","SYNDHP91",149,0)
 ;
"RTN","SYNDHP91",150,0)
 S RETSTA=$$DATA2PCE^PXAI("ENCDATA",PACKAGE,SOURCE,.VISIT,USER,$G(ERRDISP),.ZZERR,$G(PPEDIT),.ZZERDESC,.ACCOUNT)
"RTN","SYNDHP91",151,0)
 D EVARS
"RTN","SYNDHP91",152,0)
 M RETSTA=ENCDATA
"RTN","SYNDHP91",153,0)
 Q
"RTN","SYNDHP91",154,0)
 ;
"RTN","SYNDHP91",155,0)
 ;
"RTN","SYNDHP91",156,0)
T1 ;
"RTN","SYNDHP91",157,0)
 ;
"RTN","SYNDHP91",158,0)
 D VARS
"RTN","SYNDHP91",159,0)
 D CPLUPDT(.ZXC,DHPPAT,DHPVST,DHPCAT,DHPACT,DHPGOL,DHPSCT,DHPSDT,DHPEDT)
"RTN","SYNDHP91",160,0)
 Q
"RTN","SYNDHP91",161,0)
 ; 
"RTN","SYNDHP91",162,0)
 ;s q=""""
"RTN","SYNDHP91",163,0)
 ;
"RTN","SYNDHP91",164,0)
 ;w q
"RTN","SYNDHP91",165,0)
 ;
"RTN","SYNDHP91",166,0)
 ;F I=1:1:7 s @$p(a(I),q,8)=$p(a(I),"=",2)
"RTN","SYNDHP91",167,0)
 ;
"RTN","SYNDHP91",168,0)
 ;a(1)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPACT")=409002~Food allergy diet~in-progress^58332002~Allergy education~in-progress"
"RTN","SYNDHP91",169,0)
 ;a(2)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPCAT")=326051000000105~Self care~active"
"RTN","SYNDHP91",170,0)
 ;a(3)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPEDT")="
"RTN","SYNDHP91",171,0)
 ;a(4)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPPAT")=1435855215V947437"
"RTN","SYNDHP91",172,0)
 ;a(5)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPSCT")="
"RTN","SYNDHP91",173,0)
 ;a(6)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPSDT")=2760829"
"RTN","SYNDHP91",174,0)
 ;a(7)="^%wd(17.040801,1,1227,"load","careplan",12,"parms","DHPVST")=34818"
"RTN","SYNDHP91",175,0)
 ;
"RTN","SYNDHP91",176,0)
VARS ;
"RTN","SYNDHP91",177,0)
 S DHPACT="409002~Food allergy diet~in-progress^58332002~Allergy education~in-progress"
"RTN","SYNDHP91",178,0)
 S DHPCAT="326051000000105~Self care~active"
"RTN","SYNDHP91",179,0)
 S DHPEDT=""
"RTN","SYNDHP91",180,0)
 S DHPPAT="1345112108V472042"
"RTN","SYNDHP91",181,0)
 S DHPSCT="230690007^Cerebrovascular accident^passive"
"RTN","SYNDHP91",182,0)
 S DHPSDT="19760829"
"RTN","SYNDHP91",183,0)
 S DHPVST="34885"
"RTN","SYNDHP91",184,0)
 S DHPGOL="15777000~Address patient knowledge deficit on diabetic self-care~in-progress^15777000"
"RTN","SYNDHP91",185,0)
 S DHPGOL=DHPGOL_"~Improve and maintenance of optimal foot health: aim at early detection of peripheral"
"RTN","SYNDHP91",186,0)
 S DHPGOL=DHPGOL_" vascular problems and neuropathy presumed due to diabetes; and prevention of diabetic"
"RTN","SYNDHP91",187,0)
 S DHPGOL=DHPGOL_" foot ulcer, gangrene~in-progress^15777000~Maintain blood pressure below 140/90 mmHg"
"RTN","SYNDHP91",188,0)
 S DHPGOL=DHPGOL_"~in-progress^15777000~Glucose [Mass/volume] in Blood < 108~in-progress^15777000"
"RTN","SYNDHP91",189,0)
 S DHPGOL=DHPGOL_"~Hemoglobin A1c total in Blood < 7.0~in-progress"
"RTN","SYNDHP91",190,0)
 Q
"RTN","SYNDHP91",191,0)
 ; 
"RTN","SYNDHP91",192,0)
EVARS ;
"RTN","SYNDHP91",193,0)
 S ENCDATA("IVARS","DHPACT")=DHPACT
"RTN","SYNDHP91",194,0)
 S ENCDATA("IVARS","DHPCAT")=DHPCAT
"RTN","SYNDHP91",195,0)
 S ENCDATA("IVARS","DHPEDT")=DHPEDT
"RTN","SYNDHP91",196,0)
 S ENCDATA("IVARS","DHPPAT")=DHPPAT
"RTN","SYNDHP91",197,0)
 S ENCDATA("IVARS","DHPSCT")=DHPSCT
"RTN","SYNDHP91",198,0)
 S ENCDATA("IVARS","DHPSDT")=DHPSDT
"RTN","SYNDHP91",199,0)
 S ENCDATA("IVARS","DHPVST")=DHPVST
"RTN","SYNDHP91",200,0)
 S ENCDATA("IVARS","DHPGOL")=DHPGOL
"RTN","SYNDHP91",201,0)
 Q
"RTN","SYNDHP92")
0^82^B9874705
"RTN","SYNDHP92",1,0)
SYNDHP92 ; HC/ART - HealthConcourse - DHP Save TIU Note ;01/26/2019
"RTN","SYNDHP92",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP92",3,0)
 ;;
"RTN","SYNDHP92",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP92",5,0)
 ;
"RTN","SYNDHP92",6,0)
 QUIT
"RTN","SYNDHP92",7,0)
 ;
"RTN","SYNDHP92",8,0)
CREATETIU(RETSTAT,DHPICN,TITLE,VISIT,TEXT,ESIG) ;save a TIU note for a patient
"RTN","SYNDHP92",9,0)
 ;Inputs: RETSTAT - return status, by reference
"RTN","SYNDHP92",10,0)
 ;        DHPICN  - patient ICN, required
"RTN","SYNDHP92",11,0)
 ;        TITLE   - pointer to the TIU DOCUMENT DEFINITION FILE (#8925.1), required
"RTN","SYNDHP92",12,0)
 ;        VISIT   - pointer to the Visit File (#9000010), required
"RTN","SYNDHP92",13,0)
 ;        TEXT    - input array with document identifiers and text, by reference, required
"RTN","SYNDHP92",14,0)
 ;          TEXT("TEXT",1,0)="abcd"
"RTN","SYNDHP92",15,0)
 ;          TEXT("TEXT",n,0)="wxyz"
"RTN","SYNDHP92",16,0)
 ;        ESIG - e-signature to sign note
"RTN","SYNDHP92",17,0)
 ;Output: RETSTAT - return status
"RTN","SYNDHP92",18,0)
 ;          IEN of the resulting entry in the TIU DOCUMENT FILE (#8925)
"RTN","SYNDHP92",19,0)
 ;       or -1^error message
"RTN","SYNDHP92",20,0)
 ;
"RTN","SYNDHP92",21,0)
 ; validate ICN
"RTN","SYNDHP92",22,0)
 I $G(DHPICN)="" S RETSTAT="-1^No patient identifier" QUIT
"RTN","SYNDHP92",23,0)
 I '$$UICNVAL^SYNDHPUTL(DHPICN) S RETSTAT="-1^Patient identifier not recognised" QUIT
"RTN","SYNDHP92",24,0)
 ; get patient IEN from ICN
"RTN","SYNDHP92",25,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",DHPICN,""))
"RTN","SYNDHP92",26,0)
 I PATIEN="" S RETSTAT="-1^AFICN x-ref issue" QUIT
"RTN","SYNDHP92",27,0)
 ; 
"RTN","SYNDHP92",28,0)
 ; validate TITLE
"RTN","SYNDHP92",29,0)
 I '$G(TITLE) S RETSTAT="-1^No title identifier" QUIT
"RTN","SYNDHP92",30,0)
 I '$D(^TIU(8925.1,TITLE,0)) S RETSTAT="-1^Title not found" QUIT
"RTN","SYNDHP92",31,0)
 ;
"RTN","SYNDHP92",32,0)
 ; validate VISIT
"RTN","SYNDHP92",33,0)
 I '$G(VISIT) S RETSTAT="-1^No visit identifier" QUIT
"RTN","SYNDHP92",34,0)
 I '$D(^AUPNVSIT(VISIT,0)) S RETSTAT="-1^Visit not found" QUIT
"RTN","SYNDHP92",35,0)
 N PAT S PAT=$$GET1^DIQ(9000010,VISIT_",",.05,"I")
"RTN","SYNDHP92",36,0)
 I PATIEN'=PAT S RETSTAT="-1^Visit is not for this patient" QUIT
"RTN","SYNDHP92",37,0)
 ;
"RTN","SYNDHP92",38,0)
 ; validate TEXT
"RTN","SYNDHP92",39,0)
 I '$D(TEXT) S RETSTAT="-1^No note text" QUIT
"RTN","SYNDHP92",40,0)
 ;
"RTN","SYNDHP92",41,0)
 ;optional parameters
"RTN","SYNDHP92",42,0)
 N VDATE S VDATE=""
"RTN","SYNDHP92",43,0)
 N VLOC S VLOC=""
"RTN","SYNDHP92",44,0)
 N VSTR S VSTR=""
"RTN","SYNDHP92",45,0)
 N SUPPRESS S SUPPRESS=0
"RTN","SYNDHP92",46,0)
 N NOASF S NOASF=1
"RTN","SYNDHP92",47,0)
 ;
"RTN","SYNDHP92",48,0)
 N VPROV S VPROV=$O(^AUPNVPRV("AD",VISIT,"")) ;visit provider ien
"RTN","SYNDHP92",49,0)
 I VPROV="" S RETSTAT="-1^no provider associated with visit" QUIT
"RTN","SYNDHP92",50,0)
 w "VPROV: ",VPROV,"    ",$$GET1^DIQ(200,VPROV_",",.01),!
"RTN","SYNDHP92",51,0)
 ;
"RTN","SYNDHP92",52,0)
 N TIUX
"RTN","SYNDHP92",53,0)
 S TIUX(.02)=PATIEN ;Patient IEN
"RTN","SYNDHP92",54,0)
 S TIUX(.01)=TITLE
"RTN","SYNDHP92",55,0)
 S TIUX(.03)=VISIT
"RTN","SYNDHP92",56,0)
 S TIUX(1201)=$$NOW^XLFDT() ;entry date/time
"RTN","SYNDHP92",57,0)
 S TIUX(1205)=$$GET1^DIQ(9000010,VISIT_",",.06,"I") ;hospital location
"RTN","SYNDHP92",58,0)
 S TIUX(1301)=$$GET1^DIQ(9000010,VISIT_",",.01,"I") ;reference date=Visit Date
"RTN","SYNDHP92",59,0)
 M TIUX=TEXT ;note text
"RTN","SYNDHP92",60,0)
 ;
"RTN","SYNDHP92",61,0)
 ;create the note
"RTN","SYNDHP92",62,0)
 D MAKE^TIUSRVP(.RETSTAT,PATIEN,TITLE,VDATE,VLOC,VISIT,.TIUX,VSTR,SUPPRESS,NOASF)
"RTN","SYNDHP92",63,0)
 I '+RETSTAT S RETSTAT="-1^Error creating note^"_RETSTAT QUIT
"RTN","SYNDHP92",64,0)
 ;
"RTN","SYNDHP92",65,0)
 N FDA
"RTN","SYNDHP92",66,0)
 N IENS S IENS=+RETSTAT_","
"RTN","SYNDHP92",67,0)
 S FDA(8925,IENS,1202)=VPROV
"RTN","SYNDHP92",68,0)
 S FDA(8925,IENS,1204)=VPROV
"RTN","SYNDHP92",69,0)
 S FDA(8925,IENS,1302)=VPROV
"RTN","SYNDHP92",70,0)
 D FILE^DIE("K","FDA","MSG")
"RTN","SYNDHP92",71,0)
 ;
"RTN","SYNDHP92",72,0)
 N NOTEIEN S NOTEIEN=+RETSTAT
"RTN","SYNDHP92",73,0)
 ;
"RTN","SYNDHP92",74,0)
 ;sign the note
"RTN","SYNDHP92",75,0)
 QUIT:$G(ESIG)=""
"RTN","SYNDHP92",76,0)
 N duzsave S duzsave=DUZ
"RTN","SYNDHP92",77,0)
 S DUZ=VPROV
"RTN","SYNDHP92",78,0)
 N RETVAL
"RTN","SYNDHP92",79,0)
 D SIGN^TIUSRVP(.RETVAL,NOTEIEN,$$ENCRYP^XUSRB1(ESIG))
"RTN","SYNDHP92",80,0)
 I +RETVAL S RETSTAT="-1^Error signing note^"_RETVAL
"RTN","SYNDHP92",81,0)
 S DUZ=duzsave
"RTN","SYNDHP92",82,0)
 ;
"RTN","SYNDHP92",83,0)
 QUIT
"RTN","SYNDHP92",84,0)
 ;
"RTN","SYNDHP99")
0^84^B15985554
"RTN","SYNDHP99",1,0)
SYNDHP99 ; HC/art - HealthConcourse - retrieve VistA data for a resource id ;05/08/2019
"RTN","SYNDHP99",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHP99",3,0)
 ;;
"RTN","SYNDHP99",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHP99",5,0)
 ;
"RTN","SYNDHP99",6,0)
 QUIT
"RTN","SYNDHP99",7,0)
 ;
"RTN","SYNDHP99",8,0)
GETREC(RETSTR,RESID) ; Get VistA record for Resource ID
"RTN","SYNDHP99",9,0)
 ;Inputs: RETSTR - return string, by reference
"RTN","SYNDHP99",10,0)
 ;        RESID  - resource id - V_site_file#_record#
"RTN","SYNDHP99",11,0)
 ;Output: RETSTR - VistA record as a JSON string
"RTN","SYNDHP99",12,0)
 ;              or error message   
"RTN","SYNDHP99",13,0)
 ;
"RTN","SYNDHP99",14,0)
 S ^TMP("ZZZ")=RESID_"^333"
"RTN","SYNDHP99",15,0)
 new UL set UL="_"
"RTN","SYNDHP99",16,0)
 new P set P="|"
"RTN","SYNDHP99",17,0)
 set DUZ=$$DUZ^SYNDHP69
"RTN","SYNDHP99",18,0)
 set RETSTR=""
"RTN","SYNDHP99",19,0)
 ;
"RTN","SYNDHP99",20,0)
 ;check parameter
"RTN","SYNDHP99",21,0)
 if $g(RESID)="" set RETSTR="{""error:"":""resourceId is null""}" QUIT
"RTN","SYNDHP99",22,0)
 if $e(RESID)'="V" set RETSTR="{""error:"":""this is not a VistA resourceId""}" QUIT
"RTN","SYNDHP99",23,0)
 if $p(RESID,UL,2)'=DUZ(2) set RETSTR="{""error:"":""this is not the site requested""}" QUIT
"RTN","SYNDHP99",24,0)
 if +$p(RESID,UL,3)=0 set RETSTR="{""error:"":""the file number must be numeric""}" QUIT
"RTN","SYNDHP99",25,0)
 if +$p(RESID,UL,4)=0 set RETSTR="{""error:"":""the record number must be numeric""}" QUIT
"RTN","SYNDHP99",26,0)
 ;
"RTN","SYNDHP99",27,0)
 ;load file array
"RTN","SYNDHP99",28,0)
 new IDX,FILES,VFILES,FNBR,EP,FNAME
"RTN","SYNDHP99",29,0)
 for IDX=1:1 set FILES=$p($t(FILELIST+IDX),";;",2) QUIT:FILES="zzzzz"  do
"RTN","SYNDHP99",30,0)
 . set FNBR=$p(FILES,P,1)
"RTN","SYNDHP99",31,0)
 . set EP=$p(FILES,P,2)
"RTN","SYNDHP99",32,0)
 . set FNAME=$p(FILES,P,3)
"RTN","SYNDHP99",33,0)
 . set VFILES(FNBR)=EP_P_FNAME
"RTN","SYNDHP99",34,0)
 ;zwrite VFILES
"RTN","SYNDHP99",35,0)
 ;
"RTN","SYNDHP99",36,0)
 new FILE,RECORD
"RTN","SYNDHP99",37,0)
 set FILE=$p(RESID,UL,3)
"RTN","SYNDHP99",38,0)
 set RECORD=$p(RESID,UL,4)
"RTN","SYNDHP99",39,0)
 if '$d(VFILES(FILE)) set RETSTR="{""error:"":""this file is currently not supported""}" QUIT
"RTN","SYNDHP99",40,0)
 set:FILE=2.98 RECORD=+$O(^DPT(RECORD,"S",0))_","_RECORD_","
"RTN","SYNDHP99",41,0)
 if $$GET1^DIQ(FILE,RECORD_",",.01)="" set RETSTR="{""error:"":""the record was not found""}" QUIT
"RTN","SYNDHP99",42,0)
 set RECORD=$p(RESID,UL,4)
"RTN","SYNDHP99",43,0)
 ;
"RTN","SYNDHP99",44,0)
 new GETTER
"RTN","SYNDHP99",45,0)
 set GETTER=$p($g(VFILES(FILE)),P,1)
"RTN","SYNDHP99",46,0)
 if GETTER="" set RETSTR="{""error:"":""fatal internal error""}" QUIT
"RTN","SYNDHP99",47,0)
 new ARRAY,JSONSTR
"RTN","SYNDHP99",48,0)
 set GETTER=GETTER_"(.ARRAY,RECORD,""J"",.RETSTR)"
"RTN","SYNDHP99",49,0)
 do @GETTER
"RTN","SYNDHP99",50,0)
 ;
"RTN","SYNDHP99",51,0)
 QUIT
"RTN","SYNDHP99",52,0)
 ;
"RTN","SYNDHP99",53,0)
FILELIST ;file#|GETer routine|file name
"RTN","SYNDHP99",54,0)
 ;;2|GETPATIENT^SYNDHP20|Patient
"RTN","SYNDHP99",55,0)
 ;;2.98|GETPATAPPT^SYNDHP25|Patient Appointments
"RTN","SYNDHP99",56,0)
 ;;4|GET1SITE^SYNDHP10|Institution
"RTN","SYNDHP99",57,0)
 ;;26.13|GET1FLAG^SYNDHP17|PRF Assignment (flags)
"RTN","SYNDHP99",58,0)
 ;;44|GETHLOC^SYNDHP22|Hospital location
"RTN","SYNDHP99",59,0)
 ;;63|GETLABS^SYNDHP21|Lab Data
"RTN","SYNDHP99",60,0)
 ;;120.5|GET1VITALS^SYNDHP16|GMRV Vital Measurement
"RTN","SYNDHP99",61,0)
 ;;120.8|GET1ALLERGY^SYNDHP16|Patient Allergies
"RTN","SYNDHP99",62,0)
 ;;124.3|GET1GMR^SYNDHP15|GMR Text
"RTN","SYNDHP99",63,0)
 ;;216.8|GET1NCP^SYNDHP15|Nurs Care Plan
"RTN","SYNDHP99",64,0)
 ;;404.51|GET1TEAM^SYNDHP18|Team
"RTN","SYNDHP99",65,0)
 ;;404.52|ASGNHIST^SYNDHP19|Position Assignment History
"RTN","SYNDHP99",66,0)
 ;;404.53|PRECHIST^SYNDHP19|Preceptor Assignment History
"RTN","SYNDHP99",67,0)
 ;;404.57|TEAMPOS^SYNDHP18|Team Position
"RTN","SYNDHP99",68,0)
 ;;404.58|GET1TEAM^SYNDHP18|Team History
"RTN","SYNDHP99",69,0)
 ;;404.59|TEAMPOS^SYNDHP18|Team Position History
"RTN","SYNDHP99",70,0)
 ;;627.8|GET1MHDX^SYNDHP17|Diagnostic Report-Mental Health
"RTN","SYNDHP99",71,0)
 ;;8925|GET1TIU^SYNDHP24|TIU Document
"RTN","SYNDHP99",72,0)
 ;;9000010|GET1VISIT^SYNDHP13|Visit
"RTN","SYNDHP99",73,0)
 ;;9000010.06|GET1VPROV^SYNDHP23|V Provider
"RTN","SYNDHP99",74,0)
 ;;9000010.07|GET1VPOV^SYNDHP13|V POV
"RTN","SYNDHP99",75,0)
 ;;9000010.11|GET1IMMUN^SYNDHP12|V Immunization
"RTN","SYNDHP99",76,0)
 ;;9000010.18|GET1VCPT^SYNDHP14|V CPT
"RTN","SYNDHP99",77,0)
 ;;9000010.23|GET1HLF^SYNDHP15|V Health Factors
"RTN","SYNDHP99",78,0)
 ;;9000010.71|GET1VSCODE^SYNDHP14|V Standard Codes
"RTN","SYNDHP99",79,0)
 ;;9000011|GET1PROB^SYNDHP11|Problem
"RTN","SYNDHP99",80,0)
 ;;zzzzz
"RTN","SYNDHP99",81,0)
 ;
"RTN","SYNDHP99",82,0)
T1 ;
"RTN","SYNDHP99",83,0)
 N RESID S RESID="V_500_9000010_34494"
"RTN","SYNDHP99",84,0)
 N RETSTA
"RTN","SYNDHP99",85,0)
 D GETREC(.RETSTA,RESID)
"RTN","SYNDHP99",86,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP99",87,0)
 QUIT
"RTN","SYNDHP99",88,0)
 ;
"RTN","SYNDHP99",89,0)
T2 ;
"RTN","SYNDHP99",90,0)
 N RESID S RESID="V_500_2.98_33"
"RTN","SYNDHP99",91,0)
 N RETSTA
"RTN","SYNDHP99",92,0)
 D GETREC(.RETSTA,RESID)
"RTN","SYNDHP99",93,0)
 W $$ZW^SYNDHPUTL("RETSTA"),!!
"RTN","SYNDHP99",94,0)
 QUIT
"RTN","SYNDHP99",95,0)
 ;
"RTN","SYNDHPIC")
0^112^B2165360
"RTN","SYNDHPIC",1,0)
SYNDHPIC ;AFHIL DHP/fjf - HealthConcourse - get ICNs list ;03/28/2019
"RTN","SYNDHPIC",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHPIC",3,0)
 Q
"RTN","SYNDHPIC",4,0)
 ;
"RTN","SYNDHPIC",5,0)
ICNS(RETSTA,DHPCNT,DHPJSON) ; list all ICNs in a namespace
"RTN","SYNDHPIC",6,0)
 ;
"RTN","SYNDHPIC",7,0)
 ; Input: 
"RTN","SYNDHPIC",8,0)
 ;   DHPCNT  - Number of ICN's to return
"RTN","SYNDHPIC",9,0)
 ;               nn - Integer
"RTN","SYNDHPIC",10,0)
 ;               A  - all (default)
"RTN","SYNDHPIC",11,0)
 ;   DHPJSON - Return format
"RTN","SYNDHPIC",12,0)
 ;               J for JSON (default)
"RTN","SYNDHPIC",13,0)
 ;               T for plain text
"RTN","SYNDHPIC",14,0)
 ; Output:
"RTN","SYNDHPIC",15,0)
 ;   ICN's in JSON format, or
"RTN","SYNDHPIC",16,0)
 ;   ICN's in semicolon delimited text string
"RTN","SYNDHPIC",17,0)
 ; 
"RTN","SYNDHPIC",18,0)
 N ICNAR,JSICNS,ICN,N,I
"RTN","SYNDHPIC",19,0)
 S DHPCNT=$G(DHPCNT)
"RTN","SYNDHPIC",20,0)
 S DHPCNT=$S(+DHPCNT>0:DHPCNT,1:"A")
"RTN","SYNDHPIC",21,0)
 S DHPJSON=$G(DHPJSON,"J")
"RTN","SYNDHPIC",22,0)
 S ICN=""
"RTN","SYNDHPIC",23,0)
 F I=1:1 S ICN=$O(^DPT("AFICN",ICN)) Q:ICN=""  Q:DHPCNT'="A"&(I>DHPCNT)  D
"RTN","SYNDHPIC",24,0)
 .S ICNAR(ICN)=""
"RTN","SYNDHPIC",25,0)
 ;
"RTN","SYNDHPIC",26,0)
 I DHPJSON="J" D
"RTN","SYNDHPIC",27,0)
 .; put ICN array into json format
"RTN","SYNDHPIC",28,0)
 .D ENCODE^XLFJSON("ICNAR","JSICNS")
"RTN","SYNDHPIC",29,0)
 .; merge array elements into one string
"RTN","SYNDHPIC",30,0)
 .S (RETSTA,N)="" F  S N=$O(JSICNS(N)) Q:N=""  S RETSTA=RETSTA_JSICNS(N)
"RTN","SYNDHPIC",31,0)
 I DHPJSON'="J" D
"RTN","SYNDHPIC",32,0)
 .S (RETSTA,N)="" F  S N=$O(ICNAR(N)) Q:N=""  S RETSTA=RETSTA_N_";"
"RTN","SYNDHPIC",33,0)
 Q
"RTN","SYNDHPIC",34,0)
 ;
"RTN","SYNDHPIC",35,0)
TEST ; tests
"RTN","SYNDHPIC",36,0)
T1 ; count
"RTN","SYNDHPIC",37,0)
 F FT="T","J","" D
"RTN","SYNDHPIC",38,0)
 .S CT=7
"RTN","SYNDHPIC",39,0)
 .D ICNS(.ZXC,CT,FT)
"RTN","SYNDHPIC",40,0)
 .W !!!,$$ZW^SYNDHPUTL("ZXC")
"RTN","SYNDHPIC",41,0)
 Q
"RTN","SYNDHPIC",42,0)
T2 ; all
"RTN","SYNDHPIC",43,0)
 F FT="T","J","" D
"RTN","SYNDHPIC",44,0)
 .S CT="A"
"RTN","SYNDHPIC",45,0)
 .D ICNS(.ZXC,"T")
"RTN","SYNDHPIC",46,0)
 .W !!!,$$ZW^SYNDHPUTL("ZXC")
"RTN","SYNDHPIC",47,0)
 Q
"RTN","SYNDHPMP")
0^20^B33584325
"RTN","SYNDHPMP",1,0)
SYNDHPMP ; AFHIL/FJF - HealthConcourse - terminology mapping ;03/26/2019
"RTN","SYNDHPMP",2,0)
 ;;0.1;VISTA SYNTHETIC DATA LOADER;;Aug 17, 2018;Build 49
"RTN","SYNDHPMP",3,0)
 ;;
"RTN","SYNDHPMP",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHPMP",5,0)
 ;
"RTN","SYNDHPMP",6,0)
MAP(MAP,CODE,DIR,IOE) ; Return a mapped code for a given code
"RTN","SYNDHPMP",7,0)
 ; 
"RTN","SYNDHPMP",8,0)
 ;--------------------------------------------------------------------
"RTN","SYNDHPMP",9,0)
 ;
"RTN","SYNDHPMP",10,0)
 ; Input:
"RTN","SYNDHPMP",11,0)
 ;   MAP - mapping to be used
"RTN","SYNDHPMP",12,0)
 ;       currently the maps implemented are "sct2icd" (5/18/2018)
"RTN","SYNDHPMP",13,0)
 ;                                          "sct2cpt" (9/07/2018)
"RTN","SYNDHPMP",14,0)
 ;                                          "sct2icdnine" (8/28/2018)
"RTN","SYNDHPMP",15,0)
 ;                                          "mh2loinc" (9/07/2018)
"RTN","SYNDHPMP",16,0)
 ;                                          "mh2sct" (9/07/2018)
"RTN","SYNDHPMP",17,0)
 ;                                          "sct2hf" (9/07/2018)
"RTN","SYNDHPMP",18,0)
 ;                                          "flag2sct" (02/01/2019)
"RTN","SYNDHPMP",19,0)
 ;                                          "sct2vit" (02/01/2019)
"RTN","SYNDHPMP",20,0)
 ;                                          "ctpos2sct (02/01/2019)
"RTN","SYNDHPMP",21,0)
 ;                                          "rxn2ndf" (02/01/2019)
"RTN","SYNDHPMP",22,0)
 ;                                          "sct2os5" (02/02/2019)
"RTN","SYNDHPMP",23,0)
 ;
"RTN","SYNDHPMP",24,0)
 ;   CODE - map source code
"RTN","SYNDHPMP",25,0)
 ;   DIR  - direction of mapping
"RTN","SYNDHPMP",26,0)
 ;       D for direct (default)
"RTN","SYNDHPMP",27,0)
 ;       I for inverse
"RTN","SYNDHPMP",28,0)
 ;   IOE  - use internal or exernal mappings
"RTN","SYNDHPMP",29,0)
 ;       I for internal SYN VistA(default)
"RTN","SYNDHPMP",30,0)
 ;       H for external Health Concourse
"RTN","SYNDHPMP",31,0)
 ; 
"RTN","SYNDHPMP",32,0)
 ; Output:
"RTN","SYNDHPMP",33,0)
 ;   1^map target code
"RTN","SYNDHPMP",34,0)
 ;   or -1^exception
"RTN","SYNDHPMP",35,0)
 ;
"RTN","SYNDHPMP",36,0)
 ; -------------------------------------------------------------------
"RTN","SYNDHPMP",37,0)
 ; 
"RTN","SYNDHPMP",38,0)
MSTART ;
"RTN","SYNDHPMP",39,0)
 ;
"RTN","SYNDHPMP",40,0)
 N MAPA,MAPJ,MAPJ8,NODE,STA,RET,DOI,TAR,URL,C,P,SUB
"RTN","SYNDHPMP",41,0)
 S U="^",C=":",P="|"
"RTN","SYNDHPMP",42,0)
 S IOE=$S($G(IOE)="":"I",1:IOE)
"RTN","SYNDHPMP",43,0)
 I "|I|H|"'[(P_IOE_P) Q -1_U_"invalid IOE parameter"
"RTN","SYNDHPMP",44,0)
 S STA=1
"RTN","SYNDHPMP",45,0)
 I IOE'="I" D  Q STA_U_TAR
"RTN","SYNDHPMP",46,0)
 .; call the terminology server
"RTN","SYNDHPMP",47,0)
 .S RET=$$GETURL^XTHC10($$TRMURL(IOE),,"MAPJ")
"RTN","SYNDHPMP",48,0)
 .; check status of web call
"RTN","SYNDHPMP",49,0)
 .I +RET'=200 S STA=-1,TAR=+RET_C_$P(RET,U,2) Q
"RTN","SYNDHPMP",50,0)
 .; check for result returned from exernal server
"RTN","SYNDHPMP",51,0)
 .; change numbers in valueString attribute to string
"RTN","SYNDHPMP",52,0)
 .D NTS("MAPJ")
"RTN","SYNDHPMP",53,0)
 .; decode the JSON into M array 
"RTN","SYNDHPMP",54,0)
 .D DECODE^XLFJSON("MAPJ","MAPA")
"RTN","SYNDHPMP",55,0)
 .I '$D(MAPA) S STA=-1,TAR="code not mapped" Q
"RTN","SYNDHPMP",56,0)
 .; convert the number_" " back to a number
"RTN","SYNDHPMP",57,0)
 .D RMS("MAPA")
"RTN","SYNDHPMP",58,0)
 .S NODE="MAPA",TAR=""
"RTN","SYNDHPMP",59,0)
 .F  S NODE=$Q(@NODE) Q:NODE=""  Q:TAR'=""  D
"RTN","SYNDHPMP",60,0)
 ..Q:$QS(NODE,5)'="name"
"RTN","SYNDHPMP",61,0)
 ..Q:@NODE'="code"
"RTN","SYNDHPMP",62,0)
 ..S TAR=MAPA($QS(NODE,1),$QS(NODE,2),$QS(NODE,3),$QS(NODE,4),"valueString")
"RTN","SYNDHPMP",63,0)
 .I TAR="" S STA=-1,TAR="code not mapped" Q
"RTN","SYNDHPMP",64,0)
 ;I IOE'="I" Q 1_U_TAR
"RTN","SYNDHPMP",65,0)
 ;
"RTN","SYNDHPMP",66,0)
 ; if we are here then the caller passed I or null in the IOE parameter
"RTN","SYNDHPMP",67,0)
 ;
"RTN","SYNDHPMP",68,0)
 N DOI,FN,TAR
"RTN","SYNDHPMP",69,0)
 S FN="2002.030"
"RTN","SYNDHPMP",70,0)
 S DIR=$G(DIR,"D")
"RTN","SYNDHPMP",71,0)
 S DOI=$S(DIR="I":"inverse",1:"direct")
"RTN","SYNDHPMP",72,0)
 I '$D(^SYN(FN,MAP)) Q "-1^code not mapped"
"RTN","SYNDHPMP",73,0)
 I '$D(^SYN(FN,MAP,DOI,CODE)) Q "-1^code not mapped"
"RTN","SYNDHPMP",74,0)
 S TAR=$O(^SYN(FN,MAP,DOI,CODE,""))
"RTN","SYNDHPMP",75,0)
 I MAP="sct2icd" S TAR=$TR(TAR,"?","A")
"RTN","SYNDHPMP",76,0)
 ;W !,"Internal"
"RTN","SYNDHPMP",77,0)
 Q 1_U_TAR
"RTN","SYNDHPMP",78,0)
 ;
"RTN","SYNDHPMP",79,0)
 ;
"RTN","SYNDHPMP",80,0)
TRMURL(EXSRV) ; create url of mapping service
"RTN","SYNDHPMP",81,0)
 ;
"RTN","SYNDHPMP",82,0)
 ; once we have url - infuse it with mapping identifier and source code
"RTN","SYNDHPMP",83,0)
 ; currently Health Concourse is only supported external server
"RTN","SYNDHPMP",84,0)
 ; for additional servers add appropriate url builder below
"RTN","SYNDHPMP",85,0)
 ; 
"RTN","SYNDHPMP",86,0)
 ; Health Concourse
"RTN","SYNDHPMP",87,0)
 I EXSRV="H" D
"RTN","SYNDHPMP",88,0)
 .S URL="https://terminology-service.dev.openplatform.healthcare/vista2/"_MAP_"?searchString="_CODE
"RTN","SYNDHPMP",89,0)
 ;
"RTN","SYNDHPMP",90,0)
 ; Wolters Kluwer
"RTN","SYNDHPMP",91,0)
 ; I EXSRV="W" D
"RTN","SYNDHPMP",92,0)
 ; .S URL="https://Wolters Kluwer terminology-service_url with MAP and CODE"
"RTN","SYNDHPMP",93,0)
 ;
"RTN","SYNDHPMP",94,0)
 Q URL
"RTN","SYNDHPMP",95,0)
 ;
"RTN","SYNDHPMP",96,0)
MAPR(SURFORM,SFTYPE,MAOR) ; map reactions (SNOMED CT)
"RTN","SYNDHPMP",97,0)
 ; map an allergic reaction surface form to an SCT code
"RTN","SYNDHPMP",98,0)
 ; Input:
"RTN","SYNDHPMP",99,0)
 ;   SURFORM - surface form
"RTN","SYNDHPMP",100,0)
 ;   TYPE    - type of surface form
"RTN","SYNDHPMP",101,0)
 ;             I - IEN
"RTN","SYNDHPMP",102,0)
 ;             T - term
"RTN","SYNDHPMP",103,0)
 ;   MAOR    - allergen or reaction
"RTN","SYNDHPMP",104,0)
 ;             A - Allergen
"RTN","SYNDHPMP",105,0)
 ;             R - Reaction
"RTN","SYNDHPMP",106,0)
 ;
"RTN","SYNDHPMP",107,0)
 I SURFORM="" Q "-1^Surface form cannot be null"
"RTN","SYNDHPMP",108,0)
 I SFTYPE'="I",SFTYPE'="T" Q "-1^Type unrecognised - should be I or T"
"RTN","SYNDHPMP",109,0)
 I MAOR'="A",MAOR'="R" Q "-1^Allergy/Reaction indicator unrecognised - should be A or R"
"RTN","SYNDHPMP",110,0)
 N RSUB,INDX
"RTN","SYNDHPMP",111,0)
 S RSUB=$S(MAOR="A":"ALLERGENS",1:"REACTIONS")
"RTN","SYNDHPMP",112,0)
 S INDX=$S(SFTYPE="I":"ICT",1:"TCI")
"RTN","SYNDHPMP",113,0)
 I '$D(^SYN("2002.010",RSUB,INDX,SURFORM)) Q "unmapped"
"RTN","SYNDHPMP",114,0)
 QUIT $O(^SYN("2002.010",RSUB,INDX,SURFORM,""))
"RTN","SYNDHPMP",115,0)
 ;
"RTN","SYNDHPMP",116,0)
 ;
"RTN","SYNDHPMP",117,0)
TEST ; tests
"RTN","SYNDHPMP",118,0)
 ;
"RTN","SYNDHPMP",119,0)
T1(code) ; SNOMED CT to ICD
"RTN","SYNDHPMP",120,0)
 ; example SNOMED CT codes 37739004,37657006
"RTN","SYNDHPMP",121,0)
 n csys,intext,dirinv
"RTN","SYNDHPMP",122,0)
 f csys="sct2icd","sct2icdnine" d
"RTN","SYNDHPMP",123,0)
 .f intext="I","H" d
"RTN","SYNDHPMP",124,0)
 ..f dirinv="D" d
"RTN","SYNDHPMP",125,0)
 ...w !,csys," code ",code," ",$s(intext="I":"Internal",1:"External")
"RTN","SYNDHPMP",126,0)
 ...w !,$$MAP(csys,code,dirinv,intext)
"RTN","SYNDHPMP",127,0)
 Q
"RTN","SYNDHPMP",128,0)
 ;
"RTN","SYNDHPMP",129,0)
T2(code) ; mental health to SNOMED CT
"RTN","SYNDHPMP",130,0)
 ; example mental health codes PHQ-2,PHQ9,2
"RTN","SYNDHPMP",131,0)
 n csys,intext,dirinv
"RTN","SYNDHPMP",132,0)
 f csys="mh2sct" d
"RTN","SYNDHPMP",133,0)
 .f intext="I","H" d
"RTN","SYNDHPMP",134,0)
 ..f dirinv="D" d
"RTN","SYNDHPMP",135,0)
 ...w !,csys," code ",code," ",$s(intext="I":"Internal",1:"External")
"RTN","SYNDHPMP",136,0)
 ...w !,$$MAP(csys,code,dirinv,intext)
"RTN","SYNDHPMP",137,0)
 Q
"RTN","SYNDHPMP",138,0)
T3 ; new server (vista2) tests
"RTN","SYNDHPMP",139,0)
 ;
"RTN","SYNDHPMP",140,0)
T3V ;
"RTN","SYNDHPMP",141,0)
 K
"RTN","SYNDHPMP",142,0)
 ; sct2icd vista
"RTN","SYNDHPMP",143,0)
 S URLSV="https://terminology-service.dev.openplatform.healthcare/vista/sct2icd?searchString=37739004"
"RTN","SYNDHPMP",144,0)
 S RET=$$GETURL^XTHC10(URLSV,,"MAPSV")
"RTN","SYNDHPMP",145,0)
 D DECODE^XLFJSON("MAPSV","MAPSVO")
"RTN","SYNDHPMP",146,0)
 ; mh2sct vista
"RTN","SYNDHPMP",147,0)
 S URLMV="https://terminology-service.dev.openplatform.healthcare/vista/mh2sct?searchString=PHQ-2"
"RTN","SYNDHPMP",148,0)
 S RET=$$GETURL^XTHC10(URLMV,,"MAPMV") 
"RTN","SYNDHPMP",149,0)
 D DECODE^XLFJSON("MAPMV","MAPMVO")
"RTN","SYNDHPMP",150,0)
 ;
"RTN","SYNDHPMP",151,0)
 W !,URLSV,!!
"RTN","SYNDHPMP",152,0)
 ZW MAPSVO
"RTN","SYNDHPMP",153,0)
 w !!,URLMV,!!
"RTN","SYNDHPMP",154,0)
 ZW MAPMVO
"RTN","SYNDHPMP",155,0)
 ;
"RTN","SYNDHPMP",156,0)
 Q
"RTN","SYNDHPMP",157,0)
 ;
"RTN","SYNDHPMP",158,0)
T4V ;
"RTN","SYNDHPMP",159,0)
 K
"RTN","SYNDHPMP",160,0)
 ; sct2icd vista2
"RTN","SYNDHPMP",161,0)
 S URLSV="https://terminology-service.dev.openplatform.healthcare/vista2/sct2icd?searchString=37739004"
"RTN","SYNDHPMP",162,0)
 S RET=$$GETURL^XTHC10(URLSV,,"MAPSV")
"RTN","SYNDHPMP",163,0)
 ; now scan json in MPASV to find string that look like numbers
"RTN","SYNDHPMP",164,0)
 ; and convert them to strings by concateneating space
"RTN","SYNDHPMP",165,0)
 D NTS("MAPSV")
"RTN","SYNDHPMP",166,0)
 ; 
"RTN","SYNDHPMP",167,0)
 D DECODE^XLFJSON("MAPSV","MAPSVO")
"RTN","SYNDHPMP",168,0)
 ; now that json decodon complete remove space
"RTN","SYNDHPMP",169,0)
 ;D RMS("MAPSVO")
"RTN","SYNDHPMP",170,0)
 ; mh2sct vista
"RTN","SYNDHPMP",171,0)
 S URLMV="https://terminology-service.dev.openplatform.healthcare/vista2/mh2sct?searchString=PHQ-2"
"RTN","SYNDHPMP",172,0)
 S RET=$$GETURL^XTHC10(URLMV,,"MAPMV")
"RTN","SYNDHPMP",173,0)
 ; now scan json in MPAMV to find string that look like numbers
"RTN","SYNDHPMP",174,0)
 ; and convert them to strings by concateneating space
"RTN","SYNDHPMP",175,0)
 D NTS("MAPMV")
"RTN","SYNDHPMP",176,0)
 ;
"RTN","SYNDHPMP",177,0)
 D DECODE^XLFJSON("MAPMV","MAPMVO")
"RTN","SYNDHPMP",178,0)
 ;
"RTN","SYNDHPMP",179,0)
 W !,URLSV,!!
"RTN","SYNDHPMP",180,0)
 ZW MAPSVO
"RTN","SYNDHPMP",181,0)
 w !!,URLMV,!!
"RTN","SYNDHPMP",182,0)
 ZW MAPMVO
"RTN","SYNDHPMP",183,0)
 ;
"RTN","SYNDHPMP",184,0)
 Q
"RTN","SYNDHPMP",185,0)
NTS(JSONA) ; change numbers to string to accommodate XTHC10 quirk
"RTN","SYNDHPMP",186,0)
 ;
"RTN","SYNDHPMP",187,0)
 N N,VALUE
"RTN","SYNDHPMP",188,0)
 S N=JSONA
"RTN","SYNDHPMP",189,0)
 F  S N=$Q(@N) Q:N=""  D
"RTN","SYNDHPMP",190,0)
 .Q:@N'["valueString"
"RTN","SYNDHPMP",191,0)
 .S VALUE=$P($P(@N,":",2),"""",2)
"RTN","SYNDHPMP",192,0)
 .Q:VALUE'?1N.N
"RTN","SYNDHPMP",193,0)
 .S VALUE=VALUE_" "
"RTN","SYNDHPMP",194,0)
 .S $P(@N,"""",4)=VALUE
"RTN","SYNDHPMP",195,0)
 Q
"RTN","SYNDHPMP",196,0)
RMS(JSONA) ; convert numeric string to a number
"RTN","SYNDHPMP",197,0)
 ;
"RTN","SYNDHPMP",198,0)
 N N,VALUE
"RTN","SYNDHPMP",199,0)
 S N=JSONA
"RTN","SYNDHPMP",200,0)
 F  S N=$Q(@N) Q:N=""  D
"RTN","SYNDHPMP",201,0)
 .Q:N'["valueString"
"RTN","SYNDHPMP",202,0)
 .S VALUE=@N
"RTN","SYNDHPMP",203,0)
 .Q:VALUE'?1N.N1" "
"RTN","SYNDHPMP",204,0)
 .S VALUE=+VALUE
"RTN","SYNDHPMP",205,0)
 .S @N=VALUE
"RTN","SYNDHPMP",206,0)
 Q
"RTN","SYNDHPMP",207,0)
 
"RTN","SYNDHPTS1")
0^114^B11127832
"RTN","SYNDHPTS1",1,0)
SYNDHPTS1 ;AFHIL DHP/fjf/art - HealthConcourse - DHP REST handlers ;12/04/2018
"RTN","SYNDHPTS1",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHPTS1",3,0)
 ;
"RTN","SYNDHPTS1",4,0)
 ;
"RTN","SYNDHPTS1",5,0)
CTRL ;
"RTN","SYNDHPTS1",6,0)
 ;
"RTN","SYNDHPTS1",7,0)
 D GTCALLS
"RTN","SYNDHPTS1",8,0)
 S DHPFRDAT=18401231
"RTN","SYNDHPTS1",9,0)
 S DHPTODAT=20501231
"RTN","SYNDHPTS1",10,0)
 S DHPJSON=""
"RTN","SYNDHPTS1",11,0)
 S DHPICN="" F  S DHPICN=$O(^DPT("AFICN",DHPICN)) Q:DHPICN=""  D
"RTN","SYNDHPTS1",12,0)
 .;W !,DHPICN Q
"RTN","SYNDHPTS1",13,0)
 .;D PATLABI
"RTN","SYNDHPTS1",14,0)
 .;I RETSTA["2000-8" W !!!!!! ZW RETSTA
"RTN","SYNDHPTS1",15,0)
 .;Q
"RTN","SYNDHPTS1",16,0)
 .S CALL=""
"RTN","SYNDHPTS1",17,0)
 .F  S CALL=$O(CALLS(CALL)) Q:CALL=""  D
"RTN","SYNDHPTS1",18,0)
 ..;W !,"Before ",$G(CALL),! ;R *R
"RTN","SYNDHPTS1",19,0)
 ..;ZW  ;R !,ZZXC
"RTN","SYNDHPTS1",20,0)
 ..;W !!,"Still before",! ;R *R
"RTN","SYNDHPTS1",21,0)
 ..K RETSTA
"RTN","SYNDHPTS1",22,0)
 ..D @CALL
"RTN","SYNDHPTS1",23,0)
 ..W !!!! ZW RETSTA
"RTN","SYNDHPTS1",24,0)
 Q
"RTN","SYNDHPTS1",25,0)
GTCALLS ; set up call list
"RTN","SYNDHPTS1",26,0)
 F I=1:1 Q:$T(+I)=""  D
"RTN","SYNDHPTS1",27,0)
 .S LOC=$T(+I)
"RTN","SYNDHPTS1",28,0)
 .I $P(LOC," ")'="",$E(LOC,1,3)="PAT" S CALLS($P(LOC," "))=""
"RTN","SYNDHPTS1",29,0)
 Q
"RTN","SYNDHPTS1",30,0)
 ;
"RTN","SYNDHPTS1",31,0)
PATDEMI ; get patient demographics for one patient
"RTN","SYNDHPTS1",32,0)
 ;
"RTN","SYNDHPTS1",33,0)
 D PATDEMI^SYNDHP47(.RETSTA,DHPICN,DHPJSON)
"RTN","SYNDHPTS1",34,0)
 Q
"RTN","SYNDHPTS1",35,0)
 ;
"RTN","SYNDHPTS1",36,0)
PATCONI ; get patient conditions for one patient by ICN
"RTN","SYNDHPTS1",37,0)
 ;
"RTN","SYNDHPTS1",38,0)
 D PATCONI^SYNDHP03(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",39,0)
 Q
"RTN","SYNDHPTS1",40,0)
 ;
"RTN","SYNDHPTS1",41,0)
 ;
"RTN","SYNDHPTS1",42,0)
PATENCI ; get patient encounters for one patient by ICN
"RTN","SYNDHPTS1",43,0)
 ;
"RTN","SYNDHPTS1",44,0)
 D PATENCI^SYNDHP40(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",45,0)
 Q
"RTN","SYNDHPTS1",46,0)
 ;  
"RTN","SYNDHPTS1",47,0)
 ; --------------------------------------------------
"RTN","SYNDHPTS1",48,0)
 ;
"RTN","SYNDHPTS1",49,0)
PATMEDS ; get patient medication statement for one patient by ICN
"RTN","SYNDHPTS1",50,0)
 ;
"RTN","SYNDHPTS1",51,0)
 D PATMEDS^SYNDHP48(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",52,0)
 Q
"RTN","SYNDHPTS1",53,0)
 ;
"RTN","SYNDHPTS1",54,0)
PATMEDA ; get patient medication administration for one patient by ICN
"RTN","SYNDHPTS1",55,0)
 ;
"RTN","SYNDHPTS1",56,0)
 D PATMEDA^SYNDHP48(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",57,0)
 Q
"RTN","SYNDHPTS1",58,0)
 ;
"RTN","SYNDHPTS1",59,0)
PATMEDD ; get patient medication dispense for one patient by ICN
"RTN","SYNDHPTS1",60,0)
 ;
"RTN","SYNDHPTS1",61,0)
 D PATMEDD^SYNDHP48(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",62,0)
 Q
"RTN","SYNDHPTS1",63,0)
 ;
"RTN","SYNDHPTS1",64,0)
PATVITI ; get patient vitals for one patient by ICN
"RTN","SYNDHPTS1",65,0)
 ;
"RTN","SYNDHPTS1",66,0)
 D PATVITI^SYNDHP01(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",67,0)
 Q
"RTN","SYNDHPTS1",68,0)
 ;
"RTN","SYNDHPTS1",69,0)
PATHLFI ; get patient health factors for one patient
"RTN","SYNDHPTS1",70,0)
 ;
"RTN","SYNDHPTS1",71,0)
 D PATHLFI^SYNDHP09(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",72,0)
 Q
"RTN","SYNDHPTS1",73,0)
 ;
"RTN","SYNDHPTS1",74,0)
PATPRCI ; get patient procedures for one patient
"RTN","SYNDHPTS1",75,0)
 ;
"RTN","SYNDHPTS1",76,0)
 D PATPRCI^SYNDHP04(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",77,0)
 Q
"RTN","SYNDHPTS1",78,0)
 ;
"RTN","SYNDHPTS1",79,0)
PATALLI ; get patient allergies for one patient by ICN
"RTN","SYNDHPTS1",80,0)
 ;
"RTN","SYNDHPTS1",81,0)
 D PATALLI^SYNDHP57(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",82,0)
 Q
"RTN","SYNDHPTS1",83,0)
 ;
"RTN","SYNDHPTS1",84,0)
 ;
"RTN","SYNDHPTS1",85,0)
PATDXREP ; get patient diagnostic report for one patient by ICN
"RTN","SYNDHPTS1",86,0)
 ;
"RTN","SYNDHPTS1",87,0)
 D PATDXRI^SYNDHP05(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",88,0)
 Q
"RTN","SYNDHPTS1",89,0)
 ;
"RTN","SYNDHPTS1",90,0)
PATLABI ; get patient labs for one patient
"RTN","SYNDHPTS1",91,0)
 ;
"RTN","SYNDHPTS1",92,0)
 D PATLABI^SYNDHP53(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",93,0)
 Q
"RTN","SYNDHPTS1",94,0)
 ;
"RTN","SYNDHPTS1",95,0)
PATPRVI ; get patient encounter providers for one patient
"RTN","SYNDHPTS1",96,0)
 ;
"RTN","SYNDHPTS1",97,0)
 D PATPRVI^SYNDHP54(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",98,0)
 Q
"RTN","SYNDHPTS1",99,0)
 ;
"RTN","SYNDHPTS1",100,0)
PATAPTI ; get patient appointments for one patient
"RTN","SYNDHPTS1",101,0)
 ;
"RTN","SYNDHPTS1",102,0)
 D PATAPTI^SYNDHP41(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",103,0)
 Q
"RTN","SYNDHPTS1",104,0)
 ;
"RTN","SYNDHPTS1",105,0)
PATFLGI ; get patient flags for one patient
"RTN","SYNDHPTS1",106,0)
 ;
"RTN","SYNDHPTS1",107,0)
 D PATFLGI^SYNDHP08(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",108,0)
 Q
"RTN","SYNDHPTS1",109,0)
 ;
"RTN","SYNDHPTS1",110,0)
PATIMMI ; get patient immunizations for one patient
"RTN","SYNDHPTS1",111,0)
 ;
"RTN","SYNDHPTS1",112,0)
 D PATIMMI^SYNDHP02(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",113,0)
 Q
"RTN","SYNDHPTS1",114,0)
 ;
"RTN","SYNDHPTS1",115,0)
PATGOLI ; get patient goals for one patient
"RTN","SYNDHPTS1",116,0)
 ;
"RTN","SYNDHPTS1",117,0)
 D PATGOLI^SYNDHP07(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",118,0)
 Q
"RTN","SYNDHPTS1",119,0)
 ;
"RTN","SYNDHPTS1",120,0)
PATOBSI ; get patient observations for one patient
"RTN","SYNDHPTS1",121,0)
 ;
"RTN","SYNDHPTS1",122,0)
 D PATOBSI^SYNDHP56(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",123,0)
 Q
"RTN","SYNDHPTS1",124,0)
 ;
"RTN","SYNDHPTS1",125,0)
PATCPALLI ; get all care plans for a patient
"RTN","SYNDHPTS1",126,0)
 ;
"RTN","SYNDHPTS1",127,0)
 D PATCPALLI^SYNDHP59(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT,DHPJSON)
"RTN","SYNDHPTS1",128,0)
 Q
"RTN","SYNDHPTS1",129,0)
 ;
"RTN","SYNDHPTS1",130,0)
PATCPI ; get one care plan for a patient
"RTN","SYNDHPTS1",131,0)
 ;
"RTN","SYNDHPTS1",132,0)
 ; need DHPVRESID for this call
"RTN","SYNDHPTS1",133,0)
 ;D PATCPI^SYNDHP59(.RETSTA,DHPICN,DHPVRESID,DHPJSON)
"RTN","SYNDHPTS1",134,0)
 Q
"RTN","SYNDHPTS1",135,0)
PATTIUI ; get patient notes for one patient by ICN
"RTN","SYNDHPTS1",136,0)
 ;
"RTN","SYNDHPTS1",137,0)
 D PATTIUI^SYNDHP67(.RETSTA,DHPICN,DHPFRDAT,DHPTODAT)
"RTN","SYNDHPTS1",138,0)
 Q
"RTN","SYNDHPTS1",139,0)
 ;
"RTN","SYNDHPUTL")
0^74^B31232465
"RTN","SYNDHPUTL",1,0)
SYNDHPUTL ; HC/art - HealthConcourse - various utilities ;04/08/2019
"RTN","SYNDHPUTL",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDHPUTL",3,0)
 ;;
"RTN","SYNDHPUTL",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNDHPUTL",5,0)
 ;
"RTN","SYNDHPUTL",6,0)
 QUIT
"RTN","SYNDHPUTL",7,0)
 ;
"RTN","SYNDHPUTL",8,0)
TOJASON(ARRAY,JSONSTR) ;convert input array to JSON string
"RTN","SYNDHPUTL",9,0)
 ;input:  ARRAY - input array
"RTN","SYNDHPUTL",10,0)
 ;output: JSONSTR - JSON string
"RTN","SYNDHPUTL",11,0)
 ;
"RTN","SYNDHPUTL",12,0)
 N ERR,TMP
"RTN","SYNDHPUTL",13,0)
 D ENCODE^XLFJSON("ARRAY","TMP","ERR")
"RTN","SYNDHPUTL",14,0)
 ;I $G(DEBUG),$D(ERR) W !,">>ERROR<<" ZWRITE ERR
"RTN","SYNDHPUTL",15,0)
 ;I $G(DEBUG) W ! ZWRITE TMP
"RTN","SYNDHPUTL",16,0)
 ;
"RTN","SYNDHPUTL",17,0)
 S JSONSTR=""
"RTN","SYNDHPUTL",18,0)
 N IDX S IDX=""
"RTN","SYNDHPUTL",19,0)
 F  S IDX=$O(TMP(IDX)) QUIT:IDX=""  D
"RTN","SYNDHPUTL",20,0)
 . S JSONSTR=JSONSTR_$G(TMP(IDX))
"RTN","SYNDHPUTL",21,0)
 ;I $G(DEBUG) W ! ZWRITE JSONSTR
"RTN","SYNDHPUTL",22,0)
 ;
"RTN","SYNDHPUTL",23,0)
 QUIT
"RTN","SYNDHPUTL",24,0)
 ;
"RTN","SYNDHPUTL",25,0)
TOFHIR(ARRAY,FHIRARRAY) ;create FHIR tagged array from input array
"RTN","SYNDHPUTL",26,0)
 ;input:  ARRAY - input array
"RTN","SYNDHPUTL",27,0)
 ;output: FHIRARRAY - FHIR array
"RTN","SYNDHPUTL",28,0)
 ;
"RTN","SYNDHPUTL",29,0)
 ;
"RTN","SYNDHPUTL",30,0)
 QUIT
"RTN","SYNDHPUTL",31,0)
 ;
"RTN","SYNDHPUTL",32,0)
meta(fields,fileNbr) ;return field metadata
"RTN","SYNDHPUTL",33,0)
 ;input: fileNbr - file number
"RTN","SYNDHPUTL",34,0)
 ;output: fields - return array
"RTN","SYNDHPUTL",35,0)
 ;        fields(fieldNbr)=fieldName^fieldNameCC^fieldType^fieldValueSet^pointsTo
"RTN","SYNDHPUTL",36,0)
 ;
"RTN","SYNDHPUTL",37,0)
 n node0,fieldName,fieldNameCC,fieldType,fieldValueSet,pointsTo
"RTN","SYNDHPUTL",38,0)
 n fieldNbr s fieldNbr=0
"RTN","SYNDHPUTL",39,0)
 f  s fieldNbr=$o(^DD(fileNbr,fieldNbr)) quit:'+fieldNbr  d
"RTN","SYNDHPUTL",40,0)
 . s node0=^DD(fileNbr,fieldNbr,0)
"RTN","SYNDHPUTL",41,0)
 . s fieldName=$p(node0,U,1)
"RTN","SYNDHPUTL",42,0)
 . s fieldNameCC=$$camelCase(fieldName)
"RTN","SYNDHPUTL",43,0)
 . s fieldType=$p(node0,U,2)
"RTN","SYNDHPUTL",44,0)
 . s fieldType=$s(+fieldType:"M",fieldType["P":"P",fieldType["F":"F",fieldType["D":"D",fieldType["N":"N",fieldType["S":"S",fieldType["C":"C",fieldType["V":"V",1:"")
"RTN","SYNDHPUTL",45,0)
 . s fieldValueSet=$s(fieldType="S":$p(node0,U,3),1:"")
"RTN","SYNDHPUTL",46,0)
 . s pointsTo=$s(fieldType="P":+$p($p(node0,U,2),"P",2),1:"")
"RTN","SYNDHPUTL",47,0)
 . s fields(fieldNbr)=fieldName_U_fieldNameCC_U_fieldType_U_fieldValueSet_U_pointsTo_U
"RTN","SYNDHPUTL",48,0)
 ;
"RTN","SYNDHPUTL",49,0)
 ;i $g(DEBUG) w !,"fields",! zwrite fields
"RTN","SYNDHPUTL",50,0)
 ;
"RTN","SYNDHPUTL",51,0)
 QUIT
"RTN","SYNDHPUTL",52,0)
 ;
"RTN","SYNDHPUTL",53,0)
camelCase(x) ;return a string in camel case
"RTN","SYNDHPUTL",54,0)
 ;input: x - string
"RTN","SYNDHPUTL",55,0)
 ;return: camel case string
"RTN","SYNDHPUTL",56,0)
 ;
"RTN","SYNDHPUTL",57,0)
 s x=$tr(x,"`-=[]\;',./~!@#$%^&*()_+{}|:""<>?","                                 ") ;eol is out here
"RTN","SYNDHPUTL",58,0)
 s x=$$TITLE^XLFSTR(x)
"RTN","SYNDHPUTL",59,0)
 s $p(x," ",1)=$$LOW^XLFSTR($p(x," ",1))
"RTN","SYNDHPUTL",60,0)
 s x=$$STRIP^XLFSTR(x," ")
"RTN","SYNDHPUTL",61,0)
 ;
"RTN","SYNDHPUTL",62,0)
 QUIT x
"RTN","SYNDHPUTL",63,0)
 ;
"RTN","SYNDHPUTL",64,0)
PATLIST ;Get list of patients from %wd graph
"RTN","SYNDHPUTL",65,0)
 ;
"RTN","SYNDHPUTL",66,0)
 N IEN,DFN,ICN,NAME
"RTN","SYNDHPUTL",67,0)
 W !,"Patient Name",?33,"Graph IEN",?45,"DFN",?55,"ICN",!
"RTN","SYNDHPUTL",68,0)
 S IEN=0
"RTN","SYNDHPUTL",69,0)
 F  S IEN=$O(^%wd(17.040801,1,IEN)) QUIT:'+IEN  DO
"RTN","SYNDHPUTL",70,0)
 . S DFN=$$ien2dfn^SYNFUTL(IEN)
"RTN","SYNDHPUTL",71,0)
 . S ICN=$$ien2icn^SYNFUTL(IEN)
"RTN","SYNDHPUTL",72,0)
 . S NAME=$$GET1^DIQ(2,DFN_",",.01)
"RTN","SYNDHPUTL",73,0)
 . W NAME,?35,IEN,?45,DFN,?55,ICN,!
"RTN","SYNDHPUTL",74,0)
 QUIT
"RTN","SYNDHPUTL",75,0)
 ;
"RTN","SYNDHPUTL",76,0)
GETOS() ;
"RTN","SYNDHPUTL",77,0)
 ;Determine OS
"RTN","SYNDHPUTL",78,0)
 NEW ZZOS
"RTN","SYNDHPUTL",79,0)
 SET ZZOS=$$OS^%ZOSV()
"RTN","SYNDHPUTL",80,0)
 SET ZZOS=$SELECT(ZZOS["VMS":"1-VMS",ZZOS["NT":"2-MSW",ZZOS["UNIX":"3-LINUX",1:"0-")
"RTN","SYNDHPUTL",81,0)
 ;W !,ZZOS,!
"RTN","SYNDHPUTL",82,0)
 QUIT ZZOS
"RTN","SYNDHPUTL",83,0)
 ;
"RTN","SYNDHPUTL",84,0)
OPEN(ZZFILE,ZZDIR,ZZFILENM,ZZMODE) ;Open a File
"RTN","SYNDHPUTL",85,0)
 ; Inputs - ZZFILE - File tag to open
"RTN","SYNDHPUTL",86,0)
 ;          ZZDIR - Host File Directory Name
"RTN","SYNDHPUTL",87,0)
 ;          ZZFILENM - File Name
"RTN","SYNDHPUTL",88,0)
 ;          ZZMODE - Open mode - R=Read, W=Write, A=Append
"RTN","SYNDHPUTL",89,0)
 ; Output - 1 if file was opened
"RTN","SYNDHPUTL",90,0)
 ;          0 if not opened
"RTN","SYNDHPUTL",91,0)
 ;          IO - opened device designator
"RTN","SYNDHPUTL",92,0)
 ;
"RTN","SYNDHPUTL",93,0)
 NEW POP
"RTN","SYNDHPUTL",94,0)
 DO OPEN^%ZISH(ZZFILE,ZZDIR,ZZFILENM,ZZMODE)
"RTN","SYNDHPUTL",95,0)
 IF POP DO  QUIT 0
"RTN","SYNDHPUTL",96,0)
 . USE 0
"RTN","SYNDHPUTL",97,0)
 . WRITE !,"ERROR: Could not open the file: ",ZZDIR,"\",ZZFILENM,!
"RTN","SYNDHPUTL",98,0)
 . WRITE "       Ensure the directory name is valid.",!
"RTN","SYNDHPUTL",99,0)
 QUIT 1
"RTN","SYNDHPUTL",100,0)
 ;
"RTN","SYNDHPUTL",101,0)
CLOSE(ZZFILE) ;Close a File
"RTN","SYNDHPUTL",102,0)
 ; Input  - ZZFILE - File tag to close
"RTN","SYNDHPUTL",103,0)
 ; Output - none
"RTN","SYNDHPUTL",104,0)
 ;
"RTN","SYNDHPUTL",105,0)
 DO CLOSE^%ZISH(ZZFILE)
"RTN","SYNDHPUTL",106,0)
 QUIT
"RTN","SYNDHPUTL",107,0)
 ;
"RTN","SYNDHPUTL",108,0)
EOF() ;Test for EOF
"RTN","SYNDHPUTL",109,0)
 ; Input  - none
"RTN","SYNDHPUTL",110,0)
 ; Output - 1 if end of file has been reached
"RTN","SYNDHPUTL",111,0)
 ;
"RTN","SYNDHPUTL",112,0)
 QUIT $$STATUS^%ZISH
"RTN","SYNDHPUTL",113,0)
 ;
"RTN","SYNDHPUTL",114,0)
GETDFN(ZZPNAME) ;Get patient's DFN
"RTN","SYNDHPUTL",115,0)
 ;Inputs - ZZPNAME - Patient name
"RTN","SYNDHPUTL",116,0)
 ;Returns - Patient DFN
"RTN","SYNDHPUTL",117,0)
 ;
"RTN","SYNDHPUTL",118,0)
 QUIT:$GET(ZZPNAME)="" "0^Missing name"
"RTN","SYNDHPUTL",119,0)
 ;
"RTN","SYNDHPUTL",120,0)
 NEW ZZDFN,ZZMSG
"RTN","SYNDHPUTL",121,0)
 SET ZZDFN=$$FIND1^DIC(2,,"BQUX",ZZPNAME,"B",,"ZZMSG")
"RTN","SYNDHPUTL",122,0)
 ;
"RTN","SYNDHPUTL",123,0)
 QUIT ZZDFN
"RTN","SYNDHPUTL",124,0)
 ;
"RTN","SYNDHPUTL",125,0)
GETIEN(ZZFILE,ZZNAME) ;Get IEN for name
"RTN","SYNDHPUTL",126,0)
 ;Inputs - ZZFILE - File number
"RTN","SYNDHPUTL",127,0)
 ;         ZZNAME - name (.01 field)
"RTN","SYNDHPUTL",128,0)
 ;Returns - IEN
"RTN","SYNDHPUTL",129,0)
 ;
"RTN","SYNDHPUTL",130,0)
 QUIT:$GET(ZZFILE)="" "0^Missing file number"
"RTN","SYNDHPUTL",131,0)
 QUIT:$GET(ZZNAME)="" "0^Missing name"
"RTN","SYNDHPUTL",132,0)
 ;
"RTN","SYNDHPUTL",133,0)
 NEW ZZIEN,ZZMSG
"RTN","SYNDHPUTL",134,0)
 SET ZZIEN=$$FIND1^DIC(ZZFILE,,"BQUX",ZZNAME,"B",,"ZZMSG")
"RTN","SYNDHPUTL",135,0)
 ;
"RTN","SYNDHPUTL",136,0)
 QUIT ZZIEN
"RTN","SYNDHPUTL",137,0)
 ;
"RTN","SYNDHPUTL",138,0)
UICN(PATIEN) ; ICN for IEN
"RTN","SYNDHPUTL",139,0)
 ; 
"RTN","SYNDHPUTL",140,0)
 Q $$GET1^DIQ(2,PATIEN_",",991.1)
"RTN","SYNDHPUTL",141,0)
 ;
"RTN","SYNDHPUTL",142,0)
ICN(IEN) ; obtain ICN
"RTN","SYNDHPUTL",143,0)
 N ICN
"RTN","SYNDHPUTL",144,0)
 S ICN=$$GET1^DIQ(2,IEN_",",991.1)
"RTN","SYNDHPUTL",145,0)
 I ICN="" D
"RTN","SYNDHPUTL",146,0)
 . S ICN=$$GET1^DIQ(2,IEN_",",991.01)_"V"_$$GET1^DIQ(2,IEN_",",991.02)
"RTN","SYNDHPUTL",147,0)
 Q ICN
"RTN","SYNDHPUTL",148,0)
 ;
"RTN","SYNDHPUTL",149,0)
UICNVAL(ICN) ; validate ICN
"RTN","SYNDHPUTL",150,0)
 ; Input: ICN
"RTN","SYNDHPUTL",151,0)
 ; Returns: 0 - invalid
"RTN","SYNDHPUTL",152,0)
 ;          1 - valid
"RTN","SYNDHPUTL",153,0)
 ;
"RTN","SYNDHPUTL",154,0)
 I $G(ICN)="" Q 0
"RTN","SYNDHPUTL",155,0)
 I '$D(^DPT("AFICN",ICN)) Q 0
"RTN","SYNDHPUTL",156,0)
 QUIT 1
"RTN","SYNDHPUTL",157,0)
 ;
"RTN","SYNDHPUTL",158,0)
USCTPT(SCT) ; SNOMED CT preferred term
"RTN","SYNDHPUTL",159,0)
 ;Input: SCT - SNOMED Code
"RTN","SYNDHPUTL",160,0)
 ;Returns: SCT Preferred Term
"RTN","SYNDHPUTL",161,0)
 ;
"RTN","SYNDHPUTL",162,0)
 N LEX,PREF
"RTN","SYNDHPUTL",163,0)
 S LEX=$$CODE^LEXTRAN(SCT,"SCT")
"RTN","SYNDHPUTL",164,0)
 S PREF=""
"RTN","SYNDHPUTL",165,0)
 I $D(LEX("P")) S PREF=LEX("P")
"RTN","SYNDHPUTL",166,0)
 Q PREF
"RTN","SYNDHPUTL",167,0)
 ;
"RTN","SYNDHPUTL",168,0)
DATECNVT(DATE) ;convert DATE to Fileman format
"RTN","SYNDHPUTL",169,0)
 ;
"RTN","SYNDHPUTL",170,0)
 I $G(DATE)="" QUIT ""
"RTN","SYNDHPUTL",171,0)
 N %DT S %DT="T"
"RTN","SYNDHPUTL",172,0)
 N X S X=DATE
"RTN","SYNDHPUTL",173,0)
 N Y
"RTN","SYNDHPUTL",174,0)
 D ^%DT
"RTN","SYNDHPUTL",175,0)
 QUIT Y
"RTN","SYNDHPUTL",176,0)
 ;
"RTN","SYNDHPUTL",177,0)
FMTFHIR(FMDATE) ;Convert Fileman date to FHIR date
"RTN","SYNDHPUTL",178,0)
 ;Inputs - FMDATE - Fileman date/time
"RTN","SYNDHPUTL",179,0)
 ;Returns - FHIR Date
"RTN","SYNDHPUTL",180,0)
 ;
"RTN","SYNDHPUTL",181,0)
 QUIT:$GET(FMDATE)="" ""
"RTN","SYNDHPUTL",182,0)
 ;
"RTN","SYNDHPUTL",183,0)
 NEW FHIRDATE SET FHIRDATE=""
"RTN","SYNDHPUTL",184,0)
 ;
"RTN","SYNDHPUTL",185,0)
 I $L(FMDATE)<7 QUIT ""
"RTN","SYNDHPUTL",186,0)
 I $L(FMDATE)=7 D  QUIT FHIRDATE
"RTN","SYNDHPUTL",187,0)
 . S FHIRDATE=$E(FMDATE,1,3)+1700_"-"_$E(FMDATE,4,5)_"-"_$E(FMDATE,6,7)
"RTN","SYNDHPUTL",188,0)
 ;
"RTN","SYNDHPUTL",189,0)
 N hl7,dtm,tz
"RTN","SYNDHPUTL",190,0)
 S hl7=$$FMTHL7^XLFDT(FMDATE)
"RTN","SYNDHPUTL",191,0)
 I hl7="" QUIT ""
"RTN","SYNDHPUTL",192,0)
 I hl7=-1 QUIT -1
"RTN","SYNDHPUTL",193,0)
 S dtm=$P(hl7,"-",1)
"RTN","SYNDHPUTL",194,0)
 S tz="-"_$E($P(hl7,"-",2),1,2)_":"_$E($P(hl7,"-",2),3,4)
"RTN","SYNDHPUTL",195,0)
 S FHIRDATE=$E(hl7,1,4)_"-"_$E(hl7,5,6)_"-"_$E(hl7,7,8)_"T"_$E(hl7,9,10)_":"_$E(hl7,11,12)_":"_$S(+$E(hl7,13,14)>0:$E(hl7,13,14),1:"00")_tz
"RTN","SYNDHPUTL",196,0)
 ;
"RTN","SYNDHPUTL",197,0)
 QUIT FHIRDATE
"RTN","SYNDHPUTL",198,0)
 ;
"RTN","SYNDHPUTL",199,0)
CTRLS(X) ; strip control characters
"RTN","SYNDHPUTL",200,0)
 N I,CTRLS
"RTN","SYNDHPUTL",201,0)
 S CTRLS=""
"RTN","SYNDHPUTL",202,0)
 F I=1:1:31,127:1:190 S CTRLS=CTRLS_$C(I)
"RTN","SYNDHPUTL",203,0)
 Q $TR(X,CTRLS)
"RTN","SYNDHPUTL",204,0)
 ;
"RTN","SYNDHPUTL",205,0)
ZW(VAR) ; simulate Cach or GT.M ZW or ZWRITE fuction
"RTN","SYNDHPUTL",206,0)
 ; VAR - variable to be ZWritten
"RTN","SYNDHPUTL",207,0)
 ; 
"RTN","SYNDHPUTL",208,0)
 N TSUB,I
"RTN","SYNDHPUTL",209,0)
 W $G(@VAR)
"RTN","SYNDHPUTL",210,0)
 S TSUB=VAR F I=1:1 S TSUB=$Q(@TSUB) Q:TSUB'[VAR  W !,TSUB,"=",@TSUB
"RTN","SYNDHPUTL",211,0)
 Q ""
"RTN","SYNDHPUTL",212,0)
 ;
"RTN","SYNDHPUTL",213,0)
ICNPAT(ICN) ; patient for ICN
"RTN","SYNDHPUTL",214,0)
 ; Input: ICN
"RTN","SYNDHPUTL",215,0)
 ; Returns: 0 - invalid
"RTN","SYNDHPUTL",216,0)
 ;          ICN^IEN^NAME - valid
"RTN","SYNDHPUTL",217,0)
 ;
"RTN","SYNDHPUTL",218,0)
 I $G(ICN)="" Q 0
"RTN","SYNDHPUTL",219,0)
 I '$D(^DPT("AFICN",ICN)) Q 0
"RTN","SYNDHPUTL",220,0)
 N PATIEN S PATIEN=$O(^DPT("AFICN",ICN,""))
"RTN","SYNDHPUTL",221,0)
 N PATNAME S PATNAME=$$GET1^DIQ(2,PATIEN,.01)
"RTN","SYNDHPUTL",222,0)
 QUIT ICN_U_PATIEN_U_PATNAME
"RTN","SYNDHPUTL",223,0)
 ;
"RTN","SYNDTS89")
0^111^B37105881
"RTN","SYNDTS89",1,0)
SYNDTS89 ;AFHIL/HC/fjf - HealthConcourse - REST service tester ;03/28/2019
"RTN","SYNDTS89",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNDTS89",3,0)
 ;;
"RTN","SYNDTS89",4,0)
 ; This routine tests the Health Concourse GETter REST services
"RTN","SYNDTS89",5,0)
 ;
"RTN","SYNDTS89",6,0)
 ; It specifically tests those services that have a request URL in the following format:
"RTN","SYNDTS89",7,0)
 ; http://ip-address-port/endpoint?ICN=icn&JSON=flag
"RTN","SYNDTS89",8,0)
 ; the architecture can be extended to accommodate those REST services
"RTN","SYNDTS89",9,0)
 ; that don't conveniently fit the above pattern
"RTN","SYNDTS89",10,0)
 ;
"RTN","SYNDTS89",11,0)
 ; the routine currently returns the REST call url for json and non-json
"RTN","SYNDTS89",12,0)
 ; plus the relevant data in the appropriate format for the resource 
"RTN","SYNDTS89",13,0)
 ;
"RTN","SYNDTS89",14,0)
ctrl(nopats,server) ;
"RTN","SYNDTS89",15,0)
 ; Input:
"RTN","SYNDTS89",16,0)
 ;   nopats - number of patiens per system
"RTN","SYNDTS89",17,0)
 ;     if nopats is not passed or evaluates to 0 then all patiens
"RTN","SYNDTS89",18,0)
 ;     will be tested
"RTN","SYNDTS89",19,0)
 ;   server - 
"RTN","SYNDTS89",20,0)
 ;     if server is not defined in url roots then then all servers 
"RTN","SYNDTS89",21,0)
 ;     will be tested
"RTN","SYNDTS89",22,0)
 ;          
"RTN","SYNDTS89",23,0)
 ;
"RTN","SYNDTS89",24,0)
 ; create array of urls of systems to be tested
"RTN","SYNDTS89",25,0)
 s server=$g(server,"none")
"RTN","SYNDTS89",26,0)
 d urlrts
"RTN","SYNDTS89",27,0)
 ;
"RTN","SYNDTS89",28,0)
 ; create array of patient data endpoints to be tested
"RTN","SYNDTS89",29,0)
 d endpoints
"RTN","SYNDTS89",30,0)
 ;
"RTN","SYNDTS89",31,0)
 ; start of scan by url by patient by endpoint
"RTN","SYNDTS89",32,0)
 s (icn,url,endpoint)=""
"RTN","SYNDTS89",33,0)
 s nopats=$g(nopats)
"RTN","SYNDTS89",34,0)
 s s=";"
"RTN","SYNDTS89",35,0)
 s urlab=""
"RTN","SYNDTS89",36,0)
 f  s urlab=$o(urlrt(urlab)) q:urlab=""  d
"RTN","SYNDTS89",37,0)
 .s url=urlrt(urlab)
"RTN","SYNDTS89",38,0)
 .; find ICN's in namespace denoted by url+port
"RTN","SYNDTS89",39,0)
 .s icns=$$icnstr(url)
"RTN","SYNDTS89",40,0)
 .i +nopats=0 s nopats=$l(icns,s)
"RTN","SYNDTS89",41,0)
 .s icns=$p(icns,s,1,nopats)
"RTN","SYNDTS89",42,0)
 .w !,"icns ",!,icns,!
"RTN","SYNDTS89",43,0)
 .; for namepace (specified by url+port) scan through ICN's
"RTN","SYNDTS89",44,0)
 .s pats=+$g(nopats)
"RTN","SYNDTS89",45,0)
 .i pats=0 s pats=$l(icns,s)
"RTN","SYNDTS89",46,0)
 .f i=1:1:pats s icn=$p(icns,s,i) q:icn=""  d
"RTN","SYNDTS89",47,0)
 ..;for ICN's scan through endpoints
"RTN","SYNDTS89",48,0)
 ..s endpoint=""
"RTN","SYNDTS89",49,0)
 ..f  s endpoint=$o(endpoints(endpoint)) q:endpoint=""  d
"RTN","SYNDTS89",50,0)
 ...f format="","J" d
"RTN","SYNDTS89",51,0)
 ....; build patient getter REST service URL and make call
"RTN","SYNDTS89",52,0)
 ....s RESTurl=$$RESTurl(url,endpoint,icn,,,format)
"RTN","SYNDTS89",53,0)
 ....w !,RESTurl,!
"RTN","SYNDTS89",54,0)
 ....s RET=$$GETURL^XTHC10(RESTurl,,"PDATA")
"RTN","SYNDTS89",55,0)
 ....i '$d(PDATA) w !,"no data" q
"RTN","SYNDTS89",56,0)
 ....s datstr=$$xthc2st(.PDATA)
"RTN","SYNDTS89",57,0)
 ....w !,datstr,!
"RTN","SYNDTS89",58,0)
 Q
"RTN","SYNDTS89",59,0)
 ;
"RTN","SYNDTS89",60,0)
icnstr(url) ; create icn string for system at url
"RTN","SYNDTS89",61,0)
 ; invokes DHPPATICNALL service
"RTN","SYNDTS89",62,0)
 ; Input:
"RTN","SYNDTS89",63,0)
 ;   url of system of interest
"RTN","SYNDTS89",64,0)
 ; Ouput:
"RTN","SYNDTS89",65,0)
 ;   semicolon delimited list of ICN's
"RTN","SYNDTS89",66,0)
 ;
"RTN","SYNDTS89",67,0)
 n s,icnurl,RET,icns
"RTN","SYNDTS89",68,0)
 s s=";"
"RTN","SYNDTS89",69,0)
 s icnurl=url_"DHPPATICNALL?JSON=T"
"RTN","SYNDTS89",70,0)
 s RET=$$GETURL^XTHC10(icnurl,,"icnar")
"RTN","SYNDTS89",71,0)
 i +RET=-1 q RET
"RTN","SYNDTS89",72,0)
 s icnar=""
"RTN","SYNDTS89",73,0)
 s icns=$$xthc2st(.icnar)
"RTN","SYNDTS89",74,0)
 q icns
"RTN","SYNDTS89",75,0)
 ;
"RTN","SYNDTS89",76,0)
xthc2st(array) ; combines array elements from XTHC10 into a single string
"RTN","SYNDTS89",77,0)
 ; Input
"RTN","SYNDTS89",78,0)
 ;   array passed by reference
"RTN","SYNDTS89",79,0)
 ;
"RTN","SYNDTS89",80,0)
 n string,n,sub
"RTN","SYNDTS89",81,0)
 s sub=$o(array(""))
"RTN","SYNDTS89",82,0)
 s string=array(sub)
"RTN","SYNDTS89",83,0)
 s n=""
"RTN","SYNDTS89",84,0)
 f  s n=$o(array(sub,n)) q:n=""  d
"RTN","SYNDTS89",85,0)
 .s string=string_array(sub,n)
"RTN","SYNDTS89",86,0)
 .k array(sub,n)
"RTN","SYNDTS89",87,0)
 q string
"RTN","SYNDTS89",88,0)
 ;
"RTN","SYNDTS89",89,0)
RESTurl(url,endpoint,icn,fromdt,todt,format) ; create REST service URL
"RTN","SYNDTS89",90,0)
 ;
"RTN","SYNDTS89",91,0)
 s fromdt=$g(fromdt)
"RTN","SYNDTS89",92,0)
 s todt=$g(todt)
"RTN","SYNDTS89",93,0)
 s format=$g(format)
"RTN","SYNDTS89",94,0)
 s url=url_endpoint_"?ICN="_icn
"RTN","SYNDTS89",95,0)
 s:format'="" url=url_"&JSON="_format
"RTN","SYNDTS89",96,0)
 s:fromdt'="" url=url_"&FRDAT="_fromdt
"RTN","SYNDTS89",97,0)
 s:todt'="" url=url_"&TODAT="_todt
"RTN","SYNDTS89",98,0)
 q url
"RTN","SYNDTS89",99,0)
 ;
"RTN","SYNDTS89",100,0)
urlrts ; set up roots urls for healthConcourse dev
"RTN","SYNDTS89",101,0)
 k urlrt
"RTN","SYNDTS89",102,0)
 n s,t
"RTN","SYNDTS89",103,0)
 s s=";"
"RTN","SYNDTS89",104,0)
 f i=1:1 s t=$t(urlli+i) q:t["urlend"  d
"RTN","SYNDTS89",105,0)
 .s urlrt($p(t,s,4))=$p(t,s,3)
"RTN","SYNDTS89",106,0)
 i $d(urlrt(server)) d
"RTN","SYNDTS89",107,0)
 .s t=urlrt(server)
"RTN","SYNDTS89",108,0)
 .k urlrt
"RTN","SYNDTS89",109,0)
 .s urlrt(server)=t
"RTN","SYNDTS89",110,0)
 q
"RTN","SYNDTS89",111,0)
 ;
"RTN","SYNDTS89",112,0)
urlli ; list of url roots
"RTN","SYNDTS89",113,0)
 ;;http://ec2-18-208-29-125.compute-1.amazonaws.com:8001/;awsdev;                AWS dev
"RTN","SYNDTS89",114,0)
 ;;http://ec2-18-208-29-125.compute-1.amazonaws.com:9080/;awsdevshm;             AWS dev shim
"RTN","SYNDTS89",115,0)
 ;;https://vista.dev.openplatform.healthcare/rgnet-web/;k8dev;                   k8 dev
"RTN","SYNDTS89",116,0)
 ;;https://vista.dev.openplatform.healthcare/vpr-web/;k8devshm;                  k8 dev shim
"RTN","SYNDTS89",117,0)
 ;;https://vista.demo-staging.openplatform.healthcare/rgnet-web/;k8demstag;      k8 demo-staging
"RTN","SYNDTS89",118,0)
 ;;https://vista.demo-staging.openplatform.healthcare/rgnet-web/;k8demstagshm;   k8 demo-staging shim
"RTN","SYNDTS89",119,0)
 ;;https://vista.demo.openplatform.healthcare/rgnet-web/;k8demo;                 k8 demo
"RTN","SYNDTS89",120,0)
 ;;https://vista.demo.openplatform.healthcare/vpr-web/;k8demoshm;                k8 demo shim 
"RTN","SYNDTS89",121,0)
 ;;https://vista-general.dev.openplatform.healthcare/rgnet-web/;targen;          tardis general
"RTN","SYNDTS89",122,0)
 ;;https://vista-general.dev.openplatform.healthcare/vpr-web/;targenshm;         tardis general shim
"RTN","SYNDTS89",123,0)
 ;;https://vista-emergency.dev.openplatform.healthcare/rgnet-web/;taremer;       tardis emergency
"RTN","SYNDTS89",124,0)
 ;;https://vista-emergency.dev.openplatform.healthcare/vpr-web/;taremershm;      tardis emergency shim
"RTN","SYNDTS89",125,0)
 ;;https://vista-specialization.dev.openplatform.healthcare/rgnet-web/;tarspec;  tardis specialization
"RTN","SYNDTS89",126,0)
 ;;https://vista-specialization.dev.openplatform.healthcare/vpr-web/;tarspecshm; tardis specialization shim
"RTN","SYNDTS89",127,0)
 ;;http://shadow.vistaplex.org/;shadvplex;                                       GT.M server
"RTN","SYNDTS89",128,0)
 ;;http://syn.vistaplex.org/;synvplex;                                           GT.M server
"RTN","SYNDTS89",129,0)
 ;;urlend
"RTN","SYNDTS89",130,0)
 q
"RTN","SYNDTS89",131,0)
 ;
"RTN","SYNDTS89",132,0)
endpoints ; for patient data by ICN
"RTN","SYNDTS89",133,0)
 ; pattern is DHPPATxxxxxICN
"RTN","SYNDTS89",134,0)
 ;
"RTN","SYNDTS89",135,0)
 n n,s,q,pat
"RTN","SYNDTS89",136,0)
 s n="",s="/",q=""""
"RTN","SYNDTS89",137,0)
 s pat=1_q_"DHPPAT"_q_"2.5e"_1_q_"ICN"_q_".e"
"RTN","SYNDTS89",138,0)
 f  s n=$o(^RGNET(996.52,"B",n)) q:n=""  d
"RTN","SYNDTS89",139,0)
 .i n?@pat s endpoints($p(n,s))=""
"RTN","SYNDTS89",140,0)
 q
"RTN","SYNDTS89",141,0)
 ;;;;
"RTN","SYNDTS89",142,0)
ts ;
"RTN","SYNDTS89",143,0)
 ;
"RTN","SYNDTS89",144,0)
 s url="http://ec2-18-208-29-125.compute-1.amazonaws.com:8001/"
"RTN","SYNDTS89",145,0)
 s endpoint="DHPPATVITICN"
"RTN","SYNDTS89",146,0)
 s icn="9993306312V376330"
"RTN","SYNDTS89",147,0)
 s RESTurl=$$RESTurl(url,endpoint,icn,,,"J")
"RTN","SYNDTS89",148,0)
 s RET=$$GETURL^XTHC10(RESTurl,,"PDATA")
"RTN","SYNDTS89",149,0)
 q
"RTN","SYNGBLLD")
0^50^B144653085
"RTN","SYNGBLLD",1,0)
SYNGBLLD ; HC/ART - HealthConcourse - DHP load data in ^SYN("2002.030" global ;02/04/2019
"RTN","SYNGBLLD",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNGBLLD",3,0)
 ;;
"RTN","SYNGBLLD",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNGBLLD",5,0)
 ;
"RTN","SYNGBLLD",6,0)
 QUIT
"RTN","SYNGBLLD",7,0)
 ;
"RTN","SYNGBLLD",8,0)
EN ;load all
"RTN","SYNGBLLD",9,0)
 ;
"RTN","SYNGBLLD",10,0)
 D LOADMH
"RTN","SYNGBLLD",11,0)
 D LOADCPT
"RTN","SYNGBLLD",12,0)
 D LOADHF
"RTN","SYNGBLLD",13,0)
 D LOADVIT
"RTN","SYNGBLLD",14,0)
 D LOADPOS
"RTN","SYNGBLLD",15,0)
 D LOADFLAG
"RTN","SYNGBLLD",16,0)
 ;
"RTN","SYNGBLLD",17,0)
 QUIT
"RTN","SYNGBLLD",18,0)
 ;
"RTN","SYNGBLLD",19,0)
LOADMH ;load ^SYN mapping table for mental health instruments
"RTN","SYNGBLLD",20,0)
 N IDX,INSTRUMT,TESTID,TESTNAME,LOINC,SNOMED
"RTN","SYNGBLLD",21,0)
 K ^SYN("2002.030","mh2loinc")
"RTN","SYNGBLLD",22,0)
 K ^SYN("2002.030","mh2sct")
"RTN","SYNGBLLD",23,0)
 ;LOINC
"RTN","SYNGBLLD",24,0)
 S IDX=0
"RTN","SYNGBLLD",25,0)
 F  S IDX=IDX+1,INSTRUMT=$P($T(MHLOINC+IDX),";;",2) QUIT:INSTRUMT="zzzzz"  D
"RTN","SYNGBLLD",26,0)
 . S TESTID=$P(INSTRUMT,U,1)
"RTN","SYNGBLLD",27,0)
 . S TESTNAME=$P(INSTRUMT,U,2)
"RTN","SYNGBLLD",28,0)
 . S LOINC=$P(INSTRUMT,U,3)
"RTN","SYNGBLLD",29,0)
 . S:(TESTID'="")&(LOINC'="") ^SYN("2002.030","mh2loinc","direct",TESTID,LOINC)=""
"RTN","SYNGBLLD",30,0)
 . S:(TESTNAME'="")&(LOINC'="") ^SYN("2002.030","mh2loinc","direct",TESTNAME,LOINC)=""
"RTN","SYNGBLLD",31,0)
 . S:(TESTID'="")&(LOINC'="") ^SYN("2002.030","mh2loinc","inverse",LOINC,TESTID)=""
"RTN","SYNGBLLD",32,0)
 ;SNOMED
"RTN","SYNGBLLD",33,0)
 S IDX=0
"RTN","SYNGBLLD",34,0)
 F  S IDX=IDX+1,INSTRUMT=$P($T(MHSNOMED+IDX),";;",2) QUIT:INSTRUMT="zzzzz"  D
"RTN","SYNGBLLD",35,0)
 . S TESTID=$P(INSTRUMT,U,1)
"RTN","SYNGBLLD",36,0)
 . S TESTNAME=$P(INSTRUMT,U,2)
"RTN","SYNGBLLD",37,0)
 . S SNOMED=$P(INSTRUMT,U,3)
"RTN","SYNGBLLD",38,0)
 . S:(TESTID'="")&(SNOMED'="") ^SYN("2002.030","mh2sct","direct",TESTID,SNOMED)=""
"RTN","SYNGBLLD",39,0)
 . S:(TESTNAME'="")&(SNOMED'="") ^SYN("2002.030","mh2sct","direct",TESTNAME,SNOMED)=""
"RTN","SYNGBLLD",40,0)
 . S:(TESTID'="")&(SNOMED'="") ^SYN("2002.030","mh2sct","inverse",SNOMED,TESTID)=""
"RTN","SYNGBLLD",41,0)
 ;
"RTN","SYNGBLLD",42,0)
 QUIT
"RTN","SYNGBLLD",43,0)
 ;
"RTN","SYNGBLLD",44,0)
LOADCPT ;load ^SYN mapping table for SCT to CPT
"RTN","SYNGBLLD",45,0)
 N IDX,LINE,LOINC,SCT,CPT,DESC
"RTN","SYNGBLLD",46,0)
 K ^SYN("2002.030","sct2cpt")
"RTN","SYNGBLLD",47,0)
 S IDX=0
"RTN","SYNGBLLD",48,0)
 F  S IDX=IDX+1,LINE=$P($T(CPT2SCT+IDX),";;",2) QUIT:LINE="zzzzz"  D
"RTN","SYNGBLLD",49,0)
 . S CPT=$P(LINE,U,1)
"RTN","SYNGBLLD",50,0)
 . S SCT=$P(LINE,U,2)
"RTN","SYNGBLLD",51,0)
 . S DESC=$P(LINE,U,3)
"RTN","SYNGBLLD",52,0)
 . I CPT'="",SCT'="" D
"RTN","SYNGBLLD",53,0)
 . . S ^SYN("2002.030","sct2cpt","direct",SCT,CPT)=DESC
"RTN","SYNGBLLD",54,0)
 . . S ^SYN("2002.030","sct2cpt","inverse",CPT,SCT)=DESC
"RTN","SYNGBLLD",55,0)
 ;
"RTN","SYNGBLLD",56,0)
 QUIT
"RTN","SYNGBLLD",57,0)
 ;
"RTN","SYNGBLLD",58,0)
LOADHF ;load ^SYN mapping table for SCT to health factors
"RTN","SYNGBLLD",59,0)
 N IDX,LINE,SCT,HFIEN,DESC
"RTN","SYNGBLLD",60,0)
 K ^SYN("2002.030","sct2hf")
"RTN","SYNGBLLD",61,0)
 S IDX=0
"RTN","SYNGBLLD",62,0)
 F  S IDX=IDX+1,LINE=$P($T(SCT2HF+IDX),";;",2) QUIT:LINE="zzzzz"  D
"RTN","SYNGBLLD",63,0)
 . S SCT=$P(LINE,U,1)
"RTN","SYNGBLLD",64,0)
 . S HFIEN=$P(LINE,U,2)
"RTN","SYNGBLLD",65,0)
 . S DESC=$P(LINE,U,3)
"RTN","SYNGBLLD",66,0)
 . I SCT'="",HFIEN'="" D
"RTN","SYNGBLLD",67,0)
 . . S ^SYN("2002.030","sct2hf","direct",SCT,HFIEN)=DESC
"RTN","SYNGBLLD",68,0)
 . . S ^SYN("2002.030","sct2hf","inverse",HFIEN,SCT)=DESC
"RTN","SYNGBLLD",69,0)
 ;
"RTN","SYNGBLLD",70,0)
 QUIT
"RTN","SYNGBLLD",71,0)
 ;
"RTN","SYNGBLLD",72,0)
LOADVIT ;load ^SYN mapping table for SCT to health factors
"RTN","SYNGBLLD",73,0)
 ; VistA Vital Type (file 120.51)
"RTN","SYNGBLLD",74,0)
 N IDX,LINE,SCT,VITIEN,DESC
"RTN","SYNGBLLD",75,0)
 K ^SYN("2002.030","sct2vit")
"RTN","SYNGBLLD",76,0)
 S IDX=0
"RTN","SYNGBLLD",77,0)
 F  S IDX=IDX+1,LINE=$P($T(SCT2VIT+IDX),";;",2) QUIT:LINE="zzzzz"  D
"RTN","SYNGBLLD",78,0)
 . S SCT=$P(LINE,U,1)
"RTN","SYNGBLLD",79,0)
 . S VITIEN=$P(LINE,U,2)
"RTN","SYNGBLLD",80,0)
 . S DESC=$P(LINE,U,3)
"RTN","SYNGBLLD",81,0)
 . I SCT'="",VITIEN'="" D
"RTN","SYNGBLLD",82,0)
 . . S ^SYN("2002.030","sct2vit","direct",SCT,VITIEN)=DESC
"RTN","SYNGBLLD",83,0)
 . . S ^SYN("2002.030","sct2vit","inverse",VITIEN,SCT)=DESC
"RTN","SYNGBLLD",84,0)
 ;
"RTN","SYNGBLLD",85,0)
 QUIT
"RTN","SYNGBLLD",86,0)
 ;
"RTN","SYNGBLLD",87,0)
LOADPOS ;load ^SYN mapping table for care team positions
"RTN","SYNGBLLD",88,0)
 N IDX,POSITION,POSID,POSNAME,SNOMED
"RTN","SYNGBLLD",89,0)
 K ^SYN("2002.030","ctpos2sct")
"RTN","SYNGBLLD",90,0)
 S IDX=0
"RTN","SYNGBLLD",91,0)
 F  S IDX=IDX+1,POSITION=$P($T(POSSCT+IDX),";;",2) QUIT:POSITION="zzzzz"  D
"RTN","SYNGBLLD",92,0)
 . S POSID=$P(POSITION,U,1)
"RTN","SYNGBLLD",93,0)
 . S POSNAME=$P(POSITION,U,2)
"RTN","SYNGBLLD",94,0)
 . S SNOMED=$P(POSITION,U,3)
"RTN","SYNGBLLD",95,0)
 . S:(POSID'="")&(SNOMED'="") ^SYN("2002.030","ctpos2sct","direct",POSID,SNOMED)=""
"RTN","SYNGBLLD",96,0)
 . S:(POSNAME'="")&(SNOMED'="") ^SYN("2002.030","ctpos2sct","direct",POSNAME,SNOMED)=""
"RTN","SYNGBLLD",97,0)
 . S:(POSID'="")&(SNOMED'="") ^SYN("2002.030","ctpos2sct","inverse",SNOMED,POSID)=""
"RTN","SYNGBLLD",98,0)
 ;
"RTN","SYNGBLLD",99,0)
 QUIT
"RTN","SYNGBLLD",100,0)
 ;
"RTN","SYNGBLLD",101,0)
LOADFLAG ;load ^SYN mapping table for patient flags
"RTN","SYNGBLLD",102,0)
 N IDX,FLAGS,FLAGID,FLAGNAME,SNOMED
"RTN","SYNGBLLD",103,0)
 K ^SYN("2002.030","flag2sct")
"RTN","SYNGBLLD",104,0)
 S IDX=0
"RTN","SYNGBLLD",105,0)
 F  S IDX=IDX+1,FLAGS=$P($T(FLAGSCT+IDX),";;",2) QUIT:FLAGS="zzzzz"  D
"RTN","SYNGBLLD",106,0)
 . S FLAGID=$P(FLAGS,U,1)
"RTN","SYNGBLLD",107,0)
 . S FLAGNAME=$P(FLAGS,U,3)
"RTN","SYNGBLLD",108,0)
 . S SNOMED=$P(FLAGS,U,2)
"RTN","SYNGBLLD",109,0)
 . S:(FLAGID'="")&(SNOMED'="") ^SYN("2002.030","flag2sct","direct",FLAGID,SNOMED)=FLAGNAME
"RTN","SYNGBLLD",110,0)
 . S:(FLAGID'="")&(SNOMED'="") ^SYN("2002.030","flag2sct","inverse",SNOMED,FLAGID)=FLAGNAME
"RTN","SYNGBLLD",111,0)
 ;
"RTN","SYNGBLLD",112,0)
 QUIT
"RTN","SYNGBLLD",113,0)
 ;
"RTN","SYNGBLLD",114,0)
MHLOINC ; id^name^loinc
"RTN","SYNGBLLD",115,0)
 ;;5^AUDC^
"RTN","SYNGBLLD",116,0)
 ;;11^BDI2^89209-1
"RTN","SYNGBLLD",117,0)
 ;;^CESD-R^89205-9
"RTN","SYNGBLLD",118,0)
 ;;159^GAD-7^70274-6
"RTN","SYNGBLLD",119,0)
 ;;89^GDS^48544-1
"RTN","SYNGBLLD",120,0)
 ;;65^MORSE FALL SCALE^59460-6
"RTN","SYNGBLLD",121,0)
 ;;56^PC PTSD^71754-6
"RTN","SYNGBLLD",122,0)
 ;;71^PHQ-2^55758-7
"RTN","SYNGBLLD",123,0)
 ;;42^PHQ9^44249-1
"RTN","SYNGBLLD",124,0)
 ;;177^VR-12^72009-4
"RTN","SYNGBLLD",125,0)
 ;;^VR-12 T score^72017-7
"RTN","SYNGBLLD",126,0)
 ;;^Suicide Risk^89560-7
"RTN","SYNGBLLD",127,0)
 ;;^PROMIS-10 score^71970-8
"RTN","SYNGBLLD",128,0)
 ;;^PROMIS-10 T score^71969-0
"RTN","SYNGBLLD",129,0)
 ;;^PCLC^70221-7
"RTN","SYNGBLLD",130,0)
 ;;zzzzz
"RTN","SYNGBLLD",131,0)
 ;
"RTN","SYNGBLLD",132,0)
MHSNOMED ; id^name^sct^desc
"RTN","SYNGBLLD",133,0)
 ;;71^PHQ-2^454711000124102^Depression screening using Patient Health Questionnaire Two-Item score (procedure)
"RTN","SYNGBLLD",134,0)
 ;;42^PHQ9^715252007^Depression screening using Patient Health Questionnaire Nine Item score (procedure)
"RTN","SYNGBLLD",135,0)
 ;;zzzzz
"RTN","SYNGBLLD",136,0)
 ;
"RTN","SYNGBLLD",137,0)
CPT2SCT ; cpt^sct^cpt desc
"RTN","SYNGBLLD",138,0)
 ;;10060^428297005^Excision of Cyst
"RTN","SYNGBLLD",139,0)
 ;;11000^19780006^Debridement of Infection of Skin
"RTN","SYNGBLLD",140,0)
 ;;20225^56241004^Bone Marrow Biopsy
"RTN","SYNGBLLD",141,0)
 ;;27299^28181007^Operation on hip joint
"RTN","SYNGBLLD",142,0)
 ;;44391^73761001^Colonoscopy
"RTN","SYNGBLLD",143,0)
 ;;47562^45595009^Laparoscopic cholecystectomy
"RTN","SYNGBLLD",144,0)
 ;;49315^80146002^Appendectomy
"RTN","SYNGBLLD",145,0)
 ;;55250^22523008^Vasectomy
"RTN","SYNGBLLD",146,0)
 ;;64721^10431008^Neuroplasty of median nerve at carpal tunnel
"RTN","SYNGBLLD",147,0)
 ;;77056^71388002^Mammogram Both Breasts
"RTN","SYNGBLLD",148,0)
 ;;99201^185347001^Office/outpatient visit new
"RTN","SYNGBLLD",149,0)
 ;;99202^185349003^Office/outpatient visit new
"RTN","SYNGBLLD",150,0)
 ;;99205^308335008^Office/outpatient visit new
"RTN","SYNGBLLD",151,0)
 ;;99213^185345009^Office/outpatient visit est
"RTN","SYNGBLLD",152,0)
 ;;99238^308646001^Hospital discharge day
"RTN","SYNGBLLD",153,0)
 ;;99241^394701000^Office consultation
"RTN","SYNGBLLD",154,0)
 ;;99281^50849002^Emergency dept visit
"RTN","SYNGBLLD",155,0)
 ;;99285^4525004^Emergency dept visit
"RTN","SYNGBLLD",156,0)
 ;;99381^183478001^INIT PM E/M NEW PAT INF
"RTN","SYNGBLLD",157,0)
 ;;99383^170258001^PREV VISIT NEW AGE 5-11
"RTN","SYNGBLLD",158,0)
 ;;99408^105355005^
"RTN","SYNGBLLD",159,0)
 ;;59426^424441002^
"RTN","SYNGBLLD",160,0)
 ;;99218^183460006^
"RTN","SYNGBLLD",161,0)
 ;;59425^424619006^
"RTN","SYNGBLLD",162,0)
 ;;55810^10492003^
"RTN","SYNGBLLD",163,0)
 ;;77427^84755001^
"RTN","SYNGBLLD",164,0)
 ;;59400^10745001^
"RTN","SYNGBLLD",165,0)
 ;;66840^10178000^
"RTN","SYNGBLLD",166,0)
 ;;44388^12350003^
"RTN","SYNGBLLD",167,0)
 ;;27130^15163009^
"RTN","SYNGBLLD",168,0)
 ;;59409^177184002^
"RTN","SYNGBLLD",169,0)
 ;;27447^179344006^
"RTN","SYNGBLLD",170,0)
 ;;65235^13767004^
"RTN","SYNGBLLD",171,0)
 ;;90937^108241001^
"RTN","SYNGBLLD",172,0)
 ;;90653^442333005^
"RTN","SYNGBLLD",173,0)
 ;;45378^444783004^
"RTN","SYNGBLLD",174,0)
 ;;D1206^234723000^
"RTN","SYNGBLLD",175,0)
 ;;zzzzz
"RTN","SYNGBLLD",176,0)
 ;;10120^^Remove foreign body
"RTN","SYNGBLLD",177,0)
 ;;99211^^Office/outpatient visit established
"RTN","SYNGBLLD",178,0)
 ;
"RTN","SYNGBLLD",179,0)
SCT2HF ; sct^hf ien^desc
"RTN","SYNGBLLD",180,0)
 ;;266919005^5^Never smoked tobacco
"RTN","SYNGBLLD",181,0)
 ;;405746006^2^Current non-smoker
"RTN","SYNGBLLD",182,0)
 ;;8517006^4^Ex-smoker
"RTN","SYNGBLLD",183,0)
 ;;266890009^15^Family History of Alcoholism
"RTN","SYNGBLLD",184,0)
 ;;219006^12^Current drinker of alcohol
"RTN","SYNGBLLD",185,0)
 ;;371434005^13^History of alcohol abuse
"RTN","SYNGBLLD",186,0)
 ;;zzzzz
"RTN","SYNGBLLD",187,0)
 ;
"RTN","SYNGBLLD",188,0)
SCT2VIT ; sct^vital ien^desc  (VistA Vital Type (file 120.51))
"RTN","SYNGBLLD",189,0)
 ;;27113001^9^Body weight
"RTN","SYNGBLLD",190,0)
 ;;50373000^8^Body height
"RTN","SYNGBLLD",191,0)
 ;;75367002^1^Blood pressure
"RTN","SYNGBLLD",192,0)
 ;;78564009^5^Pulse rate
"RTN","SYNGBLLD",193,0)
 ;;386725007^2^Body Temperature
"RTN","SYNGBLLD",194,0)
 ;;86290005^3^Respiration
"RTN","SYNGBLLD",195,0)
 ;;48094003^10^Abdominal girth measurement
"RTN","SYNGBLLD",196,0)
 ;;21727005^11^Audiometry
"RTN","SYNGBLLD",197,0)
 ;;252465000^21^Pulse oximetry
"RTN","SYNGBLLD",198,0)
 ;;22253000^22^Pain
"RTN","SYNGBLLD",199,0)
 ;;zzzzz
"RTN","SYNGBLLD",200,0)
 ;
"RTN","SYNGBLLD",201,0)
POSSCT ; id^name^sct
"RTN","SYNGBLLD",202,0)
 ;;45^ADDICTION THERAPIST^
"RTN","SYNGBLLD",203,0)
 ;;46^ADDICTION THERAPIST (MHTC)^
"RTN","SYNGBLLD",204,0)
 ;;13^ADMIN COORDINATOR^106331006
"RTN","SYNGBLLD",205,0)
 ;;56^ADMINISTRATIVE ASSOCIATE^224608005
"RTN","SYNGBLLD",206,0)
 ;;58^ADVANCE PRACTICE ASSOCIATE PROVIDER^
"RTN","SYNGBLLD",207,0)
 ;;71^ADVANCE PRACTICE NURSE^
"RTN","SYNGBLLD",208,0)
 ;;72^ADVANCE PRACTICE NURSE (MHTC)^
"RTN","SYNGBLLD",209,0)
 ;;57^ANTICOAG CLINICAL PHARMACIST^
"RTN","SYNGBLLD",210,0)
 ;;59^ASSOCIATE PROVIDER^
"RTN","SYNGBLLD",211,0)
 ;;26^CARE MANAGER^184154008
"RTN","SYNGBLLD",212,0)
 ;;28^CASE MANAGER^768832004^nurse case manager 445451001
"RTN","SYNGBLLD",213,0)
 ;;43^CHAPLAIN^225725005
"RTN","SYNGBLLD",214,0)
 ;;44^CHAPLAIN (MHTC)^225725005
"RTN","SYNGBLLD",215,0)
 ;;60^CLINICAL ASSOCIATE^
"RTN","SYNGBLLD",216,0)
 ;;22^CLINICAL NURSE SPECIALIST^
"RTN","SYNGBLLD",217,0)
 ;;37^CLINICAL NURSE SPECIALIST (MHTC)^
"RTN","SYNGBLLD",218,0)
 ;;8^CLINICAL PHARMACIST^734293001
"RTN","SYNGBLLD",219,0)
 ;;38^CLINICAL PHARMACIST (MHTC)^734293001
"RTN","SYNGBLLD",220,0)
 ;;30^DESIGNATED WOMEN'S HEALTH PROVIDER
"RTN","SYNGBLLD",221,0)
 ;;61^FELLOW^
"RTN","SYNGBLLD",222,0)
 ;;27^HEALTH TECHNICIAN^
"RTN","SYNGBLLD",223,0)
 ;;17^INTERN (PHYSICIAN)^
"RTN","SYNGBLLD",224,0)
 ;;73^LEAD COORDINATOR^76882100
"RTN","SYNGBLLD",225,0)
 ;;39^LPC^
"RTN","SYNGBLLD",226,0)
 ;;40^LPC (MHTC)^
"RTN","SYNGBLLD",227,0)
 ;;19^MAS CLERK^
"RTN","SYNGBLLD",228,0)
 ;;18^MEDICAL STUDENT^398130009
"RTN","SYNGBLLD",229,0)
 ;;41^MFT^
"RTN","SYNGBLLD",230,0)
 ;;42^MFT (MHTC)^
"RTN","SYNGBLLD",231,0)
 ;;7^NURSE (LPN)^442251000124100
"RTN","SYNGBLLD",232,0)
 ;;62^NURSE (LVN)^
"RTN","SYNGBLLD",233,0)
 ;;6^NURSE (RN)^224535009
"RTN","SYNGBLLD",234,0)
 ;;47^NURSE (RN) (MHTC)^224563006
"RTN","SYNGBLLD",235,0)
 ;;4^NURSE PRACTITIONER^224571005
"RTN","SYNGBLLD",236,0)
 ;;35^NURSE PRACTITIONER (MHTC)^224571005
"RTN","SYNGBLLD",237,0)
 ;;63^NURSE PRACTITIONER ASSOCIATE PROVIDER^
"RTN","SYNGBLLD",238,0)
 ;;48^OCCUPATIONAL THERAPIST^80546007
"RTN","SYNGBLLD",239,0)
 ;;49^OCCUPATIONAL THERAPIST (MHTC)^80546007
"RTN","SYNGBLLD",240,0)
 ;;15^OTHER^
"RTN","SYNGBLLD",241,0)
 ;;21^PACT CLINICAL PHARMACIST^734293001
"RTN","SYNGBLLD",242,0)
 ;;14^PATIENT SERVICES ASSISTANT^
"RTN","SYNGBLLD",243,0)
 ;;64^PEER SUPPORT APPRENTICE^
"RTN","SYNGBLLD",244,0)
 ;;65^PEER SUPPORT SPECIALIST^
"RTN","SYNGBLLD",245,0)
 ;;74^PEER SUPPORT SPECIALIST (MHTC)^
"RTN","SYNGBLLD",246,0)
 ;;55^PEER SUPPORT STAFF^
"RTN","SYNGBLLD",247,0)
 ;;5^PHYSICIAN ASSISTANT^449161006
"RTN","SYNGBLLD",248,0)
 ;;36^PHYSICIAN ASSISTANT (MHTC)^449161006
"RTN","SYNGBLLD",249,0)
 ;;66^PHYSICIAN ASSISTANT ASSOCIATE PROVIDER^
"RTN","SYNGBLLD",250,0)
 ;;1^PHYSICIAN-ATTENDING^405279007
"RTN","SYNGBLLD",251,0)
 ;;2^PHYSICIAN-PRIMARY CARE^446050000
"RTN","SYNGBLLD",252,0)
 ;;10^PHYSICIAN-PSYCHIATRIST^80584001
"RTN","SYNGBLLD",253,0)
 ;;34^PHYSICIAN-PSYCHIATRIST (MHTC)^80584001
"RTN","SYNGBLLD",254,0)
 ;;3^PHYSICIAN-SUBSPECIALTY^
"RTN","SYNGBLLD",255,0)
 ;;67^PRIMARY CARE PROVIDER^453231000124104
"RTN","SYNGBLLD",256,0)
 ;;11^PSYCHOLOGIST^59944000
"RTN","SYNGBLLD",257,0)
 ;;31^PSYCHOLOGIST (MHTC)^59944000
"RTN","SYNGBLLD",258,0)
 ;;53^RECREATION THERAPIST^
"RTN","SYNGBLLD",259,0)
 ;;54^RECREATION THERAPIST (MHTC)^
"RTN","SYNGBLLD",260,0)
 ;;20^REGISTERED DIETITIAN^309399009
"RTN","SYNGBLLD",261,0)
 ;;12^REHAB/PSYCH TECHNICIAN^
"RTN","SYNGBLLD",262,0)
 ;;33^REHAB/PSYCH TECHNICIAN (MHTC)^
"RTN","SYNGBLLD",263,0)
 ;;16^RESIDENT (PHYSICIAN)^309360001
"RTN","SYNGBLLD",264,0)
 ;;9^SOCIAL WORKER^158950001
"RTN","SYNGBLLD",265,0)
 ;;32^SOCIAL WORKER (MHTC)^80292009
"RTN","SYNGBLLD",266,0)
 ;;68^SURROGATE CARE MANAGER^184154008
"RTN","SYNGBLLD",267,0)
 ;;70^SURROGATE CLINICAL ASSOCIATE^
"RTN","SYNGBLLD",268,0)
 ;;69^SURROGATE PRIMARY CARE PROVIDER^453231000124104
"RTN","SYNGBLLD",269,0)
 ;;25^TCM CLINICAL CASE MANAGER^
"RTN","SYNGBLLD",270,0)
 ;;24^TCM PROGRAM MANAGER^
"RTN","SYNGBLLD",271,0)
 ;;23^TCM TRANSITION PATIENT ADVOCATE^
"RTN","SYNGBLLD",272,0)
 ;;29^TRAINEE^
"RTN","SYNGBLLD",273,0)
 ;;50^VOC REHAB SPEC/COUNSELOR^
"RTN","SYNGBLLD",274,0)
 ;;51^VOC REHAB SPEC/COUNSELOR (MHTC)^
"RTN","SYNGBLLD",275,0)
 ;;zzzzz
"RTN","SYNGBLLD",276,0)
 ;
"RTN","SYNGBLLD",277,0)
FLAGSCT ;
"RTN","SYNGBLLD",278,0)
 ;;FALL RISK^129839007^Fall Risk
"RTN","SYNGBLLD",279,0)
 ;;WANDERER^704448006^Wanderer
"RTN","SYNGBLLD",280,0)
 ;;BEHAVIORAL^277843001^Behavioral
"RTN","SYNGBLLD",281,0)
 ;;HIGH RISK FOR SUICIDE^394685004^High risk for suicide
"RTN","SYNGBLLD",282,0)
 ;;zzzzz
"RTN","SYNGBLLD",283,0)
 ;
"RTN","SYNGBLLD",284,0)
LOADREF(MH2LOINC,LOINC2MH,MH2SNOMED) ;load temp code arrays
"RTN","SYNGBLLD",285,0)
 N IDX,INSTRU,LOINCODE,TESTID,TESTNAME,LOINC
"RTN","SYNGBLLD",286,0)
 ;LOINC
"RTN","SYNGBLLD",287,0)
 S IDX=0
"RTN","SYNGBLLD",288,0)
 F  S IDX=IDX+1,INSTRUMT=$P($T(LOINC+IDX),";;",2) Q:INSTRUMT="zzzzz"  D
"RTN","SYNGBLLD",289,0)
 . S TESTID=$P(INSTRUMT,U,1)
"RTN","SYNGBLLD",290,0)
 . S TESTNAME=$P(INSTRUMT,U,2)
"RTN","SYNGBLLD",291,0)
 . S LOINC=$P(INSTRUMT,U,3)
"RTN","SYNGBLLD",292,0)
 . S:TESTID'="" MH2LOINC(TESTID)=LOINC
"RTN","SYNGBLLD",293,0)
 . S:TESTNAME'="" MH2LOINC(TESTNAME)=LOINC
"RTN","SYNGBLLD",294,0)
 . S:LOINC'="" LOINC2MH(LOINC)=TESTID_U_TESTNAME
"RTN","SYNGBLLD",295,0)
 ;SNOMED
"RTN","SYNGBLLD",296,0)
 S IDX=0
"RTN","SYNGBLLD",297,0)
 F  S IDX=IDX+1,INSTRUMT=$P($T(SNOMED+IDX),";;",2) Q:INSTRUMT="zzzzz"  D
"RTN","SYNGBLLD",298,0)
 . S TESTID=$P(INSTRUMT,U,1)
"RTN","SYNGBLLD",299,0)
 . S TESTNAME=$P(INSTRUMT,U,2)
"RTN","SYNGBLLD",300,0)
 . S SNOMED=$P(INSTRUMT,U,3)
"RTN","SYNGBLLD",301,0)
 . S:TESTID'="" MH2SNOMED(TESTID)=SNOMED
"RTN","SYNGBLLD",302,0)
 . S:TESTNAME'="" MH2SNOMED(TESTNAME)=SNOMED
"RTN","SYNGBLLD",303,0)
 ;
"RTN","SYNGBLLD",304,0)
 QUIT
"RTN","SYNGBLLD",305,0)
 ;
"RTN","SYNGBLLD",306,0)
PRCSCT ; CPT to SNOMED CT map for procedures
"RTN","SYNGBLLD",307,0)
 K SCTA,SCTX
"RTN","SYNGBLLD",308,0)
 S SCTA(308335008)="99205^OFFICE VISIT"
"RTN","SYNGBLLD",309,0)
 S SCTA(428297005)="10060^Excision of Cyst"
"RTN","SYNGBLLD",310,0)
 S SCTA(22523008)="55250^Vasectomy"
"RTN","SYNGBLLD",311,0)
 S SCTA(73761001)="44391^Colonoscopy"
"RTN","SYNGBLLD",312,0)
 S SCTA(56241004)="20225^Bone Marrow Biopsy"
"RTN","SYNGBLLD",313,0)
 S SCTA(10431008)="64721^Neuroplasty of median nerve at carpal tunnel"
"RTN","SYNGBLLD",314,0)
 S SCTA(28181007)="27299^Operation on hip joint"
"RTN","SYNGBLLD",315,0)
 S SCTA(80146002)="49315^Appendectomy"
"RTN","SYNGBLLD",316,0)
 S SCTA(19780006)="11000^Debridement of Infection of Skin"
"RTN","SYNGBLLD",317,0)
 S SCTA(45595009)="47562^Laparoscopic cholecystectomy"
"RTN","SYNGBLLD",318,0)
 ; map incoming SNOMED CT code to VistA Vital Type (file 120.51)
"RTN","SYNGBLLD",319,0)
 S SCTX("10060")="428297005^Excision of Cyst"
"RTN","SYNGBLLD",320,0)
 S SCTX("20225")="56241004^Bone Marrow Biopsy"
"RTN","SYNGBLLD",321,0)
 S SCTX("27299")="28181007^Operation on hip joint"
"RTN","SYNGBLLD",322,0)
 S SCTX("44391")="73761001^Colonoscopy"
"RTN","SYNGBLLD",323,0)
 S SCTX("49315")="80146002^Appendectomy"
"RTN","SYNGBLLD",324,0)
 S SCTX("55250")="22523008^Vasectomy"
"RTN","SYNGBLLD",325,0)
 S SCTX("64721")="10431008^Neuroplasty of median nerve at carpal tunnel"
"RTN","SYNGBLLD",326,0)
 S SCTX("11000")="19780006^Debridement of Infection of Skin"
"RTN","SYNGBLLD",327,0)
 S SCTX("47562")="45595009^Laparoscopic cholecystectomy"
"RTN","SYNGBLLD",328,0)
 Q
"RTN","SYNGBLLD",329,0)
 ; 
"RTN","SYNGBLLD",330,0)
HLFSCT ; SNOMED CT MAP for health factors
"RTN","SYNGBLLD",331,0)
 K SCTA,SCTX
"RTN","SYNGBLLD",332,0)
 S SCTA(266919005)="5^Never smoked tobacco"
"RTN","SYNGBLLD",333,0)
 S SCTA(405746006)="2^Current non-smoker"
"RTN","SYNGBLLD",334,0)
 S SCTA(8517006)="4^Ex-smoker"
"RTN","SYNGBLLD",335,0)
 S SCTA(266890009)="15^Family History of Alcoholism"
"RTN","SYNGBLLD",336,0)
 S SCTA(219006)="12^Current drinker of alcohol"
"RTN","SYNGBLLD",337,0)
 S SCTA(371434005)="13^History of alcohol abuse"
"RTN","SYNGBLLD",338,0)
 ; map incoming SNOMED CT code to VistA Vital Type (file 120.51)
"RTN","SYNGBLLD",339,0)
 S SCTX("5")="266919005^Never smoked tobacco"
"RTN","SYNGBLLD",340,0)
 S SCTX("2")="405746006^Current non-smoker"
"RTN","SYNGBLLD",341,0)
 S SCTX("4")="8517006^Ex-smoker"
"RTN","SYNGBLLD",342,0)
 S SCTX("15")="266890009^Family History of Alcoholism"
"RTN","SYNGBLLD",343,0)
 S SCTX("13")="371434005^History of Alcoholism"
"RTN","SYNGBLLD",344,0)
 S SCTX("12")="219009^Current drinker of alcohol"
"RTN","SYNGBLLD",345,0)
 Q 
"RTN","SYNGBLLD",346,0)
 ;
"RTN","SYNPRE1")
0^^B579511
"RTN","SYNPRE1",1,0)
SYNPRE1 ; HC/art - HealthConcourse - Pre Install for SYN*1.0*2 ;04/10/2019
"RTN","SYNPRE1",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNPRE1",3,0)
 ;;
"RTN","SYNPRE1",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNPRE1",5,0)
 ;
"RTN","SYNPRE1",6,0)
 QUIT
"RTN","SYNPRE1",7,0)
 ;
"RTN","SYNPRE1",8,0)
EN ;
"RTN","SYNPRE1",9,0)
 ;Delete the global for the NETSERV HTTP ENDPOINT file
"RTN","SYNPRE1",10,0)
 ;Standard data will be loaded
"RTN","SYNPRE1",11,0)
 ;
"RTN","SYNPRE1",12,0)
 KILL ^RGNET(996.52)
"RTN","SYNPRE1",13,0)
 SET ^RGNET(996.52,0)="NETSERV HTTP ENDPOINT^996.52^0^0"
"RTN","SYNPRE1",14,0)
 ;
"RTN","SYNPRE1",15,0)
 QUIT
"RTN","SYNPRE1",16,0)
 ;
"RTN","SYNRGSHM")
0^115^B9573519
"RTN","SYNRGSHM",1,0)
SYNRGSHM ;ven/gpl - RGNET SHIM ;2018-08-17  3:28 PM
"RTN","SYNRGSHM",2,0)
 ;;0.1;VISTA FHIR SERVER;;Aug 17, 2018;Build 49
"RTN","SYNRGSHM",3,0)
 ;
"RTN","SYNRGSHM",4,0)
 ; Authored by George P. Lilly 2019
"RTN","SYNRGSHM",5,0)
 ;
"RTN","SYNRGSHM",6,0)
 q
"RTN","SYNRGSHM",7,0)
 ;
"RTN","SYNRGSHM",8,0)
 ;DETECT(ROUTINE,ARGS,AUTHMODE) ; _rewrite_dhp exit for DHP RGNET SERVICES
"RTN","SYNRGSHM",9,0)
DETECT ; _rewrite_dhp exit for DHP RGNET SERVICES
"RTN","SYNRGSHM",10,0)
 ; called from VPRJRSP or from %webrsp to detect RGNET URLs for DHP
"RTN","SYNRGSHM",11,0)
 ; If RGNET is on the system for mapping...
"RTN","SYNRGSHM",12,0)
 IF ROUTINE="" IF $D(^RGNET(996.52)) DO MATCHRG(.ROUTINE,.ARGS,.AUTHNODE)
"RTN","SYNRGSHM",13,0)
 ;
"RTN","SYNRGSHM",14,0)
 Q
"RTN","SYNRGSHM",15,0)
 ;
"RTN","SYNRGSHM",16,0)
MATCHRG(ROUTINE,ARGS,AUTHNODE) ; match agains RGNET
"RTN","SYNRGSHM",17,0)
 N PATH
"RTN","SYNRGSHM",18,0)
 S PATH=$G(HTTPREQ("path"))
"RTN","SYNRGSHM",19,0)
 S PATH=$E(PATH,2,$L(PATH))
"RTN","SYNRGSHM",20,0)
 Q:PATH=""
"RTN","SYNRGSHM",21,0)
 N SYNENTRY
"RTN","SYNRGSHM",22,0)
 S SYNENTRY=$O(^RGNET(996.52,"B",PATH,""))
"RTN","SYNRGSHM",23,0)
 ;D ^ZTER
"RTN","SYNRGSHM",24,0)
 Q:SYNENTRY=""
"RTN","SYNRGSHM",25,0)
 Q:$E(PATH,1,3)'="DHP"
"RTN","SYNRGSHM",26,0)
 ; D ^ZTER
"RTN","SYNRGSHM",27,0)
 S ARGS("command")=PATH
"RTN","SYNRGSHM",28,0)
 S ROUTINE="WSRGNET^SYNRGSHM"
"RTN","SYNRGSHM",29,0)
 Q
"RTN","SYNRGSHM",30,0)
 ;
"RTN","SYNRGSHM",31,0)
WSRGNET(RTN,FILTER) ; web service shim for RGNET web services
"RTN","SYNRGSHM",32,0)
 N CMD
"RTN","SYNRGSHM",33,0)
 S CMD=$G(FILTER("command"))
"RTN","SYNRGSHM",34,0)
 Q:CMD=""
"RTN","SYNRGSHM",35,0)
 N RGPROC ; RGNET processing routine
"RTN","SYNRGSHM",36,0)
 S RGPROC=$$GETRGR(CMD)
"RTN","SYNRGSHM",37,0)
 N RGPARM ; RGNET processor parms
"RTN","SYNRGSHM",38,0)
 D DHPPARMS("RGPARM",RGPROC)
"RTN","SYNRGSHM",39,0)
 ;
"RTN","SYNRGSHM",40,0)
 ; initialize parms to null
"RTN","SYNRGSHM",41,0)
 ;
"RTN","SYNRGSHM",42,0)
 N ZI S ZI=""
"RTN","SYNRGSHM",43,0)
 F  S ZI=$O(RGPARM(ZI)) Q:ZI=""  D  ;
"RTN","SYNRGSHM",44,0)
 . S @ZI=""
"RTN","SYNRGSHM",45,0)
 ;
"RTN","SYNRGSHM",46,0)
 ; overwrite with provided parms
"RTN","SYNRGSHM",47,0)
 ;
"RTN","SYNRGSHM",48,0)
 F  S ZI=$O(FILTER(ZI)) Q:ZI=""  D  ;
"RTN","SYNRGSHM",49,0)
 . N X,Y
"RTN","SYNRGSHM",50,0)
 . S X=ZI
"RTN","SYNRGSHM",51,0)
 . X ^%ZOSF("UPPERCASE")
"RTN","SYNRGSHM",52,0)
 . Q:Y=""
"RTN","SYNRGSHM",53,0)
 . S @Y=$G(FILTER(ZI))
"RTN","SYNRGSHM",54,0)
 ;D ^ZTER
"RTN","SYNRGSHM",55,0)
 ;
"RTN","SYNRGSHM",56,0)
 ; run the processor
"RTN","SYNRGSHM",57,0)
 ;
"RTN","SYNRGSHM",58,0)
 ;W !,"running ",RGPROC
"RTN","SYNRGSHM",59,0)
 Q:+RGPROC=-1
"RTN","SYNRGSHM",60,0)
 X RGPROC
"RTN","SYNRGSHM",61,0)
 ;ZWR RETSTA
"RTN","SYNRGSHM",62,0)
 ;
"RTN","SYNRGSHM",63,0)
 ;M RTN=RETSTA
"RTN","SYNRGSHM",64,0)
 S RTN=RETSTA_$C(13,10)
"RTN","SYNRGSHM",65,0)
 ;
"RTN","SYNRGSHM",66,0)
 Q
"RTN","SYNRGSHM",67,0)
 ;
"RTN","SYNRGSHM",68,0)
GETRGR(SVC) ; extrinsic returns the routine associated with the 
"RTN","SYNRGSHM",69,0)
 ; the RGNET web service SVC
"RTN","SYNRGSHM",70,0)
 ; returns -1 if not found
"RTN","SYNRGSHM",71,0)
 N SYNRTN S SYNRTN=-1
"RTN","SYNRGSHM",72,0)
 N SYNENTRY,SVCMINUS
"RTN","SYNRGSHM",73,0)
 Q:$L(SVC)=0 "-1^COMMAND NOT SPECIFIED"
"RTN","SYNRGSHM",74,0)
 S SYNENTRY=$E(SVC,1,$L(SVC)-1)
"RTN","SYNRGSHM",75,0)
 F  S SYNENTRY=$O(^RGNET(996.52,"B",SYNENTRY)) Q:SYNENTRY=""  Q:$E(SYNENTRY,1,$L(SVC))=SVC
"RTN","SYNRGSHM",76,0)
 Q:SYNENTRY="" "-1^ENTRY NOT FOUND"
"RTN","SYNRGSHM",77,0)
 N SYNIEN
"RTN","SYNRGSHM",78,0)
 S SYNIEN=$O(^RGNET(996.52,"B",SYNENTRY,""))
"RTN","SYNRGSHM",79,0)
 ;
"RTN","SYNRGSHM",80,0)
 N HANDLR
"RTN","SYNRGSHM",81,0)
 S HANDLR=$$GET1^DIQ(996.52,SYNIEN_",",10)
"RTN","SYNRGSHM",82,0)
 I HANDLR="" Q "-1^HANDLER NOT FOUND"
"RTN","SYNRGSHM",83,0)
 ;
"RTN","SYNRGSHM",84,0)
 ;W !,"DHPR ",$$DHPR(HANDLR),!
"RTN","SYNRGSHM",85,0)
 S SYNRTN=$$DHPR(HANDLR)
"RTN","SYNRGSHM",86,0)
 ;
"RTN","SYNRGSHM",87,0)
 Q SYNRTN
"RTN","SYNRGSHM",88,0)
 ;
"RTN","SYNRGSHM",89,0)
DHPR(HAND) ; extrinsic returns 
"RTN","SYNRGSHM",90,0)
 ;the DHP processing routine for the handler HAND
"RTN","SYNRGSHM",91,0)
 N ZI,DHPRTN
"RTN","SYNRGSHM",92,0)
 S DHPRTN=""
"RTN","SYNRGSHM",93,0)
 N HAND1,HAND2
"RTN","SYNRGSHM",94,0)
 S HAND1=$P(HAND,"^",1)
"RTN","SYNRGSHM",95,0)
 S HAND2=$P(HAND,"^",2)
"RTN","SYNRGSHM",96,0)
 F ZI=0:1:10 D  ;
"RTN","SYNRGSHM",97,0)
 . N ZL
"RTN","SYNRGSHM",98,0)
 . S ZL=$T(@HAND1+ZI^@HAND2)
"RTN","SYNRGSHM",99,0)
 . I ZL["SYNDHP" S DHPRTN=ZL
"RTN","SYNRGSHM",100,0)
 Q:DHPRTN=""
"RTN","SYNRGSHM",101,0)
 N ZE1,ZE2
"RTN","SYNRGSHM",102,0)
 S ZE1=$P(DHPRTN,"(",1)
"RTN","SYNRGSHM",103,0)
 S ZE2=$P(DHPRTN,"(",2)
"RTN","SYNRGSHM",104,0)
 N ZP,ZE3
"RTN","SYNRGSHM",105,0)
 S ZE3=".RETSTA"
"RTN","SYNRGSHM",106,0)
 F ZP=2:1:$L(ZE2,",") D  ;
"RTN","SYNRGSHM",107,0)
 . N ZP1
"RTN","SYNRGSHM",108,0)
 . S ZP1=$P(ZE2,",",ZP)
"RTN","SYNRGSHM",109,0)
 . S ZP1=$TR(ZP1,")")
"RTN","SYNRGSHM",110,0)
 . I $E(ZP1,1,3)="DHP" S ZP1=$E(ZP1,4,$L(ZP1))
"RTN","SYNRGSHM",111,0)
 . S ZE3=ZE3_","_ZP1
"RTN","SYNRGSHM",112,0)
 ;S ZE2=$TR(ZE2,"DHP","")
"RTN","SYNRGSHM",113,0)
 S DHPRTN=ZE1_"("_ZE3_")"
"RTN","SYNRGSHM",114,0)
 S DHPRTN=$E(DHPRTN,2,$L(DHPRTN))
"RTN","SYNRGSHM",115,0)
 ;
"RTN","SYNRGSHM",116,0)
 Q DHPRTN
"RTN","SYNRGSHM",117,0)
 ;
"RTN","SYNRGSHM",118,0)
DHPPARMS(ARY,CMD) ; pulls the DHP and other parameters out of the line
"RTN","SYNRGSHM",119,0)
 N ZP
"RTN","SYNRGSHM",120,0)
 F ZP=2:1:$L(CMD,",") D  ;
"RTN","SYNRGSHM",121,0)
 . N ZP1
"RTN","SYNRGSHM",122,0)
 . S ZP1=$P(CMD,",",ZP)
"RTN","SYNRGSHM",123,0)
 . S ZP1=$TR(ZP1,")")
"RTN","SYNRGSHM",124,0)
 . I $E(ZP1,1,3)="DHP" S ZP1=$E(ZP1,4,$L(ZP1))
"RTN","SYNRGSHM",125,0)
 . S @ARY@(ZP1)=""
"RTN","SYNRGSHM",126,0)
 Q
"RTN","SYNRGSHM",127,0)
 ;
"RTN","SYNRGSHM",128,0)
 
"RTN","SYNTSTAPI")
0^116^B11160876
"RTN","SYNTSTAPI",1,0)
SYNTSTAPI ; HC/art - HealthConcourse - run in code unit tests ;05/07/2019
"RTN","SYNTSTAPI",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNTSTAPI",3,0)
 ;;
"RTN","SYNTSTAPI",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNTSTAPI",5,0)
 ;
"RTN","SYNTSTAPI",6,0)
 QUIT
"RTN","SYNTSTAPI",7,0)
 ;
"RTN","SYNTSTAPI",8,0)
EN ;Run unit tests
"RTN","SYNTSTAPI",9,0)
 ;
"RTN","SYNTSTAPI",10,0)
 N STARTTM S STARTTM=$$NOW^XLFDT()
"RTN","SYNTSTAPI",11,0)
 ;
"RTN","SYNTSTAPI",12,0)
 W !!,"----- Patient Vitals",!!
"RTN","SYNTSTAPI",13,0)
 D T1^SYNDHP01
"RTN","SYNTSTAPI",14,0)
 D T2^SYNDHP01
"RTN","SYNTSTAPI",15,0)
 W !!,"----- Patient Immunizations",!!
"RTN","SYNTSTAPI",16,0)
 D T1^SYNDHP02
"RTN","SYNTSTAPI",17,0)
 D T2^SYNDHP02
"RTN","SYNTSTAPI",18,0)
 W !!,"----- Patient Conditions",!!
"RTN","SYNTSTAPI",19,0)
 D T1^SYNDHP03
"RTN","SYNTSTAPI",20,0)
 W !!,"----- Patients with a Condition",!!
"RTN","SYNTSTAPI",21,0)
 D T2^SYNDHP03
"RTN","SYNTSTAPI",22,0)
 D T3^SYNDHP03
"RTN","SYNTSTAPI",23,0)
 W !!,"----- Patient Procedures",!!
"RTN","SYNTSTAPI",24,0)
 D T1^SYNDHP04
"RTN","SYNTSTAPI",25,0)
 W !!,"----- Patient Diagnostic Reports",!!
"RTN","SYNTSTAPI",26,0)
 D T1^SYNDHP05
"RTN","SYNTSTAPI",27,0)
 D T2^SYNDHP05
"RTN","SYNTSTAPI",28,0)
 W !!,"----- Institution Details for Hospital Location",!!
"RTN","SYNTSTAPI",29,0)
 D T1^SYNDHP06
"RTN","SYNTSTAPI",30,0)
 D T2^SYNDHP06
"RTN","SYNTSTAPI",31,0)
 W !!,"----- Patient Nursing Care Plan Goals",!!
"RTN","SYNTSTAPI",32,0)
 D T1^SYNDHP07
"RTN","SYNTSTAPI",33,0)
 D T2^SYNDHP07
"RTN","SYNTSTAPI",34,0)
 W !!,"----- Patient Flags",!!
"RTN","SYNTSTAPI",35,0)
 D T1^SYNDHP08
"RTN","SYNTSTAPI",36,0)
 D T2^SYNDHP08
"RTN","SYNTSTAPI",37,0)
 W !!,"----- Patient Health Factors",!!
"RTN","SYNTSTAPI",38,0)
 D T1^SYNDHP09
"RTN","SYNTSTAPI",39,0)
 D T2^SYNDHP09
"RTN","SYNTSTAPI",40,0)
 ;D HLFTEST0^SYNDHP09
"RTN","SYNTSTAPI",41,0)
 ;D HLFTEST1^SYNDHP09
"RTN","SYNTSTAPI",42,0)
 W !!,"----- Patient Encounters",!!
"RTN","SYNTSTAPI",43,0)
 D T1^SYNDHP40
"RTN","SYNTSTAPI",44,0)
 W !!,"----- Patient Appointments",!!
"RTN","SYNTSTAPI",45,0)
 D T1^SYNDHP41
"RTN","SYNTSTAPI",46,0)
 W !!,"----- validate patient",!!
"RTN","SYNTSTAPI",47,0)
 D TESTP^SYNDHP43
"RTN","SYNTSTAPI",48,0)
 D TESTF1^SYNDHP43
"RTN","SYNTSTAPI",49,0)
 D TESTF2^SYNDHP43
"RTN","SYNTSTAPI",50,0)
 D TESTF3^SYNDHP43
"RTN","SYNTSTAPI",51,0)
 D TESTF4^SYNDHP43
"RTN","SYNTSTAPI",52,0)
 D TESTF5^SYNDHP43
"RTN","SYNTSTAPI",53,0)
 D T3^SYNDHP43
"RTN","SYNTSTAPI",54,0)
 W !!,"----- Patient Demographics",!!
"RTN","SYNTSTAPI",55,0)
 D T1^SYNDHP47
"RTN","SYNTSTAPI",56,0)
 D T2^SYNDHP47
"RTN","SYNTSTAPI",57,0)
 D T3^SYNDHP47
"RTN","SYNTSTAPI",58,0)
 D T4^SYNDHP47
"RTN","SYNTSTAPI",59,0)
 ;D T5^SYNDHP47
"RTN","SYNTSTAPI",60,0)
 D DEMTEST0^SYNDHP47
"RTN","SYNTSTAPI",61,0)
 W !!,"----- Patient Medication Statement",!!
"RTN","SYNTSTAPI",62,0)
 ;D T1^SYNDHP48
"RTN","SYNTSTAPI",63,0)
 D T6^SYNDHP48
"RTN","SYNTSTAPI",64,0)
 W !!,"----- Patient Medication Dispense",!!
"RTN","SYNTSTAPI",65,0)
 ;D T2^SYNDHP48
"RTN","SYNTSTAPI",66,0)
 D T5^SYNDHP48
"RTN","SYNTSTAPI",67,0)
 W !!,"----- Patient Medication Administration",!!
"RTN","SYNTSTAPI",68,0)
 ;D T3^SYNDHP48
"RTN","SYNTSTAPI",69,0)
 D T4^SYNDHP48
"RTN","SYNTSTAPI",70,0)
 W !!,"----- Patient Providers for Encounters",!!
"RTN","SYNTSTAPI",71,0)
 D T1^SYNDHP54
"RTN","SYNTSTAPI",72,0)
 D T2^SYNDHP54
"RTN","SYNTSTAPI",73,0)
 W !!,"----- Patient Observations",!!
"RTN","SYNTSTAPI",74,0)
 D T1^SYNDHP56
"RTN","SYNTSTAPI",75,0)
 W !!,"----- Patient Allergies",!!
"RTN","SYNTSTAPI",76,0)
 D T1^SYNDHP57
"RTN","SYNTSTAPI",77,0)
 D T2^SYNDHP57
"RTN","SYNTSTAPI",78,0)
 D ALLTEST0^SYNDHP57
"RTN","SYNTSTAPI",79,0)
 ;D PROTEST^SYNDHP57
"RTN","SYNTSTAPI",80,0)
 W !!,"----- Care Team",!!
"RTN","SYNTSTAPI",81,0)
 D T1^SYNDHP58
"RTN","SYNTSTAPI",82,0)
 D T2^SYNDHP58
"RTN","SYNTSTAPI",83,0)
 W !!,"----- Care Teams",!!
"RTN","SYNTSTAPI",84,0)
 D T3^SYNDHP58
"RTN","SYNTSTAPI",85,0)
 D T4^SYNDHP58
"RTN","SYNTSTAPI",86,0)
 W !!,"----- Patient Care Plans",!!
"RTN","SYNTSTAPI",87,0)
 D T1^SYNDHP59
"RTN","SYNTSTAPI",88,0)
 D T2^SYNDHP59
"RTN","SYNTSTAPI",89,0)
 W !!,"----- Patient Care Plan for a Visit",!!
"RTN","SYNTSTAPI",90,0)
 D T3^SYNDHP59
"RTN","SYNTSTAPI",91,0)
 D T4^SYNDHP59
"RTN","SYNTSTAPI",92,0)
 W !!,"----- Patient TIU Notes",!!
"RTN","SYNTSTAPI",93,0)
 D T1^SYNDHP67
"RTN","SYNTSTAPI",94,0)
 D T2^SYNDHP67
"RTN","SYNTSTAPI",95,0)
 D T3^SYNDHP67
"RTN","SYNTSTAPI",96,0)
 W !!,"----- M Unit Test",!!
"RTN","SYNTSTAPI",97,0)
 ;D T1^SYNDHP69
"RTN","SYNTSTAPI",98,0)
 W !!,"----- VistA Record by Resource ID",!!
"RTN","SYNTSTAPI",99,0)
 D T1^SYNDHP99
"RTN","SYNTSTAPI",100,0)
 ;
"RTN","SYNTSTAPI",101,0)
 N ENDTM S ENDTM=$$NOW^XLFDT()
"RTN","SYNTSTAPI",102,0)
 N ELAPSED S ELAPSED=$$FMDIFF^XLFDT(ENDTM,STARTTM,3)
"RTN","SYNTSTAPI",103,0)
 ;
"RTN","SYNTSTAPI",104,0)
 W !!,"Start time:   ",$$FMTE^XLFDT(STARTTM,7),!
"RTN","SYNTSTAPI",105,0)
 W "End time:     ",$$FMTE^XLFDT(ENDTM,7),!
"RTN","SYNTSTAPI",106,0)
 W "Elapsed time: ",ELAPSED,!
"RTN","SYNTSTAPI",107,0)
 ;
"RTN","SYNTSTAPI",108,0)
 QUIT
"RTN","SYNTSTAPI",109,0)
 ;
"RTN","SYNTSTRS")
0^113^B143102652
"RTN","SYNTSTRS",1,0)
SYNTSTRS ; HC/art - HealthConcourse - test rest services ;05/09/2019
"RTN","SYNTSTRS",2,0)
 ;;1.0;DHP;;Jan 17, 2017;Build 49
"RTN","SYNTSTRS",3,0)
 ;;
"RTN","SYNTSTRS",4,0)
 ;;Original routine authored by Andrew Thompson & Ferdinand Frankson of Perspecta 2017-2019
"RTN","SYNTSTRS",5,0)
 ;
"RTN","SYNTSTRS",6,0)
 QUIT
"RTN","SYNTSTRS",7,0)
 ;
"RTN","SYNTSTRS",8,0)
EN ;Run service tests
"RTN","SYNTSTRS",9,0)
 ;
"RTN","SYNTSTRS",10,0)
 W #,!,?10,"HealthConcourse Get VistA Data REST Services Unit Tests",!
"RTN","SYNTSTRS",11,0)
 ;
"RTN","SYNTSTRS",12,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",13,0)
 S DIR(0)="SO^G:General Service Testing;I:ICN Batch Tests;U:Unit Tests"
"RTN","SYNTSTRS",14,0)
 S DIR("A")="Type"
"RTN","SYNTSTRS",15,0)
 ;S DIR("B")=""
"RTN","SYNTSTRS",16,0)
 D ^DIR
"RTN","SYNTSTRS",17,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) QUIT
"RTN","SYNTSTRS",18,0)
 N TYPE S TYPE=Y
"RTN","SYNTSTRS",19,0)
 ;
"RTN","SYNTSTRS",20,0)
 I TYPE="U" D UT
"RTN","SYNTSTRS",21,0)
 I TYPE="G" D UI
"RTN","SYNTSTRS",22,0)
 I TYPE="I" D
"RTN","SYNTSTRS",23,0)
 . N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",24,0)
 . S DIR(0)="NAO^0:99999999"
"RTN","SYNTSTRS",25,0)
 . S DIR("A")="Number of ICNs, 0 for All: "
"RTN","SYNTSTRS",26,0)
 . ;S DIR("B")=""
"RTN","SYNTSTRS",27,0)
 . S DIR("?")="Enter the number of ICNs to use for each service call test, or 0 for all ICNs."
"RTN","SYNTSTRS",28,0)
 . D ^DIR
"RTN","SYNTSTRS",29,0)
 . QUIT:$D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT)
"RTN","SYNTSTRS",30,0)
 . QUIT:Y=""
"RTN","SYNTSTRS",31,0)
 . N NBR S NBR=Y
"RTN","SYNTSTRS",32,0)
 . N STARTTM S STARTTM=$$NOW^XLFDT()
"RTN","SYNTSTRS",33,0)
 . D ctrl^SYNDTS89(NBR)
"RTN","SYNTSTRS",34,0)
 . N ENDTM S ENDTM=$$NOW^XLFDT()
"RTN","SYNTSTRS",35,0)
 . N ELAPSED S ELAPSED=$$FMDIFF^XLFDT(ENDTM,STARTTM,3)
"RTN","SYNTSTRS",36,0)
 . W !,"Start time:   ",$$FMTE^XLFDT(STARTTM,7),!
"RTN","SYNTSTRS",37,0)
 . W "End time:     ",$$FMTE^XLFDT(ENDTM,7),!
"RTN","SYNTSTRS",38,0)
 . W "Elapsed time: ",ELAPSED,!
"RTN","SYNTSTRS",39,0)
 ;
"RTN","SYNTSTRS",40,0)
 QUIT
"RTN","SYNTSTRS",41,0)
 ;
"RTN","SYNTSTRS",42,0)
 ;--------------------------------------------------------------------------
"RTN","SYNTSTRS",43,0)
 ;
"RTN","SYNTSTRS",44,0)
UT ;unit test for get VistA data REST services
"RTN","SYNTSTRS",45,0)
 ; The SYN REST UNIT TESTS FILE (#2002.1) contains a record for each unit test URL
"RTN","SYNTSTRS",46,0)
 ;  .01   URL (RFJ245), [0;1]
"RTN","SYNTSTRS",47,0)
 ;  1     PASS/FAIL (RS), [0;2]
"RTN","SYNTSTRS",48,0)
 ;
"RTN","SYNTSTRS",49,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",50,0)
 S DIR(0)="SABO^A:All services;O:One service"
"RTN","SYNTSTRS",51,0)
 S DIR("A")="Mode (A)ll or (O)ne: "
"RTN","SYNTSTRS",52,0)
 ;S DIR("B")=""
"RTN","SYNTSTRS",53,0)
 D ^DIR
"RTN","SYNTSTRS",54,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) QUIT
"RTN","SYNTSTRS",55,0)
 N MODE S MODE=Y
"RTN","SYNTSTRS",56,0)
 ;
"RTN","SYNTSTRS",57,0)
 N SERVER S SERVER=$$GETSERVER()
"RTN","SYNTSTRS",58,0)
 I MODE="O" N ONAME S ONAME=$$GETSERVICE()
"RTN","SYNTSTRS",59,0)
 ;
"RTN","SYNTSTRS",60,0)
 N LASTRS S LASTRS=""
"RTN","SYNTSTRS",61,0)
 N CNTKER S CNTKER=0
"RTN","SYNTSTRS",62,0)
 N CNTERR S CNTERR=0
"RTN","SYNTSTRS",63,0)
 N TOTTEST S TOTTEST=0
"RTN","SYNTSTRS",64,0)
 N CNTPASS S CNTPASS=0
"RTN","SYNTSTRS",65,0)
 N TOTPASS S TOTPASS=0
"RTN","SYNTSTRS",66,0)
 N TOTFAIL S TOTFAIL=0
"RTN","SYNTSTRS",67,0)
 N STARTTM S STARTTM=$$NOW^XLFDT()
"RTN","SYNTSTRS",68,0)
 ;
"RTN","SYNTSTRS",69,0)
 N RET,RETDATA,RETHDR,STR,URL,URLNAME,URLIEN,URLDESC,URLSTR,URLSRVC,PF,IENS,IDX,TIMEOUT,POS,ANOMALY
"RTN","SYNTSTRS",70,0)
 N IEN S IEN=0
"RTN","SYNTSTRS",71,0)
 ;F  S IEN=$O(^SYN(2002.1,IEN)) QUIT:IEN>274  D
"RTN","SYNTSTRS",72,0)
 F  S IEN=$O(^SYN(2002.1,IEN)) QUIT:'+IEN  D
"RTN","SYNTSTRS",73,0)
 . S URL=$$GET1^DIQ(2002.1,IEN,.01)
"RTN","SYNTSTRS",74,0)
 . S URLNAME=$P($P(URL,"/",4),"?",1)
"RTN","SYNTSTRS",75,0)
 . S URLSRVC=($P(URL,"/",4))
"RTN","SYNTSTRS",76,0)
 . S URLSTR=SERVER_URLSRVC
"RTN","SYNTSTRS",77,0)
 . I MODE="O",URLNAME'=ONAME QUIT
"RTN","SYNTSTRS",78,0)
 . S TOTTEST=TOTTEST+1
"RTN","SYNTSTRS",79,0)
 . S PF=$$GET1^DIQ(2002.1,IEN,1,"I")
"RTN","SYNTSTRS",80,0)
 . S:PF="P" TOTPASS=TOTPASS+1
"RTN","SYNTSTRS",81,0)
 . S:PF="F" TOTFAIL=TOTFAIL+1
"RTN","SYNTSTRS",82,0)
 . S URLDESC=""
"RTN","SYNTSTRS",83,0)
 . I URLNAME'="" D
"RTN","SYNTSTRS",84,0)
 . . S URLIEN=$O(^RGNET(996.52,"B",URLNAME,""))
"RTN","SYNTSTRS",85,0)
 . . S IENS=1_","_URLIEN_","
"RTN","SYNTSTRS",86,0)
 . . S URLDESC=$$GET1^DIQ(996.52099,IENS,.01)
"RTN","SYNTSTRS",87,0)
 . W:URLNAME'=LASTRS !,"-------------------------------------------------------------------",!
"RTN","SYNTSTRS",88,0)
 . S LASTRS=URLNAME
"RTN","SYNTSTRS",89,0)
 . W !,"***** ",IEN," * ",URLNAME," * ",URLDESC,$S(URL["JSON=J":" (JSON)",1:""),$S(PF="F":" * (Fail)",1:" * (Pass)"),!!
"RTN","SYNTSTRS",90,0)
 . W "URL: ",URLSTR,!
"RTN","SYNTSTRS",91,0)
 . ; call the service
"RTN","SYNTSTRS",92,0)
 . S TIMEOUT=30
"RTN","SYNTSTRS",93,0)
 . I (URL["DEMRNG")!(URL["DEMALL") S TIMEOUT=300
"RTN","SYNTSTRS",94,0)
 . ;                    (URL,XT8FLG,XT8RDAT,XT8RHDR,XT8SDAT,XT8SHDR,REDIR)
"RTN","SYNTSTRS",95,0)
 . S RET=$$GETURL^XTHC10(URLSTR,TIMEOUT,"RETDATA","RETHDR")
"RTN","SYNTSTRS",96,0)
 . ; check status of web call
"RTN","SYNTSTRS",97,0)
 . I +RET'=200 D  QUIT
"RTN","SYNTSTRS",98,0)
 . . W ">>Error from Kernel call: ",+RET_":"_$P(RET,U,2),!!
"RTN","SYNTSTRS",99,0)
 . . S CNTKER=CNTKER+1
"RTN","SYNTSTRS",100,0)
 . . S:PF="P" ANOMALY(IEN)="Test should pass"
"RTN","SYNTSTRS",101,0)
 . S POS=$O(RETDATA(""))
"RTN","SYNTSTRS",102,0)
 . I POS="" D  QUIT
"RTN","SYNTSTRS",103,0)
 . . W ">>Error: no data returned: ",RET,!!
"RTN","SYNTSTRS",104,0)
 . . S CNTERR=CNTERR+1
"RTN","SYNTSTRS",105,0)
 . . S:PF="P" ANOMALY(IEN)="Test should pass"
"RTN","SYNTSTRS",106,0)
 . I ($P(RETDATA(POS),U,1)=-1)!(RETDATA(POS)["error")!(RETDATA(POS)["ERROR") D  QUIT
"RTN","SYNTSTRS",107,0)
 . . W ">>Error from service: ",RETDATA(POS),!!
"RTN","SYNTSTRS",108,0)
 . . S CNTERR=CNTERR+1
"RTN","SYNTSTRS",109,0)
 . . S:PF="P" ANOMALY(IEN)="Test should pass"
"RTN","SYNTSTRS",110,0)
 . S:PF="F" ANOMALY(IEN)="Test should fail"
"RTN","SYNTSTRS",111,0)
 . I MODE="O" D
"RTN","SYNTSTRS",112,0)
 . . W "Returned data:",!
"RTN","SYNTSTRS",113,0)
 . . N x S x=""
"RTN","SYNTSTRS",114,0)
 . . F  S x=$O(RETDATA(x)) QUIT:x=""  D
"RTN","SYNTSTRS",115,0)
 . . . W RETDATA(x)
"RTN","SYNTSTRS",116,0)
 . . . N y S y=""
"RTN","SYNTSTRS",117,0)
 . . . F  S y=$O(RETDATA(x,y)) QUIT:y=""  D
"RTN","SYNTSTRS",118,0)
 . . . . W RETDATA(x,y)
"RTN","SYNTSTRS",119,0)
 . . W !!
"RTN","SYNTSTRS",120,0)
 . E  D
"RTN","SYNTSTRS",121,0)
 . . W $S($D(RETDATA(POS,1)):"Partial return data: ",1:"Returned data: "),RETDATA(POS),!!
"RTN","SYNTSTRS",122,0)
 . S CNTPASS=CNTPASS+1
"RTN","SYNTSTRS",123,0)
 ;
"RTN","SYNTSTRS",124,0)
 N ENDTM S ENDTM=$$NOW^XLFDT()
"RTN","SYNTSTRS",125,0)
 N ELAPSED S ELAPSED=$$FMDIFF^XLFDT(ENDTM,STARTTM,3)
"RTN","SYNTSTRS",126,0)
 W !,"-------------------------------------------------------------------",!!
"RTN","SYNTSTRS",127,0)
 W "Total tests:   ",$J(TOTTEST,6),!
"RTN","SYNTSTRS",128,0)
 W "Total to pass: ",$J(TOTPASS,6),?33,"Passed: ",$J(CNTPASS,6),!
"RTN","SYNTSTRS",129,0)
 W "Total to fail: ",$J(TOTFAIL,6),?33,"Failed: ",$J(CNTKER+CNTERR,6),!
"RTN","SYNTSTRS",130,0)
 W ?35,"Kernel call:  ",$J(CNTKER,6),!
"RTN","SYNTSTRS",131,0)
 W ?35,"Service call: ",$J(CNTERR,6),!
"RTN","SYNTSTRS",132,0)
 ;
"RTN","SYNTSTRS",133,0)
 W !,"Start time:   ",$$FMTE^XLFDT(STARTTM,7),!
"RTN","SYNTSTRS",134,0)
 W "End time:     ",$$FMTE^XLFDT(ENDTM,7),!
"RTN","SYNTSTRS",135,0)
 W "Elapsed time: ",ELAPSED,!
"RTN","SYNTSTRS",136,0)
 ;
"RTN","SYNTSTRS",137,0)
 I $D(ANOMALY) D
"RTN","SYNTSTRS",138,0)
 . W !,"Anomalies:",!
"RTN","SYNTSTRS",139,0)
 . W "Test",?9,"Comment",!
"RTN","SYNTSTRS",140,0)
 . S x=""
"RTN","SYNTSTRS",141,0)
 . F  S x=$O(ANOMALY(x)) QUIT:x=""  D
"RTN","SYNTSTRS",142,0)
 . . W "  ",x,?9,ANOMALY(x),!
"RTN","SYNTSTRS",143,0)
 ;
"RTN","SYNTSTRS",144,0)
 QUIT
"RTN","SYNTSTRS",145,0)
 ;
"RTN","SYNTSTRS",146,0)
 ;--------------------------------------------------------------------------
"RTN","SYNTSTRS",147,0)
 ;
"RTN","SYNTSTRS",148,0)
UI ;User Interface to run service tests
"RTN","SYNTSTRS",149,0)
 ;
"RTN","SYNTSTRS",150,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",151,0)
 S DIR(0)="SB^P:Pick from lists;U:Enter URL"
"RTN","SYNTSTRS",152,0)
 S DIR("A")="Mode: (P)ick from lists, or enter (U)RL"
"RTN","SYNTSTRS",153,0)
 ;S DIR("B")=""
"RTN","SYNTSTRS",154,0)
 S DIR("?")="Enter P or U"
"RTN","SYNTSTRS",155,0)
 S DIR("??")="Enter P or U"
"RTN","SYNTSTRS",156,0)
 D ^DIR
"RTN","SYNTSTRS",157,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) QUIT
"RTN","SYNTSTRS",158,0)
 N MODE S MODE=Y
"RTN","SYNTSTRS",159,0)
 ;
"RTN","SYNTSTRS",160,0)
 N URL S URL=""
"RTN","SYNTSTRS",161,0)
 I MODE="P" D
"RTN","SYNTSTRS",162,0)
 . N SERVER S SERVER=$$GETSERVER()
"RTN","SYNTSTRS",163,0)
 . QUIT:SERVER=""
"RTN","SYNTSTRS",164,0)
 . N SERVICE S SERVICE=$$GETSERVICE()
"RTN","SYNTSTRS",165,0)
 . QUIT:SERVICE=""
"RTN","SYNTSTRS",166,0)
 . N PARAMS S PARAMS=$$GETPARAMS()
"RTN","SYNTSTRS",167,0)
 . S URL=SERVER_SERVICE_PARAMS
"RTN","SYNTSTRS",168,0)
 E  D
"RTN","SYNTSTRS",169,0)
 . S URL=$$GETURL()
"RTN","SYNTSTRS",170,0)
 ;
"RTN","SYNTSTRS",171,0)
 QUIT:URL=""
"RTN","SYNTSTRS",172,0)
 ;
"RTN","SYNTSTRS",173,0)
 W !!,"URL: ",URL,!
"RTN","SYNTSTRS",174,0)
 ;
"RTN","SYNTSTRS",175,0)
 N TIMEOUT S TIMEOUT=30
"RTN","SYNTSTRS",176,0)
 I (URL["DEMRNG")!(URL["DEMALL") S TIMEOUT=300
"RTN","SYNTSTRS",177,0)
 N RETDATA,RETHDR
"RTN","SYNTSTRS",178,0)
 N RET S RET=$$GETURL^XTHC10(URL,TIMEOUT,"RETDATA","RETHDR")
"RTN","SYNTSTRS",179,0)
 ; check status of web call
"RTN","SYNTSTRS",180,0)
 I +RET'=200 D  QUIT
"RTN","SYNTSTRS",181,0)
 . W ">>Error from Kernel call: ",+RET_":"_$P(RET,U,2),!!
"RTN","SYNTSTRS",182,0)
 N POS S POS=$O(RETDATA(""))
"RTN","SYNTSTRS",183,0)
 I POS="" D  QUIT
"RTN","SYNTSTRS",184,0)
 . W ">>Error: no data returned: ",RET,!!
"RTN","SYNTSTRS",185,0)
 I ($P(RETDATA(POS),U,1)=-1)!(RETDATA(POS)["error")!(RETDATA(POS)["ERROR") D  QUIT
"RTN","SYNTSTRS",186,0)
 . W ">>Error from service: ",RETDATA(POS),!!
"RTN","SYNTSTRS",187,0)
 W "Returned data:",!
"RTN","SYNTSTRS",188,0)
 N x S x=""
"RTN","SYNTSTRS",189,0)
 F  S x=$O(RETDATA(x)) QUIT:x=""  D
"RTN","SYNTSTRS",190,0)
 . W RETDATA(x)
"RTN","SYNTSTRS",191,0)
 . N y S y=""
"RTN","SYNTSTRS",192,0)
 . F  S y=$O(RETDATA(x,y)) QUIT:y=""  D
"RTN","SYNTSTRS",193,0)
 . . W RETDATA(x,y)
"RTN","SYNTSTRS",194,0)
 W !!
"RTN","SYNTSTRS",195,0)
 ;
"RTN","SYNTSTRS",196,0)
 QUIT
"RTN","SYNTSTRS",197,0)
 ;
"RTN","SYNTSTRS",198,0)
 ; check status of web call
"RTN","SYNTSTRS",199,0)
 I +RET'=200 D  QUIT
"RTN","SYNTSTRS",200,0)
 . W ">>Error from Kernel call: ",+RET_":"_$P(RET,U,2),!!
"RTN","SYNTSTRS",201,0)
 . S CNTKER=CNTKER+1
"RTN","SYNTSTRS",202,0)
 . S:PF="P" ANOMALY(IEN)="Test should pass"
"RTN","SYNTSTRS",203,0)
 S POS=$O(RETDATA(""))
"RTN","SYNTSTRS",204,0)
 I POS="" D  QUIT
"RTN","SYNTSTRS",205,0)
 . W ">>Error: no data returned: ",RET,!!
"RTN","SYNTSTRS",206,0)
 . S CNTERR=CNTERR+1
"RTN","SYNTSTRS",207,0)
 . S:PF="P" ANOMALY(IEN)="Test should pass"
"RTN","SYNTSTRS",208,0)
 I ($P(RETDATA(POS),U,1)=-1)!(RETDATA(POS)["error")!(RETDATA(POS)["ERROR") D  QUIT
"RTN","SYNTSTRS",209,0)
 . W ">>Error from service: ",RETDATA(POS),!!
"RTN","SYNTSTRS",210,0)
 . S CNTERR=CNTERR+1
"RTN","SYNTSTRS",211,0)
 . S:PF="P" ANOMALY(IEN)="Test should pass"
"RTN","SYNTSTRS",212,0)
 S:PF="F" ANOMALY(IEN)="Test should fail"
"RTN","SYNTSTRS",213,0)
 ;----------------- functions -----------------
"RTN","SYNTSTRS",214,0)
 ;
"RTN","SYNTSTRS",215,0)
GETSERVER() ;Choose a server name
"RTN","SYNTSTRS",216,0)
 ;Returns a server name
"RTN","SYNTSTRS",217,0)
 ;
"RTN","SYNTSTRS",218,0)
 N STR,n,SERVERS,SERVER,DESC
"RTN","SYNTSTRS",219,0)
 S SERVERS(1)="http://localhost:8001/"_U_"localhost"
"RTN","SYNTSTRS",220,0)
 W !,"Servers:",!
"RTN","SYNTSTRS",221,0)
 W 1,?3,$P(SERVERS(1),"/",3),!
"RTN","SYNTSTRS",222,0)
 ;F n=1:1 S STR=$P($T(urlli+n),";;",2) QUIT:STR["urlend"  D
"RTN","SYNTSTRS",223,0)
 F n=1:1 S STR=$P($T(urlli+n^SYNDTS89),";;",2) QUIT:STR["urlend"  D
"RTN","SYNTSTRS",224,0)
 . S SERVER=$$TRIM^XLFSTR($P(STR,";",1))
"RTN","SYNTSTRS",225,0)
 . S DESC=$$TRIM^XLFSTR($P(STR,";",2))
"RTN","SYNTSTRS",226,0)
 . S SERVERS(n+1)=SERVER_U_DESC
"RTN","SYNTSTRS",227,0)
 . W n+1,?3,$P(STR,"/",3),"   (",$P(SERVERS(n+1),U,2),")",!
"RTN","SYNTSTRS",228,0)
 ;
"RTN","SYNTSTRS",229,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",230,0)
 S DIR(0)="LA^1:"_n
"RTN","SYNTSTRS",231,0)
 S DIR("A")="Choose a Server: "
"RTN","SYNTSTRS",232,0)
 ;S DIR("B")=""
"RTN","SYNTSTRS",233,0)
 S DIR("?")="Enter Server Number (1-"_n_")"
"RTN","SYNTSTRS",234,0)
 S DIR("??")="Enter Server Number (1-"_n_")"
"RTN","SYNTSTRS",235,0)
 D ^DIR
"RTN","SYNTSTRS",236,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) QUIT ""
"RTN","SYNTSTRS",237,0)
 N SERVNBR S SERVNBR=+Y
"RTN","SYNTSTRS",238,0)
 ;
"RTN","SYNTSTRS",239,0)
 QUIT $P($G(SERVERS(SERVNBR)),U,1)
"RTN","SYNTSTRS",240,0)
 ;
"RTN","SYNTSTRS",241,0)
GETSERVICE() ;Choose a service name
"RTN","SYNTSTRS",242,0)
 ;Returns a service name
"RTN","SYNTSTRS",243,0)
 ;
"RTN","SYNTSTRS",244,0)
 N RSNBR S RSNBR=0
"RTN","SYNTSTRS",245,0)
 N RSCNT,RSNAMES
"RTN","SYNTSTRS",246,0)
 N RSNAME S RSNAME=""
"RTN","SYNTSTRS",247,0)
 F  S RSNAME=$O(^RGNET(996.52,"B",RSNAME)) QUIT:RSNAME=""  D
"RTN","SYNTSTRS",248,0)
 . QUIT:$E(RSNAME,1,3)'="DHP"
"RTN","SYNTSTRS",249,0)
 . QUIT:RSNAME["/"
"RTN","SYNTSTRS",250,0)
 . S RSNBR=RSNBR+1
"RTN","SYNTSTRS",251,0)
 . S RSNAMES(RSNBR)=RSNAME
"RTN","SYNTSTRS",252,0)
 . ;W !,RSNBR,"  ",RSNAMES(RSNBR)
"RTN","SYNTSTRS",253,0)
 ;
"RTN","SYNTSTRS",254,0)
 N RSLAST S RSLAST=0
"RTN","SYNTSTRS",255,0)
 N ITEMCNT S ITEMCNT=0
"RTN","SYNTSTRS",256,0)
 S RSNBR=""
"RTN","SYNTSTRS",257,0)
 W !!,"Service Names:"
"RTN","SYNTSTRS",258,0)
 F  S RSNBR=$O(RSNAMES(RSNBR)) QUIT:RSNBR=""  D
"RTN","SYNTSTRS",259,0)
 . S ITEMCNT=ITEMCNT+1
"RTN","SYNTSTRS",260,0)
 . S RSLAST=RSNBR
"RTN","SYNTSTRS",261,0)
 . I ITEMCNT=3 D
"RTN","SYNTSTRS",262,0)
 . . W !,RSNBR-2,"  ",RSNAMES(RSNBR-2),?26,RSNBR-1,"  ",RSNAMES(RSNBR-1),?52,RSNBR,"  ",RSNAMES(RSNBR)
"RTN","SYNTSTRS",263,0)
 . . S ITEMCNT=0
"RTN","SYNTSTRS",264,0)
 W:ITEMCNT=1 !,RSLAST,"  ",RSNAMES(RSLAST)
"RTN","SYNTSTRS",265,0)
 W:ITEMCNT=2 !,RSLAST-1,"  ",RSNAMES(RSLAST-1),?26,RSLAST,"  ",RSNAMES(RSLAST)
"RTN","SYNTSTRS",266,0)
 W !
"RTN","SYNTSTRS",267,0)
 ;
"RTN","SYNTSTRS",268,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",269,0)
 S DIR(0)="LA^1:"_RSLAST
"RTN","SYNTSTRS",270,0)
 S DIR("A")="Choose a Service: "
"RTN","SYNTSTRS",271,0)
 ;S DIR("B")=""
"RTN","SYNTSTRS",272,0)
 S DIR("?")="Enter Service Number (1-"_RSLAST_")"
"RTN","SYNTSTRS",273,0)
 S DIR("??")="Enter Service Number (1-"_RSLAST_")"
"RTN","SYNTSTRS",274,0)
 D ^DIR
"RTN","SYNTSTRS",275,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) QUIT ""
"RTN","SYNTSTRS",276,0)
 N RSNBR S RSNBR=+Y
"RTN","SYNTSTRS",277,0)
 ;
"RTN","SYNTSTRS",278,0)
 QUIT RSNAMES(RSNBR)
"RTN","SYNTSTRS",279,0)
 ;
"RTN","SYNTSTRS",280,0)
GETPARAMS() ;Define the Parameter(s)
"RTN","SYNTSTRS",281,0)
 ;Returns a parameter list
"RTN","SYNTSTRS",282,0)
 ;
"RTN","SYNTSTRS",283,0)
 W !!,"Define Parameter(s)",!
"RTN","SYNTSTRS",284,0)
 N PARAMS S PARAMS=""
"RTN","SYNTSTRS",285,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",286,0)
 N PNBR
"RTN","SYNTSTRS",287,0)
 F PNBR=1:1 D  QUIT:Y="" 
"RTN","SYNTSTRS",288,0)
 . S DIR(0)="FAO^3:50"
"RTN","SYNTSTRS",289,0)
 . S DIR("A")="P"_PNBR_": "
"RTN","SYNTSTRS",290,0)
 . ;S DIR("B")=""
"RTN","SYNTSTRS",291,0)
 . S DIR("?")="Enter NAME=VALUE"
"RTN","SYNTSTRS",292,0)
 . S DIR("??")="Enter NAME=VALUE"
"RTN","SYNTSTRS",293,0)
 . D ^DIR
"RTN","SYNTSTRS",294,0)
 . I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) S Y="" QUIT
"RTN","SYNTSTRS",295,0)
 . N PARAM S PARAM=Y
"RTN","SYNTSTRS",296,0)
 . I PARAM'="",PARAMS'="" S PARAMS=PARAMS_"&"_PARAM
"RTN","SYNTSTRS",297,0)
 . I PARAM'="",PARAMS="" S PARAMS="?"_PARAM
"RTN","SYNTSTRS",298,0)
 ;
"RTN","SYNTSTRS",299,0)
 QUIT PARAMS
"RTN","SYNTSTRS",300,0)
 ;
"RTN","SYNTSTRS",301,0)
GETURL() ;Enter a URL
"RTN","SYNTSTRS",302,0)
 ;Returns a string that should be a URL
"RTN","SYNTSTRS",303,0)
 ;
"RTN","SYNTSTRS",304,0)
 W !!,"Enter a URL",!
"RTN","SYNTSTRS",305,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","SYNTSTRS",306,0)
 S DIR(0)="FAO^0:245"
"RTN","SYNTSTRS",307,0)
 S DIR("A")="URL: "
"RTN","SYNTSTRS",308,0)
 ;S DIR("B")=""
"RTN","SYNTSTRS",309,0)
 S DIR("?")="Enter a URL"
"RTN","SYNTSTRS",310,0)
 S DIR("??")="Enter a URL - server/service?parameters"
"RTN","SYNTSTRS",311,0)
 D ^DIR
"RTN","SYNTSTRS",312,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) S Y="" QUIT ""
"RTN","SYNTSTRS",313,0)
 N URL S URL=Y
"RTN","SYNTSTRS",314,0)
 ;
"RTN","SYNTSTRS",315,0)
 QUIT URL
"RTN","SYNTSTRS",316,0)
 ;
"RTN","SYNTSTRS",317,0)
 ;------------------- data -------------------
"RTN","SYNTSTRS",318,0)
 ;
"RTN","SYNTSTRS",319,0)
urlli ; list of url roots
"RTN","SYNTSTRS",320,0)
 ;;http://localhost:9080/;   AWS dev %webreq
"RTN","SYNTSTRS",321,0)
 ;;http://ec2-18-208-29-125.compute-1.amazonaws.com:8001/;awsdev;                AWS dev
"RTN","SYNTSTRS",322,0)
 ;;http://ec2-18-208-29-125.compute-1.amazonaws.com:9080/;awsdevshm;             AWS dev shim
"RTN","SYNTSTRS",323,0)
 ;;https://vista.dev.openplatform.healthcare/rgnet-web/;k8dev;                   k8 dev
"RTN","SYNTSTRS",324,0)
 ;;https://vista.dev.openplatform.healthcare/vpr-web/;k8devshm;                  k8 dev shim
"RTN","SYNTSTRS",325,0)
 ;;https://vista.demo-staging.openplatform.healthcare/rgnet-web/;k8demstag;      k8 demo-staging
"RTN","SYNTSTRS",326,0)
 ;;https://vista.demo-staging.openplatform.healthcare/rgnet-web/;k8demstagshm;   k8 demo-staging shim
"RTN","SYNTSTRS",327,0)
 ;;https://vista.demo.openplatform.healthcare/rgnet-web/;k8demo;                 k8 demo
"RTN","SYNTSTRS",328,0)
 ;;https://vista.demo.openplatform.healthcare/vpr-web/;k8demoshm;                k8 demo shim 
"RTN","SYNTSTRS",329,0)
 ;;https://vista-general.dev.openplatform.healthcare/rgnet-web/;targen;          tardis general
"RTN","SYNTSTRS",330,0)
 ;;https://vista-general.dev.openplatform.healthcare/vpr-web/;targenshm;         tardis general shim
"RTN","SYNTSTRS",331,0)
 ;;https://vista-emergency.dev.openplatform.healthcare/rgnet-web/;taremer;       tardis emergency
"RTN","SYNTSTRS",332,0)
 ;;https://vista-emergency.dev.openplatform.healthcare/vpr-web/;taremershm;      tardis emergency shim
"RTN","SYNTSTRS",333,0)
 ;;https://vista-specialization.dev.openplatform.healthcare/rgnet-web/;tarspec;  tardis specialization
"RTN","SYNTSTRS",334,0)
 ;;https://vista-specialization.dev.openplatform.healthcare/vpr-web/;tarspecshm; tardis specialization shim
"RTN","SYNTSTRS",335,0)
 ;;http://shadow.vistaplex.org/;shadvplex;                                       GT.M server
"RTN","SYNTSTRS",336,0)
 ;;http://syn.vistaplex.org/;synvplex;                                           GT.M server
"RTN","SYNTSTRS",337,0)
 ;;urlend
"RTN","SYNTSTRS",338,0)
 Q
"RTN","SYNTSTRS",339,0)
 ;
"SEC","^DIC",996.5,996.5,0,"AUDIT")
@
"SEC","^DIC",996.5,996.5,0,"DD")
@
"SEC","^DIC",996.5,996.5,0,"DEL")
@
"SEC","^DIC",996.5,996.5,0,"LAYGO")
@
"SEC","^DIC",996.5,996.5,0,"RD")
@
"SEC","^DIC",996.5,996.5,0,"WR")
@
"SEC","^DIC",996.52,996.52,0,"AUDIT")
@
"SEC","^DIC",996.52,996.52,0,"DD")
@
"SEC","^DIC",996.52,996.52,0,"DEL")
@
"SEC","^DIC",996.52,996.52,0,"LAYGO")
@
"SEC","^DIC",996.52,996.52,0,"RD")
@
"SEC","^DIC",996.52,996.52,0,"WR")
@
"SEC","^DIC",2002.1,2002.1,0,"AUDIT")
@
"SEC","^DIC",2002.1,2002.1,0,"DD")
@
"SEC","^DIC",2002.1,2002.1,0,"DEL")
@
"SEC","^DIC",2002.1,2002.1,0,"LAYGO")
@
"SEC","^DIC",2002.1,2002.1,0,"RD")
@
"SEC","^DIC",2002.1,2002.1,0,"WR")
@
"VER")
8.0^22.2
"^DD",996.5,996.5,0)
FIELD^^4^6
"^DD",996.5,996.5,0,"DDA")
N
"^DD",996.5,996.5,0,"DT")
3190502
"^DD",996.5,996.5,0,"IX","B",996.5,.01)

"^DD",996.5,996.5,0,"NM","NETSERV TCP LISTENER")

"^DD",996.5,996.5,0,"VRPK")
NETSERV CONNECTION MANAGER
"^DD",996.5,996.5,.01,0)
NAME^RF^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",996.5,996.5,.01,1,0)
^.1
"^DD",996.5,996.5,.01,1,1,0)
996.5^B
"^DD",996.5,996.5,.01,1,1,1)
S ^RGNET(996.5,"B",$E(X,1,30),DA)=""
"^DD",996.5,996.5,.01,1,1,2)
K ^RGNET(996.5,"B",$E(X,1,30),DA)
"^DD",996.5,996.5,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",996.5,996.5,.01,21,0)
^^1^1^3150330.090909
"^DD",996.5,996.5,.01,21,1,0)
This is the unique name for the primary listener.
"^DD",996.5,996.5,1,0)
PORT^NJ5,0^^0;2^K:+X'=X!(X>32767)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,1,3)
Enter the TCP port number.
"^DD",996.5,996.5,1,21,0)
^^2^2^3150330.090954
"^DD",996.5,996.5,1,21,1,0)
This is the TCP port that the primary listener uses to service connection
"^DD",996.5,996.5,1,21,2,0)
requests.
"^DD",996.5,996.5,1,"DT")
3150329
"^DD",996.5,996.5,2,0)
UCI^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",996.5,996.5,2,3)
Enter the target UCI (none = current).
"^DD",996.5,996.5,2,21,0)
^^2^2^3150330.091148
"^DD",996.5,996.5,2,21,1,0)
This is the UCI where the primary listener should be spawned.  If not specified,
"^DD",996.5,996.5,2,21,2,0)
the primary listener will reside in the same UCI where it was initially spawned.
"^DD",996.5,996.5,2,"DT")
3150329
"^DD",996.5,996.5,3,0)
DISABLE^S^0:NO;1:YES;^0;4^Q
"^DD",996.5,996.5,3,3)
Enter YES to disable the listener.
"^DD",996.5,996.5,3,21,0)
^^2^2^3150330.091254
"^DD",996.5,996.5,3,21,1,0)
If set to YES, attempts to spawn a primary or secondary listener will fail.
"^DD",996.5,996.5,3,21,2,0)
This has no impact on currently running listeners.
"^DD",996.5,996.5,3,"DT")
3150330
"^DD",996.5,996.5,4,0)
MAXIMUM^NJ6,0^^0;5^K:+X'=X!(X>999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",996.5,996.5,4,3)
Enter the maximum number of secondary listeners.
"^DD",996.5,996.5,4,21,0)
^.001^3^3^3150330^
"^DD",996.5,996.5,4,21,1,0)
This sets the maximum allowable number of secondary listeners that may be 
"^DD",996.5,996.5,4,21,2,0)
spawned by the primary listener.  When this number is exceeded, additional
"^DD",996.5,996.5,4,21,3,0)
connection requests will be denied.
"^DD",996.5,996.5,4,"DT")
3150330
"^DD",996.5,996.5,10,0)
HANDLER^FX^^10;E1,250^K:X'?.8AN1"^"1.8AN X
"^DD",996.5,996.5,10,3)
Enter entry point for I/O handler as TAG^ROUTINE.
"^DD",996.5,996.5,10,21,0)
^^7^7^3150330.091725
"^DD",996.5,996.5,10,21,1,0)
This is the entry point (as TAG^ROUTINE) that will service an established
"^DD",996.5,996.5,10,21,2,0)
connection.  The handler should relinquish control back to the caller after
"^DD",996.5,996.5,10,21,3,0)
completing each request/response cycle to allow the caller to determine if
"^DD",996.5,996.5,10,21,4,0)
the connection should be terminated.  The handler may request termination
"^DD",996.5,996.5,10,21,5,0)
by setting RGQUIT to a nonzero value.  Otherwise, unless an external request
"^DD",996.5,996.5,10,21,6,0)
to terminate the connection has been received, the handler will be called
"^DD",996.5,996.5,10,21,7,0)
again.
"^DD",996.5,996.5,10,"DT")
3150330
"^DD",996.52,996.52,0)
FIELD^^20^6
"^DD",996.52,996.52,0,"DDA")
N
"^DD",996.52,996.52,0,"DT")
3190502
"^DD",996.52,996.52,0,"IX","ACE",996.52,20)

"^DD",996.52,996.52,0,"IX","B",996.52,.01)

"^DD",996.52,996.52,0,"NM","NETSERV HTTP ENDPOINT")

"^DD",996.52,996.52,0,"VRPK")
NETSERV WEB SERVER
"^DD",996.52,996.52,.01,0)
URL^RF^^0;1^K:$L(X)>150!($L(X)<1) X
"^DD",996.52,996.52,.01,1,0)
^.1
"^DD",996.52,996.52,.01,1,1,0)
996.52^B
"^DD",996.52,996.52,.01,1,1,1)
S ^RGNET(996.52,"B",$E(X,1,30),DA)=""
"^DD",996.52,996.52,.01,1,1,2)
K ^RGNET(996.52,"B",$E(X,1,30),DA)
"^DD",996.52,996.52,.01,3)
Enter URL pattern for this endpoint.
"^DD",996.52,996.52,.01,21,0)
^^6^6^3150330.151834
"^DD",996.52,996.52,.01,21,1,0)
This is the pattern to which a request URL is to be matched.  It may contain
"^DD",996.52,996.52,.01,21,2,0)
the following wildcard characters:
"^DD",996.52,996.52,.01,21,3,0)

"^DD",996.52,996.52,.01,21,4,0)
       * Matches any character sequence.
"^DD",996.52,996.52,.01,21,5,0)
       # Matches any sequence of digits.
"^DD",996.52,996.52,.01,21,6,0)

"^DD",996.52,996.52,.01,"DT")
3150330
"^DD",996.52,996.52,1,0)
METHOD^S^GET:GET;HEAD:HEAD;POST:POST;PUT:PUT;DELETE:DELETE;^0;2^Q
"^DD",996.52,996.52,1,"DT")
3150330
"^DD",996.52,996.52,2,0)
AUTH^S^BASIC:BASIC AUTHENTICATION;BEARER:OAUTH2 AUTHENTICATION;ANY:ANY METHOD;^0;3^Q
"^DD",996.52,996.52,2,3)
Enter authentication type (or no entry for none).
"^DD",996.52,996.52,2,21,0)
^^6^6^3150331.200154
"^DD",996.52,996.52,2,21,1,0)
This determines the type of authentication required for the associated endpoint.
"^DD",996.52,996.52,2,21,2,0)

"^DD",996.52,996.52,2,21,3,0)
       BASIC - Basic authentication (username/password)
"^DD",996.52,996.52,2,21,4,0)
       OAUTH - OAuth2 authentication (bearer)
"^DD",996.52,996.52,2,21,5,0)

"^DD",996.52,996.52,2,21,6,0)
No entry means that no authentication is required.
"^DD",996.52,996.52,2,"DT")
3150423
"^DD",996.52,996.52,10,0)
HANDLER^FXJ1^^10;E1,250^K:X'?.15AN1"^"1.8AN X
"^DD",996.52,996.52,10,3)
Enter the handler entry point as TAG^ROUTINE.
"^DD",996.52,996.52,10,"DT")
3180614
"^DD",996.52,996.52,20,0)
ACCESS CONTROL^FX^^20;E1,250^I $$ACECOMP^RGNETWWW(.X)
"^DD",996.52,996.52,20,1,0)
^.1
"^DD",996.52,996.52,20,1,1,0)
996.52^ACE^MUMPS
"^DD",996.52,996.52,20,1,1,1)
S ^RGNET(996.52,DA,20,"ACE")=$$ACECOMP^RGNETWWW(.X,1)
"^DD",996.52,996.52,20,1,1,2)
K ^RGNET(996.52,DA,20,"ACE")
"^DD",996.52,996.52,20,1,1,"DT")
3150413
"^DD",996.52,996.52,20,3)
Enter an access control expression to constrain access.
"^DD",996.52,996.52,20,21,0)
^^16^16^3150413.114739
"^DD",996.52,996.52,20,21,1,0)
An access control expression allows you to constrain access to an endpoint based
"^DD",996.52,996.52,20,21,2,0)
upon security keys, parameters, and options held (or not held) by a user.  An
"^DD",996.52,996.52,20,21,3,0)
expression can contain the operators:
"^DD",996.52,996.52,20,21,4,0)

"^DD",996.52,996.52,20,21,5,0)
       & = Logical AND of two results
"^DD",996.52,996.52,20,21,6,0)
       ! = Logical OR of two results
"^DD",996.52,996.52,20,21,7,0)
       ' = Negate a logical result
"^DD",996.52,996.52,20,21,8,0)

"^DD",996.52,996.52,20,21,9,0)
An expression can contain operands in one of the following formats:
"^DD",996.52,996.52,20,21,10,0)

"^DD",996.52,996.52,20,21,11,0)
       K.<name> = Security key of the specified name
"^DD",996.52,996.52,20,21,12,0)
       O.<name> = Option of the specified name
"^DD",996.52,996.52,20,21,13,0)
       P.<name> = Parameter of the specified name
"^DD",996.52,996.52,20,21,14,0)

"^DD",996.52,996.52,20,21,15,0)
Finally, an expression can contain parentheses to control the sequence of
"^DD",996.52,996.52,20,21,16,0)
subexpression evaluation.
"^DD",996.52,996.52,20,"DT")
3150413
"^DD",996.52,996.52,99,0)
DESCRIPTION^996.52099^^99;0
"^DD",996.52,996.52099,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",996.52,996.52099,0,"DT")
3150330
"^DD",996.52,996.52099,0,"NM","DESCRIPTION")

"^DD",996.52,996.52099,0,"UP")
996.52
"^DD",996.52,996.52099,.01,0)
DESCRIPTION^WL^^0;1^Q
"^DD",996.52,996.52099,.01,21,0)
^^1^1^3150330.181043
"^DD",996.52,996.52099,.01,21,1,0)
Provides a detailed description of this end point.
"^DD",996.52,996.52099,.01,"DT")
3150330
"^DD",2002.1,2002.1,0)
FIELD^^1^2
"^DD",2002.1,2002.1,0,"DT")
3190502
"^DD",2002.1,2002.1,0,"IX","B",2002.1,.01)

"^DD",2002.1,2002.1,0,"NM","SYN REST UNIT TESTS")

"^DD",2002.1,2002.1,.01,0)
URL^RFJ245^^0;1^K:$L(X)>245!($L(X)<1) X
"^DD",2002.1,2002.1,.01,1,0)
^.1
"^DD",2002.1,2002.1,.01,1,1,0)
2002.1^B
"^DD",2002.1,2002.1,.01,1,1,1)
S ^SYN(2002.1,"B",$E(X,1,30),DA)=""
"^DD",2002.1,2002.1,.01,1,1,2)
K ^SYN(2002.1,"B",$E(X,1,30),DA)
"^DD",2002.1,2002.1,.01,3)
Enter a Unit Test URL, 1 to 245 characters.
"^DD",2002.1,2002.1,.01,21,0)
^^2^2^3190418^
"^DD",2002.1,2002.1,.01,21,1,0)
This is the unit test URL. Generally, the format is 
"^DD",2002.1,2002.1,.01,21,2,0)
http://server:port/service name?parameters
"^DD",2002.1,2002.1,.01,"DT")
3190418
"^DD",2002.1,2002.1,1,0)
PASS/FAIL^RS^P:Pass;F:Fail;^0;2^Q
"^DD",2002.1,2002.1,1,3)
Enter P if this unit test should Pass, F if it should Fail.
"^DD",2002.1,2002.1,1,21,0)
^^1^1^3190418^
"^DD",2002.1,2002.1,1,21,1,0)
This is a flag to indicate whether a unit test should pass or fail.
"^DD",2002.1,2002.1,1,"DT")
3190418
"^DIC",996.5,996.5,0)
NETSERV TCP LISTENER^996.5
"^DIC",996.5,996.5,0,"GL")
^RGNET(996.5,
"^DIC",996.5,996.5,"%D",0)
^1.001^2^2^3150330^
"^DIC",996.5,996.5,"%D",1,0)
Each entry in this file represents a configuration for a listener that will
"^DIC",996.5,996.5,"%D",2,0)
process requests on a given TCP port via the specified handler.
"^DIC",996.5,"B","NETSERV TCP LISTENER",996.5)

"^DIC",996.52,996.52,0)
NETSERV HTTP ENDPOINT^996.52
"^DIC",996.52,996.52,0,"GL")
^RGNET(996.52,
"^DIC",996.52,996.52,"%",0)
^1.005^^0
"^DIC",996.52,996.52,"%D",0)
^^3^3^3150330.180223
"^DIC",996.52,996.52,"%D",1,0)
This file defines execution endpoints for HTTP-based services. A service 
"^DIC",996.52,996.52,"%D",2,0)
request is matched to its respective endpoint by matching the request method 
"^DIC",996.52,996.52,"%D",3,0)
and the request URL to the corresponding entry in this file.
"^DIC",996.52,"B","NETSERV HTTP ENDPOINT",996.52)

"^DIC",2002.1,2002.1,0)
SYN REST UNIT TESTS^2002.1
"^DIC",2002.1,2002.1,0,"GL")
^SYN(2002.1,
"^DIC",2002.1,"B","SYN REST UNIT TESTS",2002.1)

**END**
**END**
